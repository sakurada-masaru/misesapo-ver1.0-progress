<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ミセサポポータル</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        /*
         ========================================
           📋 CSS変数リファレンス（カテゴリ別）
           誰が見てもすぐ把握できるように、主要な変数の目的と範囲を記載
         ========================================
         🎨 カラーパレット (Color Palette)
           - --color-primary: メインカラー（ピンク）
           - --color-primary-hover: ホバー時の色
           - --color-primary-light: アクセント用の薄い色（シャドウ/フォーカス）
           - --color-primary-shadow: 濃いめのシャドウ色
           - --color-background: 背景色（白）
           - --color-background-secondary: サブ背景色（薄いグレー）
           - --color-background-card: カード背景色
           - --color-text-primary: メインテキスト色
           - --color-text-secondary: サブテキスト色
           - --color-text-muted: 補助テキスト色
           - --color-border: 枠線の基本色
           - --color-border-light: 枠線の薄い色
           - --color-success / --color-danger / --color-warning / --color-info: 状態色

         📝 フォント設定 (Typography)
           - --font-family-primary: フォントファミリー
           - --font-size-xs ～ --font-size-4xl: フォントサイズ
           - --font-weight-normal ～ --font-weight-bold: フォントウェイト
           - --line-height-tight/normal/relaxed: 行間

         📏 スペーシング (Spacing)
           - --spacing-xs ～ --spacing-6xl: 基本スペーシング単位
           - --padding-*: パディング用マップ（spacingのエイリアス）
           - --margin-*: マージン用マップ（spacingのエイリアス）

         🎯 レイアウト (Layout)
           - --container-max-width: コンテナ幅
           - --container-padding: コンテナの左右余白
           - --header-margin-bottom: ヘッダー下の余白
           - --section-margin-bottom: セクション下の余白

         🎨 コンポーネント (Components)
           - カード系: --card-padding, --card-border-radius, --card-shadow, --card-border
           - ボタン系: --button-padding-*, --button-border-radius, --button-font-size, --button-font-weight
           - モーダル系: --modal-padding, --modal-border-radius, --modal-shadow, --modal-border
           - フォーム系: --form-input-*, --form-input-focus-*
           - テーブル系: --table-cell-padding, --table-header-bg, --table-border-color

         📱 レスポンシブ/レイヤー (Responsive / Layers)
           - --breakpoint-sm/md/lg/xl/2xl: ブレークポイント
           - --transition-fast/normal/slow: トランジション速度
           - --z-*: Z-インデックス（modal, fixed, tooltip など）

         使い方の例:
           .example {
             padding: var(--padding-lg);
             color: var(--color-text-primary);
             background: var(--color-background-card);
             box-shadow: var(--shadow-primary);
             border-radius: var(--border-radius-lg);
           }
        */
        /* ========================================
           🎨 CSS変数（ルート設定）
           ======================================== */
        :root {
            /* カラーパレット */
            --color-primary: #FF679C;
            --color-primary-hover: #FF4081;
            --color-primary-light: rgba(255, 103, 156, 0.1);
            --color-primary-shadow: rgba(255, 103, 156, 0.2);
            --color-primary-border: rgba(255, 103, 156, 0.3);
            
            --color-background: #ffffff;
            --color-background-secondary: #fafafa;
            --color-background-card: #ffffff;
            
            --color-text-primary: #333333;
            --color-text-secondary: #6b7280;
            --color-text-muted: #9ca3af;
            
            --color-border: #e5e7eb;
            --color-border-light: #f0f0f0;
            
            --color-success: #10b981;
            --color-success-hover: #059669;
            --color-danger: #ef4444;
            --color-danger-hover: #dc2626;
            --color-warning: #f59e0b;
            --color-info: #3b82f6;
            
            /* フォント設定 */
            --font-family-primary: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-size-xs: 0.75rem;    /* 12px */
            --font-size-sm: 0.875rem;   /* 14px */
            --font-size-base: 1rem;     /* 16px */
            --font-size-lg: 1.125rem;   /* 18px */
            --font-size-xl: 1.25rem;    /* 20px */
            --font-size-2xl: 1.5rem;    /* 24px */
            --font-size-3xl: 2rem;      /* 32px */
            --font-size-4xl: 2.5rem;    /* 40px */
            
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;
            
            /* スペーシング */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 16px;
            --spacing-xl: 20px;
            --spacing-2xl: 24px;
            --spacing-3xl: 32px;
            --spacing-4xl: 40px;
            --spacing-5xl: 48px;
            --spacing-6xl: 64px;
            
            /* パディング */
            --padding-xs: var(--spacing-xs);
            --padding-sm: var(--spacing-sm);
            --padding-md: var(--spacing-md);
            --padding-lg: var(--spacing-lg);
            --padding-xl: var(--spacing-xl);
            --padding-2xl: var(--spacing-2xl);
            --padding-3xl: var(--spacing-3xl);
            
            /* マージン */
            --margin-xs: var(--spacing-xs);
            --margin-sm: var(--spacing-sm);
            --margin-md: var(--spacing-md);
            --margin-lg: var(--spacing-lg);
            --margin-xl: var(--spacing-xl);
            --margin-2xl: var(--spacing-2xl);
            --margin-3xl: var(--spacing-3xl);
            --margin-4xl: var(--spacing-4xl);
            
            /* ボーダー */
            --border-width-thin: 1px;
            --border-width-medium: 2px;
            --border-width-thick: 3px;
            
            --border-radius-sm: 4px;
            --border-radius-md: 6px;
            --border-radius-lg: 8px;
            --border-radius-xl: 10px;
            --border-radius-2xl: 12px;
            --border-radius-full: 50%;
            
            /* シャドウ */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.1);
            --shadow-primary: 0 2px 8px var(--color-primary-light);
            --shadow-primary-lg: 0 4px 16px var(--color-primary-shadow);
            
            /* レイアウト */
            --container-max-width: 100%;
            --container-padding: var(--padding-xl);
            
            --header-height: 64px;
            --header-margin-bottom: var(--margin-4xl);
            --section-margin-bottom: var(--margin-3xl);
            
            /* テーブル */
            --table-cell-padding: var(--padding-md);
            --table-header-bg: var(--color-background-secondary);
            --table-border-color: var(--color-border);
            
            /* カード */
            --card-padding: var(--padding-xl);
            --card-border-radius: var(--border-radius-lg);
            --card-shadow: var(--shadow-primary);
            --card-border: var(--border-width-thin) solid var(--color-border-light);
            
            /* ボタン */
            --button-padding-sm: var(--padding-sm) var(--padding-md);
            --button-padding-md: var(--padding-md) var(--padding-lg);
            --button-padding-lg: var(--padding-md) var(--padding-2xl);
            --button-border-radius: var(--border-radius-md);
            --button-font-size: var(--font-size-base);
            --button-font-weight: var(--font-weight-medium);
            
            /* モーダル */
            --modal-padding: var(--padding-xl);
            --modal-border-radius: var(--border-radius-lg);
            --modal-shadow: var(--shadow-primary-lg);
            --modal-border: var(--border-width-thin) solid var(--color-border-light);
            
            /* フォーム */
            --form-input-padding: var(--padding-sm) var(--padding-md);
            --form-input-border-radius: var(--border-radius-sm);
            --form-input-border: var(--border-width-thin) solid var(--color-border);
            --form-input-focus-border: var(--border-width-thin) solid var(--color-primary);
            --form-input-focus-shadow: 0 0 0 3px var(--color-primary-light);
            
            /* レスポンシブブレークポイント */
            --breakpoint-sm: 640px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 1024px;
            --breakpoint-xl: 1280px;
            --breakpoint-2xl: 1536px;
            
            /* アニメーション */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            
            /* Z-インデックス */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
        }

        /* ========================================
           🎨 基本スタイル (Basic Styles)
           ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-primary);
            background-color: var(--color-background);
            color: var(--color-text-primary);
            line-height: var(--line-height-normal);
        }

        /* ========================================
           📐 レイアウト (Layout)
           ======================================== */
        .container {
            max-width: var(--container-max-width);
            margin: 0;
            padding: var(--container-padding);
            background-color: var(--color-background);
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--header-margin-bottom);
            position: relative;
            height: var(--header-height);
            padding: var(--spacing-sm) 0;
        }

        /* 区切り線は不要になったため削除 */

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .header-menu {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            justify-content: center;
            flex: 1;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .header-actions .btn {
            padding: var(--padding-sm);
            border-radius: var(--border-radius-md);
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            min-width: 32px;
            height: 32px;
            justify-content: center;
        }

        .header-actions .btn.active {
            background: var(--color-primary);
            color: white;
            padding: var(--padding-sm) var(--padding-md);
            min-width: auto;
        }

        .header-actions .btn:not(.active) {
            background: var(--color-background-secondary);
            color: var(--color-text-secondary);
        }

        .header-actions .btn:hover {
            opacity: 0.8;
        }

        /* セクション区切り線 */
        .section-separator {
            width: 100%;
            height: 5px;
            background: var(--color-primary-border);
            margin: 0 0 var(--spacing-lg) 0;
        }

        .logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .header-text {
            text-align: left;
        }

        .header-text h1 {
            margin: 0;
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
        }

        .header-text p {
            margin: var(--spacing-xs) 0 0 0;
            font-size: var(--font-size-lg);
            color: var(--color-text-secondary);
        }

        /* ========================================
           🏷️ ヘッダーメニュー (Header Menu)
           ======================================== */
        .header-menu .tab {
            padding: var(--padding-sm) var(--padding-lg);
            background: none;
            border: none;
            cursor: pointer;
            font-size: var(--font-size-base);
            color: var(--color-text-secondary);
            border-radius: var(--border-radius-md);
            transition: all var(--transition-normal);
            text-decoration: none;
            display: inline-block;
        }

        .header-menu .tab.active {
            color: var(--color-primary);
            background: var(--color-primary-light);
            font-weight: var(--font-weight-semibold);
        }

        .header-menu .tab:hover {
            color: var(--color-primary);
            background: var(--color-primary-light);
        }

        /* ========================================
           📊 統計カード (Statistics Cards)
           ======================================== */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--margin-3xl);
        }

        .stat-card {
            background: var(--color-background-card);
            padding: var(--card-padding);
            border-radius: var(--card-border-radius);
            box-shadow: var(--card-shadow);
            text-align: center;
            border: var(--card-border);
        }

        .stat-card h3 {
            font-size: var(--font-size-3xl);
            color: var(--color-primary);
            margin-bottom: var(--spacing-sm);
        }

        .stat-card p {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
        }

        /* ========================================
           📈 プログレスバー (Progress Bar)
           ======================================== */
        .progress-container {
            background: var(--color-background-card);
            padding: var(--card-padding);
            border-radius: var(--card-border-radius);
            box-shadow: var(--card-shadow);
            margin-bottom: var(--margin-3xl);
            border: var(--card-border);
        }

        .progress-bar {
            width: 100%;
            height: var(--spacing-xl);
            background: var(--color-border);
            border-radius: var(--border-radius-xl);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary), var(--color-primary-hover));
            transition: width var(--transition-normal);
        }

        /* ========================================
           🎛️ コントロール (Controls)
           ======================================== */
        .controls-container {
            display: flex;
            align-items: center;
            margin-bottom: var(--margin-3xl);
            gap: var(--spacing-xl);
            flex-wrap: wrap;
        }
        
        /* フィルター行のスタイル */
        .filters-row {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .filter-group label {
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            white-space: nowrap;
        }
        
        .filter-group select {
            padding: var(--padding-sm) var(--padding-md);
            border: var(--form-input-border);
            border-radius: var(--form-input-border-radius);
            font-size: var(--font-size-sm);
            background: var(--color-background);
            color: var(--color-text-primary);
            min-width: 120px;
        }
        
        .filter-group select:focus {
            outline: none;
            border: var(--form-input-focus-border);
            box-shadow: var(--form-input-focus-shadow);
        }
        
        /* アクションボタン群のスタイル */
        .action-buttons {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .action-buttons-row {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .add-button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: var(--button-padding-lg);
            border-radius: var(--button-border-radius);
            cursor: pointer;
            font-size: var(--button-font-size);
            font-weight: var(--button-font-weight);
            transition: background var(--transition-normal);
        }

        .add-button:hover {
            background: var(--color-primary-hover);
        }

        .download-button, .upload-button, .category-button {
            background: none;
            border: none;
            padding: var(--padding-sm);
            cursor: pointer;
            transition: opacity var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: var(--spacing-md);
        }

        .download-button:hover, .upload-button:hover, .category-button:hover {
            opacity: 0.7;
        }

        /* ========================================
           📋 カテゴリセクション (Category Sections)
           ======================================== */
        .category-section {
            margin-bottom: var(--margin-3xl);
            background: var(--color-background-card);
            border-radius: var(--card-border-radius);
            box-shadow: var(--card-shadow);
            border: var(--card-border);
            overflow: hidden;
        }
        
        /* テーブル同士のギャップを追加 */
        .category-section + .category-section {
            margin-top: var(--spacing-2xl);
        }

        .category-header {
            background: var(--color-primary);
            padding: var(--padding-lg);
            border-bottom: var(--border-width-thin) solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .category-header h3 {
            color: white;
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .category-stats {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            align-items: center;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: var(--padding-xs) var(--padding-sm);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            white-space: nowrap;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* ========================================
           📱 レスポンシブデザイン (Responsive Design)
           ======================================== */
        
        /* モバイル用ヘッダー調整 */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: var(--spacing-md);
                text-align: center;
                height: auto;
                padding: var(--spacing-lg) 0;
            }

            .header-left {
                justify-content: center;
                flex-wrap: wrap;
                gap: var(--spacing-md);
            }

            .header-menu, .header-actions {
                justify-content: center;
            }
            
            /* SP版でヘッダーアクションボタンとタブメニューを非表示 */
            .header-actions {
                display: none;
            }
            
            .header-menu {
                display: none;
            }
            
            /* SP版でミニメニューを表示 */
            .mobile-mini-menu {
                display: block;
            }

            .logo {
                width: 50px;
                height: 50px;
            }

            .header-text h1 {
                font-size: var(--font-size-2xl);
            }

            .header-text p {
                font-size: var(--font-size-md);
            }
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--color-background-card);
            border-radius: var(--card-border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin-bottom: var(--spacing-xl);
            border: var(--border-width-thin) solid var(--color-primary-border);
        }

        .table th, .table td {
            padding: var(--table-cell-padding);
            text-align: left;
            border-bottom: var(--border-width-thin) solid var(--color-primary-border);
        }

        .table th {
            background: var(--table-header-bg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }

        .table td {
            vertical-align: middle;
        }

        /* テーブル列幅の最適化 */
        .table th:nth-child(1), .table td:nth-child(1) { width: 18% !important; } /* ページ名 */
        .table th:nth-child(2), .table td:nth-child(2) { width: 15% !important; } /* URL */
        .table th:nth-child(3), .table td:nth-child(3) { width: 5% !important; } /* PCステータス */
        .table th:nth-child(4), .table td:nth-child(4) { width: 5% !important; } /* SPステータス */
        .table th:nth-child(5), .table td:nth-child(5) { width: 10% !important; text-align: center; }  /* 業務担当 */
        .table th:nth-child(6), .table td:nth-child(6) { width: 30% !important; } /* 機能 */
        .table th:nth-child(7), .table td:nth-child(7) { width: 10% !important; } /* 最終更新日 */
        .table th:nth-child(8), .table td:nth-child(8) { width: 6% !important; }  /* 操作 */

        /* ========================================
           🎨 ボタン (Buttons)
           ======================================== */
        .btn {
            padding: var(--button-padding-sm);
            border: none;
            border-radius: var(--button-border-radius);
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--button-font-weight);
            transition: all var(--transition-normal);
        }

        /* テーブル内操作ボタンの最適化 */
        .table .btn {
            padding: var(--padding-xs) var(--padding-sm);
            font-size: var(--font-size-xs);
            min-width: 50px;
            margin: 0 var(--spacing-xs);
        }

        .table .btn:first-child {
            margin-left: 0;
        }

        .table .btn:last-child {
            margin-right: 0;
        }

        /* 操作列のコンテナ最適化 */
        .table td:last-child {
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
        }

        .table td:last-child .btn {
            display: inline-block;
            vertical-align: middle;
        }

        .btn-edit {
            background: var(--color-primary);
            color: white;
        }

        .btn-edit:hover {
            background: var(--color-primary-hover);
        }

        .btn-delete {
            background: var(--color-danger);
            color: white;
        }

        .btn-delete:hover {
            background: var(--color-danger-hover);
        }

        .btn-save {
            background: var(--color-success);
            color: white;
        }

        .btn-save:hover {
            background: var(--color-success-hover);
        }

        .btn-cancel {
            background: var(--color-text-secondary);
            color: white;
        }

        .btn-cancel:hover {
            background: var(--color-text-muted);
        }

        /* ========================================
           🪟 モーダル (Modals)
           ======================================== */
        .modal {
            display: none;
            position: fixed;
            z-index: var(--z-modal);
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--color-background-card);
            margin: 5% auto;
            padding: var(--modal-padding);
            border-radius: var(--modal-border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--modal-shadow);
            border: var(--modal-border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: var(--border-width-thin) solid var(--color-border);
        }

        .modal-header h2 {
            color: var(--color-text-primary);
        }

        .close {
            color: var(--color-text-muted);
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            cursor: pointer;
        }

        .close:hover {
            color: var(--color-text-primary);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: var(--form-input-padding);
            border: var(--form-input-border);
            border-radius: var(--form-input-border-radius);
            font-size: var(--font-size-base);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border: var(--form-input-focus-border);
            box-shadow: var(--form-input-focus-shadow);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-xl);
            border-top: var(--border-width-thin) solid var(--color-border);
        }

        /* モバイル用メインコンテンツ調整 */
        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-md);
                padding-bottom: 80px;
            }
            
            /* 統計カードのレイアウト調整 */
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-md);
            }
            
            .stat-card {
                padding: var(--spacing-lg);
            }
            
            .stat-card h3 {
                font-size: var(--font-size-2xl);
            }
            
            /* テーブルのモバイル最適化 - simple-progress.htmlを参考にした実装 */
            .table {
                font-size: var(--font-size-sm);
                display: block;
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 0;
            }
            
            .table thead {
                display: none;
            }
            
            .table tbody {
                display: block;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            
            .table tr {
                display: block;
                border: 1px solid var(--color-border);
                border-radius: var(--border-radius-md);
                margin-bottom: var(--spacing-sm);
                padding: var(--spacing-sm);
                background: var(--color-background-secondary);
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
                margin-left: 0;
                margin-right: 0;
                position: relative;
            }
            
            /* テーブル行間にピンクの区切り線を追加 */
            .table tr:not(:last-child)::after {
                content: '';
                position: absolute;
                bottom: -4px;
                left: 50%;
                transform: translateX(-50%);
                width: 60%;
                height: 2px;
                background: var(--color-primary);
                border-radius: 1px;
            }
            
            .table td {
                display: block;
                padding: var(--spacing-xs) 0;
                border: none;
                text-align: left;
                width: 100%;
                box-sizing: border-box;
                white-space: nowrap;
                min-width: 0;
            }
            
            .table td:before {
                content: attr(data-label) ": ";
                font-weight: var(--font-weight-semibold);
                color: var(--color-text-primary);
                display: inline;
                font-size: var(--font-size-xs);
                margin-right: var(--spacing-xs);
            }
            
            .table td > *:not(:before) {
                display: inline;
                white-space: nowrap;
            }
            
            /* リンクの調整 */
            .table td a {
                color: var(--color-primary);
                text-decoration: none;
                display: inline;
                white-space: nowrap;
            }
            
            .table td a:hover {
                text-decoration: underline;
            }
            
            /* ステータス表示の調整 */
            .table td span {
                display: inline;
            }
            
            /* モバイルでの操作ボタン最適化 */
            .table .btn {
                padding: var(--spacing-xs) var(--spacing-sm);
                font-size: var(--font-size-xs);
                min-width: 50px;
                margin: var(--spacing-xs) var(--spacing-xs) 0 0;
                display: inline-block;
            }
            
            /* 不要な列を非表示（必要に応じて調整） */
            .table td:nth-child(7) {
                display: none; /* 最終更新日を非表示 */
            }
            
            /* カテゴリヘッダーのモバイル調整 */
            .category-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-sm);
            }
            
            .category-stats {
                flex-wrap: wrap;
                gap: var(--spacing-xs);
            }
            
            .stat-item {
                font-size: var(--font-size-xs);
                padding: var(--spacing-xs);
            }
            
            /* カテゴリセクション間にピンクの区切り線を追加 */
            .category-section:not(:last-child) {
                margin-bottom: var(--spacing-xl);
                position: relative;
            }
            
            /* モバイル版でのテーブル間ギャップ調整 */
            .category-section + .category-section {
                margin-top: var(--spacing-xl);
            }
            
            .category-section:not(:last-child)::after {
                content: '';
                position: absolute;
                bottom: -var(--spacing-lg);
                left: 50%;
                transform: translateX(-50%);
                width: 80%;
                height: 3px;
                background: var(--color-primary);
                border-radius: 2px;
                box-shadow: 0 2px 4px var(--color-primary-shadow);
            }
            
            /* モーダルのモバイル調整 */
            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: var(--spacing-lg);
            }
        }

        /* ========================================
           📱 SP版ミニメニュー (Mobile Mini Menu)
           ======================================== */
        .mobile-mini-menu {
            display: none;
            position: relative;
            margin-bottom: var(--margin-lg);
        }
        
        .mini-menu-toggle {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--padding-sm) var(--padding-md);
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-sm);
            width: 100%;
            justify-content: center;
        }
        
        .mini-menu-toggle:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .mini-menu-toggle.active {
            background: var(--color-primary-hover);
            border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
        }
        
        .mini-menu-content {
            display: none;
            position: fixed;
            bottom: 80px;
            left: 10px;
            right: 10px;
            background: var(--color-background-card);
            border: var(--card-border);
            border-radius: var(--card-border-radius);
            box-shadow: var(--card-shadow);
            z-index: var(--z-modal);
            overflow: hidden;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .mini-menu-content.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .mini-menu-section {
            padding: var(--padding-md);
            border-bottom: 1px solid var(--color-border-light);
        }
        
        .mini-menu-section:last-child {
            border-bottom: none;
        }
        
        .mini-menu-section h4 {
            color: var(--color-text-primary);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            margin: 0 0 var(--spacing-sm) 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .mini-menu-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-xs);
        }
        
        .mini-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: var(--spacing-sm);
            background: var(--color-background-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 10px;
            color: var(--color-text-secondary);
            min-height: 50px;
            justify-content: center;
        }
        
        .mini-btn:hover {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
            color: var(--color-primary);
            transform: translateY(-1px);
        }
        
        .mini-btn.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }
        
        .mini-btn img {
            opacity: 0.8;
            width: 14px;
            height: 14px;
        }
        
        .mini-btn.active img {
            opacity: 1;
        }
        
        .mini-btn span {
            font-weight: var(--font-weight-medium);
            text-align: center;
            line-height: 1.1;
        }

        /* ========================================
           📱 モバイルナビゲーション (Mobile Navigation)
           ======================================== */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--color-background-card);
            border-top: var(--border-width-thin) solid var(--color-border-light);
            display: none;
            z-index: var(--z-fixed);
            box-shadow: 0 -2px 8px var(--color-primary-light);
        }

        .mobile-nav-content {
            display: flex;
            justify-content: space-around;
            padding: var(--spacing-md) 0;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--color-text-secondary);
            font-size: var(--font-size-xs);
        }

        .mobile-nav-item.active {
            color: var(--color-primary);
        }

        .mobile-nav-item img {
            width: var(--spacing-2xl);
            height: var(--spacing-2xl);
            margin-bottom: var(--spacing-xs);
        }
        
        /* 下部固定メニューのミニメニュートリガー */
        .mini-menu-trigger {
            background: none;
            border: none;
            cursor: pointer;
            transition: all var(--transition-normal);
        }
        
        .mini-menu-trigger:hover {
            color: var(--color-primary);
            transform: translateY(-2px);
        }
        
        .mini-menu-trigger.active {
            color: var(--color-primary);
            background: var(--color-primary-light);
            border-radius: var(--border-radius-sm);
        }

        /* モバイルナビゲーションの表示制御 */
        @media (max-width: 768px) {
            .mobile-nav {
                display: block;
            }
        }

        /* ========================================
           📱 スマートフォン専用調整 (Smartphone Specific)
           ======================================== */
        
        /* より小さなスマートフォン画面用 */
        @media (max-width: 480px) {
            .container {
                padding: var(--spacing-sm);
                padding-bottom: 80px;
            }
            
            .header {
                padding: var(--spacing-sm) 0;
            }
            
            .header-text h1 {
                font-size: var(--font-size-xl);
            }
            
            .header-text p {
                font-size: var(--font-size-sm);
            }
            
            .logo {
                width: 40px;
                height: 40px;
            }
            
            /* 統計カードを1列に */
            .stats {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }
            
            .stat-card {
                padding: var(--spacing-md);
            }
            
            .stat-card h3 {
                font-size: var(--font-size-xl);
            }
            
            /* コントロールボタンの調整 */
            .controls-container {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-md);
            }
            
            .filters-row {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-sm);
            }
            
            .filter-group {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }
            
            .filter-group select {
                width: 100%;
                min-width: auto;
            }
            
            .action-buttons {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            /* SP版でコントロールのアクションボタンを非表示 */
            .action-buttons {
                display: none;
            }
            
            /* テーブルの超小型画面調整 - simple-progress.htmlスタイル */
            .table tr {
                padding: var(--spacing-xs);
                margin-bottom: var(--spacing-xs);
            }
            
            .table td {
                padding: 2px 0;
                font-size: var(--font-size-xs);
            }
            
            .table td:before {
                font-size: 10px;
                margin-right: 4px;
            }
            
            .table .btn {
                padding: 2px 6px;
                font-size: 10px;
                min-width: 40px;
                margin: 2px 4px 0 0;
            }
            
            /* 超小型画面での区切り線調整 */
            .table tr:not(:last-child)::after {
                width: 50%;
                height: 1px;
                bottom: -2px;
            }
            
            .category-section:not(:last-child)::after {
                width: 70%;
                height: 2px;
                bottom: -var(--spacing-md);
            }
            
            /* 超小型画面でのテーブル間ギャップ調整 */
            .category-section + .category-section {
                margin-top: var(--spacing-lg);
            }
            
            /* 超小型画面でのフィルター調整 */
            .filters-row {
                gap: var(--spacing-xs);
            }
            
            .filter-group {
                gap: 2px;
            }
            
            .filter-group label {
                font-size: var(--font-size-xs);
            }
            
            .filter-group select {
                font-size: var(--font-size-xs);
                padding: var(--spacing-xs);
            }
            
            /* 超小型画面でのサブメニュー調整 */
            .submenu-content {
                padding: var(--spacing-md);
            }
            
            .submenu-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-xs);
            }
            
            .submenu-btn {
                min-height: 50px;
                padding: var(--spacing-xs);
                font-size: 10px;
            }
            
            .submenu-btn img {
                width: 14px;
                height: 14px;
            }
            
            /* 超小型画面でのミニメニュー調整 */
            .mini-menu-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 4px;
            }
            
            .mini-btn {
                min-height: 45px;
                padding: 6px;
                font-size: 9px;
            }
            
            .mini-btn img {
                width: 12px;
                height: 12px;
            }
            
            /* モーダルの調整 */
            .modal-content {
                margin: 5% auto;
                width: 98%;
                padding: var(--spacing-md);
                max-height: 90vh;
            }
            
            /* モバイルナビゲーションの調整 */
            .mobile-nav-content {
                padding: var(--spacing-sm) 0;
            }
            
            .mobile-nav-item {
                font-size: 10px;
            }
            
            .mobile-nav-item img {
                width: var(--spacing-xl);
                height: var(--spacing-xl);
            }
        }

        /* ========================================
           📱 モバイル用ボトムパネル (Mobile Bottom Panel)
           ======================================== */
        .mobile-bottom-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: var(--z-modal);
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }

        .mobile-bottom-panel.show {
            display: block;
            opacity: 1;
        }

        .bottom-panel-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--color-background-card);
            border-radius: var(--card-border-radius) var(--card-border-radius) 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 70vh;
            overflow-y: auto;
        }

        .mobile-bottom-panel.show .bottom-panel-content {
            transform: translateY(0);
        }

        .bottom-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--color-border-light);
            background: var(--color-background);
        }

        .bottom-panel-header h3 {
            margin: 0;
            color: var(--color-text-primary);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
        }

        .close-panel-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius-sm);
            transition: all var(--transition-normal);
        }

        .close-panel-btn:hover {
            background: var(--color-background-hover);
            color: var(--color-text-primary);
        }

        .bottom-panel-body {
            padding: var(--spacing-lg);
        }

        .bottom-panel-body .mini-menu-section {
            margin-bottom: var(--spacing-lg);
        }

        .bottom-panel-body .mini-menu-section:last-child {
            margin-bottom: 0;
        }

        .bottom-panel-body .mini-menu-section h4 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--color-text-primary);
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-semibold);
        }

        .bottom-panel-body .mini-menu-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
        }

        .bottom-panel-body .mini-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md);
            background: var(--color-background);
            border: 1px solid var(--color-border-light);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            min-height: 80px;
        }

        .bottom-panel-body .mini-btn:hover {
            background: var(--color-background-hover);
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--card-shadow);
        }

        .bottom-panel-body .mini-btn.active {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .bottom-panel-body .mini-btn img {
            margin-bottom: var(--spacing-xs);
        }

        .bottom-panel-body .mini-btn span {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            text-align: center;
        }

        /* スマートフォン用の調整 */
        @media (max-width: 480px) {
            .bottom-panel-content {
                max-height: 60vh;
            }

            .bottom-panel-header {
                padding: var(--spacing-md);
            }

            .bottom-panel-header h3 {
                font-size: var(--font-size-md);
            }

            .bottom-panel-body {
                padding: var(--spacing-md);
            }

            .bottom-panel-body .mini-menu-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-sm);
            }

            .bottom-panel-body .mini-btn {
                min-height: 70px;
                padding: var(--spacing-sm);
            }

            .bottom-panel-body .mini-btn span {
                font-size: var(--font-size-xs);
            }
        }

        /* ========================================
           🎯 ユーティリティ (Utilities)
           ======================================== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <!-- ========================================
         🏠 メインコンテナ (Main Container)
         ======================================== -->
    <div class="container">
        <!-- ヘッダー -->
        <div class="header">
            <div class="header-left">
                <img src="images/logo_144x144.png" alt="ミセサポロゴ" class="logo">
                <div class="header-text">
                    <h1>ミセサポポータル</h1>
                    <p>プロジェクト進捗管理システム</p>
                </div>
                <div class="header-menu">
                    <button class="tab active" onclick="showTab('progress')">進捗管理</button>
                    <a href="task-market.html" class="tab">タスクマーケット</a>
                </div>
            </div>

            <div class="header-actions">
                <button class="btn active" id="statsToggle" onclick="toggleStats()" title="統計カードの表示・非表示">
                    <img src="images/統計.svg" alt="統計" style="width: 16px; height: 16px;">
                    <span class="btn-label">統計カード</span>
                </button>
                <button class="btn active" id="progressToggle" onclick="toggleProgress()" title="完成率の表示・非表示">
                    <img src="images/完成率.svg" alt="完成率" style="width: 16px; height: 16px;">
                    <span class="btn-label">完成率</span>
                </button>
            </div>
        </div>

        <!-- SP版ミニメニュー -->
        <div class="mobile-mini-menu" id="mobileMiniMenu">
            <!-- ミニメニュートグルボタン -->
            <button class="mini-menu-toggle" id="miniMenuToggle" onclick="toggleMiniMenu()">
                <img src="images/ギアアイコン.svg" alt="メニュー" style="width: 20px; height: 20px;">
                <span>メニュー</span>
            </button>
            
            <!-- ミニメニューコンテンツ -->
            <div class="mini-menu-content" id="miniMenuContent">
                <div class="mini-menu-section">
                    <h4>表示設定</h4>
                    <div class="mini-menu-buttons">
                        <button class="mini-btn active" id="miniStatsToggle" onclick="toggleStats()">
                            <img src="images/統計.svg" alt="統計" style="width: 16px; height: 16px;">
                            <span>統計</span>
                        </button>
                        <button class="mini-btn active" id="miniProgressToggle" onclick="toggleProgress()">
                            <img src="images/完成率.svg" alt="完成率" style="width: 16px; height: 16px;">
                            <span>完成率</span>
                        </button>
                    </div>
                </div>
                
                <div class="mini-menu-section">
                    <h4>データ管理</h4>
                    <div class="mini-menu-buttons">
                        <button class="mini-btn" onclick="downloadCSV()">
                            <img src="images/ダウンロード.svg" alt="ダウンロード" style="width: 16px; height: 16px;">
                            <span>ダウンロード</span>
                        </button>
                        <button class="mini-btn" onclick="openUploadModal()">
                            <img src="images/アップロード.svg" alt="アップロード" style="width: 16px; height: 16px;">
                            <span>アップロード</span>
                        </button>
                        <button class="mini-btn" onclick="openCategoryModal()">
                            <img src="images/ギアアイコン.svg" alt="カテゴリ管理" style="width: 16px; height: 16px;">
                            <span>カテゴリ</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- モバイル用ボトムパネル -->
        <div class="mobile-bottom-panel" id="mobileBottomPanel">
            <div class="bottom-panel-content" id="bottomPanelContent">
                <div class="bottom-panel-header">
                    <h3>メニュー</h3>
                    <button class="close-panel-btn" onclick="closeBottomPanel()">
                        <span>×</span>
                    </button>
                </div>
                <div class="bottom-panel-body">
                    <div class="mini-menu-section">
                        <h4>表示設定</h4>
                        <div class="mini-menu-buttons">
                            <button class="mini-btn active" id="bottomStatsToggle" onclick="toggleStats()">
                                <img src="images/統計.svg" alt="統計" style="width: 16px; height: 16px;">
                                <span>統計</span>
                            </button>
                            <button class="mini-btn active" id="bottomProgressToggle" onclick="toggleProgress()">
                                <img src="images/完成率.svg" alt="完成率" style="width: 16px; height: 16px;">
                                <span>完成率</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mini-menu-section">
                        <h4>データ管理</h4>
                        <div class="mini-menu-buttons">
                            <button class="mini-btn" onclick="downloadCSV(); closeBottomPanel();">
                                <img src="images/ダウンロード.svg" alt="ダウンロード" style="width: 16px; height: 16px;">
                                <span>ダウンロード</span>
                            </button>
                            <button class="mini-btn" onclick="openUploadModal(); closeBottomPanel();">
                                <img src="images/アップロード.svg" alt="アップロード" style="width: 16px; height: 16px;">
                                <span>アップロード</span>
                            </button>
                            <button class="mini-btn" onclick="openCategoryModal(); closeBottomPanel();">
                                <img src="images/ギアアイコン.svg" alt="カテゴリ管理" style="width: 16px; height: 16px;">
                                <span>カテゴリ</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 区切り線 -->
        <div class="section-separator"></div>

        <!-- アラート -->
        <div id="alerts"></div>

        <!-- 進捗管理コンテンツ -->
        <div id="progress-view" class="tab-content">
            <!-- 統計情報 -->
            <div class="stats">
                <div class="stat-card">
                    <h3 id="completedCount">0</h3>
                    <p>完了</p>
                </div>
                <div class="stat-card">
                    <h3 id="spNotCompletedCount">0</h3>
                    <p>SP未対応</p>
                </div>
                <div class="stat-card">
                    <h3 id="inProgressCount">0</h3>
                    <p>進行中</p>
                </div>
                <div class="stat-card">
                    <h3 id="pendingCount">0</h3>
                    <p>未着手</p>
                </div>
                <div class="stat-card">
                    <h3 id="waitingCount">0</h3>
                    <p>待機中</p>
                </div>
            </div>

            <!-- 完成率プログレスバー -->
            <div class="progress-container">
                <h3>完成率</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <p id="progressText" class="text-center mt-20">0% (0/0)</p>
            </div>

            <!-- 新規追加ボタンとフィルター -->
            <div class="controls-container">
                <div class="action-buttons-row">
                    <button class="add-button" onclick="openAddModal()">新規項目を追加</button>
                    <button class="btn btn-save" onclick="forceSaveData()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                        更新
                    </button>
                    <button class="btn btn-info" onclick="openCSVView()" style="background: #17a2b8; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                        CSV表示
                    </button>
                </div>
                
                <div class="filters-row">
                    <div class="filter-group">
                        <label for="categoryFilter">カテゴリ:</label>
                        <select id="categoryFilter" onchange="filterByCategory()">
                            <option value="">すべて</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="statusFilter">ステータス:</label>
                        <select id="statusFilter" onchange="filterByStatus()">
                            <option value="">すべて</option>
                            <option value="completed">完了</option>
                            <option value="in-progress">進行中</option>
                            <option value="pending">未着手</option>
                            <option value="waiting">待機中</option>
                        </select>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="download-button" onclick="downloadCSV()" title="リストダウンロード">
                        <img src="images/ダウンロード.svg" alt="ダウンロード" style="width: 20px; height: 20px;">
                    </button>
                    
                    <button class="upload-button" onclick="openUploadModal()" title="リストアップロード">
                        <img src="images/アップロード.svg" alt="アップロード" style="width: 20px; height: 20px;">
                    </button>
                    
                    <button class="category-button" onclick="openCategoryModal()" title="カテゴリ管理">
                        <img src="images/ギアアイコン.svg" alt="カテゴリ管理" style="width: 20px; height: 20px;">
                    </button>
                </div>
            </div>

            <!-- カテゴリごとのテーブル -->
            <div id="categorySections">
                <!-- カテゴリセクションはJavaScriptで動的に生成 -->
            </div>
        </div>
    </div>

    <!-- ========================================
         🪟 モーダル群 (Modals)
         ======================================== -->
    
    <!-- 新規追加モーダル -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>新規項目を追加</h2>
                <span class="close" onclick="closeAddModal()">&times;</span>
            </div>
            <form id="addForm" novalidate>
                <div class="form-group">
                    <label for="addCategory">カテゴリ:</label>
                    <select id="addCategory" onchange="handleCategoryChange(this)">
                        <option value="">カテゴリを選択</option>
                        <option value="メイン">メイン</option>
                        <option value="認証">認証</option>
                        <option value="登録">登録</option>
                        <option value="サポート">サポート</option>
                        <option value="マイページ">マイページ</option>
                        <option value="管理">管理</option>
                        <option value="Eコマース">Eコマース</option>
                        <option value="__ADD_CATEGORY__">+ カテゴリを追加する</option>
                    </select>
                    <div id="addNewCategoryGroup" class="form-group" style="display: none;">
                        <label for="addNewCategoryName">新しいカテゴリ名:</label>
                        <input type="text" id="addNewCategoryName" placeholder="カテゴリ名を入力" onblur="handleNewCategoryName(this)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="addPageName">ページ名:</label>
                    <input type="text" id="addPageName" placeholder="ページ名を入力（空白の場合は「未設定」）">
                </div>
                
                <div class="form-group">
                    <label for="addUrl">URL:</label>
                    <input type="text" id="addUrl" placeholder="任意の文字列OK（空白可）">
                </div>
                
                <div class="form-group">
                    <label for="addPCStatus">PC版開発状況:</label>
                    <select id="addPCStatus">
                        <option value="pending">未着手</option>
                        <option value="in-progress">進行中</option>
                        <option value="completed">完了</option>
                        <option value="waiting">待機中</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="addSPStatus">SP版開発状況:</label>
                    <select id="addSPStatus">
                        <option value="pending">未着手</option>
                        <option value="in-progress">進行中</option>
                        <option value="completed">完了</option>
                        <option value="waiting">待機中</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="addAssignee">業務担当:</label>
                    <select id="addAssignee">
                        <option value="">担当者を選択</option>
                        <option value="デザイナー">デザイナー</option>
                        <option value="フロントエンド">フロントエンド</option>
                        <option value="バックエンド">バックエンド</option>
                        <option value="メディア">メディア</option>
                        <option value="プロダクション">プロダクション</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="addFunction">機能:</label>
                    <textarea id="addFunction" rows="3" placeholder="機能の詳細を入力"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="addLastUpdated">最終更新日:</label>
                    <input type="date" id="addLastUpdated">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-cancel" onclick="closeAddModal()">キャンセル</button>
                    <button type="submit" class="btn btn-save">追加</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 編集モーダル -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>項目を編集</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="editForm" novalidate>
                <input type="hidden" id="editId">
                
                <div class="form-group">
                    <label for="editCategory">カテゴリ:</label>
                    <select id="editCategory" onchange="handleCategoryChange(this)">
                        <option value="">カテゴリを選択</option>
                        <option value="メイン">メイン</option>
                        <option value="認証">認証</option>
                        <option value="登録">登録</option>
                        <option value="サポート">サポート</option>
                        <option value="マイページ">マイページ</option>
                        <option value="管理">管理</option>
                        <option value="Eコマース">Eコマース</option>
                        <option value="__ADD_CATEGORY__">+ カテゴリを追加する</option>
                    </select>
                    <div id="editNewCategoryGroup" class="form-group" style="display: none;">
                        <label for="editNewCategoryName">新しいカテゴリ名:</label>
                        <input type="text" id="editNewCategoryName" placeholder="カテゴリ名を入力" onblur="handleNewCategoryName(this)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editPageName">ページ名:</label>
                    <input type="text" id="editPageName" placeholder="ページ名を入力（空白の場合は「未設定」）">
                </div>
                
                <div class="form-group">
                    <label for="editUrl">URL:</label>
                    <input type="text" id="editUrl" placeholder="任意の文字列OK（空白可）">
                </div>
                
                <div class="form-group">
                    <label for="editPCStatus">PC版開発状況:</label>
                    <select id="editPCStatus">
                        <option value="pending">未着手</option>
                        <option value="in-progress">進行中</option>
                        <option value="completed">完了</option>
                        <option value="waiting">待機中</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="editSPStatus">SP版開発状況:</label>
                    <select id="editSPStatus">
                        <option value="pending">未着手</option>
                        <option value="in-progress">進行中</option>
                        <option value="completed">完了</option>
                        <option value="waiting">待機中</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="editAssignee">業務担当:</label>
                    <select id="editAssignee">
                        <option value="">担当者を選択</option>
                        <option value="デザイナー">デザイナー</option>
                        <option value="フロントエンド">フロントエンド</option>
                        <option value="バックエンド">バックエンド</option>
                        <option value="メディア">メディア</option>
                        <option value="プロダクション">プロダクション</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="editFunction">機能:</label>
                    <textarea id="editFunction" rows="3" placeholder="機能の詳細を入力"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="editLastUpdated">最終更新日:</label>
                    <input type="date" id="editLastUpdated">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-cancel" onclick="closeEditModal()">キャンセル</button>
                    <button type="submit" class="btn btn-save">更新</button>
                </div>
            </form>
        </div>
    </div>

    <!-- アップロードモーダル -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>CSVファイルをアップロード</h2>
                <span class="close" onclick="closeUploadModal()">&times;</span>
            </div>
            <form id="uploadForm">
                <div class="form-group">
                    <label for="password">パスワード:</label>
                    <input type="password" id="password" placeholder="パスワードを入力" required>
                </div>
                <div class="form-group">
                    <label for="csvFile">CSVファイル:</label>
                    <input type="file" id="csvFile" accept=".csv" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-cancel" onclick="closeUploadModal()">キャンセル</button>
                    <button type="submit" class="btn btn-save">アップロード</button>
                </div>
            </form>
        </div>
    </div>

    <!-- カテゴリ管理モーダル -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>カテゴリ管理</h2>
                <span class="close" onclick="closeCategoryModal()">&times;</span>
            </div>
            <div class="form-group">
                <label for="newCategoryName">新しいカテゴリ名:</label>
                <input type="text" id="newCategoryName" placeholder="カテゴリ名を入力">
                <button type="button" class="btn btn-save" onclick="addNewCategory()">追加</button>
            </div>
            <div id="categoryList">
                <!-- カテゴリリストはJavaScriptで動的に生成 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeCategoryModal()">閉じる</button>
            </div>
        </div>
    </div>

    <!-- ========================================
         📱 モバイルナビゲーション (Mobile Navigation)
         ======================================== -->
    <div class="mobile-nav">
        <div class="mobile-nav-content">
            <a href="#" class="mobile-nav-item active" onclick="showTab('progress')">
                <img src="images/graph.png" alt="進捗管理">
                <span>進捗</span>
            </a>
            <a href="task-market.html" class="mobile-nav-item">
                <img src="images/TASK.png" alt="タスクマーケット">
                <span>タスク</span>
            </a>
            <a href="#" class="mobile-nav-item" onclick="window.open('https://www.figma.com/design/example', '_blank')">
                <img src="images/figma.png" alt="Figma">
                <span>Figma</span>
            </a>
            <button class="mobile-nav-item mini-menu-trigger" id="bottomMiniMenuToggle" onclick="openBottomPanel()">
                <img src="images/ギアアイコン.svg" alt="メニュー">
                <span>メニュー</span>
            </button>
        </div>
    </div>

    <script>
        /* ========================================
           🔧 初期化・設定 (Initialization & Configuration)
           ======================================== */
        
        // Firebase設定
        const firebaseConfig = {
            apiKey: "AIzaSyDi2_U6INLm7sb-02GsdWzDl2qaFBe8US4",
            authDomain: "misesapo-progress.firebaseapp.com",
            databaseURL: "https://misesapo-progress-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "misesapo-progress",
            storageBucket: "misesapo-progress.firebasestorage.app",
            messagingSenderId: "926808186549",
            appId: "1:926808186549:web:91ce8534877c4ecf2e28fc",
            measurementId: "G-5JS29JLL13"
        };

        // Firebase初期化（エラーハンドリング付き）
        console.log('Firebase初期化開始');
        let firebaseInitialized = false;
        let db;
        
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                firebaseInitialized = true;
                console.log('Firebase初期化成功');
            } else {
                db = firebase.firestore();
                firebaseInitialized = true;
                console.log('Firebase既に初期化済み');
            }
        } catch (error) {
            console.error('Firebase初期化エラー:', error);
            firebaseInitialized = false;
        }
        
        // Firestore設定（簡潔版）
        if (firebaseInitialized && db) {
            // 基本的な設定のみ（警告を避けるため）
            console.log('Firestore接続準備完了');
        }

        // 認証なしでオープンアクセス（匿名認証を削除）
        // Firebase Firestoreのセキュリティルールでオープンアクセスを許可
        console.log('Firebase認証なしでオープンアクセス設定');
        
        /* ========================================
           🔒 Firestoreセキュリティルール設定（今後の課題）
           ========================================
           
           現在の設定: オープンアクセス（検証用）
           rules_version = '2';
           service cloud.firestore {
             match /databases/{database}/documents {
               match /{document=**} {
                 allow read, write: if true; // オープンアクセス
               }
             }
           }
           
           ⚠️ 本番運用時の推奨セキュリティ対策:
           
           1. 期間制限
           - 特定の期間のみアクセス許可
           - 例: allow read, write: if request.time < timestamp.date(2025, 12, 31);
           
           2. ドメイン制限
           - 特定のドメインからのアクセスのみ許可
           - 例: allow read, write: if request.headers.origin.matches('https://yourdomain.com');
           
           3. IP制限
           - 特定のIPアドレスからのアクセスのみ許可
           - 例: allow read, write: if request.auth != null && 
                 request.auth.token.ip_whitelist.has(request.ip);
           
           4. 認証ベース
           - Firebase Authenticationを使用
           - 例: allow read, write: if request.auth != null;
           
           5. カスタムトークン
           - 独自のトークン検証
           - 例: allow read, write: if request.auth != null && 
                 request.auth.token.custom_claim == 'admin';
           
           6. レート制限
           - 書き込み頻度の制限
           - 例: allow write: if request.time > resource.data.lastWrite + duration.value(5, 's');
           
           推奨実装例（本番用）:
           rules_version = '2';
           service cloud.firestore {
             match /databases/{database}/documents {
               match /projectData/{document} {
                 allow read: if request.time < timestamp.date(2025, 12, 31) &&
                            request.headers.origin.matches('https://yourdomain.com');
                 allow write: if request.time < timestamp.date(2025, 12, 31) &&
                             request.headers.origin.matches('https://yourdomain.com') &&
                             request.time > resource.data.lastWrite + duration.value(1, 's');
               }
             }
           }
           
           注意事項:
           - 現在は検証・開発用のオープンアクセス設定
           - 本番デプロイ前に必ずセキュリティルールを更新
           - 定期的なセキュリティ監査の実施を推奨
           ======================================== */

        // グローバル変数
        let projectData = {};
        let categories = ['メイン', '認証', '登録', 'サポート', 'マイページ', '管理', 'Eコマース'];

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ページ読み込み完了');
            await loadData();
            // subscribeRealtime(); // リアルタイム購読を完全に無効化
            setupEventListeners();
            
            // エラー監視
            window.addEventListener('error', function(e) {
                console.error('JavaScript Error:', e.error);
                console.error('Error details:', {
                    message: e.message,
                    filename: e.filename,
                    lineno: e.lineno,
                    colno: e.colno
                });
            });
            
            window.addEventListener('unhandledrejection', function(e) {
                console.error('Unhandled Promise Rejection:', e.reason);
                console.error('Promise rejection details:', {
                    reason: e.reason,
                    promise: e.promise
                });
            });
            
            // Firebase接続状態の監視（認証なしでオープンアクセス）
            if (firebaseInitialized && db) {
                console.log('Firebase接続状態: 認証なしでオープンアクセス');
            }
        });

        /* ========================================
           📊 データ管理 (Data Management)
           ======================================== */
        
        // データ読み込み優先度: Firestore → localStorage → CSV初期投入 → 埋め込み
        async function loadData() {
            // 1) Firestore 最優先
            if (firebaseInitialized) {
                try {
                    const doc = await db.collection('projectData').doc('main').get();
                    if (doc.exists) {
                        const data = doc.data();
                        console.log('🔥 Firebaseから読み込んだデータ:', data);
                        console.log('📈 Firebaseデータの項目数:', Object.keys(data).length);
                        console.log('🔍 FirebaseデータにID 36が存在するか:', data.hasOwnProperty('36'));
                        
                        projectData = data;
                        localStorage.setItem('projectData', JSON.stringify(projectData));
                        console.log('✅ Firebaseからデータを読み込みました:', projectData);
                        updateDisplay();
                        return;
                    }
                } catch (e) {
                    console.warn('Firebase読み込みに失敗:', e);
                }
            }

            // 2) localStorage フォールバック
            try {
                const localData = localStorage.getItem('projectData');
                if (localData) {
                    projectData = JSON.parse(localData);
                    console.log('localStorageからデータを読み込みました:', projectData);
                    updateDisplay();
                    return;
                }
            } catch (e) {
                console.warn('localStorage読み込みに失敗:', e);
            }

            // 3) CSV 初回ブートストラップ（Firestoreに存在しない場合のみ）
            try {
                const res = await fetch('project-data.csv', { cache: 'no-cache' });
                if (res.ok) {
                    const csvText = await res.text();
                    projectData = parseCsvToProjectData(csvText);
                    console.log('CSVからデータを読み込みました（初期投入）:', projectData);
                    updateDisplay();
                    try {
                        await saveData();
                        console.log('CSVデータをFirebaseに初期投入しました');
                    } catch (syncError) {
                        console.warn('Firebase初期投入に失敗:', syncError);
                    }
                    return;
                }
            } catch (e) {
                console.warn('CSV読み込みに失敗:', e);
            }

            // 4) 最終フォールバック（埋め込み初期データ）
            console.log('デフォルトデータを読み込みます');
            await initializeDefaultData();
            updateDisplay();
        }

        // Firestoreリアルタイム購読（完全に無効化）
        function subscribeRealtime() {
            console.log('⚠️ リアルタイム購読を完全に無効化しています（データ上書き問題のため）');
            // リアルタイム購読を完全に無効化（データ上書き問題のため）
            return;
            
            if (!firebaseInitialized || !db) return;
            try {
                window._unsubscribeProject = db.collection('projectData').doc('main').onSnapshot((doc) => {
                    if (!doc.exists) return;
                    // 自分のペンディング書き込みはスキップ
                    if (doc.metadata && doc.metadata.hasPendingWrites) return;
                    const data = doc.data();
                    // 変更がなければスキップ
                    const before = JSON.stringify(projectData);
                    const after = JSON.stringify(data);
                    if (before === after) return;
                    projectData = data;
                    localStorage.setItem('projectData', JSON.stringify(projectData));
                    console.log('Firestoreリアルタイム更新を反映');
                    updateDisplay();
                }, (err) => {
                    console.warn('リアルタイム購読エラー:', err);
                });
            } catch (e) {
                console.warn('リアルタイム購読の設定に失敗:', e);
            }
        }

        // CSV文字列 → 内部オブジェクトへ変換
        function parseCsvToProjectData(csv) {
            const lines = csv.split('\n').filter(l => l.trim().length > 0);
            if (lines.length <= 1) return {};
            // 期待ヘッダー: カテゴリ,ページ名,URL,ステータス,担当者,機能,最終更新日
            const data = {};
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const rawStatus = (values[3] || '').trim();
                const toInternal = (s) => s === 'complete' ? 'completed' : (s === 'pending' ? 'in-progress' : 'pending');
                const rawAssignee = (values[4] || '').trim();
                const toAssignee = rawAssignee === 'frontend' ? 'フロントエンド' : (rawAssignee === 'backend' ? 'バックエンド' : rawAssignee);
                const item = {
                    id: i.toString(),
                    category: (values[0] || '未設定').trim(),
                    pageName: (values[1] || '').trim(),
                    url: (values[2] || '').trim(),
                    pcStatus: toInternal(rawStatus),
                    spStatus: toInternal(rawStatus),
                    assignee: toAssignee,
                    function: (values[5] || '').trim(),
                    lastUpdated: (values[6] || new Date().toISOString().split('T')[0]).trim()
                };
                data[item.id] = item;
            }
            // グローバルカテゴリも更新
            categories = [...new Set(Object.values(data).map(it => it.category))];
            return data;
        }

        // 初期データ設定（CSVから読み込み）
        async function initializeDefaultData() {
            // CSVデータをJavaScriptオブジェクトに変換
            const csvData = `カテゴリ,ページ名,URL,ステータス,担当者,機能,最終更新日
メイン,トップページ,index.html,complete,frontend,サービス一覧・カテゴリフィルタ・カート連携,2025-01-27
マイページ：レポート関連,PC/レポート一覧画面,report.html,complete,frontend,動的レポート一覧・ページネーション機能,2025-01-27
マイページ,PC/マイページTOP画面,mypage.html,complete,frontend,ユーザー情報管理TOP画面,2025-01-27
マイページ：レポート関連,PC/レポート内容詳細画面,reports/[id].html,complete,frontend,動的レポート詳細表示,2025-01-27
認証,PC/サインインTOP画面,signin.html,complete,frontend,ユーザーサインイン（ログイン）画面,2025-01-27
認証,PC/サインアップ（新規登録）画面１,signup.html,complete,frontend,ユーザー登録,2025-01-27
認証,PC/サインアップ（新規登録）画面２,signup2.html,complete,frontend,追加情報入力,2025-01-27
認証,PC/サインアップ（新規登録）画面３,signup3.html,complete,frontend,最終確認,2025-01-27
認証,パスワードリセット,reset-password.html,complete,frontend,パスワード再設定,2025-01-27
登録,個人登録,registration/personal.html,complete,frontend,個人情報登録,2025-01-27
登録,個人登録2,registration/personal2.html,complete,frontend,追加情報入力,2025-01-27
登録,法人登録,registration/corporation.html,complete,frontend,法人情報登録,2025-01-27
登録,法人登録2,registration/corporation2.html,complete,frontend,追加情報入力,2025-01-27
登録,法人登録3,registration/corporation3.html,complete,frontend,最終確認,2025-01-27
登録,登録完了,registration/complete.html,complete,frontend,完了通知・カート連携,2025-01-27
サポート,お問い合わせ完了,inquiry/complete.html,complete,frontend,完了通知,2025-01-27
マイページ,PC/マイページ/個人情報編集画面,mypage/info.html,complete,frontend,情報編集・更新,2025-01-27
サポート,お問い合わせ,mypage/inquiry.html,complete,frontend,サポート問い合わせ,2025-01-27
Eコマース,カート,cart.html,complete,frontend,ショッピングカート機能,2025-01-27
Eコマース,チェックアウト,checkout.html,complete,frontend,決済・注文処理,2025-01-27
Eコマース,注文確認,order-confirm.html,complete,frontend,注文内容確認,2025-01-27
Eコマース,注文完了,order-complete.html,complete,frontend,注文完了通知,2025-01-27
SPバージョン,カート画面,cart.html,pending,frontend,SP版のレスポンシブ対応カート画面,2025-10-28
Eコマース,発注履歴確認機能,？？？,unknown,backend,過去の注文から、日毎の清掃詳細・再発注・請求書のダウンロード・レポートの確認ができる,2025-10-28
SPバージョン,発注履歴確認画面,？？？,unknown,backend,SP 過去の注文から、日毎の清掃詳細・再発注・請求書のダウンロード・レポートの確認ができる,2025-10-28
登録,PC/クレジットカード情報確認画面,？？？,unknown,frontend,マイページ上の「登録クレジット情報を確認する画面」,2025-10-28
Eコマース,クレジットカード決済機能,？？？,unknown,backend,クリジットカード情報の登録、決済ができる機能。,2025-10-28
登録,PC/クレジットカード情報入力・編集画面,？？？,unknown,frontend,クレジットカード情報入力・編集画面の実装,2025-10-28
登録,SP/クレジットカード情報確認画面,？？？,unknown,backend,クレジットカード登録・編集機能の実装,2025-10-28
SPバージョン,店舗情報編集画面,？？？,pending,frontend,SP 店舗（個人）情報の編集画面,2025-10-28
SPバージョン,新規店舗情報登録画面,？？？,unknown,frontend,SP 新規店舗情報を登録する画面,2025-10-28
SPバージョン,お客様情報（基本情報）編集画面,？？？,unknown,backend,お客様情報（基本情報）編集する画面,2025-10-28
SPバージョン,マイページTOP画面,？？？,complete,frontend,2-0　マイページのSP画面,2025-10-28
SPバージョン,マイページ：レポート一覧画面,？？？,complete,frontend,２−１清掃員から、送られてきた「清掃レポート」の一覧が表示される画面,2025-10-28
マイページ：レポート関連,SP/レポート一覧画面,report.html,complete,frontend,２−１清掃員から、送られてきた「清掃レポート」の一覧が表示される画面,2025-10-28
メイン,SP/トップページ,index.html,complete,frontend,サービス一覧・カテゴリフィルタ・カート連携,2025-10-28
マイページ,SP/マイページTOP画面,mypage.html,complete,frontend,2-0　SPマイページTOP画面,2025-10-28
マイページ,SP/マイページ/個人情報編集画面,,complete,frontend,SP/マイページ/個人情報編集画面,2025-10-28
登録,SP/クレジットカード情報入力・編集画面,,unknown,backend,,2025-10-28
マイページ：レポート関連,SP/レポート内容詳細画面,reports/[id].html,complete,frontend,動的レポート詳細表示,2025-10-28
認証,SP/サインインTOP画面,signin.html,unknown,frontend,ユーザーサインイン（ログイン）画面,2025-10-27
認証,SP/サインアップ（新規登録）画面1,signup.html,unknown,frontend,,2025-10-28
認証,SP/サインアップ（新規登録）画面２,signup2.html,unknown,frontend,,2025-10-28
認証,SP/サインアップ（新規登録）画面3,signup3.html,unknown,frontend,,2025-10-28`;

            const lines = csvData.trim().split('\n');
            const headers = lines[0].split(',');
            projectData = {};

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',');
                    const item = {
                        id: i.toString(),
                        category: values[0] || '未設定',
                        pageName: values[1] || '',
                        url: values[2] || '',
                        pcStatus: values[3] === 'complete' ? 'completed' : (values[3] === 'pending' ? 'in-progress' : 'pending'),
                        spStatus: values[3] === 'complete' ? 'completed' : (values[3] === 'pending' ? 'in-progress' : 'pending'),
                        assignee: values[4] === 'frontend' ? 'フロントエンド' : (values[4] === 'backend' ? 'バックエンド' : values[4] || ''),
                        function: values[5] || '',
                        lastUpdated: values[6] || new Date().toISOString().split('T')[0]
                    };
                    projectData[item.id] = item;
                }
            }

            // カテゴリリストを更新
            categories = [...new Set(Object.values(projectData).map(item => item.category))];
            
            await saveData();
        }

        // GitHub APIを使用してCSVファイルを更新
        async function updateCSVOnGitHub() {
            console.log('🔄 GitHub上のCSVファイルを更新開始');
            
            try {
                const csvData = convertProjectDataToCSV(projectData);
                const fileName = 'project-data-updated.csv';
                
                // GitHub APIを使用してファイルを更新
                const response = await fetch(`https://api.github.com/repos/sakurada-masaru/misesapo-ver1.0-progress/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'token YOUR_GITHUB_TOKEN', // 実際のトークンが必要
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Update ${fileName} - ${new Date().toISOString()}`,
                        content: btoa(unescape(encodeURIComponent(csvData))), // Base64エンコード
                        sha: 'current_file_sha' // 現在のファイルのSHAが必要
                    })
                });
                
                if (response.ok) {
                    console.log('✅ GitHub上のCSVファイルを更新しました');
                    return true;
                } else {
                    console.error('❌ GitHub API更新失敗:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('❌ GitHub API更新エラー:', error);
                return false;
            }
        }

        // CSV表示ページを開く
        function openCSVView() {
            const csvData = convertProjectDataToCSV(projectData);
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                <head>
                    <title>プロジェクトデータ - CSV表示</title>
                    <style>
                        body { font-family: monospace; padding: 20px; }
                        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; }
                        .header { background: #FF679C; color: white; padding: 10px; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>📊 プロジェクトデータ（最新）</h1>
                        <p>更新日時: ${new Date().toLocaleString('ja-JP')}</p>
                    </div>
                    <pre>${csvData}</pre>
                    <p><a href="data:text/csv;charset=utf-8,${encodeURIComponent(csvData)}" download="project-data-latest.csv">📥 CSVファイルをダウンロード</a></p>
                </body>
                </html>
            `);
        }

        // プロジェクトデータをCSV形式に変換
        function convertProjectDataToCSV(data) {
            const headers = ['ID', 'カテゴリ', 'ページ名', 'URL', 'PC版開発状況', 'SP版開発状況', '業務担当', '機能', '最終更新日'];
            const rows = [headers.join(',')];
            
            Object.values(data).forEach(item => {
                if (item.id && item.pageName) {
                    const row = [
                        item.id,
                        item.category || '',
                        item.pageName || '',
                        item.url || '',
                        item.pcStatus || '',
                        item.spStatus || '',
                        item.assignee || '',
                        item.function || '',
                        item.lastUpdated || ''
                    ];
                    rows.push(row.join(','));
                }
            });
            
            return rows.join('\n');
        }

        // 強制保存関数（更新ボタン用）
        async function forceSaveData() {
            console.log('💾 強制保存開始');
            try {
                await saveData();
                alert('✅ データを保存しました！');
                console.log('✅ 強制保存完了');
            } catch (error) {
                console.error('❌ 強制保存失敗:', error);
                alert('❌ 保存に失敗しました。コンソールを確認してください。');
            }
        }

        // データ保存
        async function saveData() {
            console.log('💾 saveData() 開始');
            console.log('Firebase初期化状態:', firebaseInitialized);
            console.log('DB接続状態:', !!db);
            console.log('保存するデータ:', projectData);
            console.log('📈 保存するデータの項目数:', Object.keys(projectData).length);
            console.log('🔍 保存するデータにID 36が存在するか:', projectData.hasOwnProperty('36'));
            
            try {
                if (firebaseInitialized && db) {
                    console.log('🔥 Firebaseに保存を試行中...');
                    // Firebase書き込み（リトライ機能付き）
                    let retryCount = 0;
                    const maxRetries = 3;
                    
                    while (retryCount < maxRetries) {
                        try {
                            const payload = Object.assign({}, projectData, { _updatedAt: Date.now() });
                            console.log('Firebase送信データ:', payload);
                            console.log('📈 Firebase送信データの項目数:', Object.keys(payload).length);
                            console.log('🔍 Firebase送信データにID 36が存在するか:', payload.hasOwnProperty('36'));
                            
                            // FieldValue.delete()を使用してID 36を確実に削除
                            const FieldValue = firebase.firestore.FieldValue;
                            await db.collection('projectData').doc('main').update({
                                '36': FieldValue.delete()
                            });
                            
                            // その後、新しいデータで更新
                            await db.collection('projectData').doc('main').set(payload, { merge: true });
                            console.log('✅ データをFirebaseに保存しました');
                            
                            // 保存直後にFirebaseから読み込んで確認
                            try {
                                const doc = await db.collection('projectData').doc('main').get();
                                if (doc.exists) {
                                    const savedData = doc.data();
                                    console.log('🔄 保存直後のFirebase確認:', savedData);
                                    console.log('📈 保存直後のFirebaseデータ数:', Object.keys(savedData).length);
                                    console.log('🔍 保存直後のFirebaseにID 36が存在するか:', savedData.hasOwnProperty('36'));
                                }
                            } catch (e) {
                                console.warn('保存直後のFirebase確認失敗:', e);
                            }
                            return; // 成功したら終了
                        } catch (firebaseError) {
                            retryCount++;
                            console.error(`❌ Firebase保存失敗 (試行 ${retryCount}/${maxRetries}):`, firebaseError);
                            console.error('エラー詳細:', {
                                code: firebaseError.code,
                                message: firebaseError.message,
                                stack: firebaseError.stack
                            });
                            
                            if (retryCount >= maxRetries) {
                                throw firebaseError; // 最大リトライ回数に達したらエラーを投げる
                            }
                            
                            // 1秒待ってからリトライ
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                    }
                } else {
                    console.warn('⚠️ Firebase not initialized, saving to localStorage only');
                    localStorage.setItem('projectData', JSON.stringify(projectData));
                    console.log('✅ localStorageに保存しました');
                }
            } catch (error) {
                console.error('データ保存エラー:', error);
                // フォールバック: localStorageに保存
                try {
                    localStorage.setItem('projectData', JSON.stringify(projectData));
                    console.log('データをlocalStorageに保存しました（フォールバック）');
                } catch (localError) {
                    console.error('localStorage保存も失敗:', localError);
                }
            }
        }

        /* ========================================
           🎨 UI操作 (UI Operations)
           ======================================== */
        
        // タブ切り替え
        function showTab(tabName) {
            // 進捗管理タブのみ表示（タスクマーケットは別ページ）
            const targetView = document.getElementById('progress-view');
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            
            // 選択されたタブをアクティブに
            const targetTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // モバイルナビも更新
            const mobileNavItem = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (mobileNavItem && mobileNavItem.classList.contains('mobile-nav-item')) {
                mobileNavItem.classList.add('active');
            }
        }

        // 表示更新
        function updateDisplay() {
            updateStatistics();
            updateProgressBar();
            updateCategorySections();
            updateCategoryFilter();
        }

        // 統計情報更新
        function updateStatistics() {
            const stats = {
                completed: 0,
                spNotCompleted: 0,
                inProgress: 0,
                pending: 0,
                waiting: 0
            };

            Object.values(projectData).forEach(item => {
                if (item.pcStatus === 'completed') stats.completed++;
                if (item.spStatus !== 'completed') stats.spNotCompleted++;
                if (item.pcStatus === 'in-progress' || item.spStatus === 'in-progress') stats.inProgress++;
                if (item.pcStatus === 'pending' && item.spStatus === 'pending') stats.pending++;
                if (item.pcStatus === 'waiting' || item.spStatus === 'waiting') stats.waiting++;
            });

            document.getElementById('completedCount').textContent = stats.completed;
            document.getElementById('spNotCompletedCount').textContent = stats.spNotCompleted;
            document.getElementById('inProgressCount').textContent = stats.inProgress;
            document.getElementById('pendingCount').textContent = stats.pending;
            document.getElementById('waitingCount').textContent = stats.waiting;
        }

        // プログレスバー更新
        function updateProgressBar() {
            const total = Object.keys(projectData).length;
            const completed = Object.values(projectData).filter(item => item.pcStatus === 'completed').length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${percentage}% (${completed}/${total})`;
        }

        // ステータス表示変換関数（アイコン表示）
        function getStatusDisplay(status) {
            switch(status) {
                case 'completed': return '<span style="color: #10b981; font-size: 18px;">⚪︎</span>';
                case 'pending': return '<span style="color: #ef4444; font-size: 18px;">×</span>';
                case 'in-progress': return '進行中';
                case 'waiting': return '待機中';
                default: return '<span style="color: #ef4444; font-size: 18px;">×</span>';
            }
        }

        // ステータステキスト変換関数（従来のテキスト表示用）
        function getStatusText(status) {
            switch(status) {
                case 'completed': return '完了';
                case 'in-progress': return '進行中';
                case 'waiting': return '待機中';
                case 'pending': return '未着手';
                default: return '未着手';
            }
        }

        // カテゴリセクション更新
        function updateCategorySections() {
            const container = document.getElementById('categorySections');
            container.innerHTML = '';

            categories.forEach(category => {
                const categoryItems = Object.values(projectData).filter(item => item.category === category);
                if (categoryItems.length === 0) return;

                // カテゴリ内統計計算
                const totalCount = categoryItems.length;
                const completedCount = categoryItems.filter(item => item.pcStatus === 'completed').length;
                const spNotCompletedCount = categoryItems.filter(item => item.spStatus !== 'completed').length;
                const inProgressCount = categoryItems.filter(item => item.pcStatus === 'in-progress' || item.spStatus === 'in-progress').length;
                const pendingCount = categoryItems.filter(item => item.pcStatus === 'pending' && item.spStatus === 'pending').length;
                const waitingCount = categoryItems.filter(item => item.pcStatus === 'waiting' || item.spStatus === 'waiting').length;

                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `
                    <div class="category-header">
                        <h3>${category}</h3>
                        <div class="category-stats">
                            <span class="stat-item">総数: ${totalCount}</span>
                            <span class="stat-item">完了: ${completedCount}</span>
                            <span class="stat-item">SP未対応: ${spNotCompletedCount}</span>
                            <span class="stat-item">進行中: ${inProgressCount}</span>
                            <span class="stat-item">未着手: ${pendingCount}</span>
                            <span class="stat-item">待機中: ${waitingCount}</span>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ページ名</th>
                                <th>URL</th>
                                <th>PC</th>
                                <th>SP</th>
                                <th>業務担当</th>
                                <th>機能</th>
                                <th>最終更新日</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${categoryItems.map(item => `
                                <tr>
                                    <td data-label="ページ名">${item.pageName}</td>
                                    <td data-label="URL"><a href="${item.url}" target="_blank" style="color: #FF679C; text-decoration: none;">${item.url}</a></td>
                                    <td data-label="PC">${getStatusDisplay(item.pcStatus)}</td>
                                    <td data-label="SP">${getStatusDisplay(item.spStatus)}</td>
                                    <td data-label="業務担当">${getAssigneeIcon(item.assignee)}</td>
                                    <td data-label="機能">${item.function || ''}</td>
                                    <td data-label="最終更新日">${item.lastUpdated || ''}</td>
                                    <td data-label="操作">
                                        <button class="btn btn-edit" data-id="${item.id}" onclick="editItem('${item.id}')">編集</button>
                                        <button class="btn btn-delete" data-id="${item.id}" onclick="console.log('削除ボタンクリック:', '${item.id}'); deleteItem('${item.id}')">削除</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                container.appendChild(section);
            });
        }

        // 業務担当アイコン表示関数
        function getAssigneeIcon(assignee) {
            const iconMap = {
                'デザイナー': '<img src="images/デザイナー.svg" alt="デザイナー" style="width: 20px; height: 20px;">',
                'フロントエンド': '<img src="images/フロントエンジニア.svg" alt="フロントエンド" style="width: 20px; height: 20px;">',
                'バックエンド': '<img src="images/バックエンジニア.svg" alt="バックエンド" style="width: 20px; height: 20px;">',
                'メディア': '<img src="images/メディア.svg" alt="メディア" style="width: 20px; height: 20px;">',
                'プロダクション': '<img src="images/direction.png" alt="プロダクション" style="width: 20px; height: 20px;">'
            };
            return iconMap[assignee] || '';
        }

        // カテゴリフィルター更新
        function updateCategoryFilter() {
            const filter = document.getElementById('categoryFilter');
            filter.innerHTML = '<option value="">すべて</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                filter.appendChild(option);
            });
        }

        /* ========================================
           🎛️ 表示切り替え機能 (Toggle Functions)
           ======================================== */
        function toggleStats() {
            const statsElement = document.querySelector('.stats');
            const toggleButton = document.getElementById('statsToggle');
            const mobileToggleButton = document.getElementById('mobileStatsToggle');
            const miniToggleButton = document.getElementById('miniStatsToggle');
            const bottomToggleButton = document.getElementById('bottomStatsToggle');
            if (!statsElement || !toggleButton) return;
            const hidden = statsElement.classList.toggle('hidden');
            toggleButton.classList.toggle('active', !hidden);
            if (mobileToggleButton) {
                mobileToggleButton.classList.toggle('active', !hidden);
            }
            if (miniToggleButton) {
                miniToggleButton.classList.toggle('active', !hidden);
            }
            if (bottomToggleButton) {
                bottomToggleButton.classList.toggle('active', !hidden);
            }
            toggleButton.title = hidden ? '統計カード (非表示) - クリックで表示' : '統計カード (表示中) - クリックで非表示';
        }

        function toggleProgress() {
            const progressElement = document.querySelector('.progress-container');
            const toggleButton = document.getElementById('progressToggle');
            const mobileToggleButton = document.getElementById('mobileProgressToggle');
            const miniToggleButton = document.getElementById('miniProgressToggle');
            const bottomToggleButton = document.getElementById('bottomProgressToggle');
            if (!progressElement || !toggleButton) return;
            const hidden = progressElement.classList.toggle('hidden');
            toggleButton.classList.toggle('active', !hidden);
            if (mobileToggleButton) {
                mobileToggleButton.classList.toggle('active', !hidden);
            }
            if (miniToggleButton) {
                miniToggleButton.classList.toggle('active', !hidden);
            }
            if (bottomToggleButton) {
                bottomToggleButton.classList.toggle('active', !hidden);
            }
            toggleButton.title = hidden ? '完成率 (非表示) - クリックで表示' : '完成率 (表示中) - クリックで非表示';
        }

        // ミニメニューの開閉機能
        function toggleMiniMenu() {
            const miniMenuContent = document.getElementById('miniMenuContent');
            const miniMenuToggle = document.getElementById('miniMenuToggle');
            
            if (miniMenuContent) {
                const isOpen = miniMenuContent.classList.contains('show');
                
                if (isOpen) {
                    miniMenuContent.classList.remove('show');
                    if (miniMenuToggle) miniMenuToggle.classList.remove('active');
                } else {
                    miniMenuContent.classList.add('show');
                    if (miniMenuToggle) miniMenuToggle.classList.add('active');
                }
            }
        }

        // ボトムパネルを開く
        function openBottomPanel() {
            const bottomPanel = document.getElementById('mobileBottomPanel');
            const bottomMiniMenuToggle = document.getElementById('bottomMiniMenuToggle');
            
            if (bottomPanel) {
                bottomPanel.classList.add('show');
                if (bottomMiniMenuToggle) bottomMiniMenuToggle.classList.add('active');
            }
        }

        // ボトムパネルを閉じる
        function closeBottomPanel() {
            const bottomPanel = document.getElementById('mobileBottomPanel');
            const bottomMiniMenuToggle = document.getElementById('bottomMiniMenuToggle');
            
            if (bottomPanel) {
                bottomPanel.classList.remove('show');
                if (bottomMiniMenuToggle) bottomMiniMenuToggle.classList.remove('active');
            }
        }

        // ミニメニュー外クリックで閉じる
        document.addEventListener('click', function(event) {
            const miniMenu = document.getElementById('mobileMiniMenu');
            const miniMenuContent = document.getElementById('miniMenuContent');
            const miniMenuToggle = document.getElementById('miniMenuToggle');
            const bottomPanel = document.getElementById('mobileBottomPanel');
            const bottomPanelContent = document.getElementById('bottomPanelContent');
            const bottomMiniMenuToggle = document.getElementById('bottomMiniMenuToggle');
            
            // ミニメニューの外クリック処理
            if (miniMenuContent && miniMenuContent.classList.contains('show')) {
                const isMiniMenuClick = miniMenu && miniMenu.contains(event.target);
                
                if (!isMiniMenuClick) {
                    miniMenuContent.classList.remove('show');
                    if (miniMenuToggle) miniMenuToggle.classList.remove('active');
                }
            }
            
            // ボトムパネルの外クリック処理
            if (bottomPanel && bottomPanel.classList.contains('show')) {
                const isBottomPanelClick = bottomPanelContent && bottomPanelContent.contains(event.target);
                const isBottomMenuClick = bottomMiniMenuToggle && bottomMiniMenuToggle.contains(event.target);
                
                if (!isBottomPanelClick && !isBottomMenuClick) {
                    bottomPanel.classList.remove('show');
                    if (bottomMiniMenuToggle) bottomMiniMenuToggle.classList.remove('active');
                }
            }
        });

        /* ========================================
           🪟 モーダル操作 (Modal Operations)
           ======================================== */
        
        // 新規追加モーダル
        function openAddModal() {
            document.getElementById('addModal').style.display = 'block';
            document.getElementById('addForm').reset();
            document.getElementById('addLastUpdated').value = new Date().toISOString().split('T')[0];
        }

        function closeAddModal() {
            document.getElementById('addModal').style.display = 'none';
            document.getElementById('addNewCategoryGroup').style.display = 'none';
        }

        // 編集モーダル
        function editItem(id) {
            console.log('editItem called with id:', id);
            const data = projectData[id];
            if (!data) {
                console.error('Data not found for id:', id);
                return;
            }

            document.getElementById('editId').value = id;
            document.getElementById('editCategory').value = data.category;
            document.getElementById('editPageName').value = data.pageName;
            document.getElementById('editUrl').value = data.url;
            document.getElementById('editPCStatus').value = data.pcStatus || 'pending';
            document.getElementById('editSPStatus').value = data.spStatus || 'pending';
            document.getElementById('editAssignee').value = data.assignee || '';
            document.getElementById('editFunction').value = data.function || '';
            document.getElementById('editLastUpdated').value = data.lastUpdated || '';

            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('editNewCategoryGroup').style.display = 'none';
        }

        // アップロードモーダル
        function openUploadModal() {
            document.getElementById('uploadModal').style.display = 'block';
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
        }

        // カテゴリ管理モーダル
        function openCategoryModal() {
            document.getElementById('categoryModal').style.display = 'block';
            updateCategoryList();
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
        }

        /* ========================================
           📝 フォーム処理 (Form Handling)
           ======================================== */
        
        // イベントリスナー設定
        function setupEventListeners() {
            // 新規追加フォーム
            document.getElementById('addForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewItem();
            });

            // 編集フォーム
            document.getElementById('editForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateItem();
            });

            // アップロードフォーム
            document.getElementById('uploadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                uploadCSV();
            });

            // モーダル外クリックで閉じる
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        }

        // 新規項目追加
        async function addNewItem() {
            console.log('➕ addNewItem() 開始');
            const id = Date.now().toString();
            const newItem = {
                id: id,
                category: document.getElementById('addCategory').value || '未設定',
                pageName: document.getElementById('addPageName').value.trim() || '未設定',
                url: document.getElementById('addUrl').value.trim() || '',
                pcStatus: document.getElementById('addPCStatus').value || 'pending',
                spStatus: document.getElementById('addSPStatus').value || 'pending',
                assignee: document.getElementById('addAssignee').value || '',
                function: document.getElementById('addFunction').value.trim() || '未設定',
                lastUpdated: document.getElementById('addLastUpdated').value || new Date().toISOString().split('T')[0]
            };

            console.log('📝 新しいアイテム:', newItem);
            projectData[id] = newItem;
            console.log('📊 プロジェクトデータ更新後:', projectData);
            
            try {
                await saveData();
                console.log('✅ データ保存完了');
                updateDisplay();
                closeAddModal();
                console.log('✅ アイテム追加成功');
            } catch (error) {
                console.error('❌ アイテム追加失敗:', error);
                alert('データの保存に失敗しました。コンソールを確認してください。');
            }
        }

        // 項目更新
        async function updateItem() {
            console.log('updateItem called');
            const id = document.getElementById('editId').value;
            const updatedItem = {
                id: id,
                category: document.getElementById('editCategory').value || '未設定',
                pageName: document.getElementById('editPageName').value.trim() || '未設定',
                url: document.getElementById('editUrl').value.trim() || '',
                pcStatus: document.getElementById('editPCStatus').value || 'pending',
                spStatus: document.getElementById('editSPStatus').value || 'pending',
                assignee: document.getElementById('editAssignee').value || '',
                function: document.getElementById('editFunction').value.trim() || '未設定',
                lastUpdated: document.getElementById('editLastUpdated').value || new Date().toISOString().split('T')[0]
            };

            console.log('Updated item:', updatedItem);
            projectData[id] = updatedItem;
            console.log('Project data updated:', projectData);
            
            await saveData();
            updateDisplay();
            closeEditModal();
            console.log('Item updated successfully');
        }

        // 項目削除
        async function deleteItem(id) {
            console.log('🗑️ deleteItem() 開始, ID:', id);
            console.log('削除対象のID:', id);
            console.log('削除前のプロジェクトデータ:', projectData);
            
            if (confirm(`⚠️ 警告: この項目を完全に削除しますか？\n\n項目ID: ${id}\n\n削除後は復元できません。\n\n「OK」を押すと削除されます。`)) {
                console.log('✅ 削除確認済み');
                delete projectData[id];
                console.log('📊 プロジェクトデータから削除後:', projectData);
                console.log('🔍 削除されたIDが存在するか:', projectData.hasOwnProperty(id));
                console.log('📈 現在のデータ数:', Object.keys(projectData).length);
                
                // 削除後は即座に保存
                try {
                    await saveData();
                    console.log('✅ 削除データを保存しました');
                    
                    // Firebaseから再読み込みして確認
                    try {
                        const doc = await db.collection('projectData').doc('main').get();
                        if (doc.exists) {
                            const savedData = doc.data();
                            console.log('🔄 Firebase再読み込み確認:', savedData);
                            console.log('📈 保存後のFirebaseデータ数:', Object.keys(savedData).length);
                            console.log('🔍 保存後のFirebaseにID 36が存在するか:', savedData.hasOwnProperty(id));
                        }
                    } catch (e) {
                        console.warn('Firebase再読み込み確認失敗:', e);
                    }
                    
                    updateDisplay();
                    console.log('✅ 表示更新完了');
                    
                    // 保存後の確認
                    console.log('🔍 保存後のデータ数:', Object.keys(projectData).length);
                    console.log('🔍 削除されたIDがまだ存在するか:', projectData.hasOwnProperty(id));
                } catch (error) {
                    console.error('❌ 削除データ保存失敗:', error);
                    updateDisplay();
                    console.log('⚠️ 表示更新完了（更新ボタンで保存してください）');
                }
            } else {
                console.log('❌ 削除キャンセル');
            }
        }

        /* ========================================
           🏷️ カテゴリ管理 (Category Management)
           ======================================== */
        
        // カテゴリ変更処理
        function handleCategoryChange(selectElement) {
            const isAddNew = selectElement.value === '__ADD_CATEGORY__';
            const newCategoryGroup = document.getElementById(selectElement.id.replace('Category', 'NewCategoryGroup'));
            
            if (isAddNew) {
                newCategoryGroup.style.display = 'block';
                selectElement.value = '';
            } else {
                newCategoryGroup.style.display = 'none';
            }
        }

        // 新しいカテゴリ名処理
        function handleNewCategoryName(inputElement) {
            const categoryName = inputElement.value.trim();
            if (categoryName && !categories.includes(categoryName)) {
                categories.push(categoryName);
                updateCategoryFilter();
                updateCategoryList();
                
                // セレクトボックスに新しいカテゴリを設定
                const selectElement = document.getElementById(inputElement.id.replace('NewCategoryName', 'Category'));
                selectElement.value = categoryName;
                inputElement.value = '';
            }
        }

        // カテゴリリスト更新
        function updateCategoryList() {
            const container = document.getElementById('categoryList');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>${category}</span>
                        <button class="btn btn-delete" onclick="removeCategory('${category}')">削除</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // カテゴリ削除
        async function removeCategory(categoryName) {
            if (confirm(`カテゴリ「${categoryName}」を削除しますか？`)) {
                categories = categories.filter(cat => cat !== categoryName);
                
                // そのカテゴリの項目を「未設定」に移動
                Object.values(projectData).forEach(item => {
                    if (item.category === categoryName) {
                        item.category = '未設定';
                    }
                });
                
                if (!categories.includes('未設定')) {
                    categories.push('未設定');
                }
                
                await saveData();
                updateDisplay();
                updateCategoryList();
            }
        }

        // 新しいカテゴリ追加
        function addNewCategory() {
            const categoryName = document.getElementById('newCategoryName').value.trim();
            if (categoryName && !categories.includes(categoryName)) {
                categories.push(categoryName);
                updateCategoryFilter();
                updateCategoryList();
                document.getElementById('newCategoryName').value = '';
            }
        }

        /* ========================================
           📁 CSV管理 (CSV Management)
           ======================================== */
        
        // CSVダウンロード
        function downloadCSV() {
            const headers = ['ID', 'カテゴリ', 'ページ名', 'URL', 'PCステータス', 'SPステータス', '業務担当', '機能', '最終更新日'];
            const csvContent = [
                headers.join(','),
                ...Object.values(projectData).map(item => [
                    item.id,
                    item.category,
                    item.pageName,
                    item.url,
                    item.pcStatus,
                    item.spStatus,
                    item.assignee,
                    item.function,
                    item.lastUpdated
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'project_data.csv';
            link.click();
        }

        // CSVアップロード
        function uploadCSV() {
            const password = document.getElementById('password').value;
            const file = document.getElementById('csvFile').files[0];
            
            if (password !== 'misesapo') {
                alert('パスワードが正しくありません');
                return;
            }
            
            if (!file) {
                alert('ファイルを選択してください');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',');
                    
                    const newData = {};
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const values = lines[i].split(',');
                            const item = {};
                            headers.forEach((header, index) => {
                                item[header.trim()] = values[index] ? values[index].trim() : '';
                            });
                            newData[item.ID] = item;
                        }
                    }
                    
                    projectData = newData;
                    await saveData();
                    updateDisplay();
                    closeUploadModal();
                    alert('CSVファイルが正常にアップロードされました');
                } catch (error) {
                    console.error('CSV解析エラー:', error);
                    alert('CSVファイルの解析に失敗しました');
                }
            };
            reader.readAsText(file);
        }

        /* ========================================
           🔍 フィルター機能 (Filter Functions)
           ======================================== */
        
        // カテゴリフィルター
        function filterByCategory() {
            const selectedCategory = document.getElementById('categoryFilter').value;
            const sections = document.querySelectorAll('.category-section');
            
            sections.forEach(section => {
                if (!selectedCategory || section.querySelector('h3').textContent.includes(selectedCategory)) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }

        // ステータスフィルター
        function filterByStatus() {
            const selectedStatus = document.getElementById('statusFilter').value;
            // 実装は必要に応じて追加
        }

        /* ========================================
           🌐 グローバル関数 (Global Functions)
           ======================================== */
        
        // グローバルスコープに関数を設定
        window.editItem = editItem;
        window.deleteItem = deleteItem;
        window.showTab = showTab;
        window.openAddModal = openAddModal;
        window.closeAddModal = closeAddModal;
        window.closeEditModal = closeEditModal;
        window.openUploadModal = openUploadModal;
        window.closeUploadModal = closeUploadModal;
        window.openCategoryModal = openCategoryModal;
        window.closeCategoryModal = closeCategoryModal;
        window.downloadCSV = downloadCSV;
        window.filterByCategory = filterByCategory;
        window.filterByStatus = filterByStatus;
        window.handleCategoryChange = handleCategoryChange;
        window.handleNewCategoryName = handleNewCategoryName;
        window.addNewCategory = addNewCategory;
        window.removeCategory = removeCategory;
        window.toggleStats = toggleStats;
        window.toggleProgress = toggleProgress;
    </script>
</body>
</html>
