<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>Task Market - „Éü„Çª„Çµ„Éù</title>
    <style>
        /*
         ========================================
           Task Market „Çø„Çπ„ÇØÁÆ°ÁêÜ„Éö„Éº„Ç∏
           ========================================
           
           üìã Ê¶ÇË¶Å
           WEB„Çµ„Ç§„ÉàÈñãÁô∫„Å´„Åä„Åë„ÇãÊßò„ÄÖ„Å™„Çø„Çπ„ÇØ„ÇíÁÆ°ÁêÜ„Åô„Çã„Éö„Éº„Ç∏
           
           üé® „Éá„Ç∂„Ç§„É≥„Ç≥„É≥„Çª„Éó„Éà
           - Âü∫Ë™ø„Ç´„É©„Éº: ÁôΩ„Å®„Éî„É≥„ÇØ
           - „Éï„É´HDÁîªÈù¢ÂØæÂøú
           - „Çπ„Éû„ÉõÁâà: 430px
           
           üìê „É¨„Ç§„Ç¢„Ç¶„Éà
           - „Éò„ÉÉ„ÉÄ„Éº: 60pxÈ´ò„Åï
           - „Éú„Éá„Ç£: 3„Ç´„É©„É†
             - „Ç´„É©„É†1: „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÔºà10%ÂπÖ„ÄÅ100%È´ò„ÅïÔºâ
             - „Ç´„É©„É†2: „É°„Ç§„É≥„Éú„Éº„ÉâÔºà60%ÂπÖÔºâ
             - „Ç´„É©„É†3: Ë©≥Á¥∞„Éú„Éº„ÉâÔºà30%ÂπÖÔºâ
           
           üîß Ê©üËÉΩ
           - Êñ∞Ë¶èËøΩÂä†„Éú„Çø„É≥
           - „Çø„Çπ„ÇØÂÜÖÂÆπÂÖ•Âäõ„Éï„Ç©„Éº„É†
         ========================================
        */
        :root {
            /* „Ç´„É©„Éº„Éë„É¨„ÉÉ„Éà */
            --color-primary: #FF679C;
            --color-primary-hover: #FF4081;
            --color-primary-light: rgba(255, 103, 156, 0.1);
            --color-primary-shadow: rgba(255, 103, 156, 0.2);
            
            --color-background: #ffffff;
            --color-background-secondary: #fafafa;
            --color-text-primary: #333333;
            --color-text-secondary: #7f8c8d;
            --color-border: #e1e8ed;
            
            /* „Éï„Ç©„É≥„ÉàË®≠ÂÆö */
            --font-family-primary: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            /* „Çπ„Éö„Éº„Ç∑„É≥„Ç∞ */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            
            /* „Éú„Éº„ÉÄ„ÉºÂçäÂæÑ */
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-radius-xl: 16px;
            
            /* „Ç∑„É£„Éâ„Ç¶ */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            
            /* „Éà„É©„É≥„Ç∏„Ç∑„Éß„É≥ */
            --transition-normal: 0.3s ease;

            /* „Éë„Éç„É´„Ç´„É©„ÉºÔºà5„Å§„ÅÆ„Éë„Éç„É´Áî®Ôºâ */
            --panel-1-color: #FF679C;
            --panel-1-hover: #FF4081;
            --panel-2-color: #4A90E2;
            --panel-2-hover: #357ABD;
            --panel-3-color: #50C878;
            --panel-3-hover: #3FA863;
            --panel-4-color: #FF8C42;
            --panel-4-hover: #FF6B1F;
            --panel-5-color: #4CAF50;
            --panel-5-hover: #45a049;

            /* „Ç´„ÉÜ„Ç¥„É™„Åî„Å®„ÅÆËñÑ„ÅÑÊû†Á∑öËâ≤Ôºà„Çø„Çπ„ÇØ„Ç´„Éº„ÉâÁî®Ôºâ */
            --category-design-border: rgba(255, 103, 156, 0.3);
            --category-frontend-border: rgba(74, 144, 226, 0.3);
            --category-backend-border: rgba(80, 200, 120, 0.3);
            --category-media-border: rgba(255, 140, 66, 0.3);
            --category-other-border: rgba(127, 140, 141, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-primary);
            background: var(--color-background);
            color: var(--color-text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* „Çπ„Éó„É©„ÉÉ„Ç∑„É•„Çπ„ÇØ„É™„Éº„É≥ */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-background);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 1;
            /* ÁôΩÁîªÈù¢„ÇíÊ∂à„Åô: „É≠„Ç¥„ÅåÊ∂à„Åà„ÅüÂæåÔºàÁ¥Ñ3ÁßíÂæåÔºâ„Å´ÈñãÂßã */
            animation: fadeOutScreen 0.5s ease-out 3s forwards;
        }

        .splash-screen.hidden {
            display: none;
        }

        .splash-logo {
            width: 144px;
            height: 144px;
            opacity: 0;
            /* 1. „É≠„Ç¥„ÅåÂá∫„Çã: 0.3ÁßíÂæå„Å´ÈñãÂßã„ÄÅ1Áßí„Åã„Åë„Å¶Ë°®Á§∫ */
            /* 2. „É≠„Ç¥„ÅåÊ∂à„Åà„Çã: 2ÁßíÂæå„Å´ÈñãÂßã„ÄÅ0.5Áßí„Åã„Åë„Å¶Ê∂à„Åà„Çã */
            animation: 
                fadeInUp 1s ease-out 0.3s forwards,
                fadeOutLogo 0.5s ease-out 2s forwards;
        }

        /* „É≠„Ç¥„Åå„Åµ„Çè„Å£„Å®Ë°®Á§∫ */
        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* „É≠„Ç¥„ÅåÊ∂à„Åà„Çã */
        @keyframes fadeOutLogo {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
        }

        /* ÁôΩÁîªÈù¢„ÅåÊ∂à„Åà„Çã */
        @keyframes fadeOutScreen {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                visibility: hidden;
            }
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            height: 60px;
            background: var(--color-background);
            border-bottom: 2px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            position: relative;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .logo {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .nav-button {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: transparent;
            color: var(--color-text-primary);
            font-size: var(--font-size-sm);
            cursor: pointer;
            border-radius: var(--border-radius-md);
            transition: var(--transition-normal);
        }

        .nav-button:hover {
            background: var(--color-primary-light);
            color: var(--color-primary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }


        /* „ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÔºàÂêπ„ÅçÂá∫„ÅóÔºâ */
        .tooltip-text {
            position: absolute;
            padding: 6px 10px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            font-size: 11px;
            white-space: nowrap;
            border-radius: var(--border-radius-sm);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
            z-index: 1000;
        }

        .tooltip-text::before {
            content: '';
            position: absolute;
            border: 6px solid transparent;
        }
        
        /* Â∑¶ÂÅ¥„Éú„Çø„É≥ÔºàÂ∑¶„Éë„Éç„É´Ôºâ„ÅÆ„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó */
        .slide-panel-handle .tooltip-text {
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 8px;
        }
        
        .slide-panel-handle .tooltip-text::before {
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border-right-color: rgba(0, 0, 0, 0.85);
        }

        /* „ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóË°®Á§∫Ôºà„Éõ„Éê„ÉºÊôÇÔºâ */
        .add-task-button:hover .tooltip-text,
        .add-badge-button:hover .tooltip-text,
        .trash-bin:hover .tooltip-text,
        .complete-button:hover .tooltip-text,
        .slide-panel-handle:hover .tooltip-text {
            opacity: 1;
            visibility: visible;
        }

        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä */
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
            width: 100%;
        }


        /* „Ç´„É©„É†2: „É°„Ç§„É≥„Éú„Éº„Éâ */
        .main-board {
            width: 100%;
            height: 100%;
            background: var(--color-background);
            overflow-y: auto;
            padding: var(--spacing-lg);
            transition: var(--transition-normal);
        }

        /* „É°„Ç§„É≥„Éú„Éº„Éâ„ÅÆÂπÖË™øÊï¥„ÅØJavaScript„ÅßÂà∂Âæ° */

        /* „Ç´„É©„É†3: Ë©≥Á¥∞„Éú„Éº„ÉâÔºàÂè≥„Åã„Çâ„Çπ„É©„Ç§„Éâ„Ç§„É≥„Åô„Çã„Éë„Éç„É´Ôºâ */
        .detail-board-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1500;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .detail-board-overlay.active {
            display: block;
        }

        .detail-board {
            position: fixed;
            top: 0;
            right: 0;
            width: 40%;
            height: 100%;
            background: var(--color-background-secondary);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            z-index: 1501;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
            border-left: 2px solid var(--color-border);
            padding: var(--spacing-lg);
        }

        .detail-board.active {
            transform: translateX(0);
        }
        
        /* „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Éë„Éç„É´ÔºàÂè≥„Åã„Çâ„Çπ„É©„Ç§„Éâ„Ç§„É≥„ÄÅ„Çø„Çπ„ÇØË©≥Á¥∞„Éë„Éç„É´„ÅÆ‰∏ä„Å´Ë°®Á§∫Ôºâ */
        .time-record-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1600;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .time-record-panel-overlay.active {
            display: block;
        }

        .time-record-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 40%;
            height: 100%;
            background: var(--color-background-secondary);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            z-index: 1601;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
            border-left: 2px solid var(--color-border);
            padding: var(--spacing-lg);
        }

        .time-record-panel.active {
            transform: translateX(0);
        }

        .time-record-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-border);
            position: sticky;
            top: 0;
            background: var(--color-background-secondary);
            z-index: 10;
            padding-top: var(--spacing-md);
        }

        .time-record-panel-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .time-record-panel-close-button {
            background: none;
            border: none;
            font-size: 32px;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-md);
            transition: var(--transition-normal);
            line-height: 1;
        }

        .time-record-panel-close-button:hover {
            background: var(--color-background-secondary);
            color: var(--color-text-primary);
        }

        .detail-board-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-border);
            position: sticky;
            top: 0;
            background: var(--color-background-secondary);
            z-index: 10;
            padding-top: var(--spacing-md);
        }

        .detail-board-close-button {
            background: none;
            border: none;
            font-size: 32px;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-md);
            transition: var(--transition-normal);
            line-height: 1;
        }

        .detail-board-close-button:hover {
            background: var(--color-background-secondary);
            color: var(--color-text-primary);
        }

        .detail-edit-button,
        .detail-time-record-button {
            background: var(--color-primary);
            color: white;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 8px 12px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-md);
            transition: var(--transition-normal);
            line-height: 1;
            position: relative; /* „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÅÆÂü∫Ê∫ñÁÇπ */
        }

        .detail-edit-button:hover,
        .detail-time-record-button:hover {
            background: var(--color-primary-hover);
            transform: scale(1.05);
        }

        .detail-edit-icon {
            width: 20px;
            height: 20px;
            filter: brightness(0) invert(1); /* SVG„ÇíÁôΩ„Å´Â§âÊèõ */
            transition: transform 0.3s ease;
        }

        .detail-edit-button:hover .detail-edit-icon {
            transform: rotate(180deg); /* „Éõ„Éê„ÉºÊôÇ„Å´ÂõûËª¢ */
        }

        /* Ë©≥Á¥∞„Éë„Éç„É´„ÅÆ‰øÆÊ≠£„Éú„Çø„É≥„Å®„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Éú„Çø„É≥„ÅÆ„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó */
        .detail-edit-button .tooltip-text,
        .detail-time-record-button .tooltip-text {
            left: auto;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 0;
            margin-right: 8px;
        }
        
        .detail-edit-button .tooltip-text::before,
        .detail-time-record-button .tooltip-text::before {
            left: 100%;
            right: auto;
            border-left-color: rgba(0, 0, 0, 0.85);
            border-right-color: transparent;
        }

        .detail-edit-button:hover .tooltip-text,
        .detail-time-record-button:hover .tooltip-text {
            opacity: 1;
            visibility: visible;
        }

        /* Êñ∞Ë¶èËøΩÂä†„Éú„Çø„É≥ÔºàÁîªÈù¢‰∏ãÈÉ®‰∏≠Â§Æ„Å´Âõ∫ÂÆö„ÉªÂÜÜÂΩ¢„Éá„Ç∂„Ç§„É≥Ôºâ */
        .add-task-button {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            width: 64px;
            height: 64px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 32px;
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            line-height: 1;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        /* ÂÆå‰∫Ü„Éú„Çø„É≥ÔºàÁîªÈù¢Â∑¶‰∏ã„Å´Âõ∫ÂÆö„ÉªÂÜÜÂΩ¢„Éá„Ç∂„Ç§„É≥Ôºâ */
        .complete-button {
            position: fixed !important;
            bottom: 24px !important;
            left: 24px !important;
            top: auto !important;
            right: auto !important;
            width: 64px;
            height: 64px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            opacity: 0.8;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .complete-button:hover {
            background: #45a049;
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px) scale(1.1);
            opacity: 1;
        }
        
        .complete-button.drag-over {
            background: #45a049;
            transform: scale(1.2);
            opacity: 1;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);
        }
        
        .complete-icon {
            font-size: 32px;
            font-weight: var(--font-weight-bold);
            user-select: none;
        }
        
        .complete-button .tooltip-text {
            left: 100%;
            right: auto;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 8px;
            margin-right: 0;
        }
        
        .complete-button .tooltip-text::before {
            left: -6px;
            right: auto;
            border-right-color: rgba(0, 0, 0, 0.85);
            border-left-color: transparent;
        }
        
        .add-task-button .tooltip-text {
            left: auto;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 0;
            margin-right: 8px;
        }
        
        .add-task-button .tooltip-text::before {
            left: 100%;
            right: auto;
            border-left-color: rgba(0, 0, 0, 0.85);
            border-right-color: transparent;
        }

        .add-task-button:hover {
            background: var(--color-primary-hover);
            box-shadow: var(--shadow-xl);
            transform: translateX(-50%) translateY(-2px) scale(1.1);
        }

        .add-task-button:active {
            transform: translateX(-50%) translateY(0) scale(1.05);
        }
        
        .add-task-button:focus {
            outline: none;
            box-shadow: var(--shadow-xl), 0 0 0 3px rgba(255, 103, 156, 0.3);
        }

        /* „Éê„ÉÉ„Ç∏„Çí‰Ωú„Çã„Éú„Çø„É≥ÔºàÂè≥‰∏ä„Å´Âõ∫ÂÆö„Éª‚óØ„Éá„Ç∂„Ç§„É≥Ôºâ */
        .add-badge-button {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 64px;
            height: 64px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 28px;
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            transition: var(--transition-normal);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            line-height: 1;
            padding: 0;
        }

        .add-badge-button .tooltip-text {
            left: auto;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 0;
            margin-right: 8px;
        }
        
        .add-badge-button .tooltip-text::before {
            left: 100%;
            right: auto;
            border-left-color: rgba(0, 0, 0, 0.85);
            border-right-color: transparent;
        }

        .add-badge-button:hover {
            background: var(--color-primary-hover);
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px) scale(1.1);
        }

        .add-badge-button:active {
            transform: translateY(0) scale(1.05);
        }

        .badge-icon-text {
            font-size: 28px;
            line-height: 1;
        }

        /* „Ç¥„ÉüÁÆ±ÔºàÁîªÈù¢Âè≥‰∏ã„Å´Âõ∫ÂÆöÔºâ */
        .trash-bin {
            position: fixed !important;
            bottom: 24px !important;
            right: 24px !important;
            top: auto !important;
            left: auto !important;
            width: 64px;
            height: 64px;
            background: var(--color-danger, #ff4757);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            opacity: 0.8;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .trash-bin .tooltip-text {
            left: auto;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 0;
            margin-right: 8px;
        }
        
        .trash-bin .tooltip-text::before {
            left: 100%;
            right: auto;
            border-left-color: rgba(0, 0, 0, 0.85);
            border-right-color: transparent;
        }

        .trash-bin:hover {
            background: var(--color-danger-hover, #ff3838);
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px) scale(1.1);
            opacity: 1;
        }
        
        .trash-bin:focus {
            outline: none;
            box-shadow: var(--shadow-xl), 0 0 0 3px rgba(255, 71, 87, 0.3);
        }

        .trash-bin.drag-over {
            background: var(--color-danger-hover, #ff3838);
            transform: scale(1.2);
            opacity: 1;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.6);
        }

        /* „Çπ„Éû„ÉõÁâàÔºö„Çø„ÉÉ„ÉÅ„Éâ„É©„ÉÉ„Ç∞ÊôÇ„ÅÆ„Ç¥„ÉüÁÆ±Êã°Â§ß */
        .trash-bin.touch-drag-over {
            background: var(--color-danger-hover, #ff3838);
            transform: scale(1.3);
            width: 80px;
            height: 80px;
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.8);
        }

        @media (max-width: 430px) {
            .trash-bin.touch-drag-over {
                width: 80px;
                height: 80px;
            }
        }

        .trash-bin:active {
            transform: translateY(0) scale(1.05);
        }

        .trash-icon {
            font-size: 28px;
            user-select: none;
        }

        /* „É¢„Éº„ÉÄ„É´„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* „Çø„Çπ„ÇØÂÖ•Âäõ„Éï„Ç©„Éº„É†Ôºà„É¢„Éº„ÉÄ„É´Ôºâ */
        .task-form {
            background: var(--color-background);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-xl);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .task-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-border);
        }

        .task-form-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .modal-close-button {
            background: none;
            border: none;
            font-size: 32px;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-md);
            transition: var(--transition-normal);
            line-height: 1;
        }

        .modal-close-button:hover {
            background: var(--color-background-secondary);
            color: var(--color-text-primary);
        }

        /* „Çπ„É©„Ç§„Éâ„Ç§„É≥„Éë„Éç„É´ÔºàÂ∑¶„Åã„ÇâÂè≥„Å´„Çπ„É©„Ç§„Éâ„Ç§„É≥„ÄÅÊúÄÂâçÈù¢„Å´Ë°®Á§∫Ôºâ */
        .slide-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 2000;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .slide-panel-overlay.active {
            display: block;
        }

        .slide-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: var(--color-background);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
            z-index: 2001;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
            border-right: 2px solid var(--color-border);
        }

        .slide-panel.active {
            transform: translateX(0);
        }

        .slide-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 2px solid var(--color-border);
            background: var(--color-background);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .slide-panel-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .slide-panel-close-button {
            background: none;
            border: none;
            font-size: 32px;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-md);
            transition: var(--transition-normal);
            line-height: 1;
        }

        .slide-panel-close-button:hover {
            background: var(--color-background-secondary);
            color: var(--color-text-primary);
        }

        .slide-panel-content {
            padding: var(--spacing-lg);
        }
        
        /* „Ç¢„Éº„Ç´„Ç§„Éñ„Çø„Çπ„ÇØ„É™„Çπ„Éà */
        .archive-task-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        
        /* „Ç¢„Éº„Ç´„Ç§„Éñ„Çø„Çπ„ÇØ„Ç¢„Ç§„ÉÜ„É†Ôºà„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥Ôºâ */
        .archive-task-item {
            background: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            overflow: hidden;
            transition: var(--transition-normal);
        }
        
        .archive-task-item:hover {
            box-shadow: var(--shadow-sm);
        }
        
        .archive-task-header {
            padding: var(--spacing-md);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--color-background-secondary);
            transition: var(--transition-normal);
        }
        
        .archive-task-header:hover {
            background: var(--color-border);
        }
        
        .archive-task-item.active .archive-task-header {
            background: var(--color-primary-light);
            border-bottom: 1px solid var(--color-border);
        }
        
        .archive-task-title {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            flex: 1;
            margin-right: var(--spacing-sm);
        }
        
        .archive-task-meta {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            margin-top: 4px;
        }
        
        .archive-task-arrow {
            font-size: var(--font-size-lg);
            transition: transform 0.3s ease;
        }
        
        .archive-task-item.active .archive-task-arrow {
            transform: rotate(180deg);
        }
        
        .archive-task-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 var(--spacing-md);
        }
        
        .archive-task-item.active .archive-task-content {
            max-height: 500px;
            padding: var(--spacing-md);
        }
        
        .archive-task-body {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        
        .archive-task-description {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .archive-task-badges {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
            align-items: center;
        }
        
        .archive-task-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--color-background-secondary);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-xs);
        }
        
        .archive-task-badge-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .archive-empty {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--color-text-secondary);
        }

        /* „Çπ„É©„Ç§„Éâ„Ç§„É≥„Éë„Éç„É´„ÅÆ„Éè„É≥„Éâ„É´ÔºàÂ∑¶Á´Ø„Å´Âõ∫ÂÆö„ÄÅ5„Å§„ÅÆ„Éë„Éç„É´Áî®Ôºâ */
        .slide-panel-handle {
            position: fixed;
            left: 0;
            width: 24px;
            height: 80px;
            border-radius: 0 12px 12px 0;
            cursor: pointer;
            z-index: 1999;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            padding: 0;
            border: none;
        }

        /* ÂêÑ„Éë„Éç„É´„ÅÆ„Éè„É≥„Éâ„É´„ÅÆ‰ΩçÁΩÆ„Å®Ëâ≤ÔºàÁ≠âÈñìÈöîÈÖçÁΩÆÔºâ */
        .slide-panel-handle.panel-1 {
            top: calc(100vh / 6);
            transform: translateY(-50%);
            background: var(--panel-1-color);
        }

        .slide-panel-handle.panel-2 {
            top: calc(100vh / 3);
            transform: translateY(-50%);
            background: var(--panel-2-color);
        }

        .slide-panel-handle.panel-3 {
            top: 50%;
            transform: translateY(-50%);
            background: var(--panel-3-color);
        }

        .slide-panel-handle.panel-4 {
            top: calc(100vh * 2 / 3);
            transform: translateY(-50%);
            background: var(--panel-4-color);
        }

        .slide-panel-handle.panel-5 {
            top: calc(100vh * 5 / 6);
            transform: translateY(-50%);
            background: var(--panel-5-color);
        }

        /* „Çπ„Éû„ÉõÁâà„Åß„ÅÆÂ∑¶„Éë„Éç„É´„Éè„É≥„Éâ„É´„ÅÆÈÖçÁΩÆÔºà100px‰∏ã„Å´ÈÖçÁΩÆÔºâ */
        @media (max-width: 430px) {
            .slide-panel-handle.panel-1 {
                top: 100px;
                transform: none;
            }

            .slide-panel-handle.panel-2 {
                top: calc(100px + 50px + 20px); /* 100px + 50px (È´ò„Åï) + 20px („ÇÆ„É£„ÉÉ„Éó) */
                transform: none;
            }

            .slide-panel-handle.panel-3 {
                top: calc(100px + (50px + 20px) * 2);
                transform: none;
            }

            .slide-panel-handle.panel-4 {
                top: calc(100px + (50px + 20px) * 3);
                transform: none;
            }

            .slide-panel-handle.panel-5 {
                top: calc(100px + (50px + 20px) * 4);
                transform: none;
            }
        }

        .slide-panel-handle:hover {
            width: 32px;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2);
        }

        .slide-panel-handle.panel-1:hover {
            background: var(--panel-1-hover);
        }

        .slide-panel-handle.panel-2:hover {
            background: var(--panel-2-hover);
        }

        .slide-panel-handle.panel-3:hover {
            background: var(--panel-3-hover);
        }

        .slide-panel-handle.panel-4:hover {
            background: var(--panel-4-hover);
        }

        .slide-panel-handle.panel-5:hover {
            background: var(--panel-5-hover);
        }

        .slide-panel-handle::before {
            content: '‚óÄ';
            color: white;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .slide-panel-handle:hover::before {
            transform: translateX(2px);
        }

        .slide-panel-handle.active {
            left: 40%;
        }

        .slide-panel-handle.panel-1.active {
            left: 40%;
            top: calc(100vh / 6);
            transform: translateY(-50%) translateX(-100%);
        }

        .slide-panel-handle.panel-2.active {
            left: 40%;
            top: calc(100vh / 3);
            transform: translateY(-50%) translateX(-100%);
        }

        .slide-panel-handle.panel-3.active {
            left: 40%;
            transform: translateY(-50%) translateX(-100%);
        }

        .slide-panel-handle.panel-4.active {
            left: 40%;
            top: calc(100vh * 2 / 3);
            transform: translateY(-50%) translateX(-100%);
        }

        .slide-panel-handle.panel-5.active {
            left: 40%;
            top: calc(100vh * 5 / 6);
            transform: translateY(-50%) translateX(-100%);
        }

        .slide-panel-handle.active::before {
            content: '‚ñ∂';
            transform: rotate(180deg);
        }

        .slide-panel-handle.panel-1.active::before,
        .slide-panel-handle.panel-2.active::before,
        .slide-panel-handle.panel-4.active::before,
        .slide-panel-handle.panel-5.active::before {
            content: '‚ñ∂';
            transform: rotate(180deg);
        }

        /* ÂêÑ„Éë„Éç„É´„ÅÆ„Çπ„Çø„Ç§„É´ÔºàËâ≤ÂàÜ„ÅëÔºâ */
        .slide-panel.panel-1 {
            border-right: 4px solid var(--panel-1-color);
        }

        .slide-panel.panel-2 {
            border-right: 4px solid var(--panel-2-color);
        }

        .slide-panel.panel-3 {
            border-right: 4px solid var(--panel-3-color);
        }

        .slide-panel.panel-4 {
            border-right: 4px solid var(--panel-4-color);
        }

        .slide-panel.panel-5 {
            border-right: 4px solid var(--panel-5-color);
        }

        .slide-panel-header.panel-1 {
            border-bottom: 2px solid var(--panel-1-color);
        }

        .slide-panel-header.panel-2 {
            border-bottom: 2px solid var(--panel-2-color);
        }

        .slide-panel-header.panel-3 {
            border-bottom: 2px solid var(--panel-3-color);
        }

        .slide-panel-header.panel-4 {
            border-bottom: 2px solid var(--panel-4-color);
        }

        .slide-panel-header.panel-5 {
            border-bottom: 2px solid var(--panel-5-color);
        }

        /* „É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ„Éë„Éç„É´„ÅÆ„Çø„Éñ„Çπ„Çø„Ç§„É´ */
        .resource-tabs {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-border);
        }

        .resource-tab {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: var(--transition-normal);
            margin-bottom: -2px;
        }

        .resource-tab:hover {
            color: var(--color-primary);
            background: var(--color-primary-light);
        }

        .resource-tab.active {
            color: var(--panel-2-color);
            border-bottom-color: var(--panel-2-color);
            font-weight: var(--font-weight-semibold);
        }

        .resource-tab-content {
            display: none;
        }

        .resource-tab-content.active {
            display: block;
        }

        /* „É°„É≥„Éê„Éº„Ç´„Éº„Éâ„Çπ„Çø„Ç§„É´ */
        .member-card {
            background: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            transition: var(--transition-normal);
        }

        .member-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--panel-2-color);
        }

        .member-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .member-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xl);
            flex-shrink: 0;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .member-stats {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .stat-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .stat-value {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }

        .load-indicator {
            height: 8px;
            background: var(--color-background-secondary);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            margin-top: var(--spacing-xs);
        }

        .load-bar {
            height: 100%;
            border-radius: var(--border-radius-sm);
            transition: width 0.3s ease;
        }

        .load-bar.low {
            background: #10b981;
        }

        .load-bar.medium {
            background: #f59e0b;
        }

        .load-bar.high {
            background: #ef4444;
        }

        /* ÈÄ±Ê¨°„ÉªÊúàÊ¨°Ë®àÁîª„Çπ„Çø„Ç§„É´ */
        .schedule-calendar {
            display: grid;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-md);
        }

        .schedule-week {
            display: grid;
            grid-template-columns: 120px repeat(7, 1fr);
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-xs);
        }

        .schedule-day-header {
            padding: var(--spacing-xs);
            background: var(--panel-2-color);
            color: white;
            text-align: center;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            border-radius: var(--border-radius-sm);
        }

        .schedule-member-row {
            display: grid;
            grid-template-columns: 120px repeat(7, 1fr);
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-xs);
        }

        .schedule-member-name {
            padding: var(--spacing-xs);
            background: var(--color-background-secondary);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
        }

        .schedule-cell {
            padding: var(--spacing-xs);
            background: var(--color-background-secondary);
            border-radius: var(--border-radius-sm);
            min-height: 40px;
            font-size: var(--font-size-xs);
        }

        .schedule-cell.has-task {
            background: var(--panel-2-color);
            color: white;
            cursor: pointer;
        }

        /* „Çø„Ç§„É†„É©„Ç§„É≥„Çπ„Çø„Ç§„É´ */
        .timeline-container {
            position: relative;
            padding: var(--spacing-md);
            background: var(--color-background-secondary);
            border-radius: var(--border-radius-md);
            min-height: 400px;
        }

        .timeline-member {
            margin-bottom: var(--spacing-lg);
            border-left: 2px solid var(--panel-2-color);
            padding-left: var(--spacing-md);
            position: relative;
        }

        .timeline-member::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 10px;
            height: 10px;
            background: var(--panel-2-color);
            border-radius: 50%;
        }

        .timeline-member-header {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .timeline-task {
            background: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
        }

        .timeline-task-title {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .timeline-task-time {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        /* „É°„Éã„É•„Éº„Éú„Çø„É≥„Çπ„Çø„Ç§„É´ */
        .menu-button-container {
            position: fixed;
            top: 24px;
            left: 24px;
            z-index: 10000;
            cursor: move;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        .menu-button {
            position: relative;
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .menu-button-icon {
            width: 64px;
            height: 64px;
            position: relative;
            z-index: 2;
            pointer-events: none;
        }

        .menu-button-background {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 64px;
            height: 64px;
            background: var(--color-primary);
            border-radius: 50%;
            z-index: 1;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .menu-button-container:hover .menu-button-background {
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* „É°„Éã„É•„Éº„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .menu-overlay.active {
            display: flex;
        }

        .menu-circle {
            position: absolute;
            width: 500px;
            height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        @media (max-width: 430px) {
            .menu-circle {
                width: 300px;
                height: 300px;
            }
        }

        .menu-background-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 500px;
            height: 500px;
            background: var(--color-primary);
            border-radius: 50%;
            opacity: 0.9;
            animation: menuExpandBackground 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @media (max-width: 430px) {
            .menu-background-circle {
                width: 300px;
                height: 300px;
            }
        }

        @keyframes menuExpandBackground {
            0% {
                transform: translate(-50%, -50%) scale(0.3);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0.7;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.9;
            }
        }

        .menu-items {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .menu-item {
            position: absolute;
            top: 50%;
            left: 50%;
            padding: var(--spacing-sm) var(--spacing-md);
            background: white;
            border: 2px solid var(--color-primary);
            border-radius: var(--border-radius-md);
            color: var(--color-text-primary);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            white-space: nowrap;
            cursor: pointer;
            pointer-events: auto;
            opacity: 0;
            transition: all 0.3s ease;
            animation: menuItemFadeIn 0.3s ease forwards;
            transform-origin: center center;
        }

        .menu-item:hover {
            background: var(--color-primary);
            color: white;
        }

        @keyframes menuItemFadeIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @media (max-width: 430px) {
            .menu-button-container {
                width: 48px;
                height: 48px;
                top: 16px;
                left: 16px;
            }

            .menu-button {
                width: 48px;
                height: 48px;
            }

            .menu-button-icon {
                width: 48px;
                height: 48px;
            }

            .menu-button-background {
                width: 48px;
                height: 48px;
            }
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-sm);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-sm);
            font-family: var(--font-family-primary);
            transition: var(--transition-normal);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary-light);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: flex-end;
            margin-top: var(--spacing-lg);
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-background-secondary);
            color: var(--color-text-primary);
            border: 2px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-border);
        }

        /* „Çø„Çπ„ÇØ„Ç´„Éº„Éâ„Ç∞„É™„ÉÉ„ÉâÔºàÊé≤Á§∫ÊùøÈ¢®„ÅÆ„É©„É≥„ÉÄ„É†ÈÖçÁΩÆÔºâ */
        .task-grid {
            position: relative;
            min-height: 800px;
            width: 100%;
            background: var(--color-background-secondary);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            overflow-y: auto;
            /* „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•Áî®„ÅÆ„Éà„É©„É≥„Ç∏„Ç∑„Éß„É≥ */
            transition: transform 0.3s ease-out;
        }
        
        /* „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•Áî®„ÅÆ„É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
        .pull-refresh-indicator {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--color-primary);
            font-size: var(--font-size-sm);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .pull-refresh-indicator.active {
            opacity: 1;
        }
        
        .pull-refresh-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--color-primary-light);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•„Éí„É≥„ÉàÔºà„Çπ„Éû„ÉõÁâà„ÅÆ„ÅøÔºâ */
        .pull-refresh-hint {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(0, 0, 0, 0.5); /* ÈªíÊñáÂ≠ó„ÅßÂçäÈÄèÊòé */
            font-size: var(--font-size-sm);
            pointer-events: none;
            user-select: none;
            z-index: 1;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            white-space: nowrap;
        }
        
        /* „Çπ„Éû„ÉõÁâàÔºàSPÔºâÔºö„Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•ÂØæÂøú„Å®„Éí„É≥„ÉàË°®Á§∫ */
        @media (max-width: 430px) {
            .task-grid {
                -webkit-overflow-scrolling: touch;
            }
            
            /* „Éí„É≥„Éà„ÇíË°®Á§∫Ôºà„Çπ„Éû„ÉõÁâà„Åß„ÅØ„Éá„Éï„Ç©„É´„Éà„ÅßË°®Á§∫Ôºâ */
            .pull-refresh-hint {
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            /* „Çø„Çπ„ÇØ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆ„Å´Âøú„Åò„Å¶Ë°®Á§∫/ÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà */
            .task-grid.has-tasks:not(.scroll-top) .pull-refresh-hint {
                opacity: 0;
                visibility: hidden;
            }
            
            /* „Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆ„ÅåÊúÄ‰∏äÈÉ®Ôºà5px‰ª•‰∏ãÔºâ„ÅÆÊôÇ„ÅÆ„Åø„Éí„É≥„Éà„ÇíË°®Á§∫ */
            .task-grid.scroll-top .pull-refresh-hint,
            .task-grid:not(.has-tasks) .pull-refresh-hint {
                opacity: 1 !important;
                visibility: visible !important;
            }
        }

        .task-card {
            position: absolute;
            background: var(--color-background);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            transition: var(--transition-normal);
            cursor: grab;
            width: 280px;
            min-height: 180px;
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .task-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px) rotate(0deg) !important;
            z-index: 10;
        }

        /* „Ç´„ÉÜ„Ç¥„É™„Åî„Å®„ÅÆÊû†Á∑öËâ≤ */
        .task-card.category-design {
            border-color: var(--category-design-border);
        }

        .task-card.category-frontend {
            border-color: var(--category-frontend-border);
        }

        .task-card.category-backend {
            border-color: var(--category-backend-border);
        }

        .task-card.category-media {
            border-color: var(--category-media-border);
        }

        .task-card.category-database {
            border-color: var(--category-backend-border);
        }

        .task-card.category-other {
            border-color: var(--category-other-border);
        }

        .task-card.category-design:hover {
            border-color: rgba(255, 103, 156, 0.5);
        }

        .task-card.category-frontend:hover {
            border-color: rgba(74, 144, 226, 0.5);
        }

        .task-card.category-backend:hover,
        .task-card.category-database:hover {
            border-color: rgba(80, 200, 120, 0.5);
        }

        .task-card.category-media:hover {
            border-color: rgba(255, 140, 66, 0.5);
        }

        .task-card.category-other:hover {
            border-color: rgba(127, 140, 141, 0.5);
        }

        .task-card.selected {
            border: 2px solid var(--color-primary);
            box-shadow: 0 0 15px rgba(255, 103, 156, 0.4);
            transform: scale(1.02);
            z-index: 500;
        }

        /* „Çπ„Éû„ÉõÁâàÔºàSPÔºâÔºöÈÅ∏ÊäûÁä∂ÊÖã„ÅÆ„Çπ„Çø„Ç§„É´ */
        @media (max-width: 430px) {
            .task-card.selected {
                border: 2px solid var(--color-primary);
                box-shadow: 0 0 20px rgba(255, 103, 156, 0.8); /* „Éâ„É≠„ÉÉ„Éó„Ç∑„É£„Éâ„Ç¶„ÇíÊøÉ„Åè */
                transform: scale(1.05);
            }
        }

        .task-card.dragging {
            opacity: 1;
            cursor: grabbing;
            transform: rotate(0deg) !important;
            z-index: 999 !important; /* „Ç¥„ÉüÁÆ±„ÅÆz-index: 1000„Çà„Çä‰∏ã„Å´„Åô„Çã */
        }

        .task-grid.drag-over {
            background: var(--color-primary-light);
        }

        .task-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
            gap: var(--spacing-sm);
        }

        .task-card-title {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            line-height: 1.3;
            margin: 0;
            flex: 1;
            min-width: 0; /* „ÉÜ„Ç≠„Çπ„Éà„ÅÆÊäò„ÇäËøî„Åó„ÇíË®±ÂèØ */
        }

        .task-card-priority {
            display: flex;
            align-items: center;
            gap: 2px;
            flex-shrink: 0;
            font-size: 10px; /* Â∞è„Åï„ÅèË°®Á§∫ */
            margin-left: auto; /* Âè≥ÂÅ¥„Å´ÈÖçÁΩÆ */
        }

        .task-card-priority-star {
            color: #fbbf24;
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1));
        }

        .task-card-description {
            flex: 1;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            line-height: 1.5;
            margin: 0;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
        }

        .task-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-sm);
            border-top: 1px solid var(--color-border);
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .task-card-category {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .task-card-footer-icon {
            width: 20px;
            height: 20px;
            opacity: 0.7;
        }

        /* „Éê„ÉÉ„Ç∏„Çπ„Çø„Ç§„É´ */
        .badge {
            position: absolute;
            width: 60px;
            height: 60px;
            background: var(--color-primary);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: grab;
            box-shadow: var(--shadow-md);
            z-index: 100;
            transition: var(--transition-normal);
            padding: var(--spacing-xs);
            border: 3px solid var(--color-background);
        }

        .badge:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
            z-index: 101;
        }

        .badge.dragging {
            opacity: 1;
            cursor: grabbing;
            z-index: 1000 !important;
        }

        .badge-icon {
            font-size: 24px;
            line-height: 1;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .badge-icon img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            -webkit-touch-callout: none; /* iOS„ÅÆ„É≠„É≥„Ç∞„Çø„ÉÉ„ÉÅ„É°„Éã„É•„Éº„ÇíÁÑ°ÂäπÂåñ */
            -webkit-user-select: none; /* ÁîªÂÉè„ÅÆÈÅ∏Êäû„ÇíÁÑ°ÂäπÂåñ */
            user-select: none;
            pointer-events: none; /* ÁîªÂÉè„Å∏„ÅÆ„Ç§„Éô„É≥„Éà„ÇíÁÑ°ÂäπÂåñ */
        }

        .badge-name {
            font-size: 10px;
            font-weight: var(--font-weight-semibold);
            color: white;
            text-align: center;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }

        /* „Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Åü„Éê„ÉÉ„Ç∏ */
        .task-card .badge {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 48px;
            height: 48px;
            cursor: pointer;
            z-index: 5;
        }

        /* „Çπ„Éû„ÉõÁâàÔºàSPÔºâÔºö„Ç´„Éº„Éâ„ÅÆÁõ¥‰∏ãÔºà„Ç´„Éº„ÉâÂ§ñÔºâ„Å´ÂØÜÁùÄ„Åó„Å¶Âê∏ÁùÄ */
        @media (max-width: 430px) {
            .task-card .badge.attached {
                position: absolute;
                bottom: -48px !important; /* „Ç´„Éº„Éâ‰∏ãÈÉ®„Å®„Éê„ÉÉ„Ç∏‰∏äÈÉ®„ÅåÂØÜÁùÄÔºà-48px = „Éê„ÉÉ„Ç∏„ÅÆÈ´ò„ÅïÔºâ */
                left: 50% !important;
                right: auto !important;
                transform: translateX(-50%) !important;
                margin: 0;
            }

            /* Ë§áÊï∞„ÅÆ„Éê„ÉÉ„Ç∏„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅÊ®™ÊñπÂêë„Å´‰∏¶„Åπ„Çã */
            .task-card .badge.attached:nth-of-type(2) {
                left: calc(50% - 28px) !important; /* ‰∏≠Â§Æ„Åã„ÇâÂ∑¶„Å´28pxÔºà48px/2 + 8px/2Ôºâ */
                transform: translateX(0) !important;
            }

            .task-card .badge.attached:nth-of-type(3) {
                left: calc(50% + 28px) !important; /* ‰∏≠Â§Æ„Åã„ÇâÂè≥„Å´28px */
                transform: translateX(0) !important;
            }

            .task-card .badge.attached:nth-of-type(4) {
                left: calc(50% - 84px) !important; /* „Åï„Çâ„Å´Â∑¶„Å´ */
                transform: translateX(0) !important;
            }

            .task-card .badge.attached:nth-of-type(5) {
                left: calc(50% + 84px) !important; /* „Åï„Çâ„Å´Âè≥„Å´ */
                transform: translateX(0) !important;
            }
        }

        .task-card .badge:hover {
            transform: scale(1.1);
        }

        .task-card.badge-attached {
            border: 2px dashed var(--color-primary);
        }

        .task-card.drag-over-badge {
            border: 3px solid var(--color-primary);
            box-shadow: 0 0 20px rgba(255, 103, 156, 0.5);
            transform: scale(1.05);
        }

        /* „Çø„Çπ„ÇØ„Ç´„Éº„Éâ„ÅÆ„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó */
        .task-card-tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 10px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            font-size: 11px;
            white-space: nowrap;
            border-radius: var(--border-radius-sm);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
            z-index: 1000;
        }

        /* „Çπ„Éû„ÉõÁâàÔºàSPÔºâÔºöÈÅ∏ÊäûÊôÇ„ÅÆ„ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÔºà„Ç´„Éº„Éâ‰∏ä„Å´Ë°®Á§∫Ôºâ */
        @media (max-width: 430px) {
            .task-card-tooltip {
                bottom: 100%;
                top: auto;
                left: 50%;
                transform: translateX(-50%);
                margin-bottom: 12px;
            }

            .task-card-tooltip::before {
                bottom: -6px;
                top: auto;
                left: 50%;
                transform: translateX(-50%);
                border: 6px solid transparent;
                border-top-color: rgba(0, 0, 0, 0.85);
                border-right-color: transparent;
                border-bottom-color: transparent;
            }

            .task-card.selected .task-card-tooltip {
                opacity: 1 !important;
                visibility: visible !important;
            }
        }

        /* PCÁâàÔºö„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÅÆÁü¢Âç∞Ôºà‰∏ã„Åã„Çâ‰∏äÔºâ */
        @media (min-width: 431px) {
            .task-card-tooltip::before {
                content: '';
                position: absolute;
                bottom: 100%;
                left: 50%;
                transform: translateX(-50%);
                border: 6px solid transparent;
                border-bottom-color: rgba(0, 0, 0, 0.85);
            }
        }

        /* PCÁâàÔºö„Éõ„Éê„ÉºÊôÇ„Å´„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÇíË°®Á§∫ */
        @media (min-width: 431px) {
            .task-card:hover .task-card-tooltip {
                opacity: 1;
                visibility: visible;
            }
        }

        /* Ë©≥Á¥∞„Éú„Éº„Éâ */
        .detail-header {
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-border);
        }

        .detail-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-sm);
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 430px) {
            /* „Éò„ÉÉ„ÉÄ„Éº */
            .header {
                padding: 0 var(--spacing-sm);
                height: 50px;
            }

            .header-left {
                gap: var(--spacing-xs);
            }

            .logo {
                font-size: var(--font-size-md);
            }

            .nav-button {
                padding: var(--spacing-xs) var(--spacing-sm);
                font-size: var(--font-size-xs);
                display: none; /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éú„Çø„É≥„ÇíÈùûË°®Á§∫ */
            }

            .header-right {
                gap: var(--spacing-xs);
            }

            /* GoogleË™çË®º„Éú„Çø„É≥„ÅÆ„Çµ„Ç§„Ç∫Ë™øÊï¥ */
            #googleSignInContainer {
                gap: var(--spacing-xs) !important;
            }

            #userAvatar {
                width: 24px !important;
                height: 24px !important;
            }

            #userName {
                font-size: var(--font-size-xs) !important;
            }

            /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä */
            .main-container {
                flex-direction: column;
                height: calc(100vh - 50px);
            }

            .main-board {
                width: 100%;
                height: auto;
                flex: 1;
                padding: var(--spacing-sm);
            }

            /* „Çø„Çπ„ÇØ„Ç´„Éº„ÉâÔºàÊ∞¥Âπ≥ÊñπÂêë„Å´3„Å§‰∏¶„Å∂„Çµ„Ç§„Ç∫Ôºâ */
            .task-card {
                width: calc((100vw - 24px - 40px) / 3 - 12px); /* ÁîªÈù¢ÂπÖ„Åã„Çâ„Éë„Éá„Ç£„É≥„Ç∞„Å®„ÇÆ„É£„ÉÉ„Éó„ÇíÂºï„ÅÑ„Å¶3Á≠âÂàÜ */
                max-width: 120px;
                min-height: 100px;
                padding: calc(var(--spacing-xs) * 0.8);
                font-size: 0.75rem;
            }

            .task-card-title {
                font-size: calc(var(--font-size-sm) * 0.8);
            }

            .task-card-description {
                font-size: 9px; /* 11px * 0.8 ‚âà 9px */
                -webkit-line-clamp: 3;
            }

            .task-card-priority {
                font-size: 6px; /* 8px * 0.8 = 6px */
            }

            .task-card-footer {
                font-size: calc(var(--font-size-xs) * 0.8);
            }

            .task-card-category-icon {
                width: 16px; /* 20px * 0.8 = 16px */
                height: 16px;
            }

            /* „Çø„Çπ„ÇØ„Ç´„Éº„Éâ„ÅÆ„ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÔºà„Çπ„Éû„ÉõÁâàÔºàSPÔºâ„Åß„ÅØË°®Á§∫Ôºâ */
            .task-card-tooltip {
                display: block !important;
                opacity: 0;
                visibility: hidden;
            }
            
            /* „Çπ„Éû„ÉõÁâàÔºàSPÔºâÔºöÈÅ∏ÊäûÊôÇ„Å´„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÇíË°®Á§∫ */
            .task-card.selected .task-card-tooltip {
                opacity: 1 !important;
                visibility: visible !important;
            }

            /* „Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„ÉâÔºàÊ∞¥Âπ≥ÊñπÂêë„Å´3„Å§‰∏¶„Å∂Ôºâ */
            .task-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
                padding: var(--spacing-sm);
            }

            /* Âõ∫ÂÆö„Éú„Çø„É≥„ÅÆ„Çµ„Ç§„Ç∫Ë™øÊï¥ */
            .add-task-button,
            .complete-button,
            .add-badge-button {
                width: 48px;
                height: 48px;
                font-size: 24px;
            }
            
            /* „Ç¥„ÉüÁÆ±„ÅÆ„Çµ„Ç§„Ç∫Ë™øÊï¥ÔºàSPÁâàÔºâ */
            .trash-bin {
                width: 48px !important;
                height: 48px !important;
                font-size: 24px !important;
            }
            
            .complete-icon {
                font-size: 24px;
            }

            /* Êñ∞Ë¶èËøΩÂä†„Éú„Çø„É≥ÔºöÁîªÈù¢‰∏ãÈÉ®‰∏≠Â§Æ„Å´Âõ∫ÂÆöÔºà430pxÁîªÈù¢ÂπÖÂÜÖ„Å´Âèé„ÇÅ„ÇãÔºâ */
            .add-task-button {
                position: fixed;
                bottom: 16px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1000;
            }
            
            .add-task-button:hover {
                transform: translateX(-50%) translateY(-2px) scale(1.1);
            }
            
            .add-task-button:active {
                transform: translateX(-50%) translateY(0) scale(1.05);
            }
            
            .add-task-button:focus {
                outline: none;
                box-shadow: var(--shadow-xl), 0 0 0 3px rgba(255, 103, 156, 0.3);
            }

            /* „Éê„ÉÉ„Ç∏„Éú„Çø„É≥ÔºöÁîªÈù¢Âè≥‰∏ä„Å´Âõ∫ÂÆöÔºà‰∏ãÊñπÂêë„Å´80pxÁßªÂãïÔºâ */
            .add-badge-button {
                position: fixed;
                top: 92px; /* 12px + 80px = 92px */
                right: 12px;
                z-index: 1000;
            }

            .badge-icon-text {
                font-size: 20px;
            }

            /* ÂÆå‰∫Ü„Éú„Çø„É≥ÔºöÁîªÈù¢Â∑¶‰∏ã„Å´Âõ∫ÂÆöÔºà430pxÁîªÈù¢ÂπÖÂÜÖ„Å´Âèé„ÇÅ„ÇãÔºâ */
            .complete-button {
                position: fixed !important;
                bottom: 16px !important;
                left: 16px !important;
                top: auto !important;
                right: auto !important;
                z-index: 1001;
            }
            
            /* „Ç¥„ÉüÁÆ±„Éú„Çø„É≥ÔºöÁîªÈù¢Âè≥‰∏ã„Å´Âõ∫ÂÆöÔºà430pxÁîªÈù¢ÂπÖÂÜÖ„Å´Âèé„ÇÅ„ÇãÔºâ */
            .trash-bin {
                position: fixed !important;
                bottom: 16px !important;
                right: 16px !important;
                top: auto !important;
                left: auto !important;
                width: 48px !important;
                height: 48px !important;
                z-index: 1001 !important; /* „Ç´„Éº„Éâ„ÅÆz-index„Çà„Çä‰∏ä„Å´„Åó„Å¶„ÄÅÂ∏∏„Å´‰∏ä„Å´Ë°®Á§∫ */
                /* ÂÆå‰∫Ü„Éú„Çø„É≥„Å®Âêå„Åò‰ΩçÁΩÆÔºàÂ∑¶‰∏ãÔºâ„Å´Ë°®Á§∫„Åï„Çå„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã */
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                border-radius: 50% !important;
                /* ËÉåÊôØ„Å®„Ç¢„Ç§„Ç≥„É≥„ÅÆ‰∏≠ÂøÉÁÇπ„ÇíÂêà„Çè„Åõ„Çã */
                padding: 0 !important;
                margin: 0 !important;
            }

            .trash-bin .trash-icon {
                font-size: 20px !important;
                line-height: 1 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* Ë©≥Á¥∞„Éú„Éº„Éâ */
            .detail-board {
                width: 100%;
            }

            .detail-board-header {
                padding: var(--spacing-sm);
            }

            .detail-title {
                font-size: var(--font-size-lg);
            }

            .detail-edit-button {
                width: 36px;
                height: 36px;
                padding: 6px;
            }

            .detail-edit-icon {
                width: 18px;
                height: 18px;
            }

            .detail-board-close-button {
                width: 36px;
                height: 36px;
                font-size: 24px;
            }

            /* „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Éë„Éç„É´ */
            .time-record-panel {
                width: 350px;
                padding: var(--spacing-sm) !important;
            }
            
            .time-record-panel-header {
                padding: var(--spacing-xs) !important;
                margin-bottom: var(--spacing-sm) !important;
                padding-bottom: var(--spacing-xs) !important;
                padding-top: var(--spacing-xs) !important;
            }
            
            .time-record-panel-title {
                font-size: var(--font-size-md) !important;
            }
            
            .time-record-panel-close-button {
                width: 28px !important;
                height: 28px !important;
                font-size: 20px !important;
            }
            
            #timeRecordContent {
                font-size: var(--font-size-sm) !important;
            }
            
            #timeRecordContent h3 {
                font-size: var(--font-size-md) !important;
                margin-bottom: var(--spacing-sm) !important;
            }
            
            #timeRecordContent div[style*="padding"] {
                padding: var(--spacing-sm) !important;
                margin-bottom: var(--spacing-sm) !important;
            }
            
            #timeRecordContent div[style*="margin-bottom"] {
                margin-bottom: var(--spacing-xs) !important;
            }

            /* „Çπ„É©„Ç§„Éâ„Ç§„É≥„Éë„Éç„É´ */
            .slide-panel {
                width: 100%;
            }

            .slide-panel-handle {
                width: 20px;
                height: 50px;
                z-index: 1999;
            }


            /* „É¢„Éº„ÉÄ„É´ */
            .task-form {
                width: 95%;
                max-width: 95%;
                max-height: 90vh;
                padding: var(--spacing-md);
                overflow-y: auto;
            }

            .task-form-header {
                padding: var(--spacing-sm) var(--spacing-md);
            }

            .task-form-title {
                font-size: var(--font-size-md);
            }

            .modal-close-button {
                width: 32px;
                height: 32px;
                font-size: 24px;
            }

            /* „Éê„ÉÉ„Ç∏ */
            .badge {
                width: 48px;
                height: 48px;
            }

            .badge-icon {
                font-size: 18px;
            }

            .badge-name {
                font-size: 8px;
            }

            .task-card .badge {
                width: 40px;
                height: 40px;
            }

            /* „ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÔºà„É¢„Éê„Ç§„É´„Åß„ÅØÁ∞°Áï•Ë°®Á§∫„Åæ„Åü„ÅØÈùûË°®Á§∫Ôºâ */
            .tooltip-text {
                font-size: 10px;
                padding: 4px 8px;
            }

            /* „Éï„Ç©„Éº„É† */
            .form-group {
                margin-bottom: var(--spacing-sm);
            }

            .form-group label {
                font-size: var(--font-size-xs);
            }

            .form-group input,
            .form-group textarea,
            .form-group select {
                font-size: var(--font-size-sm);
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .btn {
                padding: var(--spacing-xs) var(--spacing-md);
                font-size: var(--font-size-xs);
            }

            /* „Çπ„Éó„É©„ÉÉ„Ç∑„É•„Çπ„ÇØ„É™„Éº„É≥ */
            .splash-logo {
                width: 80px;
                height: 80px;
            }
        }
    </style>
    
    <!-- Google Identity Services -->
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- „Çπ„Éó„É©„ÉÉ„Ç∑„É•„Çπ„ÇØ„É™„Éº„É≥ -->
    <div class="splash-screen" id="splashScreen">
        <img src="images/logo_144x144.png" alt="„Éü„Çª„Çµ„Éù" class="splash-logo">
    </div>

    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="header">
        <div class="header-left">
            <div class="logo">üìã Task Market</div>
            <button class="nav-button">„Éõ„Éº„É†</button>
            <button class="nav-button">„Çø„Çπ„ÇØ</button>
            <button class="nav-button">„Éó„É≠„Ç∏„Çß„ÇØ„Éà</button>
        </div>
        <div class="header-right">
            <!-- GoogleË™çË®º„Éú„Çø„É≥/„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±Ë°®Á§∫„Ç®„É™„Ç¢ÔºàÊúÄÂè≥Ôºâ -->
            <div id="googleSignInContainer" style="display: flex; align-items: center; gap: var(--spacing-sm);">
                <!-- „É≠„Ç∞„Ç§„É≥Ââç: Google„É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥ -->
                <div id="googleSignInButton" style="display: inline-block;"></div>
                
                <!-- „É≠„Ç∞„Ç§„É≥Âæå: „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±Ë°®Á§∫ -->
                <div id="userInfo" style="display: none; align-items: center; gap: var(--spacing-sm);">
                    <img id="userAvatar" src="" alt="„É¶„Éº„Ç∂„Éº„Ç¢„Éê„Çø„Éº" style="width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--color-border);">
                    <span id="userName" style="color: var(--color-text-primary); font-size: var(--font-size-sm); font-weight: var(--font-weight-semibold);"></span>
                    <button class="nav-button" onclick="signOut()" style="padding: var(--spacing-xs) var(--spacing-sm);">
                        <span>„É≠„Ç∞„Ç¢„Ç¶„Éà</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä -->
    <div class="main-container">
        <!-- „É°„Ç§„É≥„Éú„Éº„Éâ -->
        <div class="main-board">
            <!-- „Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„Éâ -->
            <div class="task-grid" id="taskGrid">
                <!-- „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                <div class="pull-refresh-indicator" id="pullRefreshIndicator">
                    <div class="pull-refresh-spinner"></div>
                    <span>Êõ¥Êñ∞‰∏≠...</span>
                </div>
                
                <!-- „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•„Éí„É≥„ÉàÔºà„Çπ„Éû„ÉõÁâà„ÅÆ„ÅøÔºâ -->
                <div class="pull-refresh-hint" id="pullRefreshHint">
                    „ÄåÊõ¥Êñ∞„Äç„ÅØÁîªÈù¢„Çí‰∏ã„Å´„Å≤„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ
                </div>
                
                <!-- Êñ∞Ë¶èËøΩÂä†„Éú„Çø„É≥Ôºà‰∏ãÈÉ®‰∏≠Â§Æ„Å´Âõ∫ÂÆöÔºâ -->
                <button class="add-task-button" type="button" onclick="toggleTaskForm(event)">
                    +
                    <span class="tooltip-text">Êñ∞Ë¶è„Çø„Çπ„ÇØ„ÇíËøΩÂä†</span>
                </button>
                
                <!-- ÂÆå‰∫Ü„Éú„Çø„É≥ÔºàÂ∑¶‰∏ã„Å´Âõ∫ÂÆöÔºâ -->
                <div class="complete-button" id="completeButton">
                    <span class="complete-icon">‚úì</span>
                    <span class="tooltip-text">„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÅßÂÆå‰∫Ü</span>
                </div>
                
                <!-- „Éê„ÉÉ„Ç∏„Çí‰Ωú„Çã„Éú„Çø„É≥ÔºàÂè≥‰∏ä„Å´Âõ∫ÂÆö„Éª‚óØ„Éá„Ç∂„Ç§„É≥Ôºâ -->
                <button class="add-badge-button" onclick="openBadgeForm()">
                    <span class="badge-icon-text">üè∑Ô∏è</span>
                    <span class="tooltip-text">„Éê„ÉÉ„Ç∏„Çí‰Ωú„Çã</span>
                </button>
                
                <!-- „Çø„Çπ„ÇØ„Ç´„Éº„Éâ„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                <div style="text-align: center; padding: var(--spacing-xl); color: var(--color-text-secondary);">
                    <p>„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    <p style="font-size: var(--font-size-sm); margin-top: var(--spacing-sm);">Â∑¶‰∏ã„ÅÆ„Äå+„Äç„Éú„Çø„É≥„Åã„Çâ„Çø„Çπ„ÇØ„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- „Ç¥„ÉüÁÆ±ÔºàÂè≥‰∏ã„Å´Âõ∫ÂÆö„ÄÅbodyÁõ¥‰∏ã„Å´ÈÖçÁΩÆÔºâ -->
    <div class="trash-bin" id="trashBin">
        <span class="trash-icon">üóëÔ∏è</span>
        <span class="tooltip-text">„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÅßÂâäÈô§</span>
    </div>

    <!-- „Çø„Çπ„ÇØË©≥Á¥∞„Éë„Éç„É´ÔºàÂè≥„Åã„Çâ„Çπ„É©„Ç§„Éâ„Ç§„É≥Ôºâ -->
    <div class="detail-board-overlay" id="detailBoardOverlay" onclick="closeDetailBoardOnOverlay(event)">
        <div class="detail-board" id="detailBoard" onclick="event.stopPropagation()">
            <div class="detail-board-header">
                <div>
                    <h2 class="detail-title">„Çø„Çπ„ÇØË©≥Á¥∞</h2>
                    <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin: 0;">„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà„Éú„Çø„É≥„ÅßË©≥Á¥∞„ÅÆ„ÄåÁ∑®ÈõÜ„Äç„ÅåË°å„Åà„Åæ„Åô„ÄÇ</p>
                </div>
                <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                    <button class="detail-time-record-button" id="detailTimeRecordButton" onclick="showTimeRecords()" style="display: none;">
                        <span style="font-size: 20px;">üïê</span>
                        <span class="tooltip-text">„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ</span>
                    </button>
                    <button class="detail-edit-button" id="detailEditButton" onclick="toggleTaskEditMode()" style="display: none;">
                        <img src="images/„É™„É≠„Éº„Éâ„Ç¢„Ç§„Ç≥„É≥.svg" alt="Á∑®ÈõÜ" class="detail-edit-icon">
                        <span class="tooltip-text">„Çø„Çπ„ÇØÊÉÖÂ†±„ÅÆÁ∑®ÈõÜ„ÅØ„Åì„Å°„Çâ„Åã„Çâ</span>
                    </button>
                <button class="detail-board-close-button" onclick="closeDetailBoard()" title="Èñâ„Åò„Çã">√ó</button>
                </div>
            </div>
            <div id="detailContent">
                <div style="text-align: center; padding: var(--spacing-xl); color: var(--color-text-secondary);">
                    <p>„Çø„Çπ„ÇØ„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Éë„Éç„É´ÔºàÂè≥„Åã„Çâ„Çπ„É©„Ç§„Éâ„Ç§„É≥Ôºâ -->
    <div class="time-record-panel-overlay" id="timeRecordPanelOverlay" onclick="closeTimeRecordPanelOnOverlay(event)">
        <div class="time-record-panel" id="timeRecordPanel" onclick="event.stopPropagation()">
            <div class="time-record-panel-header">
                <h2 class="time-record-panel-title">„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ</h2>
                <button class="time-record-panel-close-button" onclick="closeTimeRecordPanel()" title="Èñâ„Åò„Çã">√ó</button>
            </div>
            <div id="timeRecordContent">
                <div style="text-align: center; padding: var(--spacing-xl); color: var(--color-text-secondary);">
                    <p>Ë™≠„ÅøËæº„Åø‰∏≠...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- „É°„Éã„É•„Éº„Éú„Çø„É≥ÔºàËá™Áî±ÁßªÂãïÂèØËÉΩÔºâ -->
    <div class="menu-button-container" id="menuButtonContainer">
        <div class="menu-button" id="menuButton">
            <img src="images/menu icon.svg" alt="„É°„Éã„É•„Éº" class="menu-button-icon">
            <div class="menu-button-background" id="menuButtonBackground"></div>
        </div>
    </div>

    <!-- ÂÜÜÂΩ¢„É°„Éã„É•„Éº„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div class="menu-overlay" id="menuOverlay" onclick="closeMenuOnOverlay(event)">
        <div class="menu-circle" id="menuCircle">
            <div class="menu-background-circle" id="menuBackgroundCircle"></div>
            <div class="menu-items" id="menuItems">
                <!-- „É°„Éã„É•„ÉºÈ†ÖÁõÆ„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
            </div>
        </div>
    </div>

    <!-- „Çπ„É©„Ç§„Éâ„Ç§„É≥„Éë„Éç„É´„ÅÆ„Éè„É≥„Éâ„É´ÔºàÂ∑¶Á´Ø„Å´Âõ∫ÂÆö„ÄÅ5„Å§Ôºâ -->
    <button class="slide-panel-handle panel-1" id="slidePanelHandle1" onclick="toggleSlidePanel(1)">
        <span class="tooltip-text">„É™„É≥„ÇØ„Éë„Éç„É´„ÇíÈñã„Åè</span>
    </button>
    <button class="slide-panel-handle panel-2" id="slidePanelHandle2" onclick="toggleSlidePanel(2)">
        <span class="tooltip-text">„É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ„Éë„Éç„É´„ÇíÈñã„Åè</span>
    </button>
    <button class="slide-panel-handle panel-3" id="slidePanelHandle3" onclick="toggleSlidePanel(3)">
        <span class="tooltip-text">„Éê„ÉÉ„ÇØ„Éë„Éç„É´„ÇíÈñã„Åè</span>
    </button>
    <button class="slide-panel-handle panel-4" id="slidePanelHandle4" onclick="toggleSlidePanel(4)">
        <span class="tooltip-text">„É°„Éá„Ç£„Ç¢„Éë„Éç„É´„ÇíÈñã„Åè</span>
    </button>
    <button class="slide-panel-handle panel-5" id="slidePanelHandle5" onclick="toggleSlidePanel(5)">
        <span class="tooltip-text">„Ç¢„Éº„Ç´„Ç§„Éñ„Éë„Éç„É´„ÇíÈñã„Åè</span>
    </button>

    <!-- „É¢„Éº„ÉÄ„É´Ôºö„Çø„Çπ„ÇØÂÖ•Âäõ„Éï„Ç©„Éº„É† -->
    <div class="modal-overlay" id="taskFormModal" onclick="closeModalOnOverlay(event)">
        <div class="task-form" onclick="event.stopPropagation()">
            <div class="task-form-header">
                <h3 class="task-form-title">Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„Çí‰ΩúÊàê</h3>
                <button class="modal-close-button" onclick="cancelTaskForm()" title="Èñâ„Åò„Çã">√ó</button>
            </div>
            <form id="taskInputForm">
                <div class="form-group">
                    <label for="taskTitle">„Çø„Çπ„ÇØ„Çø„Ç§„Éà„É´ *</label>
                    <input type="text" id="taskTitle" name="title" required placeholder="„Çø„Çπ„ÇØ„ÅÆ„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ">
                </div>
                <div class="form-group">
                    <label for="taskDescription">Ë™¨Êòé</label>
                    <textarea id="taskDescription" name="description" placeholder="„Çø„Çπ„ÇØ„ÅÆË©≥Á¥∞„ÇíÂÖ•Âäõ"></textarea>
                </div>
                <div class="form-group">
                    <label for="taskCategory">„Ç´„ÉÜ„Ç¥„É™„Éº</label>
                    <select id="taskCategory" name="category">
                        <option value="design">„Éá„Ç∂„Ç§„É≥</option>
                        <option value="frontend">„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ</option>
                        <option value="backend">„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ</option>
                        <option value="database">„Éá„Éº„Çø„Éô„Éº„Çπ</option>
                        <option value="media">„É°„Éá„Ç£„Ç¢</option>
                        <option value="other">„Åù„ÅÆ‰ªñ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskPriority">ÂÑ™ÂÖàÂ∫¶</label>
                    <select id="taskPriority" name="priority">
                        <option value="low">‰Ωé</option>
                        <option value="medium" selected>‰∏≠</option>
                        <option value="high">È´ò</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskEstimatedTime">‰∫àÊÉ≥‰ΩúÊ•≠ÊôÇÈñì</label>
                    <select id="taskEstimatedTime" name="estimatedTime">
                        <option value="">Êú™Ë®≠ÂÆö</option>
                        <option value="10">10ÂàÜ</option>
                        <option value="20">20ÂàÜ</option>
                        <option value="30">30ÂàÜ</option>
                        <option value="40">40ÂàÜ</option>
                        <option value="50">50ÂàÜ</option>
                        <option value="60">1ÊôÇÈñì</option>
                        <option value="70">1ÊôÇÈñì10ÂàÜ</option>
                        <option value="80">1ÊôÇÈñì20ÂàÜ</option>
                        <option value="90">1ÊôÇÈñì30ÂàÜ</option>
                        <option value="100">1ÊôÇÈñì40ÂàÜ</option>
                        <option value="110">1ÊôÇÈñì50ÂàÜ</option>
                        <option value="120">2ÊôÇÈñì</option>
                        <option value="150">2ÊôÇÈñì30ÂàÜ</option>
                        <option value="180">3ÊôÇÈñì</option>
                        <option value="240">4ÊôÇÈñì</option>
                        <option value="300">5ÊôÇÈñì</option>
                        <option value="360">6ÊôÇÈñì</option>
                        <option value="480">8ÊôÇÈñì</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="cancelTaskForm()">„Ç≠„É£„É≥„Çª„É´</button>
                    <button type="submit" class="btn btn-primary">‰ΩúÊàê</button>
                </div>
            </form>
        </div>
    </div>

    <!-- „É¢„Éº„ÉÄ„É´Ôºö„Éê„ÉÉ„Ç∏‰ΩúÊàê„Éï„Ç©„Éº„É† -->
    <div class="modal-overlay" id="badgeFormModal" onclick="closeBadgeFormOnOverlay(event)">
        <div class="task-form" onclick="event.stopPropagation()">
            <div class="task-form-header">
                <h3 class="task-form-title">Êñ∞„Åó„ÅÑ„Éê„ÉÉ„Ç∏„Çí‰ΩúÊàê</h3>
                <button class="modal-close-button" onclick="cancelBadgeForm()" title="Èñâ„Åò„Çã">√ó</button>
            </div>
            <form id="badgeInputForm">
                <div class="form-group">
                    <label for="badgeName">„Éê„ÉÉ„Ç∏ÂêçÔºàÊãÖÂΩìËÄÖÂêçÔºâ*</label>
                    <input type="text" id="badgeName" name="name" required placeholder="‰æã: Áî∞‰∏≠Â§™ÈÉé">
                </div>
                <div class="form-group">
                    <label for="badgeIcon">„Ç¢„Ç§„Ç≥„É≥ÔºàÁµµÊñáÂ≠óÔºâ</label>
                    <input type="text" id="badgeIcon" name="icon" placeholder="‰æã: üë§ üßë‚Äçüíª üë®‚Äçüíº">
                </div>
                <div class="form-group">
                    <label for="badgeColor">„Ç´„É©„Éº</label>
                    <input type="color" id="badgeColor" name="color" value="#FF679C">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="cancelBadgeForm()">„Ç≠„É£„É≥„Çª„É´</button>
                    <button type="button" class="btn btn-google" id="createFromGoogleBtn" onclick="createBadgeFromGoogle()" style="display: none; background: #4285F4; color: white; margin-right: 8px;">üîµ Google„Ç¢„Ç´„Ç¶„É≥„Éà„Åã„Çâ‰ΩúÊàê</button>
                    <button type="submit" class="btn btn-primary">‰ΩúÊàê</button>
                </div>
            </form>
        </div>
    </div>

    <!-- „Çπ„É©„Ç§„Éâ„Ç§„É≥„Éë„Éç„É´ÔºàÂ∑¶„Åã„ÇâÂè≥„Å´„Çπ„É©„Ç§„Éâ„Ç§„É≥„ÄÅ5„Å§Ôºâ -->
    <!-- „Éë„Éç„É´1Ôºà„Éî„É≥„ÇØÔºö„É™„É≥„ÇØ„Éë„Éç„É´Ôºâ -->
    <div class="slide-panel-overlay" id="slidePanelOverlay1" onclick="closeSlidePanelOnOverlay(event, 1)">
        <div class="slide-panel panel-1" id="slidePanel1" onclick="event.stopPropagation()">
            <div class="slide-panel-header panel-1">
                <h2 class="slide-panel-title">„É™„É≥„ÇØ„Éë„Éç„É´</h2>
                <button class="slide-panel-close-button" onclick="closeSlidePanel(1)" title="Èñâ„Åò„Çã">√ó</button>
            </div>
            <div class="slide-panel-content">
                <!-- „É™„É≥„ÇØËøΩÂä†„Éï„Ç©„Éº„É† -->
                <div style="padding: var(--spacing-md); margin-bottom: var(--spacing-md); background: var(--color-background-secondary); border-radius: var(--border-radius-md);">
                    <h3 style="font-size: var(--font-size-md); font-weight: var(--font-weight-semibold); margin-bottom: var(--spacing-sm); color: var(--color-text-primary);">Â§ñÈÉ®„É™„É≥„ÇØ„ÇíËøΩÂä†</h3>
                    <form id="linkAddForm" style="display: flex; gap: var(--spacing-sm); align-items: flex-end;">
                        <div style="flex: 1;">
                            <label for="linkUrl" style="display: block; font-size: var(--font-size-sm); margin-bottom: 4px; color: var(--color-text-secondary);">URL *</label>
                            <input type="url" id="linkUrl" required placeholder="https://example.com" style="width: 100%; padding: var(--spacing-xs); border: 1px solid var(--color-border); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
                </div>
                        <div style="flex: 1;">
                            <label for="linkTitle" style="display: block; font-size: var(--font-size-sm); margin-bottom: 4px; color: var(--color-text-secondary);">„Çø„Ç§„Éà„É´Ôºà‰ªªÊÑèÔºâ</label>
                            <input type="text" id="linkTitle" placeholder="„É™„É≥„ÇØÂêç" style="width: 100%; padding: var(--spacing-xs); border: 1px solid var(--color-border); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
            </div>
                        <button type="submit" class="btn btn-primary" style="padding: var(--spacing-xs) var(--spacing-md); font-size: var(--font-size-sm);">ËøΩÂä†</button>
                    </form>
        </div>
                
                <!-- „É™„É≥„ÇØ„Ç¢„Ç§„Ç≥„É≥„Ç∞„É™„ÉÉ„Éâ -->
                <div id="linkIconGrid" class="link-icon-grid">
                    <!-- „É™„É≥„ÇØ„Ç¢„Ç§„Ç≥„É≥„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                </div>
            </div>
        </div>
    </div>

    <!-- „Éë„Éç„É´2Ôºà„Éñ„É´„ÉºÔºö„É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜÔºâ -->
    <div class="slide-panel-overlay" id="slidePanelOverlay2" onclick="closeSlidePanelOnOverlay(event, 2)">
        <div class="slide-panel panel-2" id="slidePanel2" onclick="event.stopPropagation()">
            <div class="slide-panel-header panel-2">
                <h2 class="slide-panel-title">„É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ</h2>
                <button class="slide-panel-close-button" onclick="closeSlidePanel(2)" title="Èñâ„Åò„Çã">√ó</button>
            </div>
            <div class="slide-panel-content">
                <!-- „Çø„ÉñÂàá„ÇäÊõø„Åà -->
                <div class="resource-tabs" style="display: flex; gap: var(--spacing-xs); margin-bottom: var(--spacing-md); border-bottom: 2px solid var(--color-border);">
                    <button class="resource-tab active" data-tab="members" onclick="switchResourceTab('members')">„É°„É≥„Éê„Éº‰∏ÄË¶ß</button>
                    <button class="resource-tab" data-tab="schedule" onclick="switchResourceTab('schedule')">ÈÄ±Ê¨°„ÉªÊúàÊ¨°Ë®àÁîª</button>
                    <button class="resource-tab" data-tab="timeline" onclick="switchResourceTab('timeline')">„Çø„Ç§„É†„É©„Ç§„É≥</button>
                </div>
                
                <!-- „É°„É≥„Éê„Éº‰∏ÄË¶ß„Çø„Éñ -->
                <div id="resourceMembersTab" class="resource-tab-content active">
                    <div id="resourceMembersContent">
                        <!-- „É°„É≥„Éê„Éº‰∏ÄË¶ß„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                    </div>
                </div>
                
                <!-- ÈÄ±Ê¨°„ÉªÊúàÊ¨°Ë®àÁîª„Çø„Éñ -->
                <div id="resourceScheduleTab" class="resource-tab-content">
                    <div style="margin-bottom: var(--spacing-md);">
                        <div style="display: flex; gap: var(--spacing-sm); align-items: center; margin-bottom: var(--spacing-md);">
                            <select id="scheduleViewType" onchange="updateScheduleView()" style="padding: var(--spacing-xs) var(--spacing-sm); border: 1px solid var(--color-border); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
                                <option value="week">ÈÄ±Ê¨°Ë°®Á§∫</option>
                                <option value="month">ÊúàÊ¨°Ë°®Á§∫</option>
                            </select>
                            <button onclick="prevSchedulePeriod()" class="btn btn-secondary" style="padding: var(--spacing-xs) var(--spacing-sm); font-size: var(--font-size-sm);">‚Üê Ââç</button>
                            <button onclick="nextSchedulePeriod()" class="btn btn-secondary" style="padding: var(--spacing-xs) var(--spacing-sm); font-size: var(--font-size-sm);">Ê¨° ‚Üí</button>
                            <button onclick="todaySchedulePeriod()" class="btn btn-secondary" style="padding: var(--spacing-xs) var(--spacing-sm); font-size: var(--font-size-sm);">‰ªäÊó•</button>
                        </div>
                        <div id="scheduleContent">
                            <!-- ÈÄ±Ê¨°„ÉªÊúàÊ¨°Ë®àÁîª„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                        </div>
                    </div>
                </div>
                
                <!-- „Çø„Ç§„É†„É©„Ç§„É≥„Çø„Éñ -->
                <div id="resourceTimelineTab" class="resource-tab-content">
                    <div style="margin-bottom: var(--spacing-md);">
                        <div style="display: flex; gap: var(--spacing-sm); align-items: center; margin-bottom: var(--spacing-md);">
                            <label style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">„Éï„Ç£„É´„Çø„Éº:</label>
                            <select id="timelineFilter" onchange="updateTimelineView()" style="padding: var(--spacing-xs) var(--spacing-sm); border: 1px solid var(--color-border); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
                                <option value="all">ÂÖ®„É°„É≥„Éê„Éº</option>
                                <!-- „É°„É≥„Éê„Éº„Ç™„Éó„Ç∑„Éß„É≥„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô -->
                            </select>
                        </div>
                        <div id="timelineContent" style="position: relative; min-height: 400px;">
                            <!-- „Çø„Ç§„É†„É©„Ç§„É≥„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éë„Éç„É´3Ôºà„Ç∞„É™„Éº„É≥Ôºö„Éê„ÉÉ„ÇØÔºâ -->
    <div class="slide-panel-overlay" id="slidePanelOverlay3" onclick="closeSlidePanelOnOverlay(event, 3)">
        <div class="slide-panel panel-3" id="slidePanel3" onclick="event.stopPropagation()">
            <div class="slide-panel-header panel-3">
                <h2 class="slide-panel-title">„Éê„ÉÉ„ÇØ</h2>
                <button class="slide-panel-close-button" onclick="closeSlidePanel(3)" title="Èñâ„Åò„Çã">√ó</button>
            </div>
            <div class="slide-panel-content">
                <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                    „Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâÈñãÁô∫„ÅÆ„Çø„Çπ„ÇØÁÆ°ÁêÜ„Éë„Éç„É´„Åß„Åô„ÄÇ
                </p>
                <div style="padding: var(--spacing-lg); background: var(--color-background-secondary); border-radius: var(--border-radius-md);">
                    <h3 style="font-size: var(--font-size-md); font-weight: var(--font-weight-semibold); margin-bottom: var(--spacing-md); color: var(--color-text-primary);">„Éê„ÉÉ„ÇØ„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ</h3>
                    <p style="color: var(--color-text-secondary);">„Åì„Åì„Å´„Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâÈñ¢ÈÄ£„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈÖçÁΩÆ„Åß„Åç„Åæ„Åô„ÄÇ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éë„Éç„É´4Ôºà„Ç™„É¨„É≥„Ç∏Ôºö„É°„Éá„Ç£„Ç¢Ôºâ -->
    <div class="slide-panel-overlay" id="slidePanelOverlay4" onclick="closeSlidePanelOnOverlay(event, 4)">
        <div class="slide-panel panel-4" id="slidePanel4" onclick="event.stopPropagation()">
            <div class="slide-panel-header panel-4">
                <h2 class="slide-panel-title">„É°„Éá„Ç£„Ç¢</h2>
                <button class="slide-panel-close-button" onclick="closeSlidePanel(4)" title="Èñâ„Åò„Çã">√ó</button>
            </div>
            <div class="slide-panel-content">
                <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                    „É°„Éá„Ç£„Ç¢Èñ¢ÈÄ£„ÅÆ„Çø„Çπ„ÇØÁÆ°ÁêÜ„Éë„Éç„É´„Åß„Åô„ÄÇ
                </p>
                <div style="padding: var(--spacing-lg); background: var(--color-background-secondary); border-radius: var(--border-radius-md);">
                    <h3 style="font-size: var(--font-size-md); font-weight: var(--font-weight-semibold); margin-bottom: var(--spacing-md); color: var(--color-text-primary);">„É°„Éá„Ç£„Ç¢„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ</h3>
                    <p style="color: var(--color-text-secondary);">„Åì„Åì„Å´„É°„Éá„Ç£„Ç¢Èñ¢ÈÄ£„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈÖçÁΩÆ„Åß„Åç„Åæ„Åô„ÄÇ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éë„Éç„É´5Ôºà„Éë„Éº„Éó„É´Ôºö„Ç¢„Éº„Ç´„Ç§„ÉñÔºâ -->
    <div class="slide-panel-overlay" id="slidePanelOverlay5" onclick="closeSlidePanelOnOverlay(event, 5)">
        <div class="slide-panel panel-5" id="slidePanel5" onclick="event.stopPropagation()">
            <div class="slide-panel-header panel-5">
                <h2 class="slide-panel-title">„Ç¢„Éº„Ç´„Ç§„Éñ</h2>
                <button class="slide-panel-close-button" onclick="closeSlidePanel(5)" title="Èñâ„Åò„Çã">√ó</button>
            </div>
            <div class="slide-panel-content">
                <!-- „Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ -->
                <div class="archive-filter" style="padding: var(--spacing-md); margin-bottom: var(--spacing-md); background: var(--color-background-secondary); border-radius: var(--border-radius-md);">
                    <h3 style="font-size: var(--font-size-md); font-weight: var(--font-weight-semibold); margin-bottom: var(--spacing-sm); color: var(--color-text-primary);">„Éï„Ç£„É´„Çø„Éº</h3>
                    <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 120px;">
                            <label style="display: block; font-size: var(--font-size-xs); margin-bottom: 4px; color: var(--color-text-secondary);">Êó•‰ªò</label>
                            <select id="archiveFilterDate" style="width: 100%; padding: var(--spacing-xs); border: 1px solid var(--color-border); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
                                <option value="all">„Åô„Åπ„Å¶</option>
                                <option value="today">‰ªäÊó•</option>
                                <option value="week">‰ªäÈÄ±</option>
                                <option value="month">‰ªäÊúà</option>
                                <option value="year">‰ªäÂπ¥</option>
                            </select>
                </div>
                        <div style="flex: 1; min-width: 120px;">
                            <label style="display: block; font-size: var(--font-size-xs); margin-bottom: 4px; color: var(--color-text-secondary);">ÊãÖÂΩìËÄÖ</label>
                            <select id="archiveFilterAssignee" style="width: 100%; padding: var(--spacing-xs); border: 1px solid var(--color-border); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
                                <option value="all">„Åô„Åπ„Å¶</option>
                            </select>
            </div>
                        <div style="flex: 1; min-width: 120px;">
                            <label style="display: block; font-size: var(--font-size-xs); margin-bottom: 4px; color: var(--color-text-secondary);">„Ç´„ÉÜ„Ç¥„É™</label>
                            <select id="archiveFilterCategory" style="width: 100%; padding: var(--spacing-xs); border: 1px solid var(--color-border); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
                                <option value="all">„Åô„Åπ„Å¶</option>
                                <option value="design">„Éá„Ç∂„Ç§„É≥</option>
                                <option value="frontend">„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ</option>
                                <option value="backend">„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ</option>
                                <option value="database">„Éá„Éº„Çø„Éô„Éº„Çπ</option>
                                <option value="media">„É°„Éá„Ç£„Ç¢</option>
                                <option value="other">„Åù„ÅÆ‰ªñ</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 120px;">
                            <label style="display: block; font-size: var(--font-size-xs); margin-bottom: 4px; color: var(--color-text-secondary);">Ê§úÁ¥¢</label>
                            <input type="text" id="archiveFilterSearch" placeholder="„Çø„Ç§„Éà„É´„ÅßÊ§úÁ¥¢" style="width: 100%; padding: var(--spacing-xs); border: 1px solid var(--color-border); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
                        </div>
                    </div>
                </div>
                
                <!-- ÂÆå‰∫ÜÊ∏à„Çø„Çπ„ÇØ„Ç¢„Éº„Ç´„Ç§„Éñ -->
                <div id="archiveTaskList" class="archive-task-list">
                    <!-- ÂÆå‰∫ÜÊ∏à„Çø„Çπ„ÇØ„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                    <p class="archive-empty">ÂÆå‰∫ÜÊ∏à„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ========================================
           üîß FirebaseÂàùÊúüÂåñ (Firebase Initialization)
           ======================================== */
        
        // FirebaseË®≠ÂÆö
        const firebaseConfig = {
            apiKey: "AIzaSyDi2_U6INLm7sb-02GsdWzDl2qaFBe8US4",
            authDomain: "misesapo-progress.firebaseapp.com",
            databaseURL: "https://misesapo-progress-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "misesapo-progress",
            storageBucket: "misesapo-progress.firebasestorage.app",
            messagingSenderId: "926808186549",
            appId: "1:926808186549:web:91ce8534877c4ecf2e28fc",
            measurementId: "G-5JS29JLL13"
        };

        // FirebaseÂàùÊúüÂåñÔºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞‰ªò„ÅçÔºâ
        console.log('FirebaseÂàùÊúüÂåñÈñãÂßã');
        let firebaseInitialized = false;
        let db;
        
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                firebaseInitialized = true;
                console.log('FirebaseÂàùÊúüÂåñÊàêÂäü');
            } else {
                db = firebase.firestore();
                firebaseInitialized = true;
                console.log('FirebaseÊó¢„Å´ÂàùÊúüÂåñÊ∏à„Åø');
            }
        } catch (error) {
            console.error('FirebaseÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
            firebaseInitialized = false;
        }

        // FirestoreË®≠ÂÆö
        if (firebaseInitialized && db) {
            console.log('FirestoreÊé•Á∂öÊ∫ñÂÇôÂÆå‰∫Ü');
        }

        // GoogleË™çË®ºÈñ¢ÈÄ£
        let currentUser = null;
        
        // GoogleË™çË®º„ÅÆÂàùÊúüÂåñ
        function initializeGoogleSignIn() {
            // ========================================
            // Google OAuth 2.0 Client ID „ÅÆË®≠ÂÆöÊñπÊ≥ï
            // ========================================
            // 1. Google Cloud Console (https://console.cloud.google.com/) „Å´„Ç¢„ÇØ„Çª„Çπ
            // 2. „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Çí‰ΩúÊàê„Åæ„Åü„ÅØÈÅ∏Êäû
            // 3. „ÄåAPI„Å®„Çµ„Éº„Éì„Çπ„Äç‚Üí„ÄåË™çË®ºÊÉÖÂ†±„Äç„Å´ÁßªÂãï
            // 4. „ÄåË™çË®ºÊÉÖÂ†±„Çí‰ΩúÊàê„Äç‚Üí„ÄåOAuth 2.0 „ÇØ„É©„Ç§„Ç¢„É≥„Éà ID„Äç„ÇíÈÅ∏Êäû
            // 5. „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÁ®ÆÈ°û: „Äå„Ç¶„Çß„Éñ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Äç
            // 6. ÊâøË™çÊ∏à„Åø„ÅÆ JavaScript ÁîüÊàêÂÖÉ:
            //    - ÈñãÁô∫Áí∞Â¢É: http://localhost:8000 („Éù„Éº„ÉàÁï™Âè∑„ÅØÁí∞Â¢É„Å´Âøú„Åò„Å¶Â§âÊõ¥)
            //    - Êú¨Áï™Áí∞Â¢É: https://yourdomain.com
            // 7. ÊâøË™çÊ∏à„Åø„ÅÆ„É™„ÉÄ„Ç§„É¨„ÇØ„Éà URI:
            //    - http://localhost:8000 (ÈñãÁô∫Áí∞Â¢É„ÅÆÂ†¥Âêà)
            //    - https://yourdomain.com (Êú¨Áï™Áí∞Â¢É„ÅÆÂ†¥Âêà)
            // 8. ‰ΩúÊàê„Åï„Çå„ÅüClient ID„Çí‰ª•‰∏ã„ÅÆÂÆöÊï∞„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ
            // ========================================
            
            // Google Cloud Console„ÅßÂèñÂæó„Åó„ÅüClient ID„ÇíË®≠ÂÆö
            // Ê≥®ÊÑè: ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ„ÄÅClient ID„ÇíÁí∞Â¢ÉÂ§âÊï∞„ÇÑË®≠ÂÆö„Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„ÇÄ
            // Client ID„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÂá¶ÁêÜ„Çí„Çπ„Ç≠„ÉÉ„Éó
            const CLIENT_ID = '926808186549-b0nhr610mnojulc9f8e679nh19ag58f1.apps.googleusercontent.com';
            
            // Client ID„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÂá¶ÁêÜ„Çí„Çπ„Ç≠„ÉÉ„Éó
            if (!CLIENT_ID || CLIENT_ID.trim() === '') {
                console.warn('‚ö†Ô∏è Google Client ID„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇGoogle Cloud Console„ÅßClient ID„ÇíÂèñÂæó„Åó„Å¶Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                // „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„ÇíË°®Á§∫
                document.getElementById('googleSignInButton').innerHTML = 
                    '<button style="padding: 8px 16px; border: 1px solid #dadce0; border-radius: 4px; background: white; cursor: pointer; color: #3c4043; font-size: 14px;">Client ID„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</button>';
                return;
            }
            
            // Google Identity Services „ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç
            if (!window.google || !window.google.accounts || !window.google.accounts.id) {
                console.error('‚ùå Google Identity Services „ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            
            // Ë™çË®ºÊ∏à„Åø„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const savedUser = localStorage.getItem('googleUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    displayUserInfo(currentUser);
                } catch (e) {
                    console.error('„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', e);
                    localStorage.removeItem('googleUser');
                }
            }
            
            try {
                // Google Sign-In „Éú„Çø„É≥„ÇíÂàùÊúüÂåñÔºàFedCMÂØæÂøúÔºâ
                window.google.accounts.id.initialize({
                    client_id: CLIENT_ID,
                    callback: handleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true,
                    // FedCMÁßªË°åÂØæÂøú: use_fedcm_for_prompt „Çí true „Å´Ë®≠ÂÆöÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
                    // use_fedcm_for_prompt: true
                });
                
                // Google Sign-In „Éú„Çø„É≥„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
                if (!currentUser) {
                    window.google.accounts.id.renderButton(
                        document.getElementById('googleSignInButton'),
                        {
                            type: 'standard',
                            theme: 'outline',
                            size: 'medium',
                            text: 'signin_with',
                            shape: 'rectangular',
                            logo_alignment: 'left'
                        }
                    );
                    
                    // One Tap „Çµ„Ç§„É≥„Ç§„É≥Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ- FedCMÁßªË°åË≠¶Âëä„ÇíÂõûÈÅø„Åô„Çã„Åü„ÇÅ„ÄÅ„Éá„Éï„Ç©„É´„Éà„Åß„ÅØÁÑ°ÂäπÂåñ
                    // ÂøÖË¶Å„Å´Âøú„Åò„Å¶‰ª•‰∏ã„ÅÆ„Ç≥„É°„É≥„Éà„ÇíÂ§ñ„Åó„Å¶ÊúâÂäπÂåñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                    /*
                    try {
                        window.google.accounts.id.prompt((notification) => {
                            // FedCMÁßªË°åÂØæÂøú: isDismissedMoment() „Å® getNotDisplayedReason() „Çí‰ΩøÁî®
                            if (notification.isDismissedMoment && notification.isDismissedMoment()) {
                                console.log('One Tap „Çµ„Ç§„É≥„Ç§„É≥„Åå„É¶„Éº„Ç∂„Éº„Å´„Çà„Å£„Å¶Èñâ„Åò„Çâ„Çå„Åæ„Åó„Åü');
                            } else if (notification.getNotDisplayedReason) {
                                const reason = notification.getNotDisplayedReason();
                                if (reason !== 'browser_not_supported' && reason !== 'invalid_client') {
                                    // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÅÆ„ÅøË°®Á§∫ÔºàË≠¶Âëä„ÅØÂá∫„Åï„Å™„ÅÑÔºâ
                                    console.log('One Tap „Çµ„Ç§„É≥„Ç§„É≥„ÅåË°®Á§∫„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇÁêÜÁî±:', reason);
                                }
                            } else {
                                // ÊóßAPI„Å®„ÅÆ‰∫íÊèõÊÄß
                                if (notification.isNotDisplayed || notification.isSkippedMoment) {
                                    console.log('One Tap „Çµ„Ç§„É≥„Ç§„É≥„ÅåË°®Á§∫„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü');
                                }
                            }
                        });
                    } catch (e) {
                        console.warn('One Tap „Çµ„Ç§„É≥„Ç§„É≥„ÅÆÂàùÊúüÂåñ„Ç®„É©„ÉºÔºàÁÑ°Ë¶ñÂèØËÉΩÔºâ:', e);
                        // One Tap UI„ÅÆ„Ç®„É©„Éº„ÅØÁÑ°Ë¶ñ„Åó„Å¶Á∂öË°å
                    }
                    */
                }
            } catch (e) {
                console.error('GoogleË™çË®º„ÅÆÂàùÊúüÂåñ„Ç®„É©„Éº:', e);
                document.getElementById('googleSignInButton').innerHTML = 
                    '<button style="padding: 8px 16px; border: 1px solid #dadce0; border-radius: 4px; background: white; cursor: pointer; color: #3c4043; font-size: 14px;" disabled>Ë™çË®º„Ç®„É©„Éº</button>';
            }
        }
        
        // GoogleË™çË®ºÊàêÂäüÊôÇ„ÅÆ„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ
        function handleCredentialResponse(response) {
            // JWT „Éà„Éº„ÇØ„É≥„Çí„Éá„Ç≥„Éº„Éâ
            const payload = parseJwt(response.credential);
            
            // „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„Çí‰øùÂ≠ò
            currentUser = {
                id: payload.sub,
                name: payload.name,
                email: payload.email,
                picture: payload.picture
            };
            
            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
            localStorage.setItem('googleUser', JSON.stringify(currentUser));
            
            // „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíË°®Á§∫
            displayUserInfo(currentUser);
            
            console.log('„É≠„Ç∞„Ç§„É≥ÊàêÂäü:', currentUser.name, currentUser.email);
        }
        
        // JWT„Éà„Éº„ÇØ„É≥„Çí„Éë„Éº„ÇπÔºàÁ∞°ÊòìÁâàÔºâ
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                console.error('JWTËß£Êûê„Ç®„É©„Éº:', e);
                return null;
            }
        }
        
        // „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíË°®Á§∫
        function displayUserInfo(user) {
            const signInButton = document.getElementById('googleSignInButton');
            const userInfo = document.getElementById('userInfo');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            
            if (user) {
                // „É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„ÇíÈùûË°®Á§∫
                signInButton.style.display = 'none';
                
                // „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíË°®Á§∫
                userAvatar.src = user.picture || '';
                userName.textContent = user.name || user.email || '„É¶„Éº„Ç∂„Éº';
                userInfo.style.display = 'flex';
            } else {
                // „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíÈùûË°®Á§∫
                userInfo.style.display = 'none';
                signInButton.style.display = 'inline-block';
            }
        }
        
        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        function signOut() {
            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíÂâäÈô§
            localStorage.removeItem('googleUser');
            currentUser = null;
            
            // GoogleË™çË®º„Çí„É™„Çª„ÉÉ„Éà
            window.google.accounts.id.disableAutoSelect();
            
            // UI„ÇíÊõ¥Êñ∞
            displayUserInfo(null);
            
            // Google Sign-In „Éú„Çø„É≥„ÇíÂÜçË°®Á§∫
            initializeGoogleSignIn();
            
            console.log('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü');
        }
        
        // Google Identity Services „ÅåË™≠„ÅøËæº„Åæ„Çå„ÅüÂæå„Å´ÂàùÊúüÂåñ
        window.addEventListener('load', function() {
            // Google Identity Services „ÅåË™≠„ÅøËæº„Åæ„Çå„Çã„Åæ„ÅßÂæÖ„Å§
            if (window.google && window.google.accounts && window.google.accounts.id) {
                initializeGoogleSignIn();
            } else {
                // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å
                setTimeout(function() {
                    if (window.google && window.google.accounts && window.google.accounts.id) {
                        initializeGoogleSignIn();
                    } else {
                        console.error('Google Identity Services „ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü');
                    }
                }, 1000);
            }
        });
        
        // „Çø„Çπ„ÇØ„Éá„Éº„Çø
        let tasks = [];

        // „Éê„ÉÉ„Ç∏„Éá„Éº„Çø
        let badges = [];

        // „Çø„Çπ„ÇØ„Å´Á¥ê„Å•„Åè„Éê„ÉÉ„Ç∏Ôºà„Çø„Çπ„ÇØID„Çí„Ç≠„Éº„Å´„ÄÅ„Éê„ÉÉ„Ç∏ID„ÅÆÈÖçÂàó„ÇíÂÄ§„Å´Ôºâ
        let taskBadges = {};
        
        // „Çø„Ç§„É†„É¨„Ç≥„Éº„ÉâÔºà„Éê„ÉÉ„Ç∏„Åå„Çø„Çπ„ÇØ„Å´‰ªò„Åë„Çâ„Çå„ÅüÊôÇÈñì„Åã„ÇâÂÆå‰∫Ü„Åæ„Åß„ÅÆÊôÇÈñì„ÇíË®òÈå≤Ôºâ
        let timeRecords = [];
        // timeRecordsÊßãÈÄ†: [{ id, taskId, badgeId, startTime, endTime, duration, status }]

        /* ========================================
           üíæ Firebase„Éá„Éº„Çø‰øùÂ≠ò„ÉªË™≠„ÅøËæº„Åø (Firebase Data Save & Load)
           ======================================== */

        // „Éá„Éº„Çø„ÇíFirebase„Å´‰øùÂ≠ò
        async function saveTaskMarketData() {
            if (!firebaseInitialized || !db) {
                console.warn('Firebase„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇlocalStorage„Å´‰øùÂ≠ò„Åó„Åæ„Åô„ÄÇ');
                // Firebase„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØlocalStorage„Å´‰øùÂ≠ò
                localStorage.setItem('taskMarketTasks', JSON.stringify(tasks));
                localStorage.setItem('taskMarketBadges', JSON.stringify(badges));
                localStorage.setItem('taskMarketTaskBadges', JSON.stringify(taskBadges));
                localStorage.setItem('timeRecords', JSON.stringify(timeRecords));
                localStorage.setItem('externalLinks', JSON.stringify(externalLinks));
                return;
            }

            try {
                const payload = {
                    tasks: tasks,
                    badges: badges,
                    taskBadges: taskBadges,
                    timeRecords: timeRecords,
                    externalLinks: externalLinks,
                    _updatedAt: Date.now()
                };

                await db.collection('taskMarket').doc('main').set(payload, { merge: true });
                console.log('‚úÖ „Çø„Çπ„ÇØ„Éû„Éº„Ç±„ÉÉ„Éà„Éá„Éº„Çø„ÇíFirebase„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('‚ùå Firebase‰øùÂ≠ò„Ç®„É©„Éº:', error);
                // „Ç®„É©„ÉºÊôÇ„ÅØlocalStorage„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
                localStorage.setItem('taskMarketTasks', JSON.stringify(tasks));
                localStorage.setItem('taskMarketBadges', JSON.stringify(badges));
                localStorage.setItem('taskMarketTaskBadges', JSON.stringify(taskBadges));
                localStorage.setItem('timeRecords', JSON.stringify(timeRecords));
                localStorage.setItem('externalLinks', JSON.stringify(externalLinks));
            }
        }

        // „Éá„Éº„Çø„ÇíFirebase„Åã„ÇâË™≠„ÅøËæº„Åø
        async function loadTaskMarketData() {
            // 1) Firebase„Åã„ÇâË™≠„ÅøËæº„ÅøÔºàÊúÄÂÑ™ÂÖàÔºâ
            if (firebaseInitialized && db) {
                try {
                    const doc = await db.collection('taskMarket').doc('main').get();
                    if (doc.exists) {
                        const data = doc.data();
                        console.log('üî• Firebase„Åã„Çâ„Çø„Çπ„ÇØ„Éû„Éº„Ç±„ÉÉ„Éà„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü:', data);
                        
                        if (data.tasks) tasks = data.tasks;
                        if (data.badges) badges = data.badges;
                        if (data.taskBadges) taskBadges = data.taskBadges;
                        if (data.timeRecords) timeRecords = data.timeRecords;
                        if (data.externalLinks) externalLinks = data.externalLinks;
                        
                        // „É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞„ÇíË®≠ÂÆö
                        setupRealtimeListener();
                        
                        // UI„ÇíÊõ¥Êñ∞
                        updateTaskGrid();
                        updateBadges();
                        updateLinkIconGrid();
                        updateArchivePanel();
                        
                        return;
                    }
                } catch (error) {
                    console.warn('FirebaseË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                }
            }

            // 2) localStorage„Åã„ÇâË™≠„ÅøËæº„ÅøÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
            try {
                const savedTasks = localStorage.getItem('taskMarketTasks');
                const savedBadges = localStorage.getItem('taskMarketBadges');
                const savedTaskBadges = localStorage.getItem('taskMarketTaskBadges');
                const savedTimeRecords = localStorage.getItem('timeRecords');
                const savedExternalLinks = localStorage.getItem('externalLinks');

                if (savedTasks) tasks = JSON.parse(savedTasks);
                if (savedBadges) badges = JSON.parse(savedBadges);
                if (savedTaskBadges) taskBadges = JSON.parse(savedTaskBadges);
                if (savedTimeRecords) timeRecords = JSON.parse(savedTimeRecords);
                if (savedExternalLinks) externalLinks = JSON.parse(savedExternalLinks);

                console.log('localStorage„Åã„Çâ„Çø„Çπ„ÇØ„Éû„Éº„Ç±„ÉÉ„Éà„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');

                // UI„ÇíÊõ¥Êñ∞
                updateTaskGrid();
                updateBadges();
                updateLinkIconGrid();
                updateArchivePanel();
            } catch (error) {
                console.warn('localStorageË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                // „Éá„Éï„Ç©„É´„Éà„Éá„Éº„ÇøÔºàÂàùÂõûËµ∑ÂãïÊôÇÔºâ
                tasks = [];
                badges = [];
                taskBadges = {};
                timeRecords = [];
                externalLinks = [];
            }
        }

        // „É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
        function setupRealtimeListener() {
            if (!firebaseInitialized || !db) return;

            try {
                db.collection('taskMarket').doc('main').onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        console.log('üîÑ „É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞„ÇíÂèó‰ø°„Åó„Åæ„Åó„Åü:', data);
                        
                        // „Éá„Éº„Çø„ÅåÊõ¥Êñ∞„Åï„Çå„ÅüÂ†¥Âêà„ÅÆ„ÅøÂèçÊò†ÔºàËá™ÂàÜËá™Ë∫´„ÅÆÊõ¥Êñ∞„ÅØÈô§Â§ñÔºâ
                        if (data.tasks) tasks = data.tasks;
                        if (data.badges) badges = data.badges;
                        if (data.taskBadges) taskBadges = data.taskBadges;
                        if (data.timeRecords) timeRecords = data.timeRecords;
                        if (data.externalLinks) externalLinks = data.externalLinks;
                        
                        // UI„ÇíÊõ¥Êñ∞
                        updateTaskGrid();
                        updateBadges();
                        updateLinkIconGrid();
                        updateArchivePanel();
                    }
                }, (error) => {
                    console.error('„É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞„Ç®„É©„Éº:', error);
                });
            } catch (error) {
                console.error('„É™„Ç¢„É´„Çø„Ç§„É†„É™„Çπ„Éä„ÉºË®≠ÂÆö„Ç®„É©„Éº:', error);
            }
        }

        // „Éê„ÉÉ„Ç∏„ÅÆ„Éâ„É©„ÉÉ„Ç∞Áä∂ÊÖãÁÆ°ÁêÜ
        let draggedBadgeGlobal = null;
        let draggedBadgeOffset = { x: 0, y: 0 };

        // „Éï„Ç©„Éº„É†Ë°®Á§∫Âàá„ÇäÊõø„ÅàÔºà„É¢„Éº„ÉÄ„É´Ë°®Á§∫Ôºâ
        function toggleTaskForm(e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            const modal = document.getElementById('taskFormModal');
            if (!modal) return;
            
            // Êó¢„Å´Èñã„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÈñâ„Åò„Çã
            if (modal.classList.contains('active')) {
                modal.classList.remove('active');
                document.getElementById('taskInputForm').reset();
                return;
            }
            
            // „É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
            modal.classList.add('active');
            document.getElementById('taskInputForm').reset();
            
                // „Éï„Ç©„Éº„Ç´„Çπ„ÇíÊúÄÂàù„ÅÆÂÖ•ÂäõÊ¨Ñ„Å´
                setTimeout(() => {
                const titleInput = document.getElementById('taskTitle');
                if (titleInput) {
                    titleInput.focus();
                }
                }, 100);
        }

        // „Éï„Ç©„Éº„É†„Ç≠„É£„É≥„Çª„É´Ôºà„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„ÇãÔºâ
        function cancelTaskForm() {
            const modal = document.getElementById('taskFormModal');
            modal.classList.remove('active');
            document.getElementById('taskInputForm').reset();
        }

        // „Ç™„Éº„Éê„Éº„É¨„Ç§„ÇØ„É™„ÉÉ„ÇØ„Åß„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeModalOnOverlay(event) {
            if (event.target.id === 'taskFormModal') {
                cancelTaskForm();
            }
        }

        // ESC„Ç≠„Éº„Åß„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const taskModal = document.getElementById('taskFormModal');
                const badgeModal = document.getElementById('badgeFormModal');
                if (taskModal && taskModal.classList.contains('active')) {
                    cancelTaskForm();
                } else if (badgeModal && badgeModal.classList.contains('active')) {
                    cancelBadgeForm();
                }
            }
        });

        // „Çø„Çπ„ÇØ‰ΩúÊàê
        const taskInputForm = document.getElementById('taskInputForm');
        if (taskInputForm) {
            taskInputForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
                const estimatedTime = formData.get('estimatedTime');
            const task = {
                id: Date.now(),
                title: formData.get('title'),
                description: formData.get('description'),
                category: formData.get('category'),
                priority: formData.get('priority'),
                    estimatedTime: estimatedTime ? parseInt(estimatedTime) : null, // ÂàÜÂçò‰Ωç
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            tasks.push(task);
            updateTaskGrid();
            saveTaskMarketData(); // Firebase„Å´‰øùÂ≠ò
            // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            cancelTaskForm();
        });
        }

        // „Éê„ÉÉ„Ç∏‰ΩúÊàê„Éï„Ç©„Éº„É†Ë°®Á§∫
        function openBadgeForm() {
            const modal = document.getElementById('badgeFormModal');
            modal.classList.add('active');
            document.getElementById('badgeInputForm').reset();
            
            // Google„Ç¢„Ç´„Ç¶„É≥„Éà„Åß„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Éú„Çø„É≥„ÇíË°®Á§∫
            const googleBtn = document.getElementById('createFromGoogleBtn');
            if (currentUser) {
                googleBtn.style.display = 'inline-block';
            } else {
                googleBtn.style.display = 'none';
            }
            
            setTimeout(() => {
                document.getElementById('badgeName').focus();
            }, 100);
        }

        // „Éê„ÉÉ„Ç∏‰ΩúÊàê„Éï„Ç©„Éº„É†„Ç≠„É£„É≥„Çª„É´
        function cancelBadgeForm() {
            const modal = document.getElementById('badgeFormModal');
            modal.classList.remove('active');
            document.getElementById('badgeInputForm').reset();
        }

        // „Éê„ÉÉ„Ç∏‰ΩúÊàê„Éï„Ç©„Éº„É†„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇØ„É™„ÉÉ„ÇØ
        function closeBadgeFormOnOverlay(event) {
            if (event.target.id === 'badgeFormModal') {
                cancelBadgeForm();
            }
        }

        // Google„Ç¢„Ç´„Ç¶„É≥„Éà„Åã„Çâ„Éê„ÉÉ„Ç∏„Çí‰ΩúÊàê
        function createBadgeFromGoogle() {
            if (!currentUser) {
                alert('Google„Ç¢„Ç´„Ç¶„É≥„Éà„Åß„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // Êó¢„Å´Âêå„Åò„É¶„Éº„Ç∂„Éº„ÅÆ„Éê„ÉÉ„Ç∏„ÅåÂ≠òÂú®„Åô„Çã„ÅãÁ¢∫Ë™ç
            const existingBadge = badges.find(b => b.userId === currentUser.id);
            if (existingBadge) {
                if (confirm(`Êó¢„Å´„Äå${existingBadge.name}„Äç„ÅÆ„Éê„ÉÉ„Ç∏„ÅåÂ≠òÂú®„Åó„Åæ„Åô„ÄÇÊñ∞„Åó„Åè‰ΩúÊàê„Åó„Åæ„Åô„ÅãÔºü`)) {
                    // Êó¢Â≠ò„ÅÆ„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§
                    badges = badges.filter(b => b.id !== existingBadge.id);
                } else {
                    return;
                }
            }
            
            // Google„Ç¢„Ç´„Ç¶„É≥„ÉàÊÉÖÂ†±„Åã„Çâ„Éê„ÉÉ„Ç∏„Çí‰ΩúÊàê
            const badge = {
                id: Date.now(),
                userId: currentUser.id,
                name: currentUser.name || currentUser.email || '„É¶„Éº„Ç∂„Éº',
                icon: currentUser.picture ? `img:${currentUser.picture}` : 'üë§',
                color: '#FF679C',
                email: currentUser.email,
                picture: currentUser.picture,
                position: {
                    top: Math.random() * 300 + 100,
                    left: Math.random() * 300 + 100
                },
                attachedToTaskId: null,
                createdAt: new Date().toISOString()
            };
            
            badges.push(badge);
            updateBadges();
            saveTaskMarketData(); // Firebase„Å´‰øùÂ≠ò
            cancelBadgeForm();
            
            console.log('Google„Ç¢„Ç´„Ç¶„É≥„Éà„Åã„Çâ„Éê„ÉÉ„Ç∏„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü:', badge);
        }

        // „Éê„ÉÉ„Ç∏‰ΩúÊàê
        const badgeInputForm = document.getElementById('badgeInputForm');
        if (badgeInputForm) {
            badgeInputForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const badge = {
                id: Date.now(),
                name: formData.get('name'),
                icon: formData.get('icon') || 'üë§',
                color: formData.get('color') || '#FF679C',
                position: {
                    top: Math.random() * 300 + 100,
                    left: Math.random() * 300 + 100
                },
                attachedToTaskId: null // „Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØnull
            };

            badges.push(badge);
            updateBadges();
            saveTaskMarketData(); // Firebase„Å´‰øùÂ≠ò
            cancelBadgeForm();
        });
        }

        // „Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„ÉâÊõ¥Êñ∞ÔºàÊé≤Á§∫ÊùøÈ¢®„ÅÆ„É©„É≥„ÉÄ„É†ÈÖçÁΩÆÔºâ
        function updateTaskGrid() {
            const taskGrid = document.getElementById('taskGrid');
            
            // „Éí„É≥„Éà„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÊõ¥Êñ∞Ôºà„Çπ„Éû„ÉõÁâà„ÅÆ„ÅøÔºâ
            if (window.innerWidth <= 430) {
            if (tasks.length === 0) {
                    taskGrid.classList.remove('has-tasks');
                    taskGrid.classList.add('scroll-top');
                } else {
                    taskGrid.classList.add('has-tasks');
                    // „Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆ„Å´Âøú„Åò„Å¶„ÇØ„É©„Çπ„ÇíÊõ¥Êñ∞ÔºàÂàùÊúüÂåñÊôÇ„ÅØÊúÄ‰∏äÈÉ®„Å®„Åø„Å™„ÅôÔºâ
                    setTimeout(() => {
                        updatePullRefreshHint();
                    }, 100);
                }
            }
            
            // ÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑ„Çø„Çπ„ÇØ„ÅÆ„Åø„Ç´„Ç¶„É≥„Éà
            const pendingTasksCount = tasks.filter(task => task.status !== 'completed').length;
            
            if (pendingTasksCount === 0) {
                // „Ç´„Éº„Éâ„Çí„ÇØ„É™„Ç¢Ôºà„Éú„Çø„É≥„ÅØÊÆã„Åô„ÄÅ„Ç¥„ÉüÁÆ±„ÅØtaskGridÂ§ñ„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„ÅÆ„ÅßÈô§Â§ñÔºâ
                const addButton = taskGrid.querySelector('.add-task-button');
                const completeButton = taskGrid.querySelector('.complete-button');
                const addBadgeButton = taskGrid.querySelector('.add-badge-button');
                // „Ç¥„ÉüÁÆ±„ÅØtaskGridÂ§ñ„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅquerySelector„Åó„Å™„ÅÑ
                taskGrid.innerHTML = '';
                
                // „Éú„Çø„É≥„ÇíÂÜçËøΩÂä†
                if (addButton) {
                    taskGrid.appendChild(addButton);
                } else {
                    const button = document.createElement('button');
                    button.className = 'add-task-button';
                    button.type = 'button';
                    button.setAttribute('onclick', 'toggleTaskForm(event)');
                    button.innerHTML = '+<span class="tooltip-text">Êñ∞Ë¶è„Çø„Çπ„ÇØ„ÇíËøΩÂä†</span>';
                    // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÁõ¥Êé•ËøΩÂä†ÔºàonclickÂ±ûÊÄß„Å®‰ΩµÁî®Ôºâ
                    button.addEventListener('click', function(e) {
                        toggleTaskForm(e);
                    });
                    taskGrid.appendChild(button);
                }
                
                // ÂÆå‰∫Ü„Éú„Çø„É≥„ÇíÂÜçËøΩÂä†
                if (completeButton) {
                    taskGrid.appendChild(completeButton);
                } else {
                    const complete = document.createElement('div');
                    complete.className = 'complete-button';
                    complete.id = 'completeButton';
                    complete.innerHTML = '<span class="complete-icon">‚úì</span><span class="tooltip-text">„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÅßÂÆå‰∫Ü</span>';
                    taskGrid.appendChild(complete);
                    // ÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆ„Éè„É≥„Éâ„É©„Éº„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶ÂÜçË®≠ÂÆö
                    completeButtonHandlerSet = false;
                    setupCompleteButtonDrop(); // „Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„ÇíÂÜçË®≠ÂÆö
                }
                
                // „Éê„ÉÉ„Ç∏„Éú„Çø„É≥„ÇíÂÜçËøΩÂä†
                if (addBadgeButton) {
                    taskGrid.appendChild(addBadgeButton);
                } else {
                    const badgeButton = document.createElement('button');
                    badgeButton.className = 'add-badge-button';
                    badgeButton.onclick = openBadgeForm;
                    badgeButton.innerHTML = '<span class="badge-icon-text">üè∑Ô∏è</span><span class="tooltip-text">„Éê„ÉÉ„Ç∏„Çí‰Ωú„Çã</span>';
                    taskGrid.appendChild(badgeButton);
                }
                
                // „Ç¥„ÉüÁÆ±„ÅØtaskGridÂ§ñ„Å´ÈÖçÁΩÆÔºàposition: fixed„ÅßÁîªÈù¢Âè≥‰∏ã„Å´Âõ∫ÂÆöÔºâ
                // taskGridÂÜÖ„Å´„ÅØËøΩÂä†„Åó„Å™„ÅÑ
                
                const emptyMessage = document.createElement('div');
                emptyMessage.style.cssText = 'text-align: center; padding: var(--spacing-xl); color: var(--color-text-secondary); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);';
                
                // PCÁâà„Å®SPÁâà„Åß„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂàÜ„Åë„Çã
                const isMobile = window.innerWidth <= 430;
                const createMessage = isMobile ? '„Äå+„Äç„Éú„Çø„É≥„Çí„Çø„ÉÉ„ÉÅ' : '„Äå+„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ';
                
                emptyMessage.innerHTML = `
                    <p>„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÊñ∞Ë¶è„Çø„Çπ„ÇØ‰ΩúÊàê„ÅØ${createMessage}</p>
                `;
                taskGrid.appendChild(emptyMessage);
                return;
            }

            // „Ç∞„É™„ÉÉ„Éâ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
            const gridWidth = taskGrid.offsetWidth - 48; // paddingÂàÜ„ÇíÂºï„Åè
            const gridHeight = Math.max(800, taskGrid.offsetHeight - 48);
            const cardWidth = 280;
            const cardHeight = 180;

            // „Ç´„Éº„Éâ„Çí„ÇØ„É™„Ç¢Ôºà„Éú„Çø„É≥„ÅØÊÆã„Åô„ÄÅ„Ç¥„ÉüÁÆ±„ÅØtaskGridÂ§ñ„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„ÅÆ„ÅßÈô§Â§ñÔºâ
            const addButton = taskGrid.querySelector('.add-task-button');
            const completeButton = taskGrid.querySelector('.complete-button');
            const addBadgeButton = taskGrid.querySelector('.add-badge-button');
            // „Ç¥„ÉüÁÆ±„ÅØtaskGridÂ§ñ„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅquerySelector„Åó„Å™„ÅÑ
            taskGrid.innerHTML = '';
            
            // „Éú„Çø„É≥„ÇíÂÜçËøΩÂä†
            if (addButton) {
                taskGrid.appendChild(addButton);
            } else {
                const button = document.createElement('button');
                button.className = 'add-task-button';
                button.onclick = toggleTaskForm;
                button.innerHTML = '+<span class="tooltip-text">Êñ∞Ë¶è„Çø„Çπ„ÇØ„ÇíËøΩÂä†</span>';
                taskGrid.appendChild(button);
            }
            
            // ÂÆå‰∫Ü„Éú„Çø„É≥„ÇíÂÜçËøΩÂä†
            if (completeButton) {
                taskGrid.appendChild(completeButton);
            } else {
                const complete = document.createElement('div');
                complete.className = 'complete-button';
                complete.id = 'completeButton';
                complete.innerHTML = '<span class="complete-icon">‚úì</span><span class="tooltip-text">„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÅßÂÆå‰∫Ü</span>';
                taskGrid.appendChild(complete);
                // ÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆ„Éè„É≥„Éâ„É©„Éº„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶ÂÜçË®≠ÂÆö
                completeButtonHandlerSet = false;
                setupCompleteButtonDrop(); // „Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„ÇíÂÜçË®≠ÂÆö
            }
            
            // „Éê„ÉÉ„Ç∏„Éú„Çø„É≥„ÇíÂÜçËøΩÂä†
            if (addBadgeButton) {
                taskGrid.appendChild(addBadgeButton);
            } else {
                const badgeButton = document.createElement('button');
                badgeButton.className = 'add-badge-button';
                badgeButton.onclick = openBadgeForm;
                badgeButton.innerHTML = '<span class="badge-icon-text">üè∑Ô∏è</span><span class="tooltip-text">„Éê„ÉÉ„Ç∏„Çí‰Ωú„Çã</span>';
                taskGrid.appendChild(badgeButton);
            }
            
            // „Ç¥„ÉüÁÆ±„ÅØtaskGridÂ§ñ„Å´ÈÖçÁΩÆÔºàposition: fixed„ÅßÁîªÈù¢Âè≥‰∏ã„Å´Âõ∫ÂÆöÔºâ
            // taskGridÂÜÖ„Å´„ÅØËøΩÂä†„Åó„Å™„ÅÑ
            
            // ÈÖçÁΩÆÊ∏à„Åø„Ç´„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„ÇíË®òÈå≤
            const placedCards = [];

            // ÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑ„Çø„Çπ„ÇØ„ÅÆ„ÅøË°®Á§∫Ôºàpending„Çø„Çπ„ÇØ„ÅÆ„ÅøÔºâ
            const pendingTasks = tasks.filter(task => task.status !== 'completed');

            // ÂêÑ„Çø„Çπ„ÇØ„Ç´„Éº„Éâ„Çí„É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„Å´ÈÖçÁΩÆÔºà„Åæ„Åü„ÅØ‰øùÂ≠ò„Åï„Çå„Åü‰ΩçÁΩÆ„Çí‰ΩøÁî®Ôºâ
            let hasPositionUpdates = false;
            pendingTasks.forEach((task, index) => {
                const card = document.createElement('div');
                card.className = `task-card category-${task.category}`;
                card.draggable = true;
                card.dataset.taskId = task.id;
                card.dataset.isDragging = 'false';
                card.dataset.hasDragged = 'false';
                
                // „ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„ÉàÔºàÂè≥„Éë„Éç„É´„ÇíÂ±ïÈñãÔºâ
                card.addEventListener('dblclick', function(e) {
                    // „Éâ„É©„ÉÉ„Ç∞„Åß„Å™„ÅÑÂ†¥Âêà„ÅÆ„Åø„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíÂÆüË°å
                    if (this.dataset.hasDragged === 'false' && this.dataset.isDragging === 'false') {
                        e.stopPropagation();
                        showTaskDetail(task.id);
                    }
                });
                
                let top, left, rotation, zIndex;
                
                // ‰øùÂ≠ò„Åï„Çå„Åü‰ΩçÁΩÆ„Åå„ÅÇ„Çå„Å∞‰ΩøÁî®„ÄÅ„Å™„Åë„Çå„Å∞„É©„É≥„ÉÄ„É†ÈÖçÁΩÆ
                // Áõ∏ÂØæ‰ΩçÁΩÆÔºà%Ôºâ„ÇíÂÑ™ÂÖàÁöÑ„Å´‰ΩøÁî®„Åó„ÄÅÁµ∂ÂØæ‰ΩçÁΩÆÔºàpxÔºâ„ÅØÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ„Çµ„Éù„Éº„Éà
                if (task.position) {
                    if (task.position.leftPercent !== undefined && task.position.topPercent !== undefined) {
                        // Áõ∏ÂØæ‰ΩçÁΩÆÔºà%Ôºâ„Åã„ÇâÁµ∂ÂØæ‰ΩçÁΩÆÔºàpxÔºâ„Å´Â§âÊèõ
                        left = (task.position.leftPercent / 100) * gridWidth;
                        top = (task.position.topPercent / 100) * gridHeight;
                    } else if (task.position.left !== undefined && task.position.top !== undefined) {
                        // Êó¢Â≠ò„ÅÆÁµ∂ÂØæ‰ΩçÁΩÆÔºàÂæåÊñπ‰∫íÊèõÊÄßÔºâ- ÁèæÂú®„ÅÆ„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫„Å´Âêà„Çè„Åõ„Å¶Ê≠£Ë¶èÂåñ
                        // Âè§„ÅÑ„Éá„Éº„Çø„ÅØ100%ÂπÖ„Çí1920px„ÄÅ100%È´ò„Åï„Çí1080px„Å®‰ªÆÂÆö„Åó„Å¶Â§âÊèõ
                        const oldGridWidth = 1920 - 48;
                        const oldGridHeight = 1080 - 48;
                        const leftPercent = (task.position.left / oldGridWidth) * 100;
                        const topPercent = (task.position.top / oldGridHeight) * 100;
                        // Êñ∞„Åó„ÅÑ„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫„Å´Â§âÊèõ
                        left = (leftPercent / 100) * gridWidth;
                        top = (topPercent / 100) * gridHeight;
                        // Áõ∏ÂØæ‰ΩçÁΩÆ„Å®„Åó„Å¶‰øùÂ≠ò„ÅóÁõ¥„Åô
                        if (!task.position.leftPercent) task.position.leftPercent = leftPercent;
                        if (!task.position.topPercent) task.position.topPercent = topPercent;
                    } else {
                        // ‰ΩçÁΩÆÊÉÖÂ†±„Å™„Åó - „É©„É≥„ÉÄ„É†ÈÖçÁΩÆ„Å´Á∂ö„Åè
                        left = undefined;
                        top = undefined;
                    }
                    rotation = task.position.rotation || (Math.random() - 0.5) * 8;
                    zIndex = task.position.zIndex || Math.floor(Math.random() * 11);
                }
                
                if (left === undefined || top === undefined) {
                    // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„ÇíË®àÁÆóÔºàÈáç„Å™„Çä„ÇíÈÅø„Åë„ÇãÔºâ
                    let attempts = 0;
                    const maxAttempts = 50;
                    
                    do {
                        top = Math.random() * Math.max(0, gridHeight - cardHeight);
                        left = Math.random() * Math.max(0, gridWidth - cardWidth);
                        rotation = (Math.random() - 0.5) * 8; // -4Â∫¶„Åã„Çâ+4Â∫¶„ÅÆÁØÑÂõ≤
                        attempts++;
                        
                        // Êó¢Â≠ò„ÅÆ„Ç´„Éº„Éâ„Å®„ÅÆÈáç„Å™„Çä„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                        let overlaps = false;
                        for (let i = 0; i < placedCards.length; i++) {
                            const placed = placedCards[i];
                            // Á∞°ÊòìÁöÑ„Å™Èáç„Å™„Çä„ÉÅ„Çß„ÉÉ„ÇØÔºà‰ΩôÁôΩ20px„ÇíËÄÉÊÖÆÔºâ
                            const margin = 20;
                            if (!(left + cardWidth + margin < placed.left ||
                                  left > placed.left + placed.width + margin ||
                                  top + cardHeight + margin < placed.top ||
                                  top > placed.top + placed.height + margin)) {
                                overlaps = true;
                                break;
                            }
                        }
                        
                        if (!overlaps || attempts >= maxAttempts) break;
                    } while (attempts < maxAttempts);
                    
                    // „É©„É≥„ÉÄ„É†„Å™z-index„ÇíË®≠ÂÆöÔºà0„Äú10„ÅÆÁØÑÂõ≤Ôºâ
                    zIndex = Math.floor(Math.random() * 11);
                    
                    // „Çø„Çπ„ÇØ„Éá„Éº„Çø„Å´‰ΩçÁΩÆÊÉÖÂ†±„Çí‰øùÂ≠òÔºàÁõ∏ÂØæ‰ΩçÁΩÆÔºà%Ôºâ„Åß‰øùÂ≠òÔºâ
                    if (!task.position) {
                        task.position = {};
                    }
                    // Áõ∏ÂØæ‰ΩçÁΩÆÔºà%Ôºâ„ÇíË®àÁÆó„Åó„Å¶‰øùÂ≠ò
                    task.position.leftPercent = (left / gridWidth) * 100;
                    task.position.topPercent = (top / gridHeight) * 100;
                    task.position.rotation = rotation;
                    task.position.zIndex = zIndex;
                } else {
                    // Êó¢Â≠ò„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÁõ∏ÂØæ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞Ôºà„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫„ÅåÂ§â„Çè„Å£„ÅüÂ†¥Âêà„ÅÆË™øÊï¥Ôºâ
                    if (task.position.leftPercent !== undefined && task.position.topPercent !== undefined) {
                        // Áõ∏ÂØæ‰ΩçÁΩÆ„Åã„ÇâÊñ∞„Åó„ÅÑÁµ∂ÂØæ‰ΩçÁΩÆ„ÇíË®àÁÆóÔºàÊó¢„Å´Ë®àÁÆóÊ∏à„ÅøÔºâ
                        // Áõ∏ÂØæ‰ΩçÁΩÆ„ÅØ„Åù„ÅÆ„Åæ„Åæ‰øùÊåÅ
                    }
                }
                
                // ÈÖçÁΩÆÊ∏à„Åø„Ç´„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„ÇíË®òÈå≤
                placedCards.push({
                    left: left,
                    top: top,
                    width: cardWidth,
                    height: cardHeight
                });
                
                card.style.top = top + 'px';
                card.style.left = left + 'px';
                card.style.transform = `rotate(${rotation}deg)`;
                card.style.zIndex = zIndex;
                
                // „Ç´„ÉÜ„Ç¥„É™„Ç¢„Ç§„Ç≥„É≥„ÅÆ„Éë„Çπ„ÇíÂèñÂæó
                const categoryIconPath = getCategoryIconPath(task.category);
                const categoryIconHtml = categoryIconPath ? 
                    `<img src="${categoryIconPath}" alt="${getCategoryName(task.category)}" class="task-card-footer-icon">` : 
                    '';
                
                card.innerHTML = `
                    <span class="tooltip-text task-card-tooltip">„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„ÇíË°®Á§∫</span>
                    <div class="task-card-header">
                        <div class="task-card-title">${task.title}</div>
                        <div class="task-card-priority">${getPriorityStars(task.priority)}</div>
                    </div>
                    <div class="task-card-description">${task.description || 'Ë™¨Êòé„Å™„Åó'}</div>
                    <div class="task-card-footer">
                        <div class="task-card-category">
                            ${categoryIconHtml}
                            <span>${getCategoryName(task.category)}</span>
                        </div>
                    </div>
                `;
                
                // „Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Åü„Éê„ÉÉ„Ç∏„ÇíË°®Á§∫
                if (taskBadges[task.id] && taskBadges[task.id].length > 0) {
                    taskBadges[task.id].forEach((badgeId, index) => {
                        const badge = badges.find(b => b.id === badgeId);
                        if (badge && badge.attachedToTaskId === task.id) {
                            const badgeElement = createAttachedBadgeElement(badge, index);
                            card.appendChild(badgeElement);
                            card.classList.add('badge-attached');
                        }
                    });
                }
                
                taskGrid.appendChild(card);
                
                // „Ç´„Éº„Éâ„Å∏„ÅÆ„Éê„ÉÉ„Ç∏Âê∏ÁùÄÊ©üËÉΩ„ÇíË®≠ÂÆö
                setupTaskCardBadgeDrop(card, task);
            });
            
            // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö
            setupDragAndDrop();
            
            // „Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞Ôºà„Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÇÇ„ÅÆ„ÇíË°®Á§∫Ôºâ
            updateBadges();
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ„ÅÆË®≠ÂÆö
        function setupDragAndDrop() {
            const taskGrid = document.getElementById('taskGrid');
            const taskCards = taskGrid.querySelectorAll('.task-card');
            
            let draggedCard = null;
            let draggedOffset = { x: 0, y: 0 };
            
            // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„ÉàÁî®„ÅÆÂ§âÊï∞Ôºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
            let touchStartX = 0;
            let touchStartY = 0;
            let cardStartX = 0;
            let cardStartY = 0;
            let isDragging = false;
            let touchTimeout = null;
            let currentTouchedCard = null;
            let selectedCard = null;
            let selectedBadge = null;
            
            // „Ç´„Éº„ÉâÈÅ∏Êäû„ÇíËß£Èô§„Åô„ÇãÈñ¢Êï∞
            function deselectAllCards() {
                const allCards = taskGrid.querySelectorAll('.task-card');
                allCards.forEach(c => {
                    c.classList.remove('selected');
                    // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÇíÈùûË°®Á§∫Ôºà„Çπ„Éû„ÉõÁâàÔºâ
                    const tooltip = c.querySelector('.task-card-tooltip');
                    if (tooltip && window.innerWidth <= 430) {
                        tooltip.style.opacity = '0';
                        tooltip.style.visibility = 'hidden';
                    }
                });
                selectedCard = null;
            }
            
            // „Éê„ÉÉ„Ç∏ÈÅ∏Êäû„ÇíËß£Èô§„Åô„ÇãÈñ¢Êï∞
            function deselectAllBadges() {
                const allBadges = taskGrid.querySelectorAll('.badge');
                allBadges.forEach(b => {
                    b.classList.remove('selected');
                });
                selectedBadge = null;
            }
            
            // „Ç∞„É™„ÉÉ„ÉâÂ§ñ„Çí„Çø„ÉÉ„Éó„Åó„Åü„ÇâÈÅ∏ÊäûËß£Èô§„Å®„ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÈùûË°®Á§∫
            taskGrid.addEventListener('touchstart', function(e) {
                if (!e.target.closest('.task-card') && !e.target.closest('.badge')) {
                    deselectAllCards();
                    // „Éê„ÉÉ„Ç∏„ÅÆÈÅ∏Êäû„ÇÇËß£Èô§
                    deselectAllBadges();
                }
            }, { passive: true });
            
            // „Éö„Éº„Ç∏ÂÖ®‰Ωì„Åß‰Ωï„ÇÇ„Å™„ÅÑÂ†¥ÊâÄ„Çí„Çø„ÉÉ„ÉÅ„Åó„ÅüÂ†¥Âêà„ÇÇÈÅ∏ÊäûËß£Èô§
            document.addEventListener('touchstart', function(e) {
                if (window.innerWidth <= 430) {
                    // „Ç´„Éº„Éâ„ÄÅ„Éê„ÉÉ„Ç∏„ÄÅ„Éú„Çø„É≥‰ª•Â§ñ„Çí„Çø„ÉÉ„ÉÅ„Åó„ÅüÂ†¥Âêà
                    if (!e.target.closest('.task-card') && 
                        !e.target.closest('.badge') && 
                        !e.target.closest('button') &&
                        !e.target.closest('.modal') &&
                        !e.target.closest('.slide-panel')) {
                        deselectAllCards();
                        deselectAllBadges();
                    }
                }
            }, { passive: true });
            
            // „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•Ê©üËÉΩÔºà„Çπ„Éû„ÉõÁâàÔºâ
            if (window.innerWidth <= 430) {
                setupPullRefresh();
            }
            
            taskCards.forEach(card => {
                const taskId = parseInt(card.dataset.taskId);
                const task = tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // „Çø„ÉÉ„ÉÅÈñãÂßãÔºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
                card.addEventListener('touchstart', function(e) {
                    if (e.touches.length === 1) {
                        const touch = e.touches[0];
                        touchStartX = touch.clientX;
                        touchStartY = touch.clientY;
                        currentTouchedCard = this;
                        
                        // „Ç´„Éº„Éâ„ÅÆÁèæÂú®‰ΩçÁΩÆ„ÇíÂèñÂæó
                        const rect = this.getBoundingClientRect();
                        const gridRect = taskGrid.getBoundingClientRect();
                        cardStartX = rect.left - gridRect.left;
                        cardStartY = rect.top - gridRect.top;
                        
                        // Êó¢„Å´ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„Ç´„Éº„Éâ„ÅÆÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ„Å´„Åô„Çã
                        if (this.classList.contains('selected') && selectedCard === this) {
                            // ÈÅ∏ÊäûÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ„Å´„Åô„Çã
                            isDragging = true;
                            this.dataset.hasDragged = 'true';
                            this.classList.add('dragging');
                            this.style.transition = 'none';
                            this.style.zIndex = '999'; /* „Ç¥„ÉüÁÆ±„Çà„Çä‰∏ã„Å´„Åô„Çã */
                            this.style.opacity = '0.8';
                            this.style.transform += ' scale(1.05)';
                        } else {
                            // Êñ∞Ë¶èÈÅ∏ÊäûÔºö„Åæ„ÅöÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
                            deselectAllCards();
                            this.classList.add('selected');
                            selectedCard = this;
                            
                            // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÇíË°®Á§∫Ôºà„Çπ„Éû„ÉõÁâàÔºàSPÔºâÔºâ
                            if (window.innerWidth <= 430) {
                                const tooltip = this.querySelector('.task-card-tooltip');
                                if (tooltip) {
                                    tooltip.textContent = '„ÉÄ„Éñ„É´„Çø„ÉÉ„Éó„ÅßË©≥Á¥∞Ë°®Á§∫';
                                    // Âº∑Âà∂ÁöÑ„Å´Ë°®Á§∫ÔºàCSS„ÇÇÈÅ©Áî®Ôºâ
                                    tooltip.style.display = 'block';
                                    tooltip.style.opacity = '1';
                                    tooltip.style.visibility = 'visible';
                                    // 3ÁßíÂæå„Å´ÈùûË°®Á§∫
                                    setTimeout(() => {
                                        if (tooltip && this.classList.contains('selected')) {
                                            tooltip.style.opacity = '0';
                                            tooltip.style.visibility = 'hidden';
                                        }
                                    }, 3000);
                                }
                            }
                            
                            // ÈÅ∏ÊäûÂæå„ÅÆ„Éâ„É©„ÉÉ„Ç∞ÈñãÂßãÂà§ÂÆö„ÅØÁü≠ÊôÇÈñìÔºà50msÔºâ„Å´„Åô„Çã
                            touchTimeout = setTimeout(() => {
                                if (this.classList.contains('selected') && selectedCard === this) {
                                    isDragging = true;
                                    this.dataset.hasDragged = 'true';
                                    this.classList.add('dragging');
                                    this.style.transition = 'none';
                                    this.style.zIndex = '999'; /* „Ç¥„ÉüÁÆ±„Çà„Çä‰∏ã„Å´„Åô„Çã */
                                    this.style.opacity = '0.8';
                                    this.style.transform += ' scale(1.05)';
                                }
                            }, 50); // Èôê„Çä„Å™„ÅèÁü≠„ÅÑÊôÇÈñì„Å´Ë®≠ÂÆö
                        }
                    }
                }, { passive: false });
                
                // „Çø„ÉÉ„ÉÅÁßªÂãïÔºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
                card.addEventListener('touchmove', function(e) {
                    if (isDragging && e.touches.length === 1 && currentTouchedCard === this) {
                        const touch = e.touches[0];
                        const deltaX = touch.clientX - touchStartX;
                        const deltaY = touch.clientY - touchStartY;
                        
                        // „Ç´„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
                        const gridRect = taskGrid.getBoundingClientRect();
                        const newX = cardStartX + deltaX;
                        const newY = cardStartY + deltaY;
                        
                        // „Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„Éâ„ÅÆÂ¢ÉÁïåÂÜÖ„Å´Âà∂Èôê
                        const cardRect = this.getBoundingClientRect();
                        const cardWidth = cardRect.width;
                        const cardHeight = cardRect.height;
                        
                        const maxX = taskGrid.offsetWidth - cardWidth;
                        const maxY = Math.max(800, taskGrid.offsetHeight) - cardHeight;
                        
                        const clampedX = Math.max(0, Math.min(newX, maxX));
                        const clampedY = Math.max(0, Math.min(newY, maxY));
                        
                        this.style.left = clampedX + 'px';
                        this.style.top = clampedY + 'px';
                        
                        // „Ç¥„ÉüÁÆ±„Å®„ÅÆÈáç„Å™„Çä„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºà„Ç´„Éº„Éâ„ÅÆÈ†òÂüüÂÖ®‰Ωì„ÅßÂà§ÂÆöÔºâ
                        const trashBin = document.getElementById('trashBin');
                        if (trashBin) {
                            const trashRect = trashBin.getBoundingClientRect();
                            // „Ç´„Éº„Éâ„ÅÆÈ†òÂüüÂÖ®‰Ωì„ÇíË®àÁÆóÔºà„Ç∞„É™„ÉÉ„ÉâÂ∫ßÊ®ôÁ≥ªÔºâ
                            const cardLeft = clampedX + gridRect.left;
                            const cardRight = cardLeft + cardWidth;
                            const cardTop = clampedY + gridRect.top;
                            const cardBottom = cardTop + cardHeight;
                            
                            // „Ç´„Éº„Éâ„ÅÆÈ†òÂüü„Åå„Ç¥„ÉüÁÆ±„ÅÆÈ†òÂüü„Å®Èáç„Å™„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                            const isOverlapping = !(cardRight < trashRect.left || 
                                                   cardLeft > trashRect.right || 
                                                   cardBottom < trashRect.top || 
                                                   cardTop > trashRect.bottom);
                            
                            if (isOverlapping) {
                                trashBin.classList.add('touch-drag-over');
                            } else {
                                trashBin.classList.remove('touch-drag-over');
                            }
                        }
                        
                        // ÂÆå‰∫Ü„Éú„Çø„É≥„Å®„ÅÆÈáç„Å™„Çä„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºà„Ç´„Éº„Éâ„ÅÆÈ†òÂüüÂÖ®‰Ωì„ÅßÂà§ÂÆöÔºâ
                        const completeButton = document.getElementById('completeButton');
                        if (completeButton) {
                            const completeRect = completeButton.getBoundingClientRect();
                            // „Ç´„Éº„Éâ„ÅÆÈ†òÂüüÂÖ®‰Ωì„ÇíË®àÁÆóÔºà„Ç∞„É™„ÉÉ„ÉâÂ∫ßÊ®ôÁ≥ªÔºâ
                            const cardLeft = clampedX + gridRect.left;
                            const cardRight = cardLeft + cardWidth;
                            const cardTop = clampedY + gridRect.top;
                            const cardBottom = cardTop + cardHeight;
                            
                            // „Ç´„Éº„Éâ„ÅÆÈ†òÂüü„ÅåÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆÈ†òÂüü„Å®Èáç„Å™„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                            const isOverlapping = !(cardRight < completeRect.left || 
                                                   cardLeft > completeRect.right || 
                                                   cardBottom < completeRect.top || 
                                                   cardTop > completeRect.bottom);
                            
                            if (isOverlapping) {
                                completeButton.classList.add('drag-over');
                            } else {
                                completeButton.classList.remove('drag-over');
                            }
                        }
                        
                        e.preventDefault();
                    } else if (currentTouchedCard === this) {
                        // ÈÅ∏ÊäûÊ∏à„Åø„Ç´„Éº„Éâ„ÅÆÁßªÂãï„ÇíÊ§úÂá∫„Åó„Åü„ÇâÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
                        if (this.classList.contains('selected') && selectedCard === this) {
                            const touch = e.touches[0];
                            const deltaX = Math.abs(touch.clientX - touchStartX);
                            const deltaY = Math.abs(touch.clientY - touchStartY);
                            
                            // ÁßªÂãïÈáè„Åå5px‰ª•‰∏ä„ÅÆÂ†¥Âêà„ÄÅÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
                            if (deltaX > 5 || deltaY > 5) {
                                clearTimeout(touchTimeout);
                                touchTimeout = null;
                                isDragging = true;
                                this.dataset.hasDragged = 'true';
                                this.classList.add('dragging');
                                this.style.transition = 'none';
                                this.style.zIndex = '999'; /* „Ç¥„ÉüÁÆ±„Çà„Çä‰∏ã„Å´„Åô„Çã */
                                this.style.opacity = '0.8';
                                this.style.transform += ' scale(1.05)';
                                e.preventDefault();
                            }
                        } else if (touchTimeout) {
                            // Êú™ÈÅ∏Êäû„Ç´„Éº„Éâ„ÅÆÂ†¥Âêà
                            const touch = e.touches[0];
                            const deltaX = Math.abs(touch.clientX - touchStartX);
                            const deltaY = Math.abs(touch.clientY - touchStartY);
                            
                            if (deltaX < 5 && deltaY < 5) {
                                // „Åæ„Å†„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã„Åó„Å¶„ÅÑ„Å™„ÅÑ
                                return;
                            } else {
                                // ÁßªÂãïÈáè„ÅåÂ§ß„Åç„ÅÑÂ†¥Âêà„ÅØ„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢„Åó„Å¶„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
                                clearTimeout(touchTimeout);
                                touchTimeout = null;
                                // ÁßªÂãï„ÅåÊ§úÂá∫„Åï„Çå„Åü„ÇâÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
                                isDragging = true;
                                this.dataset.hasDragged = 'true';
                                this.classList.add('dragging');
                                this.style.transition = 'none';
                                this.style.zIndex = '999'; /* „Ç¥„ÉüÁÆ±„Çà„Çä‰∏ã„Å´„Åô„Çã */
                                this.style.opacity = '0.8';
                                this.style.transform += ' scale(1.05)';
                                e.preventDefault();
                            }
                        }
                    }
                }, { passive: false });
                
                // „Çø„ÉÉ„ÉÅÁµÇ‰∫ÜÔºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
                card.addEventListener('touchend', function(e) {
                    clearTimeout(touchTimeout);
                    touchTimeout = null;
                    
                    // „Ç¥„ÉüÁÆ±„ÅÆÊã°Â§ßË°®Á§∫„ÇíËß£Èô§
                    const trashBin = document.getElementById('trashBin');
                    if (trashBin) {
                        trashBin.classList.remove('touch-drag-over');
                    }
                    
                    // ÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆÊã°Â§ßË°®Á§∫„ÇíËß£Èô§
                    const completeButton = document.getElementById('completeButton');
                    if (completeButton) {
                        completeButton.classList.remove('drag-over');
                    }
                    
                    if (isDragging && currentTouchedCard === this) {
                        // „Ç¥„ÉüÁÆ±„Åæ„Åü„ÅØÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆ‰∏ä„Å´„Éâ„É≠„ÉÉ„Éó„Åï„Çå„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºà„Ç´„Éº„Éâ„ÅÆÈ†òÂüüÂÖ®‰Ωì„ÅßÂà§ÂÆöÔºâ
                        const gridRect = taskGrid.getBoundingClientRect();
                        const cardRect = this.getBoundingClientRect();
                        let droppedOnTrash = false;
                        let droppedOnComplete = false;
                        
                        if (trashBin) {
                            const trashRect = trashBin.getBoundingClientRect();
                            // „Ç´„Éº„Éâ„ÅÆÈ†òÂüüÂÖ®‰Ωì„Åå„Ç¥„ÉüÁÆ±„ÅÆÈ†òÂüü„Å®Èáç„Å™„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                            const isOverlapping = !(cardRect.right < trashRect.left || 
                                                   cardRect.left > trashRect.right || 
                                                   cardRect.bottom < trashRect.top || 
                                                   cardRect.top > trashRect.bottom);
                            
                            if (isOverlapping) {
                                droppedOnTrash = true;
                            }
                        }
                        
                        if (completeButton && !droppedOnTrash) {
                            const completeRect = completeButton.getBoundingClientRect();
                            // „Ç´„Éº„Éâ„ÅÆÈ†òÂüüÂÖ®‰Ωì„ÅåÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆÈ†òÂüü„Å®Èáç„Å™„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                            const isOverlapping = !(cardRect.right < completeRect.left || 
                                                   cardRect.left > completeRect.right || 
                                                   cardRect.bottom < completeRect.top || 
                                                   cardRect.top > completeRect.bottom);
                            
                            if (isOverlapping) {
                                droppedOnComplete = true;
                            }
                        }
                        
                        if (droppedOnTrash) {
                            // ÂâäÈô§Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíË°®Á§∫
                            const taskTitle = task.title || 'ÁÑ°È°å„ÅÆ„Çø„Çπ„ÇØ';
                            if (confirm(`„Äå${taskTitle}„Äç„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ`)) {
                                deleteTask(task.id);
                            } else {
                                // „Ç≠„É£„É≥„Çª„É´ÊôÇ„ÅØÂÖÉ„ÅÆ‰ΩçÁΩÆ„Å´Êàª„Åô
                                if (task.position) {
                                    this.style.left = task.position.left + 'px';
                                    this.style.top = task.position.top + 'px';
                                }
                                this.style.transition = '';
                                this.style.zIndex = task.position ? task.position.zIndex || 0 : 0;
                                this.style.opacity = '1';
                                this.style.transform = this.style.transform.replace(' scale(1.05)', '');
                                this.classList.remove('dragging');
                            }
                        } else if (droppedOnComplete) {
                            // „Çø„Çπ„ÇØ„ÇíÂÆå‰∫Ü„Å´„Åô„Çã
                            completeTask(task.id);
                            
                            // „Éâ„É©„ÉÉ„Ç∞Áä∂ÊÖã„ÇíËß£Èô§
                            this.style.transition = '';
                            this.style.opacity = '1';
                            this.style.transform = this.style.transform.replace(' scale(1.05)', '');
                            this.classList.remove('dragging');
                        } else {
                            // „Çø„Çπ„ÇØ„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±„ÇíÊõ¥Êñ∞
                            const newLeft = cardRect.left - gridRect.left;
                            const newTop = cardRect.top - gridRect.top;
                            
                            // „Çø„Çπ„ÇØ„Éá„Éº„Çø„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞ÔºàÁõ∏ÂØæ‰ΩçÁΩÆÔºà%Ôºâ„Åß‰øùÂ≠òÔºâ
                            if (!task.position) {
                                task.position = {};
                            }
                            // Áõ∏ÂØæ‰ΩçÁΩÆÔºà%Ôºâ„ÇíË®àÁÆó„Åó„Å¶‰øùÂ≠ò
                            const taskGrid = document.getElementById('taskGrid');
                            const gridWidth = taskGrid.offsetWidth - 48;
                            const gridHeight = Math.max(800, taskGrid.offsetHeight - 48);
                            task.position.leftPercent = (newLeft / gridWidth) * 100;
                            task.position.topPercent = (newTop / gridHeight) * 100;
                            task.position.rotation = task.position.rotation || 0;
                            task.position.zIndex = task.position.zIndex || 0;
                            
                            this.style.transition = '';
                            this.style.zIndex = task.position.zIndex || 0;
                            this.style.opacity = '1';
                            this.style.transform = this.style.transform.replace(' scale(1.05)', '');
                            this.classList.remove('dragging');
                            
                            console.log('„Çø„Çπ„ÇØ„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü:', task.id, task.position);
                            // Firebase„Å´‰øùÂ≠ò
                            saveTaskMarketData();
                        }
                        
                        isDragging = false;
                        this.dataset.hasDragged = 'false';
                        currentTouchedCard = null;
                        
                        // „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫ÜÂæå„ÇÇÈÅ∏ÊäûÁä∂ÊÖã„ÇíÁ∂≠ÊåÅ
                        this.classList.add('selected');
                        selectedCard = this;
                    } else if (currentTouchedCard === this) {
                        // „Çø„ÉÉ„ÉóÂà§ÂÆöÔºàÁßªÂãïÈáè„ÅåÂ∞ë„Å™„ÅÑÂ†¥ÂêàÔºâ
                        const touch = e.changedTouches[0];
                        const deltaX = Math.abs(touch.clientX - touchStartX);
                        const deltaY = Math.abs(touch.clientY - touchStartY);
                        
                        if (deltaX < 10 && deltaY < 10) {
                            // ÂçòÁ¥î„Å™„Çø„ÉÉ„ÉóÔºöÈÅ∏ÊäûÁä∂ÊÖã„ÅÆÂàá„ÇäÊõø„Åà
                            if (this.classList.contains('selected') && selectedCard === this) {
                                // Êó¢„Å´ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÈÅ∏ÊäûËß£Èô§
                                this.classList.remove('selected');
                                selectedCard = null;
                                // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
                                const tooltip = this.querySelector('.task-card-tooltip');
                                if (tooltip) {
                                    tooltip.style.opacity = '0';
                                    tooltip.style.visibility = 'hidden';
                                }
                            } else {
                                // Êñ∞Ë¶èÈÅ∏Êäû
                                deselectAllCards();
                                this.classList.add('selected');
                                selectedCard = this;
                                
                                // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÇíË°®Á§∫Ôºà„Çπ„Éû„ÉõÁâàÔºàSPÔºâÔºâ
                                if (window.innerWidth <= 430) {
                                    const tooltip = this.querySelector('.task-card-tooltip');
                                    if (tooltip) {
                                        tooltip.textContent = '„ÉÄ„Éñ„É´„Çø„ÉÉ„Éó„ÅßË©≥Á¥∞Ë°®Á§∫';
                                        // Âº∑Âà∂ÁöÑ„Å´Ë°®Á§∫ÔºàCSS„ÇÇÈÅ©Áî®Ôºâ
                                        tooltip.style.display = 'block';
                                        tooltip.style.opacity = '1';
                                        tooltip.style.visibility = 'visible';
                                        // 3ÁßíÂæå„Å´ÈùûË°®Á§∫
                                        setTimeout(() => {
                                            if (tooltip) {
                                                tooltip.style.opacity = '0';
                                                tooltip.style.visibility = 'hidden';
                                            }
                                        }, 3000);
                                    }
                                }
                            }
                        }
                        
                        currentTouchedCard = null;
                    }
                });
                
                // „Çø„ÉÉ„ÉÅ„Ç≠„É£„É≥„Çª„É´Ôºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
                card.addEventListener('touchcancel', function(e) {
                    clearTimeout(touchTimeout);
                    touchTimeout = null;
                    isDragging = false;
                    this.classList.remove('dragging');
                    this.style.transition = '';
                    this.style.opacity = '1';
                    this.style.transform = this.style.transform.replace(' scale(1.05)', '');
                    this.dataset.hasDragged = 'false';
                    currentTouchedCard = null;
                    
                    // „Ç¥„ÉüÁÆ±„ÅÆÊã°Â§ßË°®Á§∫„ÇíËß£Èô§
                    const trashBin = document.getElementById('trashBin');
                    if (trashBin) {
                        trashBin.classList.remove('touch-drag-over');
                    }
                    
                    // ÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆÊã°Â§ßË°®Á§∫„ÇíËß£Èô§
                    const completeButton = document.getElementById('completeButton');
                    if (completeButton) {
                        completeButton.classList.remove('drag-over');
                    }
                    
                    // ÈÅ∏ÊäûÁä∂ÊÖã„ÅØÁ∂≠ÊåÅ
                });
                
                // „Éâ„É©„ÉÉ„Ç∞ÈñãÂßãÔºàPCÂØæÂøúÔºâ
                card.addEventListener('dragstart', function(e) {
                    draggedCard = this;
                    this.classList.add('dragging');
                    this.dataset.isDragging = 'true';
                    this.dataset.hasDragged = 'true'; // „Éâ„É©„ÉÉ„Ç∞ÈñãÂßã„Çí„Éû„Éº„ÇØ
                    
                    // „Ç´„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å®„Éû„Ç¶„Çπ‰ΩçÁΩÆ„ÅÆ„Ç™„Éï„Çª„ÉÉ„Éà„ÇíË®àÁÆó
                    const rect = this.getBoundingClientRect();
                    draggedOffset.x = e.clientX - rect.left;
                    draggedOffset.y = e.clientY - rect.top;
                    
                    // ÂÖÉ„ÅÆ„Ç´„Éº„Éâ„Çí‰∏ÄÊôÇÁöÑ„Å´ÈùûË°®Á§∫„Å´„Åó„Å¶ÊÆãÂÉè„ÇíÈò≤Ê≠¢
                    this.style.visibility = 'hidden';
                    
                    // „Éá„Éº„ÇøËª¢ÈÄÅË®≠ÂÆöÔºàÂøÖÈ†àÔºâ
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.outerHTML);
                });
                
                // „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫ÜÔºàPCÂØæÂøúÔºâ
                card.addEventListener('dragend', function(e) {
                    // ÂÖÉ„ÅÆ„Ç´„Éº„Éâ„ÇíÂÜçÂ∫¶Ë°®Á§∫
                    this.style.visibility = 'visible';
                    this.classList.remove('dragging');
                    this.dataset.isDragging = 'false';
                    taskGrid.classList.remove('drag-over');
                    
                    // „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫ÜÂæå„ÄÅÂ∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶„É™„Çª„ÉÉ„ÉàÔºà„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÅåÁô∫ÁÅ´„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
                    setTimeout(() => {
                        this.dataset.hasDragged = 'false';
                    }, 100);
                });
            });
            
            // „Ç∞„É™„ÉÉ„Éâ‰∏ä„ÅÆ„Éâ„É©„ÉÉ„Ç∞„Ç™„Éº„Éê„Éº
            taskGrid.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
                
                if (draggedCard) {
                    // „Ç´„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Çí„Éû„Ç¶„Çπ‰ΩçÁΩÆ„Å´Êõ¥Êñ∞
                    const gridRect = this.getBoundingClientRect();
                    const gridWidth = this.offsetWidth - 48;
                    const gridHeight = Math.max(800, this.offsetHeight - 48);
                    const cardWidth = 280;
                    const cardHeight = 180;
                    
                    // „Ç∞„É™„ÉÉ„ÉâÂÜÖ„ÅÆÁõ∏ÂØæ‰ΩçÁΩÆ„ÇíË®àÁÆóÔºà„Éû„Ç¶„Çπ‰ΩçÁΩÆ„Åã„Çâ„Ç™„Éï„Çª„ÉÉ„Éà„ÇíÂºï„ÅèÔºâ
                    let left = e.clientX - gridRect.left - draggedOffset.x - 24; // paddingÂàÜ„ÇíËÄÉÊÖÆ
                    let top = e.clientY - gridRect.top - draggedOffset.y - 24;
                    
                    // „Ç∞„É™„ÉÉ„ÉâÂÜÖ„Å´Âà∂Èôê
                    left = Math.max(0, Math.min(left, gridWidth - cardWidth));
                    top = Math.max(0, Math.min(top, gridHeight - cardHeight));
                    
                    draggedCard.style.left = left + 'px';
                    draggedCard.style.top = top + 'px';
                    draggedCard.style.transform = 'rotate(0deg)'; // „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅØÂõûËª¢„Å™„Åó
                }
            });
            
            // „Ç∞„É™„ÉÉ„Éâ„Åã„Çâ„ÅÆ„Éâ„É©„ÉÉ„Ç∞Èõ¢ËÑ±
            taskGrid.addEventListener('dragleave', function(e) {
                // „Ç∞„É™„ÉÉ„ÉâÂ§ñ„Å´Âá∫„ÅüÂ†¥Âêà„ÅÆ„Åø
                if (!this.contains(e.relatedTarget)) {
                    this.classList.remove('drag-over');
                }
            });
            
            // „Éâ„É≠„ÉÉ„Éó
            taskGrid.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                if (draggedCard) {
                    const taskId = parseInt(draggedCard.dataset.taskId);
                    const task = tasks.find(t => t.id === taskId);
                    
                    if (task) {
                        // „Çø„Çπ„ÇØ„Éá„Éº„Çø„Å´Êñ∞„Åó„ÅÑ‰ΩçÁΩÆ„Çí‰øùÂ≠òÔºàÁõ∏ÂØæ‰ΩçÁΩÆÔºà%Ôºâ„Åß‰øùÂ≠òÔºâ
                        if (!task.position) {
                            task.position = {};
                        }
                        const absLeft = parseInt(draggedCard.style.left);
                        const absTop = parseInt(draggedCard.style.top);
                        // Áõ∏ÂØæ‰ΩçÁΩÆÔºà%Ôºâ„ÇíË®àÁÆó„Åó„Å¶‰øùÂ≠ò
                        const taskGrid = document.getElementById('taskGrid');
                        const gridWidth = taskGrid.offsetWidth - 48;
                        const gridHeight = Math.max(800, taskGrid.offsetHeight - 48);
                        task.position.leftPercent = (absLeft / gridWidth) * 100;
                        task.position.topPercent = (absTop / gridHeight) * 100;
                        // „Éâ„É≠„ÉÉ„ÉóÂæå„ÅØÂõûËª¢„Çí‰øùÊåÅÔºàÂÖÉ„ÅÆÂõûËª¢„Åå„ÅÇ„Çå„Å∞‰ΩøÁî®„ÄÅ„Å™„Åë„Çå„Å∞„É©„É≥„ÉÄ„É†Ôºâ
                        if (!task.position.rotation) {
                            task.position.rotation = (Math.random() - 0.5) * 8;
                        }
                        draggedCard.style.transform = `rotate(${task.position.rotation}deg)`;
                        // Firebase„Å´‰øùÂ≠ò
                        saveTaskMarketData();
                    }
                    
                    draggedCard = null;
                }
            });
            
            // „Ç¥„ÉüÁÆ±„ÅÆ„Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„ÇíË®≠ÂÆö
            setupTrashBinDrop();
        }

        // „Éê„ÉÉ„Ç∏Ë°®Á§∫„Å®Êõ¥Êñ∞
        function updateBadges() {
            const taskGrid = document.getElementById('taskGrid');
            
            // Êó¢Â≠ò„ÅÆ„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§Ôºà„Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Å¶„ÅÑ„Çã„ÇÇ„ÅÆ„ÇíÈô§„ÅèÔºâ
            const existingBadges = taskGrid.querySelectorAll('.badge:not(.attached)');
            existingBadges.forEach(badge => badge.remove());
            
            // „Éê„ÉÉ„Ç∏„ÇíË°®Á§∫Ôºà„Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÇÇ„ÅÆÔºâ
            badges.forEach(badge => {
                if (!badge.attachedToTaskId) {
                    const badgeElement = createBadgeElement(badge);
                    taskGrid.appendChild(badgeElement);
                    setupBadgeDragAndDrop(badgeElement, badge);
                }
            });
            
            // „Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Åü„Éê„ÉÉ„Ç∏„ÅØ„ÄÅupdateTaskGrid()„ÅßÂÄãÂà•„Å´Êõ¥Êñ∞„Åï„Çå„Çã„Åü„ÇÅ„ÄÅ„Åì„Åì„Åß„ÅØÂëº„Å≥Âá∫„Åï„Å™„ÅÑ
            // updateTaskGrid()„ÇíÂëº„Å≥Âá∫„Åô„Å®„Ç´„Éº„Éâ„ÅåÂÜçÁîüÊàê„Åï„Çå„Å¶„Åó„Åæ„ÅÜ„Åü„ÇÅ„ÄÅ„Éê„ÉÉ„Ç∏„Éâ„É≠„ÉÉ„ÉóÊôÇ„ÅÆ„ÅøÊâãÂãï„ÅßÂëº„Å≥Âá∫„Åô
        }

        // „Éê„ÉÉ„Ç∏Ë¶ÅÁ¥†„Çí‰ΩúÊàêÔºà„Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÇÇ„ÅÆÔºâ
        function createBadgeElement(badge) {
            const badgeDiv = document.createElement('div');
            badgeDiv.className = 'badge';
            badgeDiv.dataset.badgeId = badge.id;
            badgeDiv.style.background = badge.color;
            badgeDiv.style.top = badge.position.top + 'px';
            badgeDiv.style.left = badge.position.left + 'px';
            
            // Google„Ç¢„Ç´„Ç¶„É≥„Éà„ÅÆÁîªÂÉè„Çí‰ΩøÁî®„Åô„ÇãÂ†¥Âêà
            let iconHtml = badge.icon;
            if (badge.icon && badge.icon.startsWith('img:')) {
                const imageUrl = badge.icon.substring(4); // "img:"„ÇíÂâäÈô§
                iconHtml = `<img src="${imageUrl}" alt="${badge.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            } else if (badge.picture) {
                // picture„Éó„É≠„Éë„ÉÜ„Ç£„ÅåÁõ¥Êé•„ÅÇ„ÇãÂ†¥Âêà
                iconHtml = `<img src="${badge.picture}" alt="${badge.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            }
            
            badgeDiv.innerHTML = `
                <div class="badge-icon">${iconHtml}</div>
                <div class="badge-name">${badge.name}</div>
            `;
            
            return badgeDiv;
        }

        // „Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Åü„Éê„ÉÉ„Ç∏Ë¶ÅÁ¥†„Çí‰ΩúÊàê
        function createAttachedBadgeElement(badge, index = 0) {
            const badgeDiv = document.createElement('div');
            badgeDiv.className = 'badge attached';
            badgeDiv.dataset.badgeId = badge.id;
            badgeDiv.style.background = badge.color;
            badgeDiv.title = badge.name + '„ÅåÁùÄÊâã‰∏≠Ôºà„ÇØ„É™„ÉÉ„ÇØ„ÅßÂ§ñ„ÅôÔºâ';
            
            // PCÁâàÔºö„Ç´„Éº„ÉâÂÜÖ„Å´ÈÖçÁΩÆÔºàÂè≥‰∏ãÔºâ
            // „Çπ„Éû„ÉõÁâàÔºö„Ç´„Éº„Éâ„ÅÆÁõ¥‰∏ãÔºà„Ç´„Éº„ÉâÂ§ñÔºâ„Å´ÂØÜÁùÄ„Åó„Å¶ÈÖçÁΩÆÔºàCSS„ÅßÂà∂Âæ°Ôºâ
            const badgeSize = 48;
            const badgeSpacing = 12; // „Éê„ÉÉ„Ç∏Èñì„ÅÆ„Çπ„Éö„Éº„Çπ
            const baseRight = 8;
            const baseBottom = 8; // „Éï„ÉÉ„Çø„ÉºÂè≥„Å´ÈÖçÁΩÆ
            
            // PCÁâàÁî®„ÅÆÈÖçÁΩÆÔºà„Éá„Éï„Ç©„É´„ÉàÔºâ
            if (window.innerWidth > 430) {
                // Âè≥ÂÅ¥„Åã„ÇâÂ∑¶ÂÅ¥„Å∏„ÄÅÂ∞ë„Åó‰∏ä„Å´„Åö„Çâ„ÅôÈÖçÁΩÆ
                // ÊúÄÂ§ß3„Å§„Åæ„ÅßÊ®™„Å´‰∏¶„Åπ„ÄÅ„Åù„Çå‰ª•‰∏ä„ÅØ‰∏ä„Å´ÈÖçÁΩÆÔºà2ÂàóÁõÆÔºâ
                if (index < 3) {
                    // ÊúÄÂàù„ÅÆ3„Å§„ÅØÊ®™„Å´‰∏¶„Åπ„Çã
                    badgeDiv.style.right = (baseRight + (index * (badgeSize + badgeSpacing))) + 'px';
                    badgeDiv.style.bottom = baseBottom + 'px';
                } else {
                    // 4„Å§ÁõÆ‰ª•Èôç„ÅØ‰∏ä„Å´ÈÖçÁΩÆÔºà2ÂàóÁõÆÔºâ
                    const colIndex = index - 3;
                    badgeDiv.style.right = (baseRight + (colIndex * (badgeSize + badgeSpacing))) + 'px';
                    badgeDiv.style.bottom = (baseBottom + badgeSize + badgeSpacing) + 'px';
                }
            } else {
                // „Çπ„Éû„ÉõÁâàÔºö„Ç´„Éº„Éâ„ÅÆÁõ¥‰∏ã„Å´ÈÖçÁΩÆÔºàCSS„ÇØ„É©„Çπ„ÅßÂà∂Âæ°„Åï„Çå„Çã„Åü„ÇÅ„ÄÅ„Çπ„Çø„Ç§„É´„ÅØÊúÄÂ∞èÈôêÔºâ
                // CSS„ÅÆ.attached„ÇØ„É©„Çπ„Åß‰ΩçÁΩÆ„ÅåÂà∂Âæ°„Åï„Çå„Çã
            }
            
            // Google„Ç¢„Ç´„Ç¶„É≥„Éà„ÅÆÁîªÂÉè„Çí‰ΩøÁî®„Åô„ÇãÂ†¥Âêà
            let iconHtml = badge.icon;
            if (badge.icon && badge.icon.startsWith('img:')) {
                const imageUrl = badge.icon.substring(4); // "img:"„ÇíÂâäÈô§
                iconHtml = `<img src="${imageUrl}" alt="${badge.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            } else if (badge.picture) {
                // picture„Éó„É≠„Éë„ÉÜ„Ç£„ÅåÁõ¥Êé•„ÅÇ„ÇãÂ†¥Âêà
                iconHtml = `<img src="${badge.picture}" alt="${badge.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            }
            
            badgeDiv.innerHTML = `
                <div class="badge-icon">${iconHtml}</div>
                <div class="badge-name">${badge.name}</div>
            `;
            
            // „ÇØ„É™„ÉÉ„ÇØ„Åß„Ç´„Éº„Éâ„Åã„Çâ„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„Åô
            badgeDiv.addEventListener('click', function(e) {
                e.stopPropagation();
                if (badge.attachedToTaskId) {
                    const taskId = badge.attachedToTaskId;
                    
                    // Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíË°®Á§∫
                    const task = tasks.find(t => t.id === taskId);
                    const taskTitle = task ? task.title : '„Çø„Çπ„ÇØ';
                    const badgeName = badge.name || '„Éê„ÉÉ„Ç∏';
                    
                    if (confirm(`‰ΩúÊ•≠„ÇíÂÅúÊ≠¢„Åó„Åæ„Åô„ÅãÔºü\n„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„Åô„Å®„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÅåÂÅúÊ≠¢„Åó„Åæ„Åô„ÄÇ\n\n„Éê„ÉÉ„Ç∏: ${badgeName}\n„Çø„Çπ„ÇØ: ${taskTitle}`)) {
                        // „Åì„ÅÆ„Éê„ÉÉ„Ç∏„Å´Èñ¢ÈÄ£„Åô„Çã„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÂÅúÊ≠¢
                        endTimeRecordsForBadge(taskId, badge.id);
                        
                    // „Çø„Çπ„ÇØ„Åã„Çâ„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„Åô
                    if (taskBadges[taskId]) {
                        taskBadges[taskId] = taskBadges[taskId].filter(id => id !== badge.id);
                        if (taskBadges[taskId].length === 0) {
                            delete taskBadges[taskId];
                            // „Ç´„Éº„Éâ„Åã„Çâbadge-attached„ÇØ„É©„Çπ„ÇíÂâäÈô§
                            const card = this.closest('.task-card');
                            if (card) {
                                card.classList.remove('badge-attached');
                            }
                        }
                    }
                    // „Éê„ÉÉ„Ç∏„ÅÆÂê∏ÁùÄÁä∂ÊÖã„ÇíËß£Èô§
                    badge.attachedToTaskId = null;
                    // „Éê„ÉÉ„Ç∏Ë¶ÅÁ¥†„ÇíÂâäÈô§
                    this.remove();
                    // Firebase„Å´‰øùÂ≠ò
                    saveTaskMarketData();
                    // „Ç∞„É™„ÉÉ„Éâ‰∏ä„Å´„Éê„ÉÉ„Ç∏„ÇíÂÜçË°®Á§∫
                    updateBadges();
                    }
                }
            });
            
            return badgeDiv;
        }

        // „Éê„ÉÉ„Ç∏„ÅÆ„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ„ÇíË®≠ÂÆö
        function setupBadgeDragAndDrop(badgeElement, badge) {
            const taskGrid = document.getElementById('taskGrid');
            
            // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„ÉàÁî®„ÅÆÂ§âÊï∞Ôºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
            let touchStartX = 0;
            let touchStartY = 0;
            let badgeStartX = 0;
            let badgeStartY = 0;
            let isBadgeDragging = false;
            let badgeTouchTimeout = null;
            let currentTouchedBadge = null;
            
            // „Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„É°„Éã„É•„Éº„ÇíÁÑ°ÂäπÂåñÔºàÁîªÂÉè‰øùÂ≠ò„É°„Éã„É•„Éº„Å™„Å©„ÇíÈò≤„ÅêÔºâ
            badgeElement.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                e.stopPropagation();
            });
            
            // ÁîªÂÉè„ÅÆÈÅ∏Êäû„ÇíÁÑ°ÂäπÂåñ
            badgeElement.addEventListener('selectstart', function(e) {
                e.preventDefault();
            });
            
            // „Çø„ÉÉ„ÉÅÈñãÂßãÔºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
            badgeElement.addEventListener('touchstart', function(e) {
                if (e.touches.length === 1) {
                    const touch = e.touches[0];
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;
                    currentTouchedBadge = this;
                    
                    // „Éê„ÉÉ„Ç∏„ÅÆÁèæÂú®‰ΩçÁΩÆ„ÇíÂèñÂæó
                    const rect = this.getBoundingClientRect();
                    const gridRect = taskGrid.getBoundingClientRect();
                    badgeStartX = rect.left - gridRect.left;
                    badgeStartY = rect.top - gridRect.top;
                    
                    // Êó¢„Å´ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„Éê„ÉÉ„Ç∏„ÅÆÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ„Å´„Åô„Çã
                    if (this.classList.contains('selected') && selectedBadge === this) {
                        // ÈÅ∏ÊäûÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ„Å´„Åô„Çã
                        isBadgeDragging = true;
                        this.classList.add('dragging');
                        this.style.transition = 'none';
                        this.style.zIndex = '1000';
                        this.style.opacity = '0.8';
                        this.style.transform += ' scale(1.1)';
                    } else {
                        // Êñ∞Ë¶èÈÅ∏ÊäûÔºö„Åæ„ÅöÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
                        deselectAllBadges();
                        this.classList.add('selected');
                        selectedBadge = this;
                        
                        // ÈÅ∏ÊäûÂæå„ÅÆ„Éâ„É©„ÉÉ„Ç∞ÈñãÂßãÂà§ÂÆö„ÅØÁü≠ÊôÇÈñìÔºà50msÔºâ„Å´„Åô„Çã
                        badgeTouchTimeout = setTimeout(() => {
                            if (this.classList.contains('selected') && selectedBadge === this) {
                                isBadgeDragging = true;
                                this.classList.add('dragging');
                                this.style.transition = 'none';
                                this.style.zIndex = '1000';
                                this.style.opacity = '0.8';
                                this.style.transform += ' scale(1.1)';
                            }
                        }, 50); // Èôê„Çä„Å™„ÅèÁü≠„ÅÑÊôÇÈñì„Å´Ë®≠ÂÆö
                    }
                }
            }, { passive: false });
            
            // „Çø„ÉÉ„ÉÅÁßªÂãïÔºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
            badgeElement.addEventListener('touchmove', function(e) {
                // ÈÅ∏ÊäûÊ∏à„Åø„Éê„ÉÉ„Ç∏„ÅåÁßªÂãï„Åó„ÅüÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
                if (this.classList.contains('selected') && selectedBadge === this && !isBadgeDragging) {
                    const touch = e.touches[0];
                    const deltaX = Math.abs(touch.clientX - touchStartX);
                    const deltaY = Math.abs(touch.clientY - touchStartY);
                    if (deltaX > 5 || deltaY > 5) {
                        // ÁßªÂãï„ÅåÊ§úÂá∫„Åï„Çå„ÅüÂ†¥Âêà„ÅØÂç≥Â∫ß„Å´„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
                        clearTimeout(badgeTouchTimeout);
                        isBadgeDragging = true;
                        this.classList.add('dragging');
                        this.style.transition = 'none';
                        this.style.zIndex = '1000';
                        this.style.opacity = '0.8';
                        this.style.transform += ' scale(1.1)';
                    }
                }
                
                if (isBadgeDragging && e.touches.length === 1 && currentTouchedBadge === this) {
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - touchStartX;
                    const deltaY = touch.clientY - touchStartY;
                    
                    // „Éê„ÉÉ„Ç∏„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
                    const gridRect = taskGrid.getBoundingClientRect();
                    const newX = badgeStartX + deltaX;
                    const newY = badgeStartY + deltaY;
                    
                    // „Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„Éâ„ÅÆÂ¢ÉÁïåÂÜÖ„Å´Âà∂Èôê
                    const badgeRect = this.getBoundingClientRect();
                    const badgeWidth = badgeRect.width;
                    const badgeHeight = badgeRect.height;
                    
                    const maxX = taskGrid.offsetWidth - badgeWidth;
                    const maxY = Math.max(800, taskGrid.offsetHeight) - badgeHeight;
                    
                    const clampedX = Math.max(0, Math.min(newX, maxX));
                    const clampedY = Math.max(0, Math.min(newY, maxY));
                    
                    this.style.left = clampedX + 'px';
                    this.style.top = clampedY + 'px';
                    
                    // „Ç´„Éº„Éâ„Å®„ÅÆÈáç„Å™„Çä„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºà„Çπ„Éû„ÉõÁâàÔºö„Éê„ÉÉ„Ç∏Âê∏ÁùÄÊ©üËÉΩÔºâ
                    const taskCards = taskGrid.querySelectorAll('.task-card');
                    taskCards.forEach(card => {
                        const cardRect = card.getBoundingClientRect();
                        const badgeCenterX = clampedX + badgeWidth / 2 + gridRect.left;
                        const badgeCenterY = clampedY + badgeHeight / 2 + gridRect.top;
                        
                        // „Éê„ÉÉ„Ç∏„ÅÆ‰∏≠ÂøÉÁÇπ„Åå„Ç´„Éº„Éâ„ÅÆÁØÑÂõ≤ÂÜÖ„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                        if (badgeCenterX >= cardRect.left && badgeCenterX <= cardRect.right &&
                            badgeCenterY >= cardRect.top && badgeCenterY <= cardRect.bottom) {
                            card.classList.add('drag-over-badge');
                        } else {
                            card.classList.remove('drag-over-badge');
                        }
                    });
                    
                    // „Ç¥„ÉüÁÆ±„Å®„ÅÆÈáç„Å™„Çä„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                    const trashBin = document.getElementById('trashBin');
                    if (trashBin) {
                        const trashRect = trashBin.getBoundingClientRect();
                        const badgeCenterX = clampedX + badgeWidth / 2 + gridRect.left;
                        const badgeCenterY = clampedY + badgeHeight / 2 + gridRect.top;
                        
                        // „Éê„ÉÉ„Ç∏„ÅÆ‰∏≠ÂøÉÁÇπ„Åå„Ç¥„ÉüÁÆ±„ÅÆÁØÑÂõ≤ÂÜÖ„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                        if (badgeCenterX >= trashRect.left && badgeCenterX <= trashRect.right &&
                            badgeCenterY >= trashRect.top && badgeCenterY <= trashRect.bottom) {
                            trashBin.classList.add('touch-drag-over');
                        } else {
                            trashBin.classList.remove('touch-drag-over');
                        }
                    }
                    
                    e.preventDefault();
                } else if (badgeTouchTimeout && currentTouchedBadge === this) {
                    // ÁßªÂãï„ÅåÂ∞è„Åï„ÅÑÂ†¥Âêà„ÅØ„Éâ„É©„ÉÉ„Ç∞„Çí„Ç≠„É£„É≥„Çª„É´
                    const touch = e.touches[0];
                    const deltaX = Math.abs(touch.clientX - touchStartX);
                    const deltaY = Math.abs(touch.clientY - touchStartY);
                    
                    if (deltaX < 5 && deltaY < 5) {
                        // „Åæ„Å†„Éâ„É©„ÉÉ„Ç∞ÈñãÂßã„Åó„Å¶„ÅÑ„Å™„ÅÑ
                        return;
                    } else {
                        // ÁßªÂãïÈáè„ÅåÂ§ß„Åç„ÅÑÂ†¥Âêà„ÅØ„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
                        clearTimeout(badgeTouchTimeout);
                        badgeTouchTimeout = null;
                    }
                }
            }, { passive: false });
            
                // „Çø„ÉÉ„ÉÅÁµÇ‰∫ÜÔºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
                badgeElement.addEventListener('touchend', function(e) {
                    clearTimeout(badgeTouchTimeout);
                    badgeTouchTimeout = null;
                    
                    // „Ç¥„ÉüÁÆ±„ÅÆÊã°Â§ßË°®Á§∫„ÇíËß£Èô§
                    const trashBin = document.getElementById('trashBin');
                    if (trashBin) {
                        trashBin.classList.remove('touch-drag-over');
                    }
                    
                    // „Åô„Åπ„Å¶„ÅÆ„Ç´„Éº„Éâ„Åã„Çâ„Éâ„É©„ÉÉ„Ç∞„Ç™„Éº„Éê„ÉºÁä∂ÊÖã„ÇíËß£Èô§
                    const taskCards = taskGrid.querySelectorAll('.task-card');
                    taskCards.forEach(card => {
                        card.classList.remove('drag-over-badge');
                    });
                    
                    if (isBadgeDragging && currentTouchedBadge === this) {
                        // „Ç¥„ÉüÁÆ±„ÅÆ‰∏ä„Å´„Éâ„É≠„ÉÉ„Éó„Åï„Çå„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                        const gridRect = taskGrid.getBoundingClientRect();
                        const badgeRect = this.getBoundingClientRect();
                        let droppedOnTrash = false;
                        let droppedOnCard = null;
                        
                        if (trashBin) {
                            const trashRect = trashBin.getBoundingClientRect();
                            // „Éê„ÉÉ„Ç∏„ÅÆ‰∏≠ÂøÉÁÇπ„Åå„Ç¥„ÉüÁÆ±„ÅÆÁØÑÂõ≤ÂÜÖ„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                            const badgeCenterX = badgeRect.left + badgeRect.width / 2;
                            const badgeCenterY = badgeRect.top + badgeRect.height / 2;
                            
                            if (badgeCenterX >= trashRect.left && badgeCenterX <= trashRect.right &&
                                badgeCenterY >= trashRect.top && badgeCenterY <= trashRect.bottom) {
                                droppedOnTrash = true;
                            }
                        }
                        
                        // „Ç´„Éº„Éâ„ÅÆ‰∏ä„Å´„Éâ„É≠„ÉÉ„Éó„Åï„Çå„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºà„Çπ„Éû„ÉõÁâàÔºö„Éê„ÉÉ„Ç∏Âê∏ÁùÄÊ©üËÉΩÔºâ
                        if (!droppedOnTrash) {
                            taskCards.forEach(card => {
                                const cardRect = card.getBoundingClientRect();
                                const badgeCenterX = badgeRect.left + badgeRect.width / 2;
                                const badgeCenterY = badgeRect.top + badgeRect.height / 2;
                                
                                // „Éê„ÉÉ„Ç∏„ÅÆ‰∏≠ÂøÉÁÇπ„Åå„Ç´„Éº„Éâ„ÅÆÁØÑÂõ≤ÂÜÖ„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                                if (badgeCenterX >= cardRect.left && badgeCenterX <= cardRect.right &&
                                    badgeCenterY >= cardRect.top && badgeCenterY <= cardRect.bottom) {
                                    const taskId = parseInt(card.dataset.taskId);
                                    if (taskId && badge.attachedToTaskId !== taskId) {
                                        droppedOnCard = { card: card, taskId: taskId };
                                    }
                                }
                            });
                        }
                        
                        if (droppedOnTrash) {
                            // „Éê„ÉÉ„Ç∏„ÇíÂâäÈô§ÔºàÁ¢∫Ë™ç„Å™„ÅóÔºâ
                            deleteBadge(badge.id);
                        } else if (droppedOnCard) {
                            // „Ç´„Éº„Éâ„Å´„Éê„ÉÉ„Ç∏„ÇíÂê∏ÁùÄÔºà„Çπ„Éû„ÉõÁâàÔºâ
                            const taskId = droppedOnCard.taskId;
                            const card = droppedOnCard.card;
                            
                            // ‰ª•Ââç„ÅÆ„Ç´„Éº„Éâ„Åã„Çâ„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„ÅôÔºàÂà•„ÅÆ„Ç´„Éº„Éâ„Å´ÁßªÂãï„Åô„ÇãÊôÇÔºâ
                            if (badge.attachedToTaskId && badge.attachedToTaskId !== taskId) {
                                const prevTaskId = badge.attachedToTaskId;
                                
                                // Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíË°®Á§∫Ôºà„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„ÅôÊôÇ„ÅÆ„ÅøÔºâ
                                const prevTask = tasks.find(t => t.id === prevTaskId);
                                const prevTaskTitle = prevTask ? prevTask.title : '„Çø„Çπ„ÇØ';
                                const badgeName = badge.name || '„Éê„ÉÉ„Ç∏';
                                
                                if (confirm(`‰ΩúÊ•≠„ÇíÂÅúÊ≠¢„Åó„Åæ„Åô„ÅãÔºü\n„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„Åô„Å®„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÅåÂÅúÊ≠¢„Åó„Åæ„Åô„ÄÇ\n\n„Éê„ÉÉ„Ç∏: ${badgeName}\n„Çø„Çπ„ÇØ: ${prevTaskTitle}`)) {
                                    // ‰ª•Ââç„ÅÆ„Çø„Çπ„ÇØ„Åã„Çâ„Åì„ÅÆ„Éê„ÉÉ„Ç∏„Å´Èñ¢ÈÄ£„Åô„Çã„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÂÅúÊ≠¢
                                    endTimeRecordsForBadge(prevTaskId, badge.id);
                                    
                                    if (taskBadges[prevTaskId]) {
                                        taskBadges[prevTaskId] = taskBadges[prevTaskId].filter(id => id !== badge.id);
                                        if (taskBadges[prevTaskId].length === 0) {
                                            delete taskBadges[prevTaskId];
                                        }
                                    }
                                    // Firebase„Å´‰øùÂ≠ò
                                    saveTaskMarketData();
                                } else {
                                    // „Ç≠„É£„É≥„Çª„É´„Åó„ÅüÂ†¥Âêà„ÅØ„ÄÅÊñ∞„Åó„ÅÑ„Ç´„Éº„Éâ„Å∏„ÅÆÂê∏ÁùÄ„Çí‰∏≠Ê≠¢
                                    e.preventDefault();
                                    return;
                                }
                            }
                            
                            // Êñ∞„Åó„ÅÑ„Ç´„Éº„Éâ„Å´„Éê„ÉÉ„Ç∏„ÇíÂê∏ÁùÄ
                            badge.attachedToTaskId = taskId;
                            if (!taskBadges[taskId]) {
                                taskBadges[taskId] = [];
                            }
                            if (!taskBadges[taskId].includes(badge.id)) {
                                taskBadges[taskId].push(badge.id);
                                // „Çø„Ç§„É†„É¨„Ç≥„Éº„ÉâËµ∑Âãï„ÅÆÁ¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
                                const taskObj = tasks.find(t => t.id === taskId);
                                const taskTitle = taskObj ? taskObj.title : '„Çø„Çπ„ÇØ';
                                const badgeName = badge.name || '„Éê„ÉÉ„Ç∏';
                                
                                if (confirm(`${badgeName}Ôºö„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíËµ∑Âãï„Åó„ÄÅ„Çø„Çπ„ÇØ„Äå${taskTitle}„Äç„ÇíÂÆüË°å„Åó„Åæ„Åô„ÄÇ`)) {
                                    // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàêÔºà„Éê„ÉÉ„Ç∏„Åå„Çø„Çπ„ÇØ„Å´‰ªò„Åë„Çâ„Çå„ÅüÊôÇÔºâ
                                    createTimeRecord(taskId, badge.id);
                                }
                                // Firebase„Å´‰øùÂ≠ò
                                saveTaskMarketData();
                            }
                            
                            // „Ç´„Éº„Éâ„Å´Áõ¥Êé•„Éê„ÉÉ„Ç∏„ÇíËøΩÂä†
                            const existingBadges = card.querySelectorAll('.badge.attached');
                            const badgeIndex = existingBadges.length;
                            const attachedBadgeElement = createAttachedBadgeElement(badge, badgeIndex);
                            card.appendChild(attachedBadgeElement);
                            card.classList.add('badge-attached');
                            
                            // „Ç∞„É™„ÉÉ„Éâ‰∏ä„ÅÆ„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§
                            this.remove();
                            
                            // „Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞Ôºà„Ç∞„É™„ÉÉ„Éâ‰∏ä„ÅÆ„Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞Ôºâ
                            updateBadges();
                            
                            console.log('„Éê„ÉÉ„Ç∏„Çí„Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Åæ„Åó„Åü:', badge.id, taskId);
                        } else {
                            // „Éê„ÉÉ„Ç∏„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±„ÇíÊõ¥Êñ∞
                            const newLeft = badgeRect.left - gridRect.left;
                            const newTop = badgeRect.top - gridRect.top;
                            
                            // „Éê„ÉÉ„Ç∏„Éá„Éº„Çø„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞Ôºà„Ç´„Éº„Éâ„Å´Âê∏ÁùÄ„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºâ
                            if (!badge.attachedToTaskId) {
                                badge.position.left = newLeft;
                                badge.position.top = newTop;
                            }
                            
                            this.style.transition = '';
                            this.style.zIndex = '10';
                            this.style.opacity = '1';
                            this.style.transform = this.style.transform.replace(' scale(1.1)', '');
                            this.classList.remove('dragging');
                            
                            console.log('„Éê„ÉÉ„Ç∏„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü:', badge.id, badge.position);
                            // Firebase„Å´‰øùÂ≠ò
                            saveTaskMarketData();
                        }
                        
                        isBadgeDragging = false;
                        currentTouchedBadge = null;
                        
                        // „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫ÜÂæå„ÇÇÈÅ∏ÊäûÁä∂ÊÖã„ÇíÁ∂≠ÊåÅ
                        this.classList.add('selected');
                        selectedBadge = this;
                    } else if (currentTouchedBadge === this) {
                        // „Çø„ÉÉ„ÉóÂà§ÂÆöÔºàÁßªÂãïÈáè„ÅåÂ∞ë„Å™„ÅÑÂ†¥ÂêàÔºâ
                        const touch = e.changedTouches[0];
                        const deltaX = Math.abs(touch.clientX - touchStartX);
                        const deltaY = Math.abs(touch.clientY - touchStartY);
                        
                        if (deltaX < 10 && deltaY < 10) {
                            // „Çø„ÉÉ„ÉóÔºöÈÅ∏ÊäûÁä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà
                            if (this.classList.contains('selected')) {
                                this.classList.remove('selected');
                                selectedBadge = null;
                            } else {
                                deselectAllBadges();
                                this.classList.add('selected');
                                selectedBadge = this;
                            }
                        }
                        currentTouchedBadge = null;
                    }
                });
            
            // „Çø„ÉÉ„ÉÅ„Ç≠„É£„É≥„Çª„É´Ôºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
            badgeElement.addEventListener('touchcancel', function(e) {
                clearTimeout(badgeTouchTimeout);
                badgeTouchTimeout = null;
                isBadgeDragging = false;
                this.classList.remove('dragging');
                this.style.transition = '';
                this.style.opacity = '1';
                this.style.transform = this.style.transform.replace(' scale(1.1)', '');
                currentTouchedBadge = null;
                
                // „Ç¥„ÉüÁÆ±„ÅÆÊã°Â§ßË°®Á§∫„ÇíËß£Èô§
                const trashBin = document.getElementById('trashBin');
                if (trashBin) {
                    trashBin.classList.remove('touch-drag-over');
                }
                
                // „Åô„Åπ„Å¶„ÅÆ„Ç´„Éº„Éâ„Åã„Çâ„Éâ„É©„ÉÉ„Ç∞„Ç™„Éº„Éê„ÉºÁä∂ÊÖã„ÇíËß£Èô§
                const taskCards = taskGrid.querySelectorAll('.task-card');
                taskCards.forEach(card => {
                    card.classList.remove('drag-over-badge');
                });
            });
            
            // „Éâ„É©„ÉÉ„Ç∞ÈñãÂßãÔºàPCÂØæÂøúÔºâ
            badgeElement.addEventListener('dragstart', function(e) {
                draggedBadgeGlobal = badge;
                this.classList.add('dragging');
                
                const rect = this.getBoundingClientRect();
                const gridRect = taskGrid.getBoundingClientRect();
                draggedBadgeOffset.x = e.clientX - rect.left;
                draggedBadgeOffset.y = e.clientY - rect.top;
                
                // ÂÖÉ„ÅÆ„Éê„ÉÉ„Ç∏„Çí‰∏ÄÊôÇÁöÑ„Å´ÈùûË°®Á§∫„Å´„Åó„Å¶ÊÆãÂÉè„ÇíÈò≤Ê≠¢
                this.style.visibility = 'hidden';
                
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('badgeId', badge.id.toString());
            });
            
            // „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫ÜÔºàPCÂØæÂøúÔºâ
            badgeElement.addEventListener('dragend', function(e) {
                // ÂÖÉ„ÅÆ„Éê„ÉÉ„Ç∏„ÇíÂÜçÂ∫¶Ë°®Á§∫
                this.style.visibility = 'visible';
                this.classList.remove('dragging');
                
                // „Éâ„É≠„ÉÉ„ÉóÂÖà„Åå„Ç´„Éº„Éâ„Åß„Å™„ÅÑÂ†¥Âêà„ÄÅ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
                if (draggedBadgeGlobal && !draggedBadgeGlobal.attachedToTaskId) {
                    const rect = this.getBoundingClientRect();
                    const gridRect = taskGrid.getBoundingClientRect();
                    draggedBadgeGlobal.position.left = parseInt(this.style.left);
                    draggedBadgeGlobal.position.top = parseInt(this.style.top);
                    // Firebase„Å´‰øùÂ≠ò
                    saveTaskMarketData();
                }
                
                draggedBadgeGlobal = null;
            });
            
            badgeElement.setAttribute('draggable', 'true');
        }
        
        // ÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆ„Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„ÇíË®≠ÂÆöÔºàÈáçË§áÁôªÈå≤„ÇíÈò≤„ÅêÔºâ
        let completeButtonHandlerSet = false;
        function setupCompleteButtonDrop() {
            const completeButton = document.getElementById('completeButton');
            if (!completeButton) return;
            
            // Êó¢„Å´Ë®≠ÂÆöÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (completeButtonHandlerSet) return;
            completeButtonHandlerSet = true;
            
            // ÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆ‰∏ä„Åß„ÅÆ„Éâ„É©„ÉÉ„Ç∞„Ç™„Éº„Éê„Éº
            completeButton.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            });
            
            // ÂÆå‰∫Ü„Éú„Çø„É≥„Åã„ÇâÈõ¢„Çå„ÅüÊôÇ
            completeButton.addEventListener('dragleave', function(e) {
                this.classList.remove('drag-over');
            });
            
            // ÂÆå‰∫Ü„Éú„Çø„É≥„Å´„Éâ„É≠„ÉÉ„ÉóÔºà‰∏ÄÂ∫¶„Å†„ÅëÂá¶ÁêÜ„Åï„Çå„Çã„Çà„ÅÜ„Å´„Éï„É©„Ç∞„Çí‰ΩøÁî®Ôºâ
            let isProcessing = false;
            completeButton.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('drag-over');
                
                // Êó¢„Å´Âá¶ÁêÜ‰∏≠„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
                if (isProcessing) return;
                isProcessing = true;
                
                // „Çø„Çπ„ÇØ„Ç´„Éº„Éâ„Åå„Éâ„É≠„ÉÉ„Éó„Åï„Çå„ÅüÂ†¥Âêà
                const taskGrid = document.getElementById('taskGrid');
                const draggedCard = taskGrid.querySelector('.task-card.dragging');
                if (draggedCard) {
                    const taskIdNum = parseInt(draggedCard.dataset.taskId);
                    if (taskIdNum && !isNaN(taskIdNum)) {
                        completeTask(taskIdNum);
                        // Âá¶ÁêÜÂÆå‰∫ÜÂæå„Å´„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                        setTimeout(() => { isProcessing = false; }, 100);
                        return;
                    }
                }
                
                // Âá¶ÁêÜÂÆå‰∫ÜÂæå„Å´„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                setTimeout(() => { isProcessing = false; }, 100);
            });
        }
        
        // „Çø„Çπ„ÇØ„ÇíÂÆå‰∫Ü„Å´„Åô„Çã
        function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Êó¢„Å´ÂÆå‰∫ÜÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (task.status === 'completed') return;
            
            // „Çø„Çπ„ÇØ„ÇíÂÆå‰∫ÜÁä∂ÊÖã„Å´Â§âÊõ¥
            task.status = 'completed';
            task.completedAt = new Date().toISOString();
            task.updatedAt = new Date().toISOString();
            
            // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÁµÇ‰∫ÜÔºà„Åì„ÅÆ„Çø„Çπ„ÇØ„Å´Á¥ê„Å•„Åè„Åô„Åπ„Å¶„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„ÉâÔºâ
            endTimeRecordsForTask(taskId);
            
            // „Ç∞„É™„ÉÉ„Éâ„ÇíÊõ¥Êñ∞ÔºàÂÆå‰∫Ü„Çø„Çπ„ÇØ„ÅØË°®Á§∫„Åã„ÇâÈô§Â§ñÔºâ
            updateTaskGrid();
            
            // „Ç¢„Éº„Ç´„Ç§„Éñ„Éë„Éç„É´„ÇíÊõ¥Êñ∞Ôºà„Éë„Éç„É´„ÅåÈñã„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥ÂêàÔºâ
            if (document.getElementById('slidePanelOverlay5') && document.getElementById('slidePanelOverlay5').classList.contains('active')) {
                updateArchivePanel();
            }
            
            // Firebase„Å´‰øùÂ≠ò
            saveTaskMarketData();
            
            console.log('„Çø„Çπ„ÇØ„ÇíÂÆå‰∫Ü„Å´„Åó„Åæ„Åó„Åü:', task.title);
        }
        
        // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàêÔºà„Éê„ÉÉ„Ç∏„Åå„Çø„Çπ„ÇØ„Å´‰ªò„Åë„Çâ„Çå„ÅüÊôÇÔºâ
        function createTimeRecord(taskId, badgeId) {
            const timeRecord = {
                id: Date.now(),
                taskId: taskId,
                badgeId: badgeId,
                startTime: new Date().toISOString(),
                endTime: null,
                duration: null, // ÁßíÂçò‰Ωç
                status: 'active' // 'active' or 'completed'
            };
            
            timeRecords.push(timeRecord);
            saveTimeRecords();
            
            console.log('„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü:', timeRecord);
            return timeRecord;
        }
        
        // „Çø„Çπ„ÇØ„Å´Á¥ê„Å•„Åè„Åô„Åπ„Å¶„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÁµÇ‰∫Ü
        function endTimeRecordsForTask(taskId) {
            const endTime = new Date();
            const endTimeISO = endTime.toISOString();
            
            timeRecords.forEach(record => {
                if (record.taskId === taskId && record.status === 'active') {
                    const startTime = new Date(record.startTime);
                    const duration = Math.floor((endTime - startTime) / 1000); // ÁßíÂçò‰Ωç
                    
                    record.endTime = endTimeISO;
                    record.duration = duration;
                    record.status = 'completed';
                }
            });
            
            saveTimeRecords();
            console.log('„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü:', taskId);
        }
        
        // ÁâπÂÆö„ÅÆ„Éê„ÉÉ„Ç∏„Å´Á¥ê„Å•„Åè„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÁµÇ‰∫ÜÔºà„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„Åó„ÅüÊôÇÔºâ
        function endTimeRecordsForBadge(taskId, badgeId) {
            const endTime = new Date();
            const endTimeISO = endTime.toISOString();
            
            timeRecords.forEach(record => {
                if (record.taskId === taskId && record.badgeId === badgeId && record.status === 'active') {
                    const startTime = new Date(record.startTime);
                    const duration = Math.floor((endTime - startTime) / 1000); // ÁßíÂçò‰Ωç
                    
                    record.endTime = endTimeISO;
                    record.duration = duration;
                    record.status = 'completed';
                }
            });
            
            saveTimeRecords();
            console.log('„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÂÅúÊ≠¢„Åó„Åæ„Åó„ÅüÔºà„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„Åó„ÅüÔºâ:', taskId, badgeId);
        }
        
        // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Çí‰øùÂ≠ò
        function saveTimeRecords() {
            localStorage.setItem('timeRecords', JSON.stringify(timeRecords));
            // Firebase„Å´„ÇÇ‰øùÂ≠ò
            saveTaskMarketData();
        }
        
        // „Çø„Çπ„ÇØ„ÅÆ„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÂèñÂæó
        function getTimeRecordsForTask(taskId) {
            return timeRecords.filter(record => record.taskId === taskId);
        }
        
        // ÊôÇÈñì„Çí„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºà„Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÂÆöÁæ©Ôºâ
        function formatDuration(seconds) {
            if (!seconds && seconds !== 0) return '-';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            if (hours > 0) {
                return `${hours}ÊôÇÈñì ${minutes}ÂàÜ ${secs}Áßí`;
            } else if (minutes > 0) {
                return `${minutes}ÂàÜ ${secs}Áßí`;
            } else {
                return `${secs}Áßí`;
            }
        }
        
        // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíË°®Á§∫ÔºàÂà•„Éë„Éç„É´„ÅßË°®Á§∫Ôºâ
        function showTimeRecords() {
            if (!currentDetailTaskId) return;
            
            const task = tasks.find(t => t.id === currentDetailTaskId);
            if (!task) return;
            
            const taskRecords = getTimeRecordsForTask(currentDetailTaskId);
            const activeRecord = taskRecords.find(r => r.status === 'active');
            
            const overlay = document.getElementById('timeRecordPanelOverlay');
            const panel = document.getElementById('timeRecordPanel');
            const content = document.getElementById('timeRecordContent');
            
            // „Éê„ÉÉ„Ç∏ÊÉÖÂ†±„ÇíÂèñÂæó
            const badgeMap = {};
            badges.forEach(badge => {
                badgeMap[badge.id] = badge;
            });
            
            function formatDateTime(isoString) {
                if (!isoString) return '-';
                const date = new Date(isoString);
                return date.toLocaleString('ja-JP', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            }
            
            // ÁèæÂú®„ÅÆ„Çø„Ç§„É†„É¨„Ç≥„Éº„ÉâÊÉÖÂ†±„ÇíË°®Á§∫
            let currentInfoHTML = '';
            if (activeRecord) {
                const badge = badgeMap[activeRecord.badgeId];
                const badgeName = badge ? badge.name : '‰∏çÊòé„Å™„Éê„ÉÉ„Ç∏';
                
                currentInfoHTML = `
                    <div style="background: var(--color-background); border: 2px solid #4CAF50; border-radius: var(--border-radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                        <h3 style="font-size: var(--font-size-lg); margin-bottom: var(--spacing-md); color: var(--color-text-primary);">ÁèæÂú®„ÅÆ„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ</h3>
                        <div style="margin-bottom: var(--spacing-sm);">
                            <span style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary);">ÊãÖÂΩìËÄÖ: </span>
                            <span style="color: var(--color-text-primary);">${escapeHtml(badgeName)}</span>
                        </div>
                        <div style="margin-bottom: var(--spacing-sm);">
                            <span style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary);">ÈñãÂßãÊôÇÈñì: </span>
                            <span style="color: var(--color-text-primary);">${formatDateTime(activeRecord.startTime)}</span>
                        </div>
                        ${task.estimatedTime ? `
                        <div style="margin-bottom: var(--spacing-sm);">
                            <span style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary);">‰∫àÊÉ≥‰ΩúÊ•≠ÊôÇÈñì: </span>
                            <span style="color: var(--color-text-primary);">${formatEstimatedTime(task.estimatedTime)}</span>
                        </div>
                        ` : ''}
                        <div style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 1px solid var(--color-border);">
                            <span style="font-size: var(--font-size-sm); color: #4CAF50; font-weight: var(--font-weight-semibold);">‚óè ‰ΩúÊ•≠‰∏≠</span>
                        </div>
                    </div>
                `;
            } else {
                currentInfoHTML = `
                    <div style="background: var(--color-background); border: 1px solid var(--color-border); border-radius: var(--border-radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                        <p style="color: var(--color-text-secondary); text-align: center;">
                            ÁèæÂú®ÂÆüË°å‰∏≠„ÅÆ„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì
                        </p>
                    </div>
                `;
            }
            
            // Â±•Ê≠¥„ÇíË°®Á§∫
            const completedRecords = taskRecords.filter(r => r.status === 'completed');
            let historyHTML = '';
            
            if (completedRecords.length > 0) {
                const historyItems = completedRecords.map(record => {
                    const badge = badgeMap[record.badgeId];
                    const badgeName = badge ? badge.name : '‰∏çÊòé„Å™„Éê„ÉÉ„Ç∏';
                    
                    return `
                        <div style="background: var(--color-background); border: 1px solid var(--color-border); border-radius: var(--border-radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-xs);">
                                <span style="font-weight: var(--font-weight-semibold); color: var(--color-text-primary);">${escapeHtml(badgeName)}</span>
                                <span style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">ÂÆå‰∫Ü</span>
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                <div>ÈñãÂßã: ${formatDateTime(record.startTime)}</div>
                                ${record.endTime ? `<div>ÁµÇ‰∫Ü: ${formatDateTime(record.endTime)}</div>` : ''}
                                <div style="margin-top: var(--spacing-xs); font-weight: var(--font-weight-semibold); color: var(--color-text-primary);">
                                    ‰ΩúÊ•≠ÊôÇÈñì: ${formatDuration(record.duration)}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // ÂêàË®àÊôÇÈñì„ÇíË®àÁÆó
                const totalDuration = completedRecords
                    .filter(r => r.duration !== null)
                    .reduce((sum, r) => sum + r.duration, 0);
                
                historyHTML = `
                    <div style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 2px solid var(--color-border);">
                        <h3 style="font-size: var(--font-size-lg); margin-bottom: var(--spacing-md); color: var(--color-text-primary);">Â±•Ê≠¥</h3>
                        <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-sm); background: var(--color-background-secondary); border-radius: var(--border-radius-md);">
                            <div style="font-weight: var(--font-weight-semibold); color: var(--color-text-primary);">
                                ÂêàË®à‰ΩúÊ•≠ÊôÇÈñì: ${formatDuration(totalDuration)}
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: 4px;">
                                Ë®òÈå≤Êï∞: ${completedRecords.length}‰ª∂
                            </div>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${historyItems}
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = `
                <div style="background: var(--color-background); border-radius: var(--border-radius-lg); padding: var(--spacing-md);">
                    ${currentInfoHTML}
                    ${historyHTML}
                </div>
            `;
            
            // „Éë„Éç„É´„ÇíÈñã„Åè
            overlay.classList.add('active');
            setTimeout(function() {
                panel.classList.add('active');
            }, 10);
        }
        
        // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        function closeTimeRecordPanel() {
            const overlay = document.getElementById('timeRecordPanelOverlay');
            const panel = document.getElementById('timeRecordPanel');
            
            panel.classList.remove('active');
            setTimeout(function() {
                overlay.classList.remove('active');
            }, 300);
        }
        
        // „Ç™„Éº„Éê„Éº„É¨„Ç§„ÇØ„É™„ÉÉ„ÇØ„Åß„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        function closeTimeRecordPanelOnOverlay(event) {
            if (event.target.id === 'timeRecordPanelOverlay') {
                closeTimeRecordPanel();
            }
        }
        
        // „Ç¥„ÉüÁÆ±„ÅÆ„Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„ÇíË®≠ÂÆöÔºàÈáçË§áÁôªÈå≤„ÇíÈò≤„ÅêÔºâ
        let trashBinHandlerSet = false;
        function setupTrashBinDrop() {
            const trashBin = document.getElementById('trashBin');
            if (!trashBin) return;
            
            // Êó¢„Å´Ë®≠ÂÆöÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (trashBinHandlerSet) return;
            trashBinHandlerSet = true;
            
            // „Ç¥„ÉüÁÆ±„ÅÆ‰∏ä„Åß„ÅÆ„Éâ„É©„ÉÉ„Ç∞„Ç™„Éº„Éê„Éº
            trashBin.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            });
            
            // „Ç¥„ÉüÁÆ±„Åã„ÇâÈõ¢„Çå„ÅüÊôÇ
            trashBin.addEventListener('dragleave', function(e) {
                this.classList.remove('drag-over');
            });
            
            // „Ç¥„ÉüÁÆ±„Å´„Éâ„É≠„ÉÉ„ÉóÔºà‰∏ÄÂ∫¶„Å†„ÅëÂá¶ÁêÜ„Åï„Çå„Çã„Çà„ÅÜ„Å´„Éï„É©„Ç∞„Çí‰ΩøÁî®Ôºâ
            let isProcessing = false;
            trashBin.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('drag-over');
                
                // Êó¢„Å´Âá¶ÁêÜ‰∏≠„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
                if (isProcessing) return;
                isProcessing = true;
                
                // „Çø„Çπ„ÇØ„Ç´„Éº„Éâ„Åå„Éâ„É≠„ÉÉ„Éó„Åï„Çå„ÅüÂ†¥Âêà
                const taskGrid = document.getElementById('taskGrid');
                const draggedCard = taskGrid.querySelector('.task-card.dragging');
                if (draggedCard) {
                    const taskIdNum = parseInt(draggedCard.dataset.taskId);
                    if (taskIdNum && !isNaN(taskIdNum)) {
                        deleteTask(taskIdNum);
                        // Âá¶ÁêÜÂÆå‰∫ÜÂæå„Å´„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                        setTimeout(() => { isProcessing = false; }, 100);
                        return;
                    }
                }
                
                // „Éê„ÉÉ„Ç∏„Åå„Éâ„É≠„ÉÉ„Éó„Åï„Çå„ÅüÂ†¥Âêà
                const badgeId = e.dataTransfer.getData('badgeId');
                if (badgeId) {
                    deleteBadge(parseInt(badgeId));
                }
                
                // Âá¶ÁêÜÂÆå‰∫ÜÂæå„Å´„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                setTimeout(() => { isProcessing = false; }, 100);
            });
        }
        
        // „Çø„Çπ„ÇØ„ÇíÂâäÈô§ÔºàÈáçË§áÂÆüË°å„ÇíÈò≤„ÅêÔºâ
        let isDeletingTask = false;
        function deleteTask(taskId) {
            // Êó¢„Å´ÂâäÈô§Âá¶ÁêÜ‰∏≠„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (isDeletingTask) return;
            
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // ÂâäÈô§„Éï„É©„Ç∞„ÇíË®≠ÂÆö
            isDeletingTask = true;
            
            // ÂâäÈô§Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
            const taskTitle = task.title || 'ÁÑ°È°å„ÅÆ„Çø„Çπ„ÇØ';
            if (!confirm(`„Äå${taskTitle}„Äç„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ`)) {
                // „Ç≠„É£„É≥„Çª„É´ÊôÇ„ÇÇ„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                isDeletingTask = false;
                return;
            }
            
            // „Çø„Çπ„ÇØ„ÇíÂâäÈô§
            tasks = tasks.filter(t => t.id !== taskId);
            
            // „Çø„Çπ„ÇØ„Å´Á¥ê„Å•„Åè„Éê„ÉÉ„Ç∏„ÇÇÂâäÈô§
            if (taskBadges[taskId]) {
                taskBadges[taskId].forEach(badgeId => {
                    const badge = badges.find(b => b.id === badgeId);
                    if (badge) {
                        badge.attachedToTaskId = null;
                    }
                });
                delete taskBadges[taskId];
            }
            
            // „Ç∞„É™„ÉÉ„Éâ„ÇíÊõ¥Êñ∞
            updateTaskGrid();
            
            // Firebase„Å´‰øùÂ≠ò
            saveTaskMarketData();
            
            console.log('„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü:', taskId);
            
            // ÂâäÈô§Âá¶ÁêÜÂÆå‰∫ÜÂæå„Å´„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
            isDeletingTask = false;
        }
        
        // „Éê„ÉÉ„Ç∏„ÇíÂâäÈô§
        function deleteBadge(badgeId) {
            const badge = badges.find(b => b.id === badgeId);
            if (!badge) return;
            
            // „Éê„ÉÉ„Ç∏„Åå„Çø„Çπ„ÇØ„Å´Âê∏ÁùÄ„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÂÅúÊ≠¢
            if (badge.attachedToTaskId) {
                const taskId = badge.attachedToTaskId;
                const task = tasks.find(t => t.id === taskId);
                const taskTitle = task ? task.title : '„Çø„Çπ„ÇØ';
                const badgeName = badge.name || '„Éê„ÉÉ„Ç∏';
                
                if (confirm(`‰ΩúÊ•≠„ÇíÂÅúÊ≠¢„Åó„Åæ„Åô„ÅãÔºü\n„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§„Åô„Çã„Å®„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÅåÂÅúÊ≠¢„Åó„Åæ„Åô„ÄÇ\n\n„Éê„ÉÉ„Ç∏: ${badgeName}\n„Çø„Çπ„ÇØ: ${taskTitle}`)) {
                    // „Åì„ÅÆ„Éê„ÉÉ„Ç∏„Å´Èñ¢ÈÄ£„Åô„Çã„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÂÅúÊ≠¢
                    endTimeRecordsForBadge(taskId, badgeId);
                } else {
                    // „Ç≠„É£„É≥„Çª„É´„Åó„ÅüÂ†¥Âêà„ÅØÂâäÈô§„Çí‰∏≠Ê≠¢
                    return;
                }
            }
            
            // „Éê„ÉÉ„Ç∏„ÇíÂâäÈô§
            badges = badges.filter(b => b.id !== badgeId);
            
            // „Çø„Çπ„ÇØ„Åã„Çâ„Éê„ÉÉ„Ç∏„ÅÆÁ¥ê‰ªò„Åë„ÇíÂâäÈô§
            if (badge.attachedToTaskId) {
                const taskId = badge.attachedToTaskId;
                if (taskBadges[taskId]) {
                    taskBadges[taskId] = taskBadges[taskId].filter(id => id !== badgeId);
                    if (taskBadges[taskId].length === 0) {
                        delete taskBadges[taskId];
                    }
                }
            }
            
            // „Éê„ÉÉ„Ç∏Ë°®Á§∫„ÇíÊõ¥Êñ∞
            updateBadges();
            
            // Firebase„Å´‰øùÂ≠ò
            saveTaskMarketData();
            
            console.log('„Éê„ÉÉ„Ç∏„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü:', badgeId);
        }

        // „Ç∞„É™„ÉÉ„Éâ‰∏ä„Åß„ÅÆ„Éê„ÉÉ„Ç∏„Éâ„É©„ÉÉ„Ç∞‰∏≠„Å´‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞Ôºà‰∏ÄÂ∫¶„Å†„ÅëË®≠ÂÆöÔºâ
        let badgeDragHandlerSet = false;
        function setupBadgeDragHandler() {
            if (badgeDragHandlerSet) return;
            badgeDragHandlerSet = true;
            
            const taskGrid = document.getElementById('taskGrid');
            if (taskGrid) {
                taskGrid.addEventListener('dragover', function(e) {
                    if (draggedBadgeGlobal && !draggedBadgeGlobal.attachedToTaskId) {
                        const draggingElement = taskGrid.querySelector(`.badge[data-badge-id="${draggedBadgeGlobal.id}"].dragging`);
                        if (draggingElement) {
                            const gridRect = taskGrid.getBoundingClientRect();
                            let newLeft = e.clientX - gridRect.left - draggedBadgeOffset.x;
                            let newTop = e.clientY - gridRect.top - draggedBadgeOffset.y;
                            
                            // „Ç∞„É™„ÉÉ„ÉâÂÜÖ„Å´Âà∂Èôê
                            newLeft = Math.max(0, Math.min(newLeft, gridRect.width - draggingElement.offsetWidth));
                            newTop = Math.max(0, Math.min(newTop, gridRect.height - draggingElement.offsetHeight));
                            
                            draggingElement.style.left = newLeft + 'px';
                            draggingElement.style.top = newTop + 'px';
                        }
                    }
                });
            }
        }

        // „Ç´„Éº„Éâ„Å∏„ÅÆ„Éê„ÉÉ„Ç∏Âê∏ÁùÄÊ©üËÉΩ„ÇíË®≠ÂÆö
        function setupTaskCardBadgeDrop(cardElement, task) {
            cardElement.addEventListener('dragover', function(e) {
                const badgeId = e.dataTransfer.getData('badgeId');
                if (badgeId) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    this.classList.add('drag-over-badge');
                }
            });
            
            cardElement.addEventListener('dragleave', function(e) {
                this.classList.remove('drag-over-badge');
            });
            
            cardElement.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('drag-over-badge');
                
                const badgeId = parseInt(e.dataTransfer.getData('badgeId'));
                if (badgeId) {
                    const badge = badges.find(b => b.id === badgeId);
                    if (badge && badge.attachedToTaskId !== task.id) {
                        // ‰ª•Ââç„ÅÆ„Ç´„Éº„Éâ„Åã„Çâ„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„ÅôÔºàÂà•„ÅÆ„Ç´„Éº„Éâ„Å´ÁßªÂãï„Åô„ÇãÊôÇÔºâ
                        if (badge.attachedToTaskId) {
                            const prevTaskId = badge.attachedToTaskId;
                            
                            // Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíË°®Á§∫Ôºà„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„ÅôÊôÇ„ÅÆ„ÅøÔºâ
                            const prevTask = tasks.find(t => t.id === prevTaskId);
                            const prevTaskTitle = prevTask ? prevTask.title : '„Çø„Çπ„ÇØ';
                            const badgeName = badge.name || '„Éê„ÉÉ„Ç∏';
                            
                            if (confirm(`‰ΩúÊ•≠„ÇíÂÅúÊ≠¢„Åó„Åæ„Åô„ÅãÔºü\n„Éê„ÉÉ„Ç∏„ÇíÂ§ñ„Åô„Å®„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÅåÂÅúÊ≠¢„Åó„Åæ„Åô„ÄÇ\n\n„Éê„ÉÉ„Ç∏: ${badgeName}\n„Çø„Çπ„ÇØ: ${prevTaskTitle}`)) {
                                // ‰ª•Ââç„ÅÆ„Çø„Çπ„ÇØ„Åã„Çâ„Åì„ÅÆ„Éê„ÉÉ„Ç∏„Å´Èñ¢ÈÄ£„Åô„Çã„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíÂÅúÊ≠¢
                                endTimeRecordsForBadge(prevTaskId, badge.id);
                                
                            if (taskBadges[prevTaskId]) {
                                taskBadges[prevTaskId] = taskBadges[prevTaskId].filter(id => id !== badge.id);
                                }
                            } else {
                                // „Ç≠„É£„É≥„Çª„É´„Åó„ÅüÂ†¥Âêà„ÅØ„ÄÅÊñ∞„Åó„ÅÑ„Ç´„Éº„Éâ„Å∏„ÅÆÂê∏ÁùÄ„Çí‰∏≠Ê≠¢
                                e.preventDefault();
                                e.stopPropagation();
                                return;
                            }
                        }
                        
                        // Êñ∞„Åó„ÅÑ„Ç´„Éº„Éâ„Å´„Éê„ÉÉ„Ç∏„ÇíÂê∏ÁùÄ
                        badge.attachedToTaskId = task.id;
                        if (!taskBadges[task.id]) {
                            taskBadges[task.id] = [];
                        }
                        if (!taskBadges[task.id].includes(badge.id)) {
                            taskBadges[task.id].push(badge.id);
                            // Firebase„Å´‰øùÂ≠ò
                            saveTaskMarketData();
                            // „Çø„Ç§„É†„É¨„Ç≥„Éº„ÉâËµ∑Âãï„ÅÆÁ¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
                            const taskObj = tasks.find(t => t.id === task.id);
                            const taskTitle = taskObj ? taskObj.title : '„Çø„Çπ„ÇØ';
                            const badgeName = badge.name || '„Éê„ÉÉ„Ç∏';
                            
                            if (confirm(`${badgeName}Ôºö„Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÇíËµ∑Âãï„Åó„ÄÅ„Çø„Çπ„ÇØ„Äå${taskTitle}„Äç„ÇíÂÆüË°å„Åó„Åæ„Åô„ÄÇ`)) {
                                // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàêÔºà„Éê„ÉÉ„Ç∏„Åå„Çø„Çπ„ÇØ„Å´‰ªò„Åë„Çâ„Çå„ÅüÊôÇÔºâ
                                createTimeRecord(task.id, badge.id);
                            }
                        }
                        
                        // „Ç´„Éº„Éâ„Å´Áõ¥Êé•„Éê„ÉÉ„Ç∏„ÇíËøΩÂä†ÔºàupdateTaskGrid()„ÇíÂëº„Å∞„Å™„ÅÑÔºâ
                        // Êó¢Â≠ò„ÅÆ„Éê„ÉÉ„Ç∏„ÅÆÊï∞„ÇíÂèñÂæó„Åó„Å¶„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíË®≠ÂÆö
                        const existingBadges = this.querySelectorAll('.badge.attached');
                        const badgeIndex = existingBadges.length;
                        const badgeElement = createAttachedBadgeElement(badge, badgeIndex);
                        this.appendChild(badgeElement);
                        this.classList.add('badge-attached');
                        
                        // „Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞Ôºà„Ç∞„É™„ÉÉ„Éâ‰∏ä„ÅÆ„Éê„ÉÉ„Ç∏„ÇíÊõ¥Êñ∞Ôºâ
                        updateBadges();
                    }
                }
            });
        }

        // „Ç´„ÉÜ„Ç¥„É™„ÉºÂêçÂèñÂæó
        function getCategoryName(category) {
            const names = {
                'design': '„Éá„Ç∂„Ç§„É≥',
                'frontend': '„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ',
                'backend': '„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ',
                'database': '„Éá„Éº„Çø„Éô„Éº„Çπ',
                'media': '„É°„Éá„Ç£„Ç¢',
                'other': '„Åù„ÅÆ‰ªñ'
            };
            return names[category] || category;
        }

        // „Ç´„ÉÜ„Ç¥„É™„Ç¢„Ç§„Ç≥„É≥„Éë„ÇπÂèñÂæó
        function getCategoryIconPath(category) {
            const iconPaths = {
                'design': 'images/„Éá„Ç∂„Ç§„É≥.svg',
                'frontend': 'images/„Éï„É≠„É≥„Éà.svg',
                'backend': 'images/„Éê„ÉÉ„ÇØ.svg',
                'media': 'images/„É°„Éá„Ç£„Ç¢ „ÉªSNS.svg',
                'database': 'images/„Éê„ÉÉ„ÇØ.svg',
                'other': null
            };
            return iconPaths[category] || null;
        }

        // ÂÑ™ÂÖàÂ∫¶ÂêçÂèñÂæó
        function getPriorityName(priority) {
            const names = {
                'low': '‰Ωé',
                'medium': '‰∏≠',
                'high': 'È´ò'
            };
            return names[priority] || priority;
        }

        // ÂÑ™ÂÖàÂ∫¶„Ç´„É©„ÉºÂèñÂæó
        function getPriorityColor(priority) {
            const colors = {
                'low': '#10b981',
                'medium': '#f59e0b',
                'high': '#ef4444'
            };
            return colors[priority] || '#7f8c8d';
        }

        // ÂÑ™ÂÖàÂ∫¶„Çí‚≠êÔ∏è„ÅßË°®Á§∫
        function getPriorityStars(priority) {
            const starCount = {
                'low': 1,
                'medium': 2,
                'high': 3
            };
            const count = starCount[priority] || 1;
            return '‚≠êÔ∏è'.repeat(count);
        }
        
        // ‰∫àÊÉ≥‰ΩúÊ•≠ÊôÇÈñì„Çí„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºàÂàÜÂçò‰Ωç„ÇíÊó•Êú¨Ë™ûË°®Ë®ò„Å´Â§âÊèõÔºâ
        function formatEstimatedTime(minutes) {
            if (!minutes && minutes !== 0) return '-';
            
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            
            if (hours > 0 && mins > 0) {
                return `${hours}ÊôÇÈñì${mins}ÂàÜ`;
            } else if (hours > 0) {
                return `${hours}ÊôÇÈñì`;
            } else {
                return `${mins}ÂàÜ`;
            }
        }

        // ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆ„Çø„Çπ„ÇØID„Çí‰øùÊåÅ
        let currentDetailTaskId = null;

        // „Çø„Çπ„ÇØË©≥Á¥∞Ë°®Á§∫ÔºàÂè≥„Åã„Çâ„Çπ„É©„Ç§„Éâ„Ç§„É≥Ôºâ
        function showTaskDetail(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            currentDetailTaskId = taskId;

            const overlay = document.getElementById('detailBoardOverlay');
            const detailBoard = document.getElementById('detailBoard');
            const detailContent = document.getElementById('detailContent');
            const editButton = document.getElementById('detailEditButton');
            const timeRecordButton = document.getElementById('detailTimeRecordButton');
            
            // ‰øÆÊ≠£„Éú„Çø„É≥„ÇíË°®Á§∫
            editButton.style.display = 'flex';
            // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Éú„Çø„É≥„ÇíË°®Á§∫
            timeRecordButton.style.display = 'flex';
            
            // Ë°®Á§∫„É¢„Éº„Éâ„ÅßË©≥Á¥∞„ÇíË°®Á§∫
            renderTaskDetailView(task);
            
            // „Éë„Éç„É´„ÇíÈñã„Åè
            overlay.classList.add('active');
            setTimeout(function() {
                detailBoard.classList.add('active');
            }, 10);
        }

        // „Çø„Çπ„ÇØË©≥Á¥∞„ÅÆË°®Á§∫„É¢„Éº„ÉâÔºàË™≠„ÅøÂèñ„ÇäÂ∞ÇÁî®Ôºâ
        function renderTaskDetailView(task) {
            const detailContent = document.getElementById('detailContent');
            
            detailContent.innerHTML = `
                <div style="background: var(--color-background); border-radius: var(--border-radius-lg); padding: var(--spacing-md);">
                    <h3 style="font-size: var(--font-size-lg); margin-bottom: var(--spacing-md); color: var(--color-text-primary);">${task.title}</h3>
                    <div style="margin-bottom: var(--spacing-sm);">
                        <span style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary);">„Ç´„ÉÜ„Ç¥„É™„Éº: </span>
                        <span>${getCategoryName(task.category)}</span>
                    </div>
                    <div style="margin-bottom: var(--spacing-sm);">
                        <span style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary);">ÂÑ™ÂÖàÂ∫¶: </span>
                        <span style="color: ${getPriorityColor(task.priority)};">${getPriorityStars(task.priority)}</span>
                    </div>
                    <div style="margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <span style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary);">„Çπ„ÉÜ„Éº„Çø„Çπ: </span>
                        <span>${task.status === 'completed' ? 'ÂÆå‰∫Ü' : 'Êú™ÁùÄÊâã'}</span>
                    </div>
                    ${task.estimatedTime ? `
                    <div style="margin-bottom: var(--spacing-md);">
                        <span style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary);">‰∫àÊÉ≥‰ΩúÊ•≠ÊôÇÈñì: </span>
                        <span>${formatEstimatedTime(task.estimatedTime)}</span>
                    </div>
                    ` : ''}
                    <div style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 1px solid var(--color-border);">
                        <p style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary); margin-bottom: var(--spacing-sm);">Ë™¨Êòé:</p>
                        <p style="color: var(--color-text-primary); line-height: 1.6;">${task.description || 'Ë™¨Êòé„Å™„Åó'}</p>
                    </div>
                </div>
            `;
        }

        // „Çø„Çπ„ÇØË©≥Á¥∞„ÅÆÁ∑®ÈõÜ„É¢„Éº„Éâ
        function renderTaskDetailEdit(task) {
            const detailContent = document.getElementById('detailContent');
            
            detailContent.innerHTML = `
                <div style="background: var(--color-background); border-radius: var(--border-radius-lg); padding: var(--spacing-md);">
                    <form id="taskEditForm">
                        <div class="form-group">
                            <label for="editTaskTitle">„Çø„Ç§„Éà„É´ *</label>
                            <input type="text" id="editTaskTitle" name="title" value="${task.title || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTaskCategory">„Ç´„ÉÜ„Ç¥„É™„Éº *</label>
                            <select id="editTaskCategory" name="category" required>
                                <option value="design" ${task.category === 'design' ? 'selected' : ''}>„Éá„Ç∂„Ç§„É≥</option>
                                <option value="frontend" ${task.category === 'frontend' ? 'selected' : ''}>„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ</option>
                                <option value="backend" ${task.category === 'backend' ? 'selected' : ''}>„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ</option>
                                <option value="database" ${task.category === 'database' ? 'selected' : ''}>„Éá„Éº„Çø„Éô„Éº„Çπ</option>
                                <option value="media" ${task.category === 'media' ? 'selected' : ''}>„É°„Éá„Ç£„Ç¢</option>
                                <option value="other" ${task.category === 'other' ? 'selected' : ''}>„Åù„ÅÆ‰ªñ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTaskPriority">ÂÑ™ÂÖàÂ∫¶ *</label>
                            <select id="editTaskPriority" name="priority" required>
                                <option value="low" ${task.priority === 'low' ? 'selected' : ''}>‰Ωé (‚≠êÔ∏è)</option>
                                <option value="medium" ${task.priority === 'medium' ? 'selected' : ''}>‰∏≠ (‚≠êÔ∏è‚≠êÔ∏è)</option>
                                <option value="high" ${task.priority === 'high' ? 'selected' : ''}>È´ò (‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTaskEstimatedTime">‰∫àÊÉ≥‰ΩúÊ•≠ÊôÇÈñì</label>
                            <select id="editTaskEstimatedTime" name="estimatedTime">
                                <option value="">Êú™Ë®≠ÂÆö</option>
                                <option value="10" ${task.estimatedTime === 10 ? 'selected' : ''}>10ÂàÜ</option>
                                <option value="20" ${task.estimatedTime === 20 ? 'selected' : ''}>20ÂàÜ</option>
                                <option value="30" ${task.estimatedTime === 30 ? 'selected' : ''}>30ÂàÜ</option>
                                <option value="40" ${task.estimatedTime === 40 ? 'selected' : ''}>40ÂàÜ</option>
                                <option value="50" ${task.estimatedTime === 50 ? 'selected' : ''}>50ÂàÜ</option>
                                <option value="60" ${task.estimatedTime === 60 ? 'selected' : ''}>1ÊôÇÈñì</option>
                                <option value="70" ${task.estimatedTime === 70 ? 'selected' : ''}>1ÊôÇÈñì10ÂàÜ</option>
                                <option value="80" ${task.estimatedTime === 80 ? 'selected' : ''}>1ÊôÇÈñì20ÂàÜ</option>
                                <option value="90" ${task.estimatedTime === 90 ? 'selected' : ''}>1ÊôÇÈñì30ÂàÜ</option>
                                <option value="100" ${task.estimatedTime === 100 ? 'selected' : ''}>1ÊôÇÈñì40ÂàÜ</option>
                                <option value="110" ${task.estimatedTime === 110 ? 'selected' : ''}>1ÊôÇÈñì50ÂàÜ</option>
                                <option value="120" ${task.estimatedTime === 120 ? 'selected' : ''}>2ÊôÇÈñì</option>
                                <option value="150" ${task.estimatedTime === 150 ? 'selected' : ''}>2ÊôÇÈñì30ÂàÜ</option>
                                <option value="180" ${task.estimatedTime === 180 ? 'selected' : ''}>3ÊôÇÈñì</option>
                                <option value="240" ${task.estimatedTime === 240 ? 'selected' : ''}>4ÊôÇÈñì</option>
                                <option value="300" ${task.estimatedTime === 300 ? 'selected' : ''}>5ÊôÇÈñì</option>
                                <option value="360" ${task.estimatedTime === 360 ? 'selected' : ''}>6ÊôÇÈñì</option>
                                <option value="480" ${task.estimatedTime === 480 ? 'selected' : ''}>8ÊôÇÈñì</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTaskDescription">Ë™¨Êòé</label>
                            <textarea id="editTaskDescription" name="description" rows="5">${task.description || ''}</textarea>
                        </div>
                        
                        <div class="form-actions" style="margin-top: var(--spacing-md);">
                            <button type="button" class="btn btn-secondary" onclick="cancelTaskEdit()">„Ç≠„É£„É≥„Çª„É´</button>
                            <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                        </div>
                    </form>
                </div>
            `;
            
            // „Éï„Ç©„Éº„É†„ÅÆÈÄÅ‰ø°„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö
            const taskEditForm = document.getElementById('taskEditForm');
            if (taskEditForm) {
                // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§ÔºàÈáçË§áÈò≤Ê≠¢Ôºâ
                const newTaskEditForm = taskEditForm.cloneNode(true);
                taskEditForm.parentNode.replaceChild(newTaskEditForm, taskEditForm);
                
                newTaskEditForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveTaskEdit();
                });
            }
        }

        // Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÂàá„ÇäÊõø„Åà
        function toggleTaskEditMode() {
            if (!currentDetailTaskId) return;
            
            const task = tasks.find(t => t.id === currentDetailTaskId);
            if (!task) return;
            
            const editButton = document.getElementById('detailEditButton');
            const detailContent = document.getElementById('detailContent');
            
            // Á∑®ÈõÜ„É¢„Éº„Éâ„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆöÔºà„Éï„Ç©„Éº„É†„ÅåÂ≠òÂú®„Åô„Çã„ÅãÔºâ
            const isEditMode = detailContent.querySelector('#taskEditForm');
            
            if (isEditMode) {
                // Á∑®ÈõÜ„É¢„Éº„Éâ„Åã„ÇâË°®Á§∫„É¢„Éº„Éâ„Å´Êàª„Åô
                renderTaskDetailView(task);
            } else {
                // Ë°®Á§∫„É¢„Éº„Éâ„Åã„ÇâÁ∑®ÈõÜ„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà
                renderTaskDetailEdit(task);
            }
        }

        // „Çø„Çπ„ÇØÁ∑®ÈõÜ„Çí„Ç≠„É£„É≥„Çª„É´
        function cancelTaskEdit() {
            if (!currentDetailTaskId) return;
            
            const task = tasks.find(t => t.id === currentDetailTaskId);
            if (!task) return;
            
            renderTaskDetailView(task);
        }

        // „Çø„Çπ„ÇØÁ∑®ÈõÜ„Çí‰øùÂ≠ò
        function saveTaskEdit() {
            if (!currentDetailTaskId) return;
            
            const task = tasks.find(t => t.id === currentDetailTaskId);
            if (!task) return;
            
            const form = document.getElementById('taskEditForm');
            const formData = new FormData(form);
            
            // „Çø„Çπ„ÇØ„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
            const estimatedTime = formData.get('estimatedTime');
            task.title = formData.get('title');
            task.category = formData.get('category');
            task.priority = formData.get('priority');
            task.description = formData.get('description') || '';
            task.estimatedTime = estimatedTime ? parseInt(estimatedTime) : null; // ÂàÜÂçò‰Ωç
            task.updatedAt = new Date().toISOString();
            
            // „Ç´„Éº„Éâ„ÅÆÂÜÖÂÆπ„ÇíÊõ¥Êñ∞Ôºà„Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„Éâ„ÇíÂÜçÊèèÁîªÔºâ
            updateTaskGrid();
            
            // Ë©≥Á¥∞„Éë„Éç„É´„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            renderTaskDetailView(task);
            
            // Firebase„Å´‰øùÂ≠ò
            saveTaskMarketData();
            
            console.log('„Çø„Çπ„ÇØ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü:', task);
        }

        // Ë©≥Á¥∞„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        function closeDetailBoard() {
            const overlay = document.getElementById('detailBoardOverlay');
            const detailBoard = document.getElementById('detailBoard');
            const editButton = document.getElementById('detailEditButton');
            
            // Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÅØË°®Á§∫„É¢„Éº„Éâ„Å´Êàª„Åô
            const detailContent = document.getElementById('detailContent');
            const isEditMode = detailContent && detailContent.querySelector('#taskEditForm');
            if (isEditMode) {
                cancelTaskEdit();
            }
            
            // ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆ„Çø„Çπ„ÇØID„Çí„É™„Çª„ÉÉ„Éà
            currentDetailTaskId = null;
            
            // ‰øÆÊ≠£„Éú„Çø„É≥„ÇíÈùûË°®Á§∫
            editButton.style.display = 'none';
            // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Éú„Çø„É≥„ÇíÈùûË°®Á§∫
            const timeRecordButton = document.getElementById('detailTimeRecordButton');
            if (timeRecordButton) {
                timeRecordButton.style.display = 'none';
            }
            
            detailBoard.classList.remove('active');
            setTimeout(function() {
                overlay.classList.remove('active');
            }, 300);
        }

        // „Ç™„Éº„Éê„Éº„É¨„Ç§„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        function closeDetailBoardOnOverlay(event) {
            if (event.target.id === 'detailBoardOverlay') {
                closeDetailBoard();
            }
        }


        // Ë©≥Á¥∞„Éú„Éº„Éâ„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„ÅàÔºàÂâäÈô§ÔºöË©≥Á¥∞„Éú„Éº„Éâ„ÅØ„Ç´„É©„É†„Åß„ÅØ„Å™„Åè„Çπ„É©„Ç§„Éâ„Ç§„É≥„Éë„Éç„É´„Å´Â§âÊõ¥Ôºâ
        // function toggleDetail() {
        //     const detailBoard = document.querySelector('.detail-board');
        //     const mainBoard = document.querySelector('.main-board');
        //     const toggleBtn = document.getElementById('toggleDetail');
        //     
        //     detailBoard.classList.toggle('hidden');
        //     toggleBtn.classList.toggle('active');
        //     updateMainBoardWidth();
        // }

        // „É°„Ç§„É≥„Éú„Éº„Éâ„ÅÆÂπÖ„ÇíÂãïÁöÑ„Å´Ë™øÊï¥ÔºàË©≥Á¥∞„Éú„Éº„Éâ„ÅØ„Ç´„É©„É†„Åß„ÅØ„Å™„Åè„Å™„Å£„Åü„Åü„ÇÅÂâäÈô§Ôºâ

        // „Çπ„Éó„É©„ÉÉ„Ç∑„É•„Çπ„ÇØ„É™„Éº„É≥„ÅÆÈùûË°®Á§∫Âá¶ÁêÜ
        window.addEventListener('load', function() {
            const splashScreen = document.getElementById('splashScreen');
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæåÔºà3.5ÁßíÔºâ„Å´„Çπ„Éó„É©„ÉÉ„Ç∑„É•„Çπ„ÇØ„É™„Éº„É≥„ÇíÂâäÈô§
            // È†ÜÁï™: 1. ÁôΩÁîªÈù¢„ÅåÂá∫„ÇãÔºà0ÁßíÔºâ‚Üí 2. „É≠„Ç¥„ÅåÂá∫„ÇãÔºà0.3Áßí„Äú1.3ÁßíÔºâ‚Üí 3. „É≠„Ç¥„ÅåÊ∂à„Åà„ÇãÔºà2Áßí„Äú2.5ÁßíÔºâ‚Üí 4. ÁôΩÁîªÈù¢„ÇíÊ∂à„ÅôÔºà3Áßí„Äú3.5ÁßíÔºâ
            setTimeout(function() {
                splashScreen.classList.add('hidden');
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„Å´ÂÆåÂÖ®„Å´ÂâäÈô§
                setTimeout(function() {
                    splashScreen.remove();
                    // „Çπ„Éó„É©„ÉÉ„Ç∑„É•Âæå„Å´„Çø„Çπ„ÇØ„Ç∞„É™„ÉÉ„Éâ„ÇíÊõ¥Êñ∞ÔºàÁ¢∫ÂÆü„Å´„Çµ„Ç§„Ç∫„ÇíÂèñÂæó„Åô„Çã„Åü„ÇÅÔºâ
                    setTimeout(function() {
                        updateTaskGrid();
                    }, 100);
                }, 500);
            }, 3500);
        });

        // „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•„Éí„É≥„Éà„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÊõ¥Êñ∞
        function updatePullRefreshHint() {
            if (window.innerWidth > 430) return;
            
            const taskGrid = document.getElementById('taskGrid');
            if (!taskGrid) return;
            
            // „Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆ„ÅåÊúÄ‰∏äÈÉ®Ôºà5px‰ª•‰∏ãÔºâ„ÅÆÊôÇ„ÅÆ„Åø„Éí„É≥„Éà„ÇíË°®Á§∫
            if (taskGrid.scrollTop <= 5) {
                taskGrid.classList.add('scroll-top');
            } else {
                taskGrid.classList.remove('scroll-top');
            }
        }
        
        // „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•Ê©üËÉΩÔºà„Çπ„Éû„ÉõÁâàÔºâ
        function setupPullRefresh() {
            const taskGrid = document.getElementById('taskGrid');
            const pullRefreshIndicator = document.getElementById('pullRefreshIndicator');
            
            // „Çπ„ÇØ„É≠„Éº„É´„Ç§„Éô„É≥„Éà„Åß„Éí„É≥„Éà„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÊõ¥Êñ∞
            taskGrid.addEventListener('scroll', function() {
                updatePullRefreshHint();
            }, { passive: true });
            
            if (!taskGrid || !pullRefreshIndicator || window.innerWidth > 430) {
                return; // „Çπ„Éû„ÉõÁâà„ÅÆ„Åø
            }
            
            let touchStartY = 0;
            let touchCurrentY = 0;
            let isPulling = false;
            let pullDistance = 0;
            const PULL_THRESHOLD = 80; // 80pxÂºï„Å£Âºµ„Å£„Åü„Çâ„É™„Éï„É¨„ÉÉ„Ç∑„É•ÈñãÂßã
            const PULL_MAX = 120; // ÊúÄÂ§ß120px„Åæ„ÅßÂºï„Å£Âºµ„Çå„Çã
            
            // „Çø„ÉÉ„ÉÅÈñãÂßã
            taskGrid.addEventListener('touchstart', function(e) {
                // „Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆ„ÅåÊúÄ‰∏äÈÉ®Ôºà0„Åæ„Åü„ÅØ0„Å´Ëøë„ÅÑÔºâ„ÅÆÊôÇ„ÅÆ„ÅøÊúâÂäπ
                if (taskGrid.scrollTop <= 5) {
                    touchStartY = e.touches[0].clientY;
                    isPulling = false;
                    pullDistance = 0;
                }
            }, { passive: true });
            
            // „Çø„ÉÉ„ÉÅÁßªÂãï
            taskGrid.addEventListener('touchmove', function(e) {
                if (touchStartY === 0) return;
                
                touchCurrentY = e.touches[0].clientY;
                const deltaY = touchCurrentY - touchStartY;
                
                // ‰∏ãÊñπÂêë„Å∏„ÅÆÂºï„Å£Âºµ„Çä„ÇíÊ§úÂá∫Ôºà„Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆ„ÅåÊúÄ‰∏äÈÉ®„ÅÆÊôÇÔºâ
                if (deltaY > 0 && taskGrid.scrollTop <= 5) {
                    e.preventDefault(); // „Éá„Éï„Ç©„É´„Éà„ÅÆ„Çπ„ÇØ„É≠„Éº„É´„ÇíÈò≤Ê≠¢
                    
                    pullDistance = Math.min(deltaY, PULL_MAX);
                    isPulling = pullDistance > 10; // 10px‰ª•‰∏äÂºï„Å£Âºµ„Å£„Åü„ÇâÈñãÂßã
                    
                    // Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
                    if (pullDistance >= PULL_THRESHOLD) {
                        pullRefreshIndicator.classList.add('active');
                        pullRefreshIndicator.querySelector('span').textContent = 'Èõ¢„Åó„Å¶Êõ¥Êñ∞';
                    } else {
                        pullRefreshIndicator.classList.remove('active');
                        pullRefreshIndicator.querySelector('span').textContent = 'Êõ¥Êñ∞‰∏≠...';
                    }
                    
                    // „Ç∞„É™„ÉÉ„Éâ„Çí‰∏ã„Å´Âºï„Å£Âºµ„Çã
                    taskGrid.style.transform = `translateY(${Math.min(pullDistance * 0.5, PULL_MAX * 0.5)}px)`;
                }
            }, { passive: false });
            
            // „Çø„ÉÉ„ÉÅÁµÇ‰∫Ü
            taskGrid.addEventListener('touchend', function(e) {
                if (!isPulling) {
                    touchStartY = 0;
                    touchCurrentY = 0;
                    pullDistance = 0;
                    taskGrid.style.transform = '';
                    pullRefreshIndicator.classList.remove('active');
                    return;
                }
                
                if (pullDistance >= PULL_THRESHOLD) {
                    // „É™„Éï„É¨„ÉÉ„Ç∑„É•ÂÆüË°å
                    pullRefreshIndicator.classList.add('active');
                    pullRefreshIndicator.querySelector('span').textContent = 'Êõ¥Êñ∞‰∏≠...';
                    
                    // „É™„Éï„É¨„ÉÉ„Ç∑„É•Âá¶ÁêÜ
                    refreshTaskData();
                } else {
                    // ÈñæÂÄ§„Å´ÈÅî„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÂÖÉ„Å´Êàª„Åô
                    taskGrid.style.transform = '';
                    pullRefreshIndicator.classList.remove('active');
                }
                
                // „É™„Çª„ÉÉ„Éà
                touchStartY = 0;
                touchCurrentY = 0;
                pullDistance = 0;
                isPulling = false;
            }, { passive: true });
            
            // „Çø„ÉÉ„ÉÅ„Ç≠„É£„É≥„Çª„É´
            taskGrid.addEventListener('touchcancel', function(e) {
                touchStartY = 0;
                touchCurrentY = 0;
                pullDistance = 0;
                isPulling = false;
                taskGrid.style.transform = '';
                pullRefreshIndicator.classList.remove('active');
            }, { passive: true });
        }
        
        // „Çø„Çπ„ÇØ„Éá„Éº„Çø„Çí„É™„Éï„É¨„ÉÉ„Ç∑„É•ÔºàÂÜçË™≠„ÅøËæº„ÅøÔºâ
        function refreshTaskData() {
            console.log('„Çø„Çπ„ÇØ„Éá„Éº„Çø„Çí„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åô...');
            
            // ÂÆüÈöõ„ÅÆ„É™„Éï„É¨„ÉÉ„Ç∑„É•Âá¶ÁêÜÔºàFirebase„Å™„Å©„Åã„ÇâÂÜçË™≠„ÅøËæº„ÅøÔºâ
            // ‰ªäÂõû„ÅØÁ∞°Âçò„Å´updateTaskGrid„Å®updateBadges„ÇíÂëº„Å≥Âá∫„Åô
            setTimeout(() => {
                updateTaskGrid();
                updateBadges();
                
                // „É™„Éï„É¨„ÉÉ„Ç∑„É•ÂÆå‰∫Ü
                const pullRefreshIndicator = document.getElementById('pullRefreshIndicator');
                if (pullRefreshIndicator) {
                    pullRefreshIndicator.querySelector('span').textContent = 'Êõ¥Êñ∞ÂÆå‰∫Ü';
                    setTimeout(() => {
                        pullRefreshIndicator.classList.remove('active');
                        const taskGrid = document.getElementById('taskGrid');
                        if (taskGrid) {
                            taskGrid.style.transform = '';
                        }
                    }, 500);
                }
            }, 800); // 0.8ÁßíÂæå„Å´ÂÆå‰∫ÜÔºàÂÆüÈöõ„ÅÆ„Éá„Éº„ÇøÂèñÂæó„Çí„Ç∑„Éü„É•„É¨„Éº„ÉàÔºâ
        }

        // „É™„É≥„ÇØ„Éë„Éç„É´Èñ¢ÈÄ£„ÅÆÂ§âÊï∞ÔºàÂàùÊúüÂåñÊôÇ„ÅØÁ©∫„ÄÅloadTaskMarketData()„ÅßË™≠„ÅøËæº„ÇÄÔºâ
        let externalLinks = [];
        let selectedLinkIds = new Set();
        let linkDragStartPosition = { x: 0, y: 0 };
        
        // „Ç¢„Éº„Ç´„Ç§„Éñ„Éë„Éç„É´Èñ¢ÈÄ£„ÅÆÂ§âÊï∞
        let archiveFilters = {
            date: 'all',
            assignee: 'all',
            category: 'all',
            search: ''
        };
        
        // „Ç¢„Éº„Ç´„Ç§„Éñ„Éë„Éç„É´ÔºöÂÆå‰∫ÜÊ∏à„Çø„Çπ„ÇØ„ÇíË°®Á§∫
        function updateArchivePanel() {
            const archiveTaskList = document.getElementById('archiveTaskList');
            if (!archiveTaskList) return;
            
            // ÂÆå‰∫ÜÊ∏à„Çø„Çπ„ÇØ„ÇíÂèñÂæó
            let completedTasks = tasks.filter(task => task.status === 'completed');
            
            // „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®
            completedTasks = applyArchiveFilters(completedTasks);
            
            archiveTaskList.innerHTML = '';
            
            if (completedTasks.length === 0) {
                archiveTaskList.innerHTML = '<p class="archive-empty">ÂÆå‰∫ÜÊ∏à„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            // Êó•‰ªò„Åß„ÇΩ„Éº„ÉàÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ
            completedTasks.sort((a, b) => {
                const dateA = new Date(a.completedAt || a.updatedAt || a.createdAt || 0);
                const dateB = new Date(b.completedAt || b.updatedAt || b.createdAt || 0);
                return dateB - dateA;
            });
            
            completedTasks.forEach(task => {
                const archiveItem = createArchiveTaskItem(task);
                archiveTaskList.appendChild(archiveItem);
            });
        }
        
        // „Ç¢„Éº„Ç´„Ç§„Éñ„Çø„Çπ„ÇØ„Ç¢„Ç§„ÉÜ„É†„Çí‰ΩúÊàêÔºà„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥Ôºâ
        function createArchiveTaskItem(task) {
            const item = document.createElement('div');
            item.className = 'archive-task-item';
            item.dataset.taskId = task.id;
            
            // ÂÆå‰∫ÜÊó•ÊôÇ
            const completedDate = task.completedAt ? new Date(task.completedAt) : (task.updatedAt ? new Date(task.updatedAt) : new Date(task.createdAt));
            const dateStr = completedDate.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // ÊãÖÂΩì„Éê„ÉÉ„Ç∏
            const assignedBadges = getAssignedBadgesForTask(task.id);
            
            // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„ÅÆÂêàË®à‰ΩúÊ•≠ÊôÇÈñì„ÇíË®àÁÆó
            const taskRecords = getTimeRecordsForTask(task.id);
            const completedRecords = taskRecords.filter(r => r.status === 'completed' && r.duration !== null);
            const totalDuration = completedRecords.reduce((sum, r) => sum + r.duration, 0);
            const totalDurationFormatted = totalDuration > 0 ? formatDuration(totalDuration) : '-';
            
            // „Ç´„ÉÜ„Ç¥„É™Âêç
            const categoryNames = {
                'design': '„Éá„Ç∂„Ç§„É≥',
                'frontend': '„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ',
                'backend': '„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ',
                'database': '„Éá„Éº„Çø„Éô„Éº„Çπ',
                'media': '„É°„Éá„Ç£„Ç¢',
                'other': '„Åù„ÅÆ‰ªñ'
            };
            
            item.innerHTML = `
                <div class="archive-task-header" onclick="toggleArchiveTask(this)">
                    <div style="flex: 1;">
                        <div class="archive-task-title">${escapeHtml(task.title || 'ÁÑ°È°å„ÅÆ„Çø„Çπ„ÇØ')}</div>
                        <div class="archive-task-meta">
                            <span>üìÖ ${dateStr}</span>
                            <span>|</span>
                            <span>${categoryNames[task.category] || 'Êú™ÂàÜÈ°û'}</span>
                            ${assignedBadges.length > 0 ? `<span>|</span><span>ÊãÖÂΩì: ${assignedBadges.length}‰∫∫</span>` : ''}
                            ${totalDuration > 0 ? `<span>|</span><span>‚è±Ô∏è ${totalDurationFormatted}</span>` : ''}
                        </div>
                    </div>
                    <span class="archive-task-arrow">‚ñº</span>
                </div>
                <div class="archive-task-content">
                    <div class="archive-task-body">
                        ${task.description ? `<div class="archive-task-description">${escapeHtml(task.description)}</div>` : ''}
                        ${assignedBadges.length > 0 ? `
                            <div class="archive-task-badges">
                                <span style="font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-right: var(--spacing-xs);">ÊãÖÂΩìËÄÖ:</span>
                                ${assignedBadges.map(badge => `
                                    <div class="archive-task-badge">
                                        ${badge.picture ? `<img src="${badge.picture}" alt="${escapeHtml(badge.name)}" class="archive-task-badge-icon">` : 
                                          badge.icon && badge.icon.startsWith('img:') ? `<img src="${badge.icon.substring(4)}" alt="${escapeHtml(badge.name)}" class="archive-task-badge-icon">` :
                                          `<span>${badge.icon || 'üë§'}</span>`}
                                        <span>${escapeHtml(badge.name)}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return item;
        }
        
        // „Çø„Çπ„ÇØ„Å´Ââ≤„ÇäÂΩì„Å¶„Çâ„Çå„Åü„Éê„ÉÉ„Ç∏„ÇíÂèñÂæó
        function getAssignedBadgesForTask(taskId) {
            if (!taskBadges[taskId] || taskBadges[taskId].length === 0) {
                return [];
            }
            
            return badges.filter(badge => taskBadges[taskId].includes(badge.id));
        }
        
        // HTML„Ç®„Çπ„Ç±„Éº„Éó
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // „Ç¢„Éº„Ç´„Ç§„Éñ„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥„ÅÆÈñãÈñâ
        function toggleArchiveTask(header) {
            const item = header.closest('.archive-task-item');
            item.classList.toggle('active');
        }
        
        // „Ç¢„Éº„Ç´„Ç§„Éñ„Éï„Ç£„É´„Çø„Éº„ÇíÈÅ©Áî®
        function applyArchiveFilters(tasks) {
            let filtered = [...tasks];
            
            // Êó•‰ªò„Éï„Ç£„É´„Çø„Éº
            if (archiveFilters.date !== 'all') {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                filtered = filtered.filter(task => {
                    const taskDate = task.completedAt ? new Date(task.completedAt) : (task.updatedAt ? new Date(task.updatedAt) : new Date(task.createdAt));
                    
                    switch (archiveFilters.date) {
                        case 'today':
                            return taskDate >= today;
                        case 'week':
                            const weekAgo = new Date(today);
                            weekAgo.setDate(weekAgo.getDate() - 7);
                            return taskDate >= weekAgo;
                        case 'month':
                            const monthAgo = new Date(today);
                            monthAgo.setMonth(monthAgo.getMonth() - 1);
                            return taskDate >= monthAgo;
                        case 'year':
                            const yearAgo = new Date(today);
                            yearAgo.setFullYear(yearAgo.getFullYear() - 1);
                            return taskDate >= yearAgo;
                        default:
                            return true;
                    }
                });
            }
            
            // ÊãÖÂΩìËÄÖ„Éï„Ç£„É´„Çø„Éº
            if (archiveFilters.assignee !== 'all') {
                filtered = filtered.filter(task => {
                    const assignedBadges = getAssignedBadgesForTask(task.id);
                    return assignedBadges.some(badge => badge.id.toString() === archiveFilters.assignee);
                });
            }
            
            // „Ç´„ÉÜ„Ç¥„É™„Éï„Ç£„É´„Çø„Éº
            if (archiveFilters.category !== 'all') {
                filtered = filtered.filter(task => task.category === archiveFilters.category);
            }
            
            // Ê§úÁ¥¢„Éï„Ç£„É´„Çø„Éº
            if (archiveFilters.search.trim() !== '') {
                const searchTerm = archiveFilters.search.toLowerCase();
                filtered = filtered.filter(task => 
                    (task.title && task.title.toLowerCase().includes(searchTerm)) ||
                    (task.description && task.description.toLowerCase().includes(searchTerm))
                );
            }
            
            return filtered;
        }
        
        // „Ç¢„Éº„Ç´„Ç§„Éñ„Éï„Ç£„É´„Çø„Éº„Ç§„Éô„É≥„Éà
        function setupArchiveFilters() {
            const filterDate = document.getElementById('archiveFilterDate');
            const filterAssignee = document.getElementById('archiveFilterAssignee');
            const filterCategory = document.getElementById('archiveFilterCategory');
            const filterSearch = document.getElementById('archiveFilterSearch');
            
            if (filterDate) {
                filterDate.addEventListener('change', function() {
                    archiveFilters.date = this.value;
                    updateArchivePanel();
                });
            }
            
            if (filterAssignee) {
                filterAssignee.addEventListener('change', function() {
                    archiveFilters.assignee = this.value;
                    updateArchivePanel();
                });
            }
            
            if (filterCategory) {
                filterCategory.addEventListener('change', function() {
                    archiveFilters.category = this.value;
                    updateArchivePanel();
                });
            }
            
            if (filterSearch) {
                filterSearch.addEventListener('input', function() {
                    archiveFilters.search = this.value;
                    updateArchivePanel();
                });
            }
            
            // ÊãÖÂΩìËÄÖ„Éï„Ç£„É´„Çø„Éº„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
            updateAssigneeFilterOptions();
        }
        
        // ÊãÖÂΩìËÄÖ„Éï„Ç£„É´„Çø„Éº„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
        function updateAssigneeFilterOptions() {
            const filterAssignee = document.getElementById('archiveFilterAssignee');
            if (!filterAssignee) return;
            
            // ÁèæÂú®„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„Çí‰øùÊåÅÔºà„Äå„Åô„Åπ„Å¶„Äç„ÅÆ„ÅøÔºâ
            filterAssignee.innerHTML = '<option value="all">„Åô„Åπ„Å¶</option>';
            
            // „Åô„Åπ„Å¶„ÅÆ„Éê„ÉÉ„Ç∏„ÇíÂèñÂæó
            badges.forEach(badge => {
                const option = document.createElement('option');
                option.value = badge.id.toString();
                option.textContent = badge.name;
                filterAssignee.appendChild(option);
            });
        }
        
        // Â§ñÈÉ®„É™„É≥„ÇØ„ÇíËøΩÂä†
        function addExternalLink(url, title = '') {
            try {
                const urlObj = new URL(url);
                const domain = urlObj.hostname;
                
                // „Çø„Ç§„Éà„É´„ÅåÊú™ÊåáÂÆö„ÅÆÂ†¥Âêà„ÅØ„Éâ„É°„Ç§„É≥Âêç„Çí‰ΩøÁî®
                const linkTitle = title || domain.replace('www.', '');
                
                // „Éï„Ç°„Éì„Ç≥„É≥URL„ÇíÁîüÊàê
                const faviconUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
                
                const link = {
                    id: Date.now(),
                    url: url,
                    title: linkTitle,
                    domain: domain,
                    faviconUrl: faviconUrl,
                    position: {
                        x: Math.random() * 300,
                        y: Math.random() * 300
                    },
                    groupId: null // „Ç∞„É´„Éº„ÉóIDÔºànull„ÅØ„Ç∞„É´„Éº„ÉóÊú™ÊâÄÂ±ûÔºâ
                };
                
                externalLinks.push(link);
                saveExternalLinks();
                updateLinkIconGrid();
                
                return link;
            } catch (error) {
                alert('ÊúâÂäπ„Å™URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                console.error('URLËß£Êûê„Ç®„É©„Éº:', error);
                return null;
            }
        }
        
        // Â§ñÈÉ®„É™„É≥„ÇØ„Çí‰øùÂ≠ò
        function saveExternalLinks() {
            localStorage.setItem('externalLinks', JSON.stringify(externalLinks));
            // Firebase„Å´„ÇÇ‰øùÂ≠ò
            saveTaskMarketData();
        }
        
        // Â§ñÈÉ®„É™„É≥„ÇØ„ÇíÂâäÈô§
        function deleteExternalLink(linkId) {
            externalLinks = externalLinks.filter(link => link.id !== linkId);
            saveExternalLinks();
            updateLinkIconGrid();
        }
        
        // „É™„É≥„ÇØ„Ç¢„Ç§„Ç≥„É≥„Ç∞„É™„ÉÉ„Éâ„ÇíÊõ¥Êñ∞
        function updateLinkIconGrid() {
            const linkIconGrid = document.getElementById('linkIconGrid');
            if (!linkIconGrid) return;
            
            linkIconGrid.innerHTML = '';
            
            externalLinks.forEach(link => {
                const linkIcon = document.createElement('div');
                linkIcon.className = 'link-icon';
                linkIcon.dataset.linkId = link.id;
                linkIcon.draggable = true;
                
                // ‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Çã‰ΩçÁΩÆ„ÇíÈÅ©Áî®
                if (link.position && link.position.x !== undefined && link.position.y !== undefined) {
                    linkIcon.style.position = 'absolute';
                    linkIcon.style.left = link.position.x + 'px';
                    linkIcon.style.top = link.position.y + 'px';
                }
                
                // „Éï„Ç°„Éì„Ç≥„É≥ÁîªÂÉè
                const img = document.createElement('img');
                img.src = link.faviconUrl;
                img.alt = link.title;
                img.onerror = function() {
                    // „Éï„Ç°„Éì„Ç≥„É≥Ë™≠„ÅøËæº„ÅøÂ§±ÊïóÊôÇ„ÅØ„Éá„Éï„Ç©„É´„Éà„Ç¢„Ç§„Ç≥„É≥
                    this.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50"><rect fill="%23ccc" width="50" height="50"/><text x="25" y="30" font-size="20" text-anchor="middle" fill="%23666">üîó</text></svg>';
                };
                
                // „Çø„Ç§„Éà„É´Ë°®Á§∫
                const titleSpan = document.createElement('span');
                titleSpan.className = 'link-icon-title';
                titleSpan.textContent = link.title;
                
                linkIcon.appendChild(img);
                linkIcon.appendChild(titleSpan);
                
                // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Ç§„Éô„É≥„Éà
                setupLinkDragAndDrop(linkIcon, link);
                
                // ÈÅ∏ÊäûÁî®„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„ÉàÔºàCtrl„Ç≠„Éº„Åæ„Åü„ÅØÈï∑Êäº„Åó„ÅßÈÅ∏ÊäûÔºâ
                linkIcon.addEventListener('click', function(e) {
                    // Ctrl„Ç≠„ÉºÔºàMac„Åß„ÅØCmd„Ç≠„ÉºÔºâ„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÈÅ∏Êäû„É¢„Éº„Éâ
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        toggleLinkSelection(link.id);
                    }
                });
                
                linkIconGrid.appendChild(linkIcon);
            });
            
            // „Ç¥„ÉüÁÆ±„ÅÆ„Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„ÇíË®≠ÂÆö
            // „Éë„Éç„É´ÂÜÖ„Ç¥„ÉüÁÆ±„ÅØÂâäÈô§„Åï„Çå„Åü„Åü„ÇÅ„ÄÅ„Åì„ÅÆÈñ¢Êï∞„ÅØÂëº„Å∞„Å™„ÅÑ
            // setupPanelTrashBin();
        }
        
        // „É™„É≥„ÇØ„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà
        function toggleLinkSelection(linkId) {
            if (selectedLinkIds.has(linkId)) {
                selectedLinkIds.delete(linkId);
            } else {
                selectedLinkIds.add(linkId);
            }
            
            // UIÊõ¥Êñ∞
            const linkIcon = document.querySelector(`.link-icon[data-link-id="${linkId}"]`);
            if (linkIcon) {
                if (selectedLinkIds.has(linkId)) {
                    linkIcon.classList.add('selected');
                } else {
                    linkIcon.classList.remove('selected');
                }
            }
            
            // „Ç∞„É´„Éº„ÉóÂåñ„ÅÆÁ¢∫Ë™ç
            if (selectedLinkIds.size > 1) {
                groupSelectedLinks();
            } else {
                ungroupLinks();
            }
        }
        
        // ÈÅ∏Êäû„Åï„Çå„Åü„É™„É≥„ÇØ„Çí„Ç∞„É´„Éº„ÉóÂåñ
        function groupSelectedLinks() {
            const groupId = Date.now();
            const selectedArray = Array.from(selectedLinkIds);
            
            selectedArray.forEach(linkId => {
                const link = externalLinks.find(l => l.id === linkId);
                if (link) {
                    link.groupId = groupId;
                }
            });
            
            saveExternalLinks();
        }
        
        // „É™„É≥„ÇØ„ÅÆ„Ç∞„É´„Éº„Éó„ÇíËß£Èô§
        function ungroupLinks() {
            externalLinks.forEach(link => {
                if (selectedLinkIds.has(link.id)) {
                    link.groupId = null;
                }
            });
            saveExternalLinks();
        }
        
        // „É™„É≥„ÇØ„ÅÆ„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ„ÇíË®≠ÂÆö
        function setupLinkDragAndDrop(linkIcon, link) {
            // PCÁâàÔºö„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó
            let dragStartPosition = { x: 0, y: 0 };
            
            linkIcon.addEventListener('dragstart', function(e) {
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('linkId', link.id.toString());
                
                // „Ç∞„É´„Éº„ÉóÂåñ„Åï„Çå„Åü„Ç¢„Ç§„Ç≥„É≥„ÇÇ‰∏ÄÁ∑í„Å´„Éâ„É©„ÉÉ„Ç∞„Åô„ÇãÂ†¥Âêà„ÅÆÂá¶ÁêÜ
                if (link.groupId) {
                    e.dataTransfer.setData('groupId', link.groupId.toString());
                }
                
                // „Éâ„É©„ÉÉ„Ç∞ÈñãÂßã‰ΩçÁΩÆ„ÇíË®òÈå≤
                dragStartPosition.x = link.position.x;
                dragStartPosition.y = link.position.y;
            });
            
            linkIcon.addEventListener('drag', function(e) {
                // „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅÆ‰ΩçÁΩÆÊõ¥Êñ∞Ôºà„Ç∞„É´„Éº„ÉóÂåñ„Åï„Çå„Åü„Ç¢„Ç§„Ç≥„É≥„ÇÇ‰∏ÄÁ∑í„Å´ÁßªÂãïÔºâ
                if (link.groupId && e.clientX !== 0 && e.clientY !== 0) {
                    const gridRect = document.getElementById('linkIconGrid').getBoundingClientRect();
                    const newX = e.clientX - gridRect.left - 25; // „Ç¢„Ç§„Ç≥„É≥„ÅÆ‰∏≠ÂøÉ„ÇíËÄÉÊÖÆ
                    const newY = e.clientY - gridRect.top - 25;
                    
                    const deltaX = newX - dragStartPosition.x;
                    const deltaY = newY - dragStartPosition.y;
                    
                    moveGroupedLinks(link.id, deltaX, deltaY);
                    dragStartPosition.x = newX;
                    dragStartPosition.y = newY;
                }
            });
            
            linkIcon.addEventListener('dragend', function(e) {
                this.classList.remove('dragging');
                
                // ÊúÄÁµÇ‰ΩçÁΩÆ„Çí‰øùÂ≠ò
                const rect = this.getBoundingClientRect();
                const gridRect = document.getElementById('linkIconGrid').getBoundingClientRect();
                link.position.x = rect.left - gridRect.left;
                link.position.y = rect.top - gridRect.top;
                saveExternalLinks();
            });
            
            // „Çπ„Éû„ÉõÁâàÔºö„Çø„ÉÉ„ÉÅ„Éâ„É©„ÉÉ„Ç∞
            let touchStartX = 0;
            let touchStartY = 0;
            let isDragging = false;
            let linkStartX = 0;
            let linkStartY = 0;
            let touchTimeout = null;
            
            linkIcon.addEventListener('touchstart', function(e) {
                if (e.touches.length === 1) {
                    const touch = e.touches[0];
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;
                    isDragging = false;
                    
                    // „É™„É≥„ÇØ„Ç¢„Ç§„Ç≥„É≥„ÅÆÁèæÂú®‰ΩçÁΩÆ„ÇíÂèñÂæó
                    const rect = this.getBoundingClientRect();
                    const gridRect = document.getElementById('linkIconGrid').getBoundingClientRect();
                    linkStartX = rect.left - gridRect.left;
                    linkStartY = rect.top - gridRect.top;
                    
                    // Èï∑Êäº„Åó„Åß„Éâ„É©„ÉÉ„Ç∞ÈñãÂßãÔºà300msÔºâ
                    touchTimeout = setTimeout(() => {
                        isDragging = true;
                        this.classList.add('dragging');
                        this.style.transition = 'none';
                        this.style.zIndex = '100';
                    }, 300);
                }
            }, { passive: true });
            
            linkIcon.addEventListener('touchmove', function(e) {
                if (e.touches.length === 1) {
                    const touch = e.touches[0];
                    const deltaX = Math.abs(touch.clientX - touchStartX);
                    const deltaY = Math.abs(touch.clientY - touchStartY);
                    
                    if ((deltaX > 5 || deltaY > 5) && !isDragging) {
                        clearTimeout(touchTimeout);
                        isDragging = true;
                        this.classList.add('dragging');
                        this.style.transition = 'none';
                        this.style.zIndex = '100';
                    }
                    
                    // „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅÆ‰ΩçÁΩÆÊõ¥Êñ∞
                    if (isDragging) {
                        e.preventDefault();
                        const gridRect = document.getElementById('linkIconGrid').getBoundingClientRect();
                        const newX = linkStartX + (touch.clientX - touchStartX);
                        const newY = linkStartY + (touch.clientY - touchStartY);
                        
                        // „Ç∞„É™„ÉÉ„ÉâÂÜÖ„Å´Âà∂Èôê
                        const maxX = gridRect.width - 50;
                        const maxY = gridRect.height - 50;
                        const clampedX = Math.max(0, Math.min(newX, maxX));
                        const clampedY = Math.max(0, Math.min(newY, maxY));
                        
                        this.style.position = 'absolute';
                        this.style.left = clampedX + 'px';
                        this.style.top = clampedY + 'px';
                        
                        // „Éë„Éç„É´ÂÜÖ„Ç¥„ÉüÁÆ±„ÅØÂâäÈô§„Åï„Çå„Åü„Åü„ÇÅ„ÄÅ„Åì„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„ÅØ‰∏çË¶Å
                        // const panelTrashBin = document.getElementById('panelTrashBin1');
                        // ...
                    }
                }
            }, { passive: false });
            
            linkIcon.addEventListener('touchend', function(e) {
                clearTimeout(touchTimeout);
                
                if (isDragging) {
                    isDragging = false;
                    this.classList.remove('dragging');
                    this.style.transition = '';
                    this.style.zIndex = '';
                    
                    // „Éë„Éç„É´ÂÜÖ„Ç¥„ÉüÁÆ±„ÅØÂâäÈô§„Åï„Çå„Åü„Åü„ÇÅ„ÄÅ„É°„Ç§„É≥„ÅÆ„Ç¥„ÉüÁÆ±„Åß„ÉÅ„Çß„ÉÉ„ÇØ
                    const trashBin = document.getElementById('trashBin');
                    if (trashBin) {
                        const trashRect = trashBin.getBoundingClientRect();
                        const linkRect = this.getBoundingClientRect();
                        
                        // „É™„É≥„ÇØ„ÅÆÈ†òÂüü„Åå„Ç¥„ÉüÁÆ±„ÅÆÈ†òÂüü„Å®Èáç„Å™„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                        if (linkRect.left < trashRect.right && linkRect.right > trashRect.left &&
                            linkRect.top < trashRect.bottom && linkRect.bottom > trashRect.top) {
                            // „É™„É≥„ÇØ„ÇíÂâäÈô§
                            if (confirm('„Åì„ÅÆ„É™„É≥„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                                deleteExternalLink(link.id);
                            } else {
                                // ‰ΩçÁΩÆ„Çí„É™„Çª„ÉÉ„Éà
                                this.style.position = '';
                                this.style.left = '';
                                this.style.top = '';
                            }
                        } else {
                            // ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞Ôºà„Ç∞„É™„ÉÉ„Éâ„Åã„ÇâÁã¨Á´ã„Åó„Åü‰ΩçÁΩÆ„Å´ÁßªÂãïÔºâ
                            const rect = this.getBoundingClientRect();
                            const gridRect = document.getElementById('linkIconGrid').getBoundingClientRect();
                            link.position.x = rect.left - gridRect.left;
                            link.position.y = rect.top - gridRect.top;
                            saveExternalLinks();
                            
                            // Áµ∂ÂØæ‰ΩçÁΩÆ„Åß‰øùÊåÅ
                            this.style.position = 'absolute';
                            this.style.left = link.position.x + 'px';
                            this.style.top = link.position.y + 'px';
                        }
                    } else {
                        // ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞Ôºà„Ç∞„É™„ÉÉ„Éâ„Åã„ÇâÁã¨Á´ã„Åó„Åü‰ΩçÁΩÆ„Å´ÁßªÂãïÔºâ
                        const rect = this.getBoundingClientRect();
                        const gridRect = document.getElementById('linkIconGrid').getBoundingClientRect();
                        link.position.x = rect.left - gridRect.left;
                        link.position.y = rect.top - gridRect.top;
                        saveExternalLinks();
                        
                        // Áµ∂ÂØæ‰ΩçÁΩÆ„Åß‰øùÊåÅ
                        this.style.position = 'absolute';
                        this.style.left = link.position.x + 'px';
                        this.style.top = link.position.y + 'px';
                    }
                } else {
                    // „Çø„ÉÉ„ÉóÔºö„É™„É≥„ÇØ„ÇíÈñã„ÅèÔºàCtrl/Cmd„Ç≠„Éº„ÅßÈÅ∏ÊäûÔºâ
                    // ÈÅ∏ÊäûÂá¶ÁêÜ„ÅØÂà•„ÅÆ„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº„ÅßÂá¶ÁêÜ
                }
            }, { passive: true });
            
            // „É™„É≥„ÇØ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Èñã„ÅèÔºàÈÅ∏Êäû„É¢„Éº„Éâ„Åß„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºâ
            linkIcon.addEventListener('click', function(e) {
                if (!isDragging && !e.ctrlKey && !e.metaKey) {
                    window.open(link.url, '_blank');
                }
            });
        }
        
        // „Éë„Éç„É´ÂÜÖ„Ç¥„ÉüÁÆ±„ÅØÂâäÈô§„Åï„Çå„Åü„Åü„ÇÅ„ÄÅ„Åì„ÅÆÈñ¢Êï∞„ÅØ‰∏çË¶Å
        // function setupPanelTrashBin() { ... }
        
        // „É™„É≥„ÇØËøΩÂä†„Éï„Ç©„Éº„É†„ÅÆÂá¶ÁêÜ
        document.getElementById('linkAddForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const url = document.getElementById('linkUrl').value.trim();
            const title = document.getElementById('linkTitle').value.trim();
            
            if (!url) {
                alert('URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            addExternalLink(url, title);
            
            // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkTitle').value = '';
        });
        
        // „Éë„Éç„É´1„ÅåÈñã„Åã„Çå„ÅüÊôÇ„Å´„É™„É≥„ÇØ„Ç∞„É™„ÉÉ„Éâ„ÇíÊõ¥Êñ∞
        function updateLinkPanelOnOpen() {
            if (document.getElementById('slidePanelOverlay1').classList.contains('active')) {
                updateLinkIconGrid();
            }
        }
        
        // „Éë„Éç„É´ÈñãÈñâÊôÇ„Å´„É™„É≥„ÇØ„Ç∞„É™„ÉÉ„Éâ„ÇíÊõ¥Êñ∞Ôºà„É©„ÉÉ„Éë„ÉºÈñ¢Êï∞Ôºâ
        function openSlidePanel(panelNumber) {
            openSlidePanelOriginal(panelNumber);
            if (panelNumber === 1) {
                setTimeout(() => {
                    updateLinkIconGrid();
                }, 100);
            } else if (panelNumber === 2) {
                // „É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ„Éë„Éç„É´„ÇíÈñã„ÅÑ„ÅüÊôÇ„Å´Êõ¥Êñ∞
                setTimeout(() => {
                    updateResourcePanel();
                }, 100);
            } else if (panelNumber === 5) {
                // „Ç¢„Éº„Ç´„Ç§„Éñ„Éë„Éç„É´„ÇíÈñã„ÅÑ„ÅüÊôÇ„Å´Êõ¥Êñ∞
                setTimeout(() => {
                    updateArchivePanel();
                    updateAssigneeFilterOptions();
                }, 100);
            }
        }

        /* ========================================
           üìä „É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ„Éë„Éç„É´Ê©üËÉΩ (Resource Management Panel)
           ======================================== */

        // „É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ„Éë„Éç„É´„ÅÆ„Éá„Éº„ÇøÊõ¥Êñ∞
        function updateResourcePanel() {
            updateResourceMembers();
            updateScheduleView();
            updateTimelineView();
        }

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchResourceTab(tabName) {
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆactive„ÇØ„É©„Çπ„ÇíÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.resource-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.resource-tab[data-tab="${tabName}"]`)?.classList.add('active');

            // „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆactive„ÇØ„É©„Çπ„ÇíÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.resource-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`resource${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`)?.classList.add('active');

            // ÂêÑ„Çø„Éñ„ÅÆ„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
            if (tabName === 'members') {
                updateResourceMembers();
            } else if (tabName === 'schedule') {
                updateScheduleView();
            } else if (tabName === 'timeline') {
                updateTimelineView();
            }
        }

        // „É°„É≥„Éê„Éº‰∏ÄË¶ß„ÇíÊõ¥Êñ∞
        function updateResourceMembers() {
            const content = document.getElementById('resourceMembersContent');
            if (!content) return;

            if (badges.length === 0) {
                content.innerHTML = '<p style="color: var(--color-text-secondary); text-align: center; padding: var(--spacing-xl);">„É°„É≥„Éê„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }

            // ÂêÑ„É°„É≥„Éê„Éº„ÅÆÊÉÖÂ†±„ÇíË®àÁÆó
            const membersData = badges.map(badge => {
                // ÁèæÂú®„ÅÆ„Çø„Çπ„ÇØÊï∞
                const currentTasks = Object.keys(taskBadges).filter(taskId => 
                    taskBadges[taskId] && taskBadges[taskId].includes(badge.id)
                ).length;

                // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„ÉâÊï∞ÔºàÁ®ºÂÉçÁéáÔºâ
                const activeTimeRecords = timeRecords.filter(tr => 
                    tr.badgeId === badge.id && tr.status === 'active'
                ).length;

                // Á∑è‰ΩúÊ•≠ÊôÇÈñìÔºàÁßíÔºâ„ÇíË®àÁÆó
                const totalDuration = timeRecords
                    .filter(tr => tr.badgeId === badge.id && tr.duration !== null)
                    .reduce((sum, tr) => sum + tr.duration, 0);

                // Ë≤†Ëç∑Áä∂ÊÖã„ÇíÂà§ÂÆöÔºà„Çø„Çπ„ÇØÊï∞„Å®„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Ç§„É†„É¨„Ç≥„Éº„ÉâÊï∞„Åã„ÇâÔºâ
                let loadLevel = 'low';
                if (currentTasks >= 5 || activeTimeRecords >= 3) {
                    loadLevel = 'high';
                } else if (currentTasks >= 3 || activeTimeRecords >= 2) {
                    loadLevel = 'medium';
                }

                return {
                    badge,
                    currentTasks,
                    activeTimeRecords,
                    totalDuration,
                    loadLevel
                };
            });

            // HTML„ÇíÁîüÊàê
            const html = membersData.map(member => {
                const badgeIcon = member.badge.icon && member.badge.icon.startsWith('img:') 
                    ? `<img src="${member.badge.icon.substring(4)}" alt="${member.badge.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`
                    : member.badge.picture 
                        ? `<img src="${member.badge.picture}" alt="${member.badge.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`
                        : member.badge.icon || 'üë§';

                function formatDuration(seconds) {
                    if (!seconds || seconds === 0) return '0ÂàÜ';
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    if (hours > 0) {
                        return `${hours}ÊôÇÈñì${minutes}ÂàÜ`;
                    }
                    return `${minutes}ÂàÜ`;
                }

                const loadPercent = Math.min((member.currentTasks / 5) * 100, 100);

                return `
                    <div class="member-card">
                        <div class="member-header">
                            <div class="member-icon" style="background: ${member.badge.color || '#FF679C'};">
                                ${badgeIcon}
                            </div>
                            <div class="member-info">
                                <div class="member-name">${escapeHtml(member.badge.name)}</div>
                                <div class="load-indicator">
                                    <div class="load-bar ${member.loadLevel}" style="width: ${loadPercent}%;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="member-stats">
                            <div class="stat-item">
                                <div class="stat-label">ÁèæÂú®„ÅÆ„Çø„Çπ„ÇØ</div>
                                <div class="stat-value">${member.currentTasks}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Á®ºÂÉç‰∏≠</div>
                                <div class="stat-value">${member.activeTimeRecords}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Á∑è‰ΩúÊ•≠ÊôÇÈñì</div>
                                <div class="stat-value">${formatDuration(member.totalDuration)}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Ë≤†Ëç∑Áä∂ÊÖã</div>
                                <div class="stat-value" style="color: ${member.loadLevel === 'high' ? '#ef4444' : member.loadLevel === 'medium' ? '#f59e0b' : '#10b981'};">
                                    ${member.loadLevel === 'high' ? 'È´ò' : member.loadLevel === 'medium' ? '‰∏≠' : '‰Ωé'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            content.innerHTML = html;
        }

        // ÈÄ±Ê¨°„ÉªÊúàÊ¨°Ë®àÁîª„ÅÆË°®Á§∫ÊúüÈñìÁÆ°ÁêÜ
        let currentScheduleDate = new Date();
        let scheduleViewType = 'week'; // 'week' or 'month'

        // ÈÄ±Ê¨°„ÉªÊúàÊ¨°Ë®àÁîª„ÇíÊõ¥Êñ∞
        function updateScheduleView() {
            const viewTypeSelect = document.getElementById('scheduleViewType');
            if (viewTypeSelect) {
                scheduleViewType = viewTypeSelect.value;
            }
            const content = document.getElementById('scheduleContent');
            if (!content) return;

            if (scheduleViewType === 'week') {
                renderWeekSchedule();
            } else {
                renderMonthSchedule();
            }
        }

        // ÈÄ±Ê¨°„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíË°®Á§∫
        function renderWeekSchedule() {
            const content = document.getElementById('scheduleContent');
            if (!content) return;

            // ÈÄ±„ÅÆÈñãÂßãÊó•ÔºàÊúàÊõúÊó•Ôºâ„ÇíÂèñÂæó
            const startOfWeek = new Date(currentScheduleDate);
            const day = startOfWeek.getDay();
            const diff = startOfWeek.getDate() - day + (day === 0 ? -6 : 1); // ÊúàÊõúÊó•„ÇíÈÄ±„ÅÆÂßã„Åæ„Çä„Å®„Åô„Çã
            startOfWeek.setDate(diff);
            startOfWeek.setHours(0, 0, 0, 0);

            // ÈÄ±„ÅÆÂêÑÊó•„ÇíÁîüÊàê
            const weekDays = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(date.getDate() + i);
                weekDays.push(date);
            }

            // Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„Éà
            const formatDate = (date) => {
                return date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });
            };

            const formatDayName = (date) => {
                const dayNames = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
                return dayNames[date.getDay()];
            };

            // „Éò„ÉÉ„ÉÄ„Éº
            let html = `
                <div style="margin-bottom: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-text-primary);">
                    ${startOfWeek.getFullYear()}Âπ¥${startOfWeek.getMonth() + 1}Êúà ${startOfWeek.getDate()}Êó• „Äú ${weekDays[6].getMonth() + 1}Êúà${weekDays[6].getDate()}Êó•
                </div>
                <div class="schedule-calendar">
                    <div class="schedule-week">
                        <div class="schedule-day-header" style="background: var(--color-background-secondary);"></div>
                        ${weekDays.map((date, i) => `
                            <div class="schedule-day-header">
                                ${formatDate(date)}<br>${formatDayName(date)}
                            </div>
                        `).join('')}
                    </div>
            `;

            // ÂêÑ„É°„É≥„Éê„Éº„ÅÆË°å„ÇíÁîüÊàê
            badges.forEach(badge => {
                html += `<div class="schedule-member-row">
                    <div class="schedule-member-name">${escapeHtml(badge.name)}</div>
                `;
                
                weekDays.forEach(date => {
                    // „Åù„ÅÆÊó•„ÅÆ„Çø„Çπ„ÇØ„ÇíÂèñÂæó
                    const dayTasks = tasks.filter(task => {
                        if (task.status === 'completed') return false;
                        const taskDate = task.createdAt ? new Date(task.createdAt) : null;
                        if (!taskDate) return false;
                        const taskBadgeIds = taskBadges[task.id] || [];
                        const hasBadge = taskBadgeIds.includes(badge.id);
                        return hasBadge && 
                               taskDate.getDate() === date.getDate() &&
                               taskDate.getMonth() === date.getMonth() &&
                               taskDate.getFullYear() === date.getFullYear();
                    });

                    const taskCount = dayTasks.length;
                    html += `<div class="schedule-cell ${taskCount > 0 ? 'has-task' : ''}" title="${taskCount > 0 ? taskCount + '‰ª∂„ÅÆ„Çø„Çπ„ÇØ' : '„Å™„Åó'}">
                        ${taskCount > 0 ? taskCount + '‰ª∂' : ''}
                    </div>`;
                });

                html += `</div>`;
            });

            html += `</div>`;
            content.innerHTML = html;
        }

        // ÊúàÊ¨°„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíË°®Á§∫
        function renderMonthSchedule() {
            const content = document.getElementById('scheduleContent');
            if (!content) return;

            const year = currentScheduleDate.getFullYear();
            const month = currentScheduleDate.getMonth();

            // Êúà„ÅÆÊúÄÂàù„ÅÆÊó•„Å®ÊúÄÂæå„ÅÆÊó•
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();

            // ÈÄ±„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            let html = `
                <div style="margin-bottom: var(--spacing-md); font-weight: var(--font-weight-semibold); color: var(--color-text-primary);">
                    ${year}Âπ¥${month + 1}Êúà
                </div>
                <div class="schedule-calendar">
            `;

            // ÂêÑÈÄ±„ÇíË°®Á§∫ÔºàÁ∞°Áï•ÁâàÔºöÈÄ±„Åî„Å®„ÅÆ„Çø„Çπ„ÇØÊï∞„ÇíË°®Á§∫Ôºâ
            badges.forEach(badge => {
                const badgeTasks = tasks.filter(task => {
                    if (task.status === 'completed') return false;
                    const taskBadgeIds = taskBadges[task.id] || [];
                    return taskBadgeIds.includes(badge.id);
                });

                const monthTasks = badgeTasks.filter(task => {
                    const taskDate = task.createdAt ? new Date(task.createdAt) : null;
                    if (!taskDate) return false;
                    return taskDate.getFullYear() === year && taskDate.getMonth() === month;
                });

                html += `
                    <div style="padding: var(--spacing-sm); background: var(--color-background-secondary); border-radius: var(--border-radius-sm); margin-bottom: var(--spacing-xs);">
                        <div style="font-weight: var(--font-weight-semibold); margin-bottom: var(--spacing-xs);">${escapeHtml(badge.name)}</div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">${monthTasks.length}‰ª∂„ÅÆ„Çø„Çπ„ÇØ</div>
                    </div>
                `;
            });

            html += `</div>`;
            content.innerHTML = html;
        }

        // ÊúüÈñìÁßªÂãïÈñ¢Êï∞
        function prevSchedulePeriod() {
            if (scheduleViewType === 'week') {
                currentScheduleDate.setDate(currentScheduleDate.getDate() - 7);
            } else {
                currentScheduleDate.setMonth(currentScheduleDate.getMonth() - 1);
            }
            updateScheduleView();
        }

        function nextSchedulePeriod() {
            if (scheduleViewType === 'week') {
                currentScheduleDate.setDate(currentScheduleDate.getDate() + 7);
            } else {
                currentScheduleDate.setMonth(currentScheduleDate.getMonth() + 1);
            }
            updateScheduleView();
        }

        function todaySchedulePeriod() {
            currentScheduleDate = new Date();
            updateScheduleView();
        }

        // „Çø„Ç§„É†„É©„Ç§„É≥Ë°®Á§∫„ÇíÊõ¥Êñ∞
        function updateTimelineView() {
            const filterSelect = document.getElementById('timelineFilter');
            const selectedBadgeId = filterSelect ? parseInt(filterSelect.value) : null;
            const content = document.getElementById('timelineContent');
            if (!content) return;

            // „Éï„Ç£„É´„Çø„ÉºÁî®„ÅÆ„É°„É≥„Éê„Éº„Ç™„Éó„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
            if (filterSelect) {
                const existingOptions = filterSelect.querySelectorAll('option:not([value="all"])');
                existingOptions.forEach(opt => opt.remove());
                
                badges.forEach(badge => {
                    const option = document.createElement('option');
                    option.value = badge.id;
                    option.textContent = badge.name;
                    if (selectedBadgeId === badge.id) {
                        option.selected = true;
                    }
                    filterSelect.appendChild(option);
                });
            }

            // Ë°®Á§∫„Åô„Çã„É°„É≥„Éê„Éº„Çí„Éï„Ç£„É´„Çø„Éº
            const displayBadges = selectedBadgeId === null || isNaN(selectedBadgeId) 
                ? badges 
                : badges.filter(b => b.id === selectedBadgeId);

            if (displayBadges.length === 0) {
                content.innerHTML = '<p style="color: var(--color-text-secondary); text-align: center; padding: var(--spacing-xl);">„É°„É≥„Éê„Éº„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }

            let html = '<div class="timeline-container">';

            displayBadges.forEach(badge => {
                // „Åì„ÅÆ„É°„É≥„Éê„Éº„Å´Èñ¢ÈÄ£„Åô„Çã„Çø„Çπ„ÇØ„ÇíÂèñÂæó
                const memberTasks = tasks.filter(task => {
                    if (task.status === 'completed') return false;
                    const taskBadgeIds = taskBadges[task.id] || [];
                    return taskBadgeIds.includes(badge.id);
                });

                // „Çø„Ç§„É†„É¨„Ç≥„Éº„Éâ„Åã„Çâ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Çπ„ÇØ„ÇíÂèñÂæó
                const activeRecords = timeRecords.filter(tr => 
                    tr.badgeId === badge.id && tr.status === 'active'
                );

                html += `
                    <div class="timeline-member">
                        <div class="timeline-member-header">${escapeHtml(badge.name)}</div>
                `;

                // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Çπ„ÇØ„ÇíË°®Á§∫
                activeRecords.forEach(record => {
                    const task = tasks.find(t => t.id === record.taskId);
                    if (task) {
                        const startTime = new Date(record.startTime);
                        html += `
                            <div class="timeline-task">
                                <div class="timeline-task-title">${escapeHtml(task.title)}</div>
                                <div class="timeline-task-time">
                                    ÈñãÂßã: ${startTime.toLocaleString('ja-JP')} (Á®ºÂÉç‰∏≠)
                                </div>
                            </div>
                        `;
                    }
                });

                // „Åù„ÅÆ‰ªñ„ÅÆ„Çø„Çπ„ÇØ„ÇíË°®Á§∫
                memberTasks.forEach(task => {
                    if (!activeRecords.find(r => r.taskId === task.id)) {
                        const createdDate = task.createdAt ? new Date(task.createdAt) : null;
                        html += `
                            <div class="timeline-task">
                                <div class="timeline-task-title">${escapeHtml(task.title)}</div>
                                <div class="timeline-task-time">
                                    ${createdDate ? '‰ΩúÊàê: ' + createdDate.toLocaleString('ja-JP') : 'Êó•‰ªò‰∏çÊòé'}
                                </div>
                            </div>
                        `;
                    }
                });

                html += `</div>`;
            });

            html += '</div>';
            content.innerHTML = html;
        }

        // HTML„Ç®„Çπ„Ç±„Éº„ÉóÈñ¢Êï∞
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /* ========================================
           üéõÔ∏è „É°„Éã„É•„Éº„Éú„Çø„É≥Ê©üËÉΩ (Menu Button)
           ======================================== */

        // „É°„Éã„É•„Éº„Éú„Çø„É≥„ÅÆ‰ΩçÁΩÆÁÆ°ÁêÜ
        let menuButtonPosition = { top: 24, left: 24 };
        
        // „É°„Éã„É•„Éº„ÅÆÈñãÈñâÁä∂ÊÖã
        let isMenuOpen = false;

        // „É°„Éã„É•„ÉºÈ†ÖÁõÆ„ÅÆÂÆöÁæ©ÔºàÈ†ÜÂ∫èÔºö„Éû„Ç§„Éö„Éº„Ç∏„ÄÅ„É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ„ÄÅ„Ç¢„Éº„Ç´„Ç§„Éñ„ÄÅË®≠ÂÆöÔºâ
        const menuItemsList = [
            { id: 'mypage', label: '„Éû„Ç§„Éö„Éº„Ç∏', action: () => console.log('„Éû„Ç§„Éö„Éº„Ç∏') },
            { id: 'resource', label: '„É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ', action: () => toggleSlidePanel(2) },
            { id: 'archive', label: '„Ç¢„Éº„Ç´„Ç§„Éñ', action: () => toggleSlidePanel(5) },
            { id: 'settings', label: 'Ë®≠ÂÆö', action: () => console.log('Ë®≠ÂÆö') }
        ];

        // „É°„Éã„É•„Éº„Éú„Çø„É≥„ÅÆÂàùÊúüÂåñ
        function initializeMenuButton() {
            const container = document.getElementById('menuButtonContainer');
            const menuButton = document.getElementById('menuButton');
            if (!container || !menuButton) return;

            // ‰øùÂ≠ò„Åï„Çå„Åü‰ΩçÁΩÆ„ÇíË™≠„ÅøËæº„Åø
            const savedPosition = localStorage.getItem('menuButtonPosition');
            if (savedPosition) {
                try {
                    menuButtonPosition = JSON.parse(savedPosition);
                    container.style.top = menuButtonPosition.top + 'px';
                    container.style.left = menuButtonPosition.left + 'px';
                } catch (e) {
                    console.warn('„É°„Éã„É•„Éº„Éú„Çø„É≥„ÅÆ‰ΩçÁΩÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', e);
                }
            }

            // PCÁâàÔºö„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó
            let isDragging = false;
            let dragStartX = 0;
            let dragStartY = 0;
            let dragStartLeft = 0;
            let dragStartTop = 0;
            let lastClickTime = 0;
            let lastClickTarget = null;

            menuButton.addEventListener('mousedown', function(e) {
                if (e.button !== 0) return; // Â∑¶„ÇØ„É™„ÉÉ„ÇØ„ÅÆ„Åø
                
                // „ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØÂà§ÂÆö
                const currentTime = Date.now();
                if (currentTime - lastClickTime < 300 && lastClickTarget === menuButton) {
                    e.preventDefault();
                    toggleMenu();
                    return;
                }
                lastClickTime = currentTime;
                lastClickTarget = menuButton;

                isDragging = true;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                dragStartLeft = parseInt(container.style.left) || menuButtonPosition.left;
                dragStartTop = parseInt(container.style.top) || menuButtonPosition.top;
                
                menuButton.style.cursor = 'grabbing';
                e.preventDefault();
            });

            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                const deltaX = e.clientX - dragStartX;
                const deltaY = e.clientY - dragStartY;
                
                const newLeft = Math.max(0, Math.min(dragStartLeft + deltaX, window.innerWidth - container.offsetWidth));
                const newTop = Math.max(0, Math.min(dragStartTop + deltaY, window.innerHeight - container.offsetHeight));
                
                container.style.left = newLeft + 'px';
                container.style.top = newTop + 'px';
            });

            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                    menuButton.style.cursor = 'move';
                    
                    // ‰ΩçÁΩÆ„Çí‰øùÂ≠ò
                    menuButtonPosition.left = parseInt(container.style.left);
                    menuButtonPosition.top = parseInt(container.style.top);
                    localStorage.setItem('menuButtonPosition', JSON.stringify(menuButtonPosition));
                }
            });

            // SPÁâàÔºö„Çø„ÉÉ„ÉÅ„Éâ„É©„ÉÉ„Ç∞
            let touchStartX = 0;
            let touchStartY = 0;
            let touchStartLeft = 0;
            let touchStartTop = 0;
            let isTouchDragging = false;
            let touchStartTime = 0;

            menuButton.addEventListener('touchstart', function(e) {
                const touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
                touchStartLeft = parseInt(container.style.left) || menuButtonPosition.left;
                touchStartTop = parseInt(container.style.top) || menuButtonPosition.top;
                touchStartTime = Date.now();
                isTouchDragging = false;
            }, { passive: true });

            menuButton.addEventListener('touchmove', function(e) {
                const touch = e.touches[0];
                const deltaX = Math.abs(touch.clientX - touchStartX);
                const deltaY = Math.abs(touch.clientY - touchStartY);
                
                if (deltaX > 5 || deltaY > 5) {
                    isTouchDragging = true;
                    e.preventDefault();
                    
                    const newLeft = Math.max(0, Math.min(touchStartLeft + (touch.clientX - touchStartX), window.innerWidth - container.offsetWidth));
                    const newTop = Math.max(0, Math.min(touchStartTop + (touch.clientY - touchStartY), window.innerHeight - container.offsetHeight));
                    
                    container.style.left = newLeft + 'px';
                    container.style.top = newTop + 'px';
                }
            }, { passive: false });

            menuButton.addEventListener('touchend', function(e) {
                const touchDuration = Date.now() - touchStartTime;
                
                // „ÉÄ„Éñ„É´„Çø„ÉÉ„ÉóÂà§ÂÆöÔºà„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºâ
                if (!isTouchDragging && touchDuration < 300) {
                    const currentTime = Date.now();
                    if (currentTime - lastClickTime < 300 && lastClickTarget === menuButton) {
                        e.preventDefault();
                        toggleMenu();
                        return;
                    }
                    lastClickTime = currentTime;
                    lastClickTarget = menuButton;
                }
                
                if (isTouchDragging) {
                    // ‰ΩçÁΩÆ„Çí‰øùÂ≠ò
                    menuButtonPosition.left = parseInt(container.style.left);
                    menuButtonPosition.top = parseInt(container.style.top);
                    localStorage.setItem('menuButtonPosition', JSON.stringify(menuButtonPosition));
                }
                
                isTouchDragging = false;
            }, { passive: true });
        }

        // „É°„Éã„É•„Éº„ÅÆÈñãÈñâ
        function toggleMenu() {
            const overlay = document.getElementById('menuOverlay');
            const menuCircle = document.getElementById('menuCircle');
            const menuButtonContainer = document.getElementById('menuButtonContainer');
            
            if (!overlay || !menuCircle || !menuButtonContainer) return;

            if (isMenuOpen) {
                closeMenu();
            } else {
                openMenu();
            }
        }

        // „É°„Éã„É•„Éº„ÇíÈñã„Åè
        function openMenu() {
            const overlay = document.getElementById('menuOverlay');
            const menuCircle = document.getElementById('menuCircle');
            const menuItems = document.getElementById('menuItems');
            const menuButtonContainer = document.getElementById('menuButtonContainer');
            
            if (!overlay || !menuCircle || !menuItems || !menuButtonContainer) return;

            // „É°„Éã„É•„Éº„Éú„Çø„É≥„ÅÆ‰ΩçÁΩÆ„ÇíÂèñÂæó
            const buttonRect = menuButtonContainer.getBoundingClientRect();
            const buttonCenterX = buttonRect.left + buttonRect.width / 2;
            const buttonCenterY = buttonRect.top + buttonRect.height / 2;

            // ÁîªÈù¢‰∏≠Â§ÆÊñπÂêë„ÇíË®àÁÆó
            const screenCenterX = window.innerWidth / 2;
            const screenCenterY = window.innerHeight / 2;
            
            // „Éú„Çø„É≥„ÅåÁîªÈù¢Â∑¶ÂçäÂàÜ„ÅãÂè≥ÂçäÂàÜ„Åã„ÇíÂà§ÂÆö
            const isLeftSide = buttonCenterX < screenCenterX;
            
            // „É°„Éã„É•„Éº„ÅÆÂçäÂæÑÔºàPC: 250px, SP: 150pxÔºâ
            const radius = window.innerWidth <= 430 ? 150 : 250;
            
            // „É°„Éã„É•„Éº„Çµ„Éº„ÇØ„É´„ÅÆ‰ΩçÁΩÆ„ÇíË®≠ÂÆöÔºà„É°„Éã„É•„Éº„Éú„Çø„É≥„ÅÆ‰ΩçÁΩÆ„Å´Ôºâ
            menuCircle.style.left = buttonCenterX + 'px';
            menuCircle.style.top = buttonCenterY + 'px';
            menuCircle.style.transform = 'translate(-50%, -50%)';

            // „É°„Éã„É•„ÉºÈ†ÖÁõÆ„ÇíÁîüÊàê
            menuItems.innerHTML = '';
            
            const totalItems = menuItemsList.length;
            menuItemsList.forEach((item, index) => {
                // ËßíÂ∫¶„ÇíË®àÁÆóÔºàÊôÇË®àÂõû„Çä/ÂèçÊôÇË®àÂõû„ÇäÔºâ
                // ÁîªÈù¢‰∏≠Â§ÆÊñπÂêë„ÇíÂü∫Ê∫ñ„Å´ÈÖçÁΩÆ
                // ÂêÑÈ†ÖÁõÆ„ÅÆËßíÂ∫¶Ôºà0„Åã„Çâ360Â∫¶„Å´ÂùáÁ≠â„Å´ÈÖçÁΩÆÔºâ
                const baseAngle = (index / totalItems) * Math.PI * 2;
                
                // ÁîªÈù¢‰∏≠Â§ÆÊñπÂêë„Å∏„ÅÆ„Ç™„Éï„Çª„ÉÉ„ÉàËßíÂ∫¶„ÇíË®àÁÆó
                const centerAngle = Math.atan2(screenCenterY - buttonCenterY, screenCenterX - buttonCenterX);
                
                let finalAngle;
                if (isLeftSide) {
                    // Â∑¶ÂÅ¥ÔºöÊôÇË®àÂõû„ÇäÔºàÁîªÈù¢‰∏≠Â§ÆÊñπÂêë„ÇíÂü∫Ê∫ñ„Å´ÊôÇË®àÂõû„ÇäÔºâ
                    finalAngle = centerAngle + baseAngle;
                } else {
                    // Âè≥ÂÅ¥ÔºöÂèçÊôÇË®àÂõû„ÇäÔºàÁîªÈù¢‰∏≠Â§ÆÊñπÂêë„ÇíÂü∫Ê∫ñ„Å´ÂèçÊôÇË®àÂõû„ÇäÔºâ
                    finalAngle = centerAngle - baseAngle;
                }
                
                // ‰ΩçÁΩÆ„ÇíË®àÁÆó
                const x = Math.cos(finalAngle) * radius;
                const y = Math.sin(finalAngle) * radius;
                
                // „É©„Éô„É´„ÅÆÂõûËª¢ËßíÂ∫¶ÔºàÂ∫¶„Å´Â§âÊèõ„ÄÅ90Â∫¶„ÇíÂºï„ÅÑ„Å¶„ÉÜ„Ç≠„Çπ„Éà„ÇíÊ≠£„Åó„ÅÑÂêë„Åç„Å´Ôºâ
                const rotationAngle = (finalAngle * 180 / Math.PI) - 90;
                
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.textContent = item.label;
                menuItem.style.left = `calc(50% + ${x}px)`;
                menuItem.style.top = `calc(50% + ${y}px)`;
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„Å´ÂõûËª¢„ÇíÈÅ©Áî®
                menuItem.style.setProperty('--rotation', `${rotationAngle}deg`);
                menuItem.style.animationDelay = `${index * 0.05}s`;
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„Å´ÂõûËª¢„ÇíÈÅ©Áî®
                setTimeout(() => {
                    menuItem.style.transform = `translate(-50%, -50%) rotate(var(--rotation))`;
                }, (index * 0.05 + 0.3) * 1000);
                
                // hoverÊôÇ„ÅÆtransformÔºàÂõûËª¢„ÇíÁ∂≠ÊåÅÔºâ
                menuItem.addEventListener('mouseenter', function() {
                    this.style.transform = `translate(-50%, -50%) rotate(var(--rotation)) scale(1.1)`;
                });
                menuItem.addEventListener('mouseleave', function() {
                    this.style.transform = `translate(-50%, -50%) rotate(var(--rotation)) scale(1)`;
                });
                
                menuItem.onclick = function(e) {
                    e.stopPropagation();
                    item.action();
                    closeMenu();
                };
                
                menuItems.appendChild(menuItem);
            });

            overlay.classList.add('active');
            isMenuOpen = true;
        }

        // „É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
        function closeMenu() {
            const overlay = document.getElementById('menuOverlay');
            if (!overlay) return;
            
            overlay.classList.remove('active');
            isMenuOpen = false;
        }

        // „Ç™„Éº„Éê„Éº„É¨„Ç§„ÇØ„É™„ÉÉ„ÇØ„Åß„É°„Éã„É•„Éº„ÇíÈñâ„Åò„Çã
        function closeMenuOnOverlay(event) {
            const menuCircle = document.getElementById('menuCircle');
            if (menuCircle && event.target === event.currentTarget) {
                closeMenu();
            }
        }

        // ESC„Ç≠„Éº„Åß„É°„Éã„É•„Éº„ÇíÈñâ„Åò„ÇãÔºàÊó¢Â≠ò„ÅÆESC„Ç≠„Éº„Éè„É≥„Éâ„É©„Éº„Å´ËøΩÂä†Ôºâ
        // Ê≥®ÊÑèÔºöÊó¢Â≠ò„ÅÆESC„Ç≠„Éº„Éè„É≥„Éâ„É©„Éº„ÅåÂÆöÁæ©„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åù„Å°„Çâ„ÅßÂá¶ÁêÜ„Åï„Çå„Çã

        // ÂàùÊúüÂåñÔºà„Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„Å´„ÇÇÂÆüË°å„ÄÅ„Çπ„Éó„É©„ÉÉ„Ç∑„É•Âæå„Å´ÂÜçÂÆüË°å„Åï„Çå„ÇãÔºâ
        setTimeout(async function() {
            // Firebase„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÅøÔºàÊúÄÂÑ™ÂÖàÔºâ
            await loadTaskMarketData();
            
            // „Ç¥„ÉüÁÆ±„ÇíÂÖ®„Å¶ÂâäÈô§„Åó„Å¶„Åã„ÇâÂÜç‰ΩúÊàêÔºàÈáçË§á„ÇíÂÆåÂÖ®„Å´Èò≤„ÅêÔºâ
            const allTrashBins = document.querySelectorAll('.trash-bin[id="trashBin"]');
            allTrashBins.forEach(function(trashBin) {
                trashBin.remove();
            });
            
            // Âè≥‰∏ã„Å´1„Å§„Å†„Åë„Ç¥„ÉüÁÆ±„Çí‰ΩúÊàê
            const trashBin = document.createElement('div');
            trashBin.className = 'trash-bin';
            trashBin.id = 'trashBin';
            trashBin.innerHTML = '<span class="trash-icon">üóëÔ∏è</span><span class="tooltip-text">„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÅßÂâäÈô§</span>';
            document.body.appendChild(trashBin);
            
            // setupTrashBinDrop„ÅÆ„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„ÉàÔºàÊñ∞„Åó„ÅÑ„Ç¥„ÉüÁÆ±„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö„Åô„Çã„Åü„ÇÅÔºâ
            trashBinHandlerSet = false;
            
            setupBadgeDragHandler(); // „Éê„ÉÉ„Ç∏„Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É©„Éº„ÇíË®≠ÂÆö
            setupTrashBinDrop(); // „Ç¥„ÉüÁÆ±„ÅÆ„Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„ÇíÂàùÊúüÂåñ
            setupCompleteButtonDrop(); // ÂÆå‰∫Ü„Éú„Çø„É≥„ÅÆ„Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„ÇíÂàùÊúüÂåñ
            initializeMenuButton(); // „É°„Éã„É•„Éº„Éú„Çø„É≥„ÇíÂàùÊúüÂåñ
            // „Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÊôÇ„Å´Êó¢„Å´updateTaskGrid()„ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅÈáçË§á„ÇíÈÅø„Åë„Çã
            // „Åü„Å†„Åó„ÄÅ„Ç¥„ÉüÁÆ±‰ΩúÊàêÂæå„Å´UI„ÇíÊõ¥Êñ∞
            if (!document.getElementById('taskGrid').hasChildNodes() || document.getElementById('taskGrid').childElementCount === 0) {
            updateTaskGrid();
            }
            if (badges.length > 0) {
            updateBadges(); // „Éê„ÉÉ„Ç∏„ÇíË°®Á§∫
            }
            // „É™„É≥„ÇØ„Éë„Éç„É´„ÅÆÂàùÊúüÂåñ
            updateLinkIconGrid();
            // „Ç¢„Éº„Ç´„Ç§„Éñ„Éë„Éç„É´„ÅÆÂàùÊúüÂåñ
            setupArchiveFilters();
            updateArchivePanel();
            // „Éó„É´„É™„Éï„É¨„ÉÉ„Ç∑„É•Ê©üËÉΩ„ÇíÂàùÊúüÂåñÔºà„Çπ„Éû„ÉõÁâà„ÅÆ„ÅøÔºâ
            if (window.innerWidth <= 430) {
                setupPullRefresh();
                // „Éí„É≥„Éà„ÅÆÂàùÊúüË°®Á§∫„ÇíË®≠ÂÆö
                const taskGrid = document.getElementById('taskGrid');
                if (taskGrid) {
                    // ÂàùÊúüÂåñÊôÇ„ÅØÊúÄ‰∏äÈÉ®„Å®„Åø„Å™„Åô
                    taskGrid.classList.add('scroll-top');
                    updatePullRefreshHint();
                }
            }
        }, 100);

        // „Çπ„É©„Ç§„Éâ„Ç§„É≥„Éë„Éç„É´„ÅÆÈñãÈñâÊ©üËÉΩÔºà5„Å§„ÅÆ„Éë„Éç„É´ÂØæÂøúÔºâ
        function openSlidePanelOriginal(panelNumber) {
            const overlay = document.getElementById('slidePanelOverlay' + panelNumber);
            const panel = document.getElementById('slidePanel' + panelNumber);
            const handle = document.getElementById('slidePanelHandle' + panelNumber);
            overlay.classList.add('active');
            handle.classList.add('active');
            // Â∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶„Éë„Éç„É´„ÇíË°®Á§∫Ôºà„Ç™„Éº„Éê„Éº„É¨„Ç§„ÅÆË°®Á§∫Âæå„Å´Ôºâ
            setTimeout(function() {
                panel.classList.add('active');
            }, 10);
        }

        function closeSlidePanel(panelNumber) {
            const overlay = document.getElementById('slidePanelOverlay' + panelNumber);
            const panel = document.getElementById('slidePanel' + panelNumber);
            const handle = document.getElementById('slidePanelHandle' + panelNumber);
            panel.classList.remove('active');
            handle.classList.remove('active');
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„Å´„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÈùûË°®Á§∫
            setTimeout(function() {
                overlay.classList.remove('active');
            }, 300);
        }

        // „Éë„Éç„É´„ÅÆÈñãÈñâ„ÇíÂàá„ÇäÊõø„Åà„Çã
        function toggleSlidePanel(panelNumber) {
            const overlay = document.getElementById('slidePanelOverlay' + panelNumber);
            if (overlay.classList.contains('active')) {
                closeSlidePanel(panelNumber);
            } else {
                // ‰ªñ„ÅÆ„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
                for (let i = 1; i <= 5; i++) {
                    if (i !== panelNumber) {
                        closeSlidePanel(i);
                    }
                }
                openSlidePanel(panelNumber);
            }
        }

        // „Ç™„Éº„Éê„Éº„É¨„Ç§„ÇØ„É™„ÉÉ„ÇØ„Åß„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        function closeSlidePanelOnOverlay(event, panelNumber) {
            if (event.target.id === 'slidePanelOverlay' + panelNumber) {
                closeSlidePanel(panelNumber);
            }
        }

        // ESC„Ç≠„Éº„ÅßÈñã„ÅÑ„Å¶„ÅÑ„Çã„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                // „É°„Éã„É•„Éº„ÇíÈñâ„Åò„ÇãÔºàÊúÄÂÑ™ÂÖàÔºâ
                if (isMenuOpen) {
                    closeMenu();
                    return;
                }
                
                // Ë©≥Á¥∞„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
                const detailOverlay = document.getElementById('detailBoardOverlay');
                if (detailOverlay && detailOverlay.classList.contains('active')) {
                    closeDetailBoard();
                    return;
                }
                
                // Èñã„ÅÑ„Å¶„ÅÑ„Çã„Çπ„É©„Ç§„Éâ„Ç§„É≥„Éë„Éç„É´„Çí„Åô„Åπ„Å¶Èñâ„Åò„Çã
                for (let i = 1; i <= 5; i++) {
                    const overlay = document.getElementById('slidePanelOverlay' + i);
                    if (overlay && overlay.classList.contains('active')) {
                        closeSlidePanel(i);
                    }
                }
            }
        });
    </script>
</body>
</html>

