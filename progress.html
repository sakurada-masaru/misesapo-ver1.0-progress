<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>開発進捗状況 | ミセサポ</title>
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
      import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
      
      // Firebase設定
      const firebaseConfig = {
        apiKey: "AIzaSyDi2_U6INLm7sb-02GsdWzDl2qaFBe8US4",
        authDomain: "misesapo-progress.firebaseapp.com",
        databaseURL: "https://misesapo-progress-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "misesapo-progress",
        storageBucket: "misesapo-progress.firebasestorage.app",
        messagingSenderId: "926808186549",
        appId: "1:926808186549:web:91ce8534877c4ecf2e28fc",
        measurementId: "G-5JS29JLL13"
      };
      
      // Firebase初期化
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      
      // グローバル変数として設定
      window.firebaseDatabase = database;
      window.firebaseRef = ref;
      window.firebaseSet = set;
      window.firebaseGet = get;
      window.firebaseOnValue = onValue;
    </script>
    <style>
      :root { color-scheme: light dark; }
      
      * {
        box-sizing: border-box;
      }
      
      body { 
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; 
        margin: 0;
        padding: 16px; 
        background: #f8fafc;
        color: #1f2937;
        line-height: 1.5;
      }
      
      .container { 
        max-width: 1200px; 
        margin: 0 auto; 
        width: 100%;
      }
      
      h1 { 
        font-size: 1.5rem; 
        margin: 0 0 8px; 
        color: #FF679C;
        line-height: 1.3;
      }
      .new-label { 
        background: #10b981; 
        color: white; 
        padding: 4px 8px; 
        border-radius: 4px; 
        font-size: 0.8rem; 
        font-weight: 500; 
        margin-left: 8px; 
      }
      .new-label-container {
        text-align: center;
        margin: 24px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
      }
      .btn-add-new {
        background: #FF679C;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        font-size: 0.9rem;
        transition: background-color 0.2s;
      }
      .btn-add-new:hover {
        background: #e55a8a;
      }
      .subtitle { 
        color: #6b7280; 
        font-size: 0.95rem; 
        margin-bottom: 24px; 
      }
      
      .summary { 
        background: white; 
        padding: 16px; 
        border-radius: 8px; 
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 24px;
      }
      
      .stats { 
        display: grid; 
        grid-template-columns: 1fr; 
        gap: 12px; 
      }
      .stat-card { 
        background: #f9fafb; 
        padding: 16px; 
        border-radius: 6px; 
        text-align: center;
        border-left: 4px solid #FF679C;
      }
      .stat-number { font-size: 2rem; font-weight: bold; color: #FF679C; }
      .stat-label { color: #6b7280; font-size: 0.9rem; }
      
      /* プログレスバー */
      .progress-container {
        background: #f3f4f6;
        border-radius: 8px;
        padding: 16px;
        margin: 16px 0;
        border-left: 4px solid #FF679C;
      }
      
      .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      
      .progress-label {
        font-weight: 600;
        color: #374151;
        font-size: 0.9rem;
      }
      
      .progress-percentage {
        font-weight: bold;
        color: #FF679C;
        font-size: 1.1rem;
      }
      
      .progress-bar {
        width: 100%;
        height: 12px;
        background: #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
        position: relative;
      }
      
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #FF679C 0%, #e55a8a 100%);
        border-radius: 6px;
        transition: width 0.5s ease-in-out;
        position: relative;
      }
      
      .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
        animation: shimmer 2s infinite;
      }
      
      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      
      .progress-stats {
        display: flex;
        justify-content: space-between;
        margin-top: 8px;
        font-size: 0.8rem;
        color: #6b7280;
      }
      
      .table-container {
        overflow-x: auto;
        margin-bottom: 24px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      
      table { 
        border-collapse: collapse; 
        width: 100%; 
        min-width: 800px;
        background: white;
      }
      
      th, td { 
        border: 1px solid #e5e7eb; 
        padding: 8px 12px; 
        text-align: left; 
        font-size: 0.85rem;
      }
      th { 
        background: #f9fafb; 
        font-weight: 600;
        color: #374151;
      }
      tr:hover { background: #f9fafb; }
      
      .status-complete { 
        background: #dcfce7; 
        color: #166534; 
        padding: 4px 8px; 
        border-radius: 4px; 
        font-weight: 600;
        font-size: 0.85rem;
      }
      .status-in-progress { 
        background: #fef3c7; 
        color: #92400e; 
        padding: 4px 8px; 
        border-radius: 4px; 
        font-weight: 600;
        font-size: 0.85rem;
      }
      .status-pending { 
        background: #f3f4f6; 
        color: #6b7280; 
        padding: 4px 8px; 
        border-radius: 4px; 
        font-weight: 600;
        font-size: 0.85rem;
      }
      
      .category-header {
        background: #FF679C;
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
      }
      
      .url-link { 
        color: #FF679C; 
        text-decoration: none; 
        font-weight: 500;
      }
      .url-link:hover { 
        text-decoration: underline; 
      }
      
      .code { 
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; 
        background: #f3f4f6;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.85rem;
      }
      
      .last-updated {
        color: #6b7280;
        font-size: 0.9rem;
        margin-top: 24px;
        text-align: center;
      }
      
      .last-updated {
        color: #059669;
        font-size: 0.85rem;
        font-weight: 500;
      }
      
      .btn-edit, .btn-update, .btn-delete {
        background: #FF679C;
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        font-size: 0.75rem;
        cursor: pointer;
        margin: 2px;
        white-space: nowrap;
        transition: background-color 0.2s;
      }
      
      .btn-edit:hover, .btn-update:hover, .btn-delete:hover {
        background: #E35687;
      }
      
      .btn-update {
        background: #059669;
      }
      
      .btn-delete {
        background: #ef4444;
      }
      
      .btn-delete:hover {
        background: #dc2626;
      }
      
      
      .edit-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
      }
      
      .edit-modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        min-width: 400px;
      }
      
      .edit-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .edit-form input, .edit-form select, .edit-form textarea {
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 0.9rem;
      }
      
      .edit-form label {
        font-weight: 600;
        color: #374151;
      }
      
      .modal-buttons {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
        margin-top: 16px;
      }
      
      .btn-save, .btn-cancel {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
      }
      
      .btn-save {
        background: #FF679C;
        color: white;
      }
      
      .btn-cancel {
        background: #6b7280;
        color: white;
      }
      
      .btn-delete {
        background: #ef4444;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
        margin-left: 4px;
        transition: background-color 0.2s;
      }
      
      .btn-delete:hover {
        background: #dc2626;
      }
      
      .delete-warning {
        color: #ef4444;
        font-weight: 500;
        margin: 8px 0;
      }
      
      /* タブレット用 */
      @media (min-width: 768px) {
        body {
          padding: 24px;
        }
        
        h1 {
          font-size: 2rem;
        }
        
        .subtitle {
          font-size: 1.1rem;
          margin-bottom: 32px;
        }
        
        .summary {
          padding: 24px;
          margin-bottom: 32px;
        }
        
        .stats {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 16px;
        }
        
        th, td {
          padding: 12px 16px;
          font-size: 0.9rem;
        }
        
        .btn-edit, .btn-update, .btn-delete {
          padding: 4px 8px;
          font-size: 0.8rem;
        }
      }
      
      /* デスクトップ用 */
      @media (min-width: 1024px) {
        body {
          padding: 32px;
        }
        
        .container {
          max-width: 1400px;
        }
        
        h1 {
          font-size: 2.5rem;
        }
        
        .subtitle {
          font-size: 1.2rem;
        }
        
        .summary {
          padding: 32px;
        }
        
        .stats {
          gap: 20px;
        }
        
        th, td {
          padding: 16px 20px;
          font-size: 1rem;
        }
        
        .btn-edit, .btn-update, .btn-delete {
          padding: 6px 12px;
          font-size: 0.85rem;
        }
        
        .progress-container {
          padding: 20px;
        }
        
        .progress-header {
          margin-bottom: 12px;
        }
        
        .progress-bar {
          height: 16px;
        }
      }
      
      /* スマホ用プログレスバー */
      @media (max-width: 767px) {
        .progress-container {
          padding: 12px;
          margin: 12px 0;
        }
        
        .progress-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 4px;
        }
        
        .progress-label {
          font-size: 0.85rem;
        }
        
        .progress-percentage {
          font-size: 1rem;
        }
        
        .progress-bar {
          height: 10px;
        }
        
        .progress-stats {
          font-size: 0.75rem;
          margin-top: 6px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🚀 ミセサポ 開発進捗状況</h1>
      <p class="subtitle">定期清掃サービス Webアプリケーション - 実装状況ダッシュボード</p>
      
      <div class="summary">
        <h2>📊 プロジェクト概要</h2>
        <div class="stats">
          <div class="stat-card">
            <div class="stat-number">19</div>
            <div class="stat-label">実装済みページ</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">34</div>
            <div class="stat-label">サービス項目</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">6</div>
            <div class="stat-label">カテゴリ</div>
          </div>
        </div>
        
        <!-- プログレスバー -->
        <div class="progress-container">
          <div class="progress-header">
            <span class="progress-label">📊 プロジェクト完成率</span>
            <span class="progress-percentage" id="progressPercentage">100%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 100%"></div>
          </div>
          <div class="progress-stats">
            <span id="completedCount">19</span> / <span id="totalCount">19</span> ページ完了
          </div>
          <div style="margin-top: 8px; font-size: 0.8rem; color: #6b7280;">
            <strong>実装状況の判定基準:</strong><br>
            ✅ <strong>完全実装</strong>: HTML + CSS + JavaScript + 機能動作<br>
            🔄 <strong>部分実装</strong>: HTML + CSS、JavaScript未実装<br>
            📝 <strong>テンプレート</strong>: HTMLのみ、機能未実装<br>
            ❌ <strong>未実装</strong>: ファイル存在しない
          </div>
        </div>
      </div>
      
      <div class="new-label-container">
        <button class="btn-add-new" onclick="openAddNewModal()">+ 新規項目を追加</button>
      </div>

      <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>ページ名</th>
            <th>URL</th>
            <th>カテゴリ</th>
            <th>ステータス</th>
            <th>最終更新日</th>
            <th>機能</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <!-- テーブルの中身は動的に生成されます -->
        </tbody>
      </table>
      </div>
      
      <div class="last-updated">
        <p>最終更新: 2025年10月23日 | ローカルサーバー: http://localhost:5173</p>
      </div>
    </div>

      <!-- 新規項目追加モーダル -->
      <div id="addNewModal" class="edit-modal">
        <div class="edit-modal-content">
          <h3>新規項目を追加</h3>
          <form class="edit-form" id="addNewForm">
            <div>
              <label for="newPageName">ページ名:</label>
              <input type="text" id="newPageName" name="pageName" required>
            </div>
            <div>
              <label for="newUrl">URL:</label>
              <input type="text" id="newUrl" name="url" placeholder="/path/to/page.html (未実装の場合は空白可)">
            </div>
            <div>
              <label for="newCategory">カテゴリ:</label>
              <select id="newCategory" name="category" required>
                <option value="">カテゴリを選択</option>
                <option value="メイン">メイン</option>
                <option value="認証">認証</option>
                <option value="登録">登録</option>
                <option value="サポート">サポート</option>
                <option value="マイページ">マイページ</option>
                 <option value="カート">カート</option>
                 <option value="レジ">レジ</option>
                 <option value="レポート">レポート</option>
                <option value="管理">管理</option>
              </select>
            </div>
            <div>
              <label for="newStatus">ステータス:</label>
              <select id="newStatus" name="status" required>
                <option value="complete">✅ 完全実装</option>
                <option value="in-progress">🔄 実装中</option>
                <option value="pending">⏳ 未実装</option>
              </select>
            </div>
            <div>
              <label for="newFunction">機能説明:</label>
              <textarea id="newFunction" name="function" rows="3" required></textarea>
            </div>
            <div class="modal-buttons">
              <button type="button" class="btn-cancel" onclick="closeAddNewModal()">キャンセル</button>
              <button type="submit" class="btn-save">追加</button>
            </div>
          </form>
        </div>
      </div>

      <!-- 削除確認モーダル -->
      <div id="deleteModal" class="edit-modal">
        <div class="edit-modal-content">
          <h3>項目を削除</h3>
          <p>この項目を削除してもよろしいですか？</p>
          <p class="delete-warning">この操作は取り消せません。</p>
          <div class="modal-buttons">
            <button type="button" class="btn-cancel" onclick="closeDeleteModal()">キャンセル</button>
            <button type="button" class="btn-delete" onclick="confirmDelete()">削除</button>
          </div>
        </div>
      </div>

      <!-- 編集モーダル -->
      <div id="editModal" class="edit-modal">
      <div class="edit-modal-content">
        <h3>ページ情報を編集</h3>
        <form class="edit-form" id="editForm">
          <div>
            <label for="editPageName">ページ名:</label>
            <input type="text" id="editPageName" name="pageName" required>
          </div>
            <div>
              <label for="editUrl">URL:</label>
              <input type="text" id="editUrl" name="url" placeholder="/path/to/page.html (未実装の場合は空白可)">
            </div>
          <div>
            <label for="editCategory">カテゴリ:</label>
            <select id="editCategory" name="category">
              <option value="メイン">メイン</option>
              <option value="認証">認証</option>
              <option value="登録">登録</option>
              <option value="サポート">サポート</option>
              <option value="マイページ">マイページ</option>
              <option value="管理">管理</option>
            </select>
          </div>
          <div>
            <label for="editStatus">ステータス:</label>
            <select id="editStatus" name="status">
              <option value="complete">✅ 完全実装</option>
              <option value="in-progress">🔄 実装中</option>
              <option value="pending">⏳ 未実装</option>
            </select>
          </div>
          <div>
            <label for="editFunction">機能説明:</label>
            <textarea id="editFunction" name="function" rows="3"></textarea>
          </div>
          <div class="modal-buttons">
            <button type="button" class="btn-cancel" onclick="closeEditModal()">キャンセル</button>
            <button type="submit" class="btn-save">保存</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // ページデータの管理
      let pageData = {
        'index': {
          name: 'トップページ',
          category: 'メイン',
          status: 'complete',
          function: 'サービス一覧・カテゴリフィルタ',
          lastUpdated: '2025-10-23'
        }
      };

      // 編集モーダルを開く
      function editPage(pageId) {
        const modal = document.getElementById('editModal');
        const data = pageData[pageId] || {};
        
        document.getElementById('editPageName').value = data.name || '';
         document.getElementById('editUrl').value = data.url || '';
        document.getElementById('editCategory').value = data.category || 'メイン';
        document.getElementById('editStatus').value = data.status || 'complete';
        document.getElementById('editFunction').value = data.function || '';
        
        modal.style.display = 'block';
        modal.dataset.pageId = pageId;
      }

      // 編集モーダルを閉じる
      function closeEditModal() {
        document.getElementById('editModal').style.display = 'none';
      }

      // 新規追加モーダルを開く
      function openAddNewModal() {
        document.getElementById('addNewModal').style.display = 'flex';
      }

      // 新規追加モーダルを閉じる
      function closeAddNewModal() {
        document.getElementById('addNewModal').style.display = 'none';
        document.getElementById('addNewForm').reset();
      }

      // 削除モーダルを開く
      function deletePage(pageId) {
        document.getElementById('deleteModal').style.display = 'flex';
        document.getElementById('deleteModal').dataset.pageId = pageId;
      }

      // 削除モーダルを閉じる
      function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
      }

      // 削除を確認
      function confirmDelete() {
        const pageId = document.getElementById('deleteModal').dataset.pageId;
        
        // データから削除
        delete pageData[pageId];
        
         // Firebaseに保存
         saveToFirebase();
        
        // テーブルから行を削除
        const row = document.querySelector(`[data-page="${pageId}"]`);
        if (row) {
          row.closest('tr').remove();
        }
        
        // 統計情報を更新
        updateStats();
        
        // モーダルを閉じる
        closeDeleteModal();
      }

      // テーブルに新しい行を動的に追加
      function addNewRowToTable(pageId, pageData) {
        const table = document.querySelector('table tbody');
        const category = pageData.category;
        
        // ステータスの表示テキストとクラスを取得
        const statusText = getStatusText(pageData.status);
        const statusClass = getStatusClass(pageData.status);
        
           // URL表示を決定
           const urlDisplay = pageData.url || '未定';
           const linkDisplay = pageData.url ? 
             `<a href="http://localhost:5173${pageData.url}" class="url-link" target="_blank">${pageData.name}</a>` : 
             pageData.name;
           
        // 新しい行を作成
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
             <td>${linkDisplay}</td>
             <td><code class="code">${urlDisplay}</code></td>
          <td>${category}</td>
          <td><span class="${statusClass}">${statusText}</span></td>
          <td><span class="last-updated" data-page="${pageId}">${pageData.lastUpdated}</span></td>
          <td>${pageData.function}</td>
          <td>
            <button class="btn-edit" onclick="editPage('${pageId}')">編集</button>
            <button class="btn-update" onclick="updateTimestamp('${pageId}')">更新</button>
            <button class="btn-delete" onclick="deletePage('${pageId}')">削除</button>
          </td>
        `;
        
        // カテゴリに応じて適切な位置に追加
        insertRowByCategory(table, newRow, category);
      }

      // ステータステキストを取得
      function getStatusText(status) {
        const statusMap = {
          'complete': '✅ 完全実装',
          'in-progress': '🔄 実装中',
          'pending': '⏳ 未実装'
        };
        return statusMap[status] || status;
      }

      // ステータスクラスを取得
      function getStatusClass(status) {
        const statusClassMap = {
          'complete': 'status-complete',
          'in-progress': 'status-in-progress',
          'pending': 'status-pending'
        };
        return statusClassMap[status] || 'status-complete';
      }

      // カテゴリに応じて新規項目を適切な位置に配置
      function insertRowByCategory(table, newRow, category) {
        const categoryMap = {
          'メイン': '🏠 メインページ',
          '認証': '🔐 認証関連',
          '登録': '📋 登録関連',
          'サポート': '📞 サポート',
          'マイページ': '👤 マイページ関連',
             'カート': '🛒 カート',
             'レジ': '💳 レジ',
             'レポート': '📊 レポート',
          '管理': '🔧 管理画面'
        };
        
        const categoryHeader = categoryMap[category];
        const rows = Array.from(table.querySelectorAll('tr'));
        
        // カテゴリヘッダーを見つける
        let categoryHeaderIndex = -1;
        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          if (row.classList.contains('category-header') && row.textContent.includes(categoryHeader)) {
            categoryHeaderIndex = i;
            break;
          }
        }
        
        if (categoryHeaderIndex === -1) {
          // カテゴリヘッダーが見つからない場合は最後に追加
          table.appendChild(newRow);
          return;
        }
        
        // カテゴリの最後の項目を見つける
        let lastItemIndex = categoryHeaderIndex;
        for (let i = categoryHeaderIndex + 1; i < rows.length; i++) {
          const row = rows[i];
          if (row.classList.contains('category-header')) {
            // 次のカテゴリヘッダーに到達したら終了
            break;
          }
          lastItemIndex = i;
        }
        
        // カテゴリの最後の項目の次の位置に挿入
        const insertIndex = lastItemIndex + 1;
        const nextRow = table.children[insertIndex];
        if (nextRow) {
          table.insertBefore(newRow, nextRow);
        } else {
          table.appendChild(newRow);
        }
      }

      // 統計情報を更新
      function updateStats() {
        const totalPages = Object.keys(pageData).length;
        const statNumbers = document.querySelectorAll('.stat-number');
        
        // 実装済みページ数を更新
        if (statNumbers.length > 0) {
          statNumbers[0].textContent = totalPages;
        }
        
        // 完成率を計算（完全実装の項目数 / 総項目数 * 100）
        const completePages = Object.values(pageData).filter(page => page.status === 'complete').length;
        const completionRate = totalPages > 0 ? Math.round((completePages / totalPages) * 100) : 0;
        
           // プログレスバーを更新
           updateProgressBar(completePages, totalPages, completionRate);
         }
         
         // プログレスバーを更新
         function updateProgressBar(completed, total, percentage) {
           const progressFill = document.getElementById('progressFill');
           const progressPercentage = document.getElementById('progressPercentage');
           const completedCount = document.getElementById('completedCount');
           const totalCount = document.getElementById('totalCount');
           
           if (progressFill) {
             progressFill.style.width = percentage + '%';
           }
           
           if (progressPercentage) {
             progressPercentage.textContent = percentage + '%';
           }
           
           if (completedCount) {
             completedCount.textContent = completed;
           }
           
           if (totalCount) {
             totalCount.textContent = total;
           }
         }
         
         // テーブル行を動的に更新
         function updateTableRow(pageId, pageData) {
           const row = document.querySelector(`tr[data-page="${pageId}"]`);
           if (!row) return;
           
           // ステータスの表示テキストとクラスを取得
           const statusText = getStatusText(pageData.status);
           const statusClass = getStatusClass(pageData.status);
           
           // URL表示を決定
           const urlDisplay = pageData.url || '未定';
           const linkDisplay = pageData.url ? 
             `<a href="http://localhost:5173${pageData.url}" class="url-link" target="_blank">${pageData.name}</a>` : 
             pageData.name;
           
           // 行の内容を更新
           row.innerHTML = `
             <td>${linkDisplay}</td>
             <td><code class="code">${urlDisplay}</code></td>
             <td>${pageData.category}</td>
             <td><span class="${statusClass}">${statusText}</span></td>
             <td><span class="last-updated" data-page="${pageId}">${pageData.lastUpdated}</span></td>
             <td>${pageData.function}</td>
             <td>
               <button class="btn-edit" onclick="editPage('${pageId}')">編集</button>
               <button class="btn-update" onclick="updateTimestamp('${pageId}')">更新</button>
               <button class="btn-delete" onclick="deletePage('${pageId}')">削除</button>
             </td>
           `;
         }
         
         // 実際に存在するHTMLファイルを基にテーブルを構築
         function buildTableFromExistingFiles() {
           const table = document.querySelector('table tbody');
           
           // 実際に存在するHTMLファイルのリスト（実装状況を正確に判定）
           // 実装状況の判定基準:
           // - 'full': 完全実装（HTML + CSS + JavaScript + 機能動作）
           // - 'partial': 部分実装（HTML + CSS、JavaScript未実装）
           // - 'template': テンプレートのみ（HTMLのみ、機能未実装）
           // - 'missing': 未実装（ファイル存在しない）
           const existingFiles = [
             // メインページ
             { id: 'index', name: 'トップページ', url: '/index.html', category: 'メイン', status: 'complete', function: 'サービス一覧・カテゴリフィルタ', implementation: 'full' },
             { id: 'report', name: 'レポート', url: '/report.html', category: 'メイン', status: 'complete', function: '清掃レポート表示', implementation: 'full' },
             { id: 'mypage', name: 'マイページ', url: '/mypage.html', category: 'メイン', status: 'complete', function: 'ユーザー情報管理', implementation: 'full' },
             
             // 認証関連
             { id: 'signin', name: 'ログイン', url: '/signin.html', category: '認証', status: 'complete', function: 'ユーザーログイン', implementation: 'full' },
             { id: 'signup', name: '新規登録', url: '/signup.html', category: '認証', status: 'complete', function: 'ユーザー登録', implementation: 'full' },
             { id: 'signup2', name: '新規登録2', url: '/signup2.html', category: '認証', status: 'complete', function: '追加情報入力', implementation: 'full' },
             { id: 'signup3', name: '新規登録3', url: '/signup3.html', category: '認証', status: 'complete', function: '最終確認', implementation: 'full' },
             { id: 'reset-password', name: 'パスワードリセット', url: '/reset-password.html', category: '認証', status: 'complete', function: 'パスワード再設定', implementation: 'full' },
             
             // 登録関連
             { id: 'personal', name: '個人登録', url: '/registration/personal.html', category: '登録', status: 'complete', function: '個人情報登録', implementation: 'full' },
             { id: 'personal2', name: '個人登録2', url: '/registration/personal2.html', category: '登録', status: 'complete', function: '追加情報入力', implementation: 'full' },
             { id: 'corporation', name: '法人登録', url: '/registration/corporation.html', category: '登録', status: 'complete', function: '法人情報登録', implementation: 'full' },
             { id: 'corporation2', name: '法人登録2', url: '/registration/corporation2.html', category: '登録', status: 'complete', function: '追加情報入力', implementation: 'full' },
             { id: 'corporation3', name: '法人登録3', url: '/registration/corporation3.html', category: '登録', status: 'complete', function: '最終確認', implementation: 'full' },
             { id: 'complete', name: '登録完了', url: '/registration/complete.html', category: '登録', status: 'complete', function: '完了通知', implementation: 'full' },
             
             // サポート
             { id: 'inquiry-complete', name: 'お問い合わせ完了', url: '/inquiry/complete.html', category: 'サポート', status: 'complete', function: '完了通知', implementation: 'full' },
             
             // マイページ関連
             { id: 'mypage-info', name: '個人情報', url: '/mypage/info.html', category: 'マイページ', status: 'complete', function: '情報編集・更新', implementation: 'full' },
             { id: 'mypage-inquiry', name: 'お問い合わせ', url: '/mypage/inquiry.html', category: 'マイページ', status: 'complete', function: 'サポート問い合わせ', implementation: 'full' },
             
             // 管理画面
             { id: 'sitemap', name: 'サイトマップ', url: '/admin/sitemap.html', category: '管理', status: 'complete', function: 'サイトマップ表示', implementation: 'full' },
             { id: 'progress', name: '開発進捗状況', url: '/admin/progress.html', category: '管理', status: 'complete', function: '進捗ダッシュボード', implementation: 'full' }
           ];
           
           // カテゴリごとにグループ化
           const categories = {
             'メイン': '🏠 メインページ',
             '認証': '🔐 認証関連',
             '登録': '📋 登録関連',
             'サポート': '📞 サポート',
             'マイページ': '👤 マイページ関連',
             '管理': '🔧 管理画面'
           };
           
           // 各カテゴリのファイルを追加
           Object.keys(categories).forEach(category => {
             const categoryFiles = existingFiles.filter(file => file.category === category);
             if (categoryFiles.length > 0) {
               // カテゴリヘッダーを追加
               const headerRow = document.createElement('tr');
               headerRow.className = 'category-header';
               headerRow.innerHTML = `<td colspan="7">${categories[category]}</td>`;
               table.appendChild(headerRow);
               
               // カテゴリのファイルを追加
               categoryFiles.forEach(file => {
                 const row = document.createElement('tr');
                 row.setAttribute('data-page', file.id);
                 
                 // ステータスの表示テキストとクラスを取得
                 const statusText = getStatusText(file.status);
                 const statusClass = getStatusClass(file.status);
                 
                 // URL表示を決定
                 const urlDisplay = file.url;
                 const linkDisplay = `<a href="http://localhost:5173${file.url}" class="url-link" target="_blank">${file.name}</a>`;
                 
                 row.innerHTML = `
                   <td>${linkDisplay}</td>
                   <td><code class="code">${urlDisplay}</code></td>
                   <td>${file.category}</td>
                   <td><span class="${statusClass}">${statusText}</span></td>
                   <td><span class="last-updated" data-page="${file.id}">2025-01-27</span></td>
                   <td>${file.function}</td>
                   <td>
                     <button class="btn-edit" onclick="editPage('${file.id}')">編集</button>
                     <button class="btn-update" onclick="updateTimestamp('${file.id}')">更新</button>
                     <button class="btn-delete" onclick="deletePage('${file.id}')">削除</button>
                   </td>
                 `;
                 
                 table.appendChild(row);
                 
                 // pageDataに追加
                 pageData[file.id] = {
                   name: file.name,
                   url: file.url,
                   category: file.category,
                   status: file.status,
                   function: file.function,
                   implementation: file.implementation,
                   lastUpdated: '2025-01-27'
                 };
               });
             }
           });
           
           // Firebaseに保存
           saveToFirebase();
      }

      // タイムスタンプを更新
      function updateTimestamp(pageId) {
        const today = new Date().toISOString().split('T')[0];
        const element = document.querySelector(`[data-page="${pageId}"]`);
        if (element) {
          element.textContent = today;
        }
        
        // データも更新
        if (pageData[pageId]) {
          pageData[pageId].lastUpdated = today;
        }
        
         // Firebaseに保存
         saveToFirebase();
      }

      // フォーム送信処理
      document.getElementById('editForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const pageId = document.getElementById('editModal').dataset.pageId;
        const formData = new FormData(this);
        
        // データを更新
        pageData[pageId] = {
          name: formData.get('pageName'),
             url: formData.get('url') || '',
          category: formData.get('category'),
          status: formData.get('status'),
          function: formData.get('function'),
          lastUpdated: new Date().toISOString().split('T')[0]
        };
        
           // Firebaseに保存
           saveToFirebase();
           
           // テーブル行を動的に更新
           updateTableRow(pageId, pageData[pageId]);
           
           // 統計情報を更新
           updateStats();
        
        // モーダルを閉じる
        closeEditModal();
      });

      // 新規項目追加フォーム送信処理
      document.getElementById('addNewForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        
        // 新しいページIDを生成
        const newPageId = 'new_' + Date.now();
        
        // 新しいデータを作成
        const newPageData = {
          name: formData.get('pageName'),
          url: formData.get('url'),
          category: formData.get('category'),
          status: formData.get('status'),
          function: formData.get('function'),
          lastUpdated: new Date().toISOString().split('T')[0]
        };
        
        // データに追加
        pageData[newPageId] = newPageData;
        
         // Firebaseに保存
         saveToFirebase();
        
        // テーブルに新しい行を動的に追加
        addNewRowToTable(newPageId, newPageData);
        
        // 統計情報を更新
        updateStats();
        
        // モーダルを閉じる
        closeAddNewModal();
      });

      // ページ読み込み時にデータを復元
       window.addEventListener('load', async function() {
         await loadFromFirebase();
        
        // 実際に存在するHTMLファイルを基にテーブルを構築
        buildTableFromExistingFiles();
        
        // 新規追加された項目を復元
        Object.keys(pageData).forEach(pageId => {
          if (pageId.startsWith('new_')) {
            const data = pageData[pageId];
            // テーブルに既に存在するかチェック
            const existingRow = document.querySelector(`[data-page="${pageId}"]`);
            if (!existingRow) {
              addNewRowToTable(pageId, data);
            }
          } else {
            // 既存のデータを復元
            const data = pageData[pageId];
            const element = document.querySelector(`[data-page="${pageId}"]`);
            if (element && data.lastUpdated) {
              element.textContent = data.lastUpdated;
            }
          }
        });
        
        // 統計情報を更新
        updateStats();
        
        // 初期統計情報を設定
        initializeStats();
      });

      // 初期統計情報を設定
      function initializeStats() {
        // 既存のページデータから統計を計算
        const existingPages = document.querySelectorAll('table tbody tr:not(.category-header)');
        const totalExistingPages = existingPages.length;
        
        // 既存の完全実装ページ数を計算
        const completeExistingPages = Array.from(existingPages).filter(row => {
          const statusSpan = row.querySelector('.status-complete');
          return statusSpan && statusSpan.textContent.includes('✅ 完全実装');
        }).length;
        
        // 統計情報を更新
        const statNumbers = document.querySelectorAll('.stat-number');
        if (statNumbers.length > 0) {
          statNumbers[0].textContent = totalExistingPages;
        }
           
           // プログレスバーを更新
          const completionRate = totalExistingPages > 0 ? Math.round((completeExistingPages / totalExistingPages) * 100) : 0;
           updateProgressBar(completeExistingPages, totalExistingPages, completionRate);
         }

         // Firebaseに保存する関数
         async function saveToFirebase() {
           try {
             if (window.firebaseSet && window.firebaseRef && window.firebaseDatabase) {
               await window.firebaseSet(window.firebaseRef(window.firebaseDatabase, 'pageData'), pageData);
               console.log('Firebaseに保存しました');
             } else {
               // Firebaseが利用できない場合はローカルストレージに保存
               localStorage.setItem('pageData', JSON.stringify(pageData));
               console.log('ローカルストレージに保存しました');
             }
           } catch (error) {
             console.error('保存エラー:', error);
             // エラーの場合はローカルストレージに保存
             localStorage.setItem('pageData', JSON.stringify(pageData));
           }
         }

         // Firebaseからデータを読み込む関数
         async function loadFromFirebase() {
           try {
             if (window.firebaseGet && window.firebaseRef && window.firebaseDatabase) {
               const snapshot = await window.firebaseGet(window.firebaseRef(window.firebaseDatabase, 'pageData'));
               if (snapshot.exists()) {
                 pageData = snapshot.val();
                 console.log('Firebaseから読み込みました');
                 return true;
               }
             }
           } catch (error) {
             console.error('読み込みエラー:', error);
           }
           
           // Firebaseが利用できない場合はローカルストレージから読み込み
           const savedData = localStorage.getItem('pageData');
           if (savedData) {
             pageData = JSON.parse(savedData);
             console.log('ローカルストレージから読み込みました');
             return true;
           }
           return false;
      }

      // モーダル外クリックで閉じる
      document.getElementById('editModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeEditModal();
        }
      });

      // 新規追加モーダル外クリックで閉じる
      document.getElementById('addNewModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeAddNewModal();
        }
      });

      // 削除モーダル外クリックで閉じる
      document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeDeleteModal();
        }
      });
    </script>
  </body>
</html>
